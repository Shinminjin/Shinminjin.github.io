---
title: Item 13 - clone ì¬ì •ì˜ëŠ” ì£¼ì˜í•´ì„œ ì§„í–‰í•˜ë¼
date: 2024-08-17 10:08:00 +0900
categories: [ì´í™í‹°ë¸Œ ìë°”, chapter2]
tags: [ì´í™í‹°ë¸Œ ìë°”]
---

`clone` ë©”ì„œë“œê°€ ì„ ì–¸ëœ ê³³ì´ Cloneableì´ ì•„ë‹Œ Objectì´ë©°, ì ‘ê·¼ ì œí•œìê°€ `protected`ì´ê¸° ë•Œë¬¸ì— Cloneableì„ êµ¬í˜„í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œëŠ” ì™¸ë¶€ ê°ì²´ì—ì„œ `clone` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ì—†ë‹¤.

> ì´ëŸ° ë¬¸ì œì ì—ë„ ë¶ˆêµ¬í•˜ê³ , **Cloneable ë°©ì‹**ì€ ë„ë¦¬ ì“°ì¸ë‹¤. ì´ì— ëŒ€í•´ ì•Œì•„ë³´ì.


## **Cloneable ì¸í„°í˜ì´ìŠ¤**
- Objectì˜ protected ë©”ì„œë“œì¸ `clone`ì˜ ë™ì‘ ë°©ì‹ì„ ê²°ì •í•œë‹¤.
- Cloneableì„ êµ¬í˜„í•œ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ `clone` í˜¸ì¶œ ì‹œ, ê·¸ ê°ì²´ í•„ë“œë“¤ì„ í•˜ë‚˜í•˜ë‚˜ ë³µì‚¬í•œ ê°ì²´ë¥¼ ë°˜í™˜

```java
public class Car implements Cloneable {
    private List<String> features;
    private String model;
    private int year;
    private double price;
    
    public Car(List<String> features, String model, int year, double price) {
        this.features = features;
        this.model = model;
        this.year = year;
        this.price = price;
    }

    @Override // clone() êµ¬í˜„
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
    
    // getter, setter ...
}
```

### **ğŸš‘ ì£¼ì˜ì‚¬í•­**
- **ì• ë§¤ëª¨í˜¸í•œ clone ê·œì•½**
    - x.clone() != x ë°˜ë“œì‹œ true â†’ ë³µì‚¬í•œ ê°ì²´ëŠ” ì›ë³¸ ê°ì²´ì™€ ë…ë¦½ì 
    - x.clone().getClass() == x.getClass() ë°˜ë“œì‹œ true â†’ ë³µì‚¬í•œ ê°ì²´ì™€ ì›ë³¸ ê°ì²´ëŠ” ê°™ì€ í´ë˜ìŠ¤
    - x.clone().equals(x) trueê°€ ì•„ë‹ ìˆ˜ë„ ìˆë‹¤. (ì¼ë°˜ì ìœ¼ë¡œ ì°¸ì´ì§€ë§Œ, í•„ìˆ˜ëŠ” ì•„ë‹˜)

- `clone` ë©”ì„œë“œëŠ” **í”¼ìƒì  ë³µì‚¬**ë¥¼ ì§€ì›í•œë‹¤.
    - í”¼ìƒì  ë³µì‚¬ë€,Â **ë‹¨ìˆœí•˜ê²Œ ì°¸ì¡°ë§Œ ë³µì‚¬**í•œë‹¤ê³  ì´í•´í•˜ë©´ ì‰½ë‹¤.
    - ë°°ì—´ì„ ì˜ˆë¡œ ë“¤ë©´, ë‚´ë¶€ ìš”ì†Œ í•˜ë‚˜í•˜ë‚˜ ë³µì‚¬ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë°°ì—´ì˜ ì°¸ì¡°ë¥¼ ë³µì‚¬í•œë‹¤.

```java
public static void main(String[] args) throws CloneNotSupportedException {
    List<String> features = Arrays.asList("Navigation System", "Leather Seats");
    Car car = new Car(features, "Tesla Model S", 2024, 79999.99);
    Car clonedCar = (Car) car.clone();

    System.out.println("ì›ë³¸ ì°¨ ê°€ê²©: " + car.getPrice()); // 79999.99
    System.out.println("ë³µì œëœ ì°¨ ê°€ê²©: " + clonedCar.getPrice()); // 79999.99

    System.out.println("ì›ë³¸ ì°¨ ê¸°ëŠ¥: " + car.getFeatures()); // [Navigation System, Leather Seats]
    System.out.println("ë³µì œëœ ì°¨ ê¸°ëŠ¥: " + clonedCar.getFeatures()); // [Navigation System, Leather Seats]

    // ë˜‘ê°™ì€ ì°¸ì¡°ë¥¼ ê°€ì§„ë‹¤!
    System.out.println(System.identityHashCode(car.getPrice()));
    System.out.println(System.identityHashCode(clonedCar.getPrice()));

    // ë˜‘ê°™ì€ ì°¸ì¡°ë¥¼ ê°€ì§„ë‹¤!
    System.out.println(System.identityHashCode(car.getFeatures()));
    System.out.println(System.identityHashCode(clonedCar.getFeatures()));
}
```

## **clone ë©”ì„œë“œ ì¬ì •ì˜ ì‹œ ë¬¸ì œì **

> **[clone ë©”ì„œë“œì˜ íŠ¹ì´í•œ ë©”ì»¤ë‹ˆì¦˜] ìƒì„±ìë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šê³ ë„ ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.**


ë¶ˆë³€ ê°ì²´ë¼ë©´ ë‹¤ìŒìœ¼ë¡œ ì¶©ë¶„í•˜ë‹¤.
- Cloenable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ , `clone` ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•œë‹¤.
- ì´ë•Œ, super.clone()ì„ ì‚¬ìš©í•œë‹¤.

```java
@Override
public Car clone() {
    try {
        return (Car) super.clone();
    } catch (CloneNotSupportedException e) {
        throw new AssertionError();
    }
}
```

### **1ï¸âƒ£ ê°€ë³€ ê°ì²´ë¥¼ ì°¸ì¡°**

> **ê°€ë³€ ê°ì²´ë¥¼ ì°¸ì¡°í•˜ëŠ” ê°ì²´**ë¥¼ ë³µì‚¬í•˜ëŠ” ê²½ìš°, ë¬¸ì œê°€ ë°œìƒí•œë‹¤.


- **`clone`**ì„ ì‚¬ìš©í•´ì„œ ë³µì‚¬í•œ ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  í•„ë“œëŠ” ê°™ì€ ì°¸ì¡°ê°’ì„ ê°€ì§„ë‹¤.
    - ì›ë³¸ê³¼ ë³µì‚¬ë³¸ì´ ìˆì„ ë•Œ,Â **ë³µì‚¬ë³¸ì˜ ê°€ë³€ ê°ì²´ë¥¼ ìˆ˜ì •í•˜ë©´ ì›ë³¸ ê°’ë„ ìˆ˜ì •ëœë‹¤**ëŠ” ì˜ë¯¸ë‹¤.
- ìƒì„±ìë¥¼ ì‚¬ìš©í•˜ë©´ ì´ëŸ° ë¬¸ì œê°€ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
    - í•˜ì§€ë§Œ ìœ ì‚¬ ìƒì„±ìì¸Â **`clone`**ì€Â **ê°ì²´ì˜ ë¶ˆë³€ì„±ì„ ë³´ì¥í•  ìˆ˜ ì—†ë‹¤.** 
    

ë‹¤ìŒê³¼ ê°™ì´ ì¬ì •ì˜í•´ì„œ ë¶ˆë³€ì„±ì„ ë³´ì¥í•˜ì.

```java
@Override
public Car clone() {
    try {
        Car result = (Car) super.clone();
        // ê¹Šì€ ë³µì‚¬ë¥¼ ìœ„í•´ features ë¦¬ìŠ¤íŠ¸ë¥¼ ìƒˆë¡œ ìƒì„±
        result.features = new ArrayList<>(this.features);
        return result;
    } catch (CloneNotSupportedException e) {
        throw new AssertionError("Cloning not supported", e);
    }
}
```


### **2ï¸âƒ£ ë³µì¡í•œ ê°€ë³€ ê°ì²´ë¥¼ ì°¸ì¡°**
- ë‚´ë¶€ ì—”íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ íŠ¹ì • ê°’ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•œ `HashTable`ì´ë‹¤.
- **`clone`**ì„ ì‚¬ìš©í•˜ë©´Â **ë³µì‚¬ë³¸ì´ ì›ë³¸ì˜ ì—”íŠ¸ë¦¬ë¥¼ í†µí•´ì„œ ê°’ì„ ì°¾ê¸° ë•Œë¬¸ì— ì˜ëª»ëœ ê°’ì„ ì°¾ê²Œ ëœë‹¤**.

```java
public class HashTable implements Cloneable {
    private Entry[] buckets;

    private static class Entry {
        final Object key;
        Object value;
        Entry next;

        Entry(Object key, Object value, Entry next) {
            this.key = key;
            this.value = value;
            this.next = next;
        }

    // getter, setter ...
}
```

ë‹¤ìŒê³¼ ê°™ì´ ì¬ê·€ì ìœ¼ë¡œ êµ¬í˜„í•´ì„œ í•´ê²°í•  ìˆ˜ë„ ìˆë‹¤.

```java
Entry deepCopy() {
    return new Entry(key, value,
    	next == null ? null : next.deepCopy());
}

@Override
public HashTable clone() {
    try {
        HashTable result = (HashTable) super.clone();
        result.buckets = new Entry[buckets.length];
        for (int i = 0; i < buckets.length; i++) {
            if (buckets[i] != null) {
                result.buckets[i] = buckets[i].deepCopy();
            }
        }
        return result;
    } catch (CloneNotSupportedException e) {
        throw new AssertionError();
    }
}
```

- ì¬ê·€í˜¸ì¶œë¡œ ì—°ê²°ë¦¬ìŠ¤íŠ¸ì˜ ì›ì†Œìˆ˜ë§Œí¼ ìŠ¤íƒ í”„ë ˆì„ì„ ì†Œë¹„í•œë‹¤. â†’ ìŠ¤íƒ ì˜¤ë²„í”Œë¡œìš° ë°œìƒ ê°€ëŠ¥ì„±!

ì¬ê·€ í˜¸ì¶œ ëŒ€ì‹  ì•„ë˜ì˜ ì½”ë“œì²˜ëŸ¼ ë°˜ë³µìë¡œ ìˆœíšŒí•˜ì.
```java
// ê°œì„ ëœ deepCopy()
Entry deepCopy() {
    Entry result = new Entry(key, value, next);
    for (Entry p = result; p.next != null; p = p.next) {
        p.next = new Entry(p.next.key, p.next.value, p.next.next);
    }
    return result;
}
```
- ë‹¤ë¥¸ ë°©ë²•ìœ¼ë¡œ ê³ ìˆ˜ì¤€ ë©”ì„œë“œë¥¼ ë§Œë“¤ì–´ì„œ ë³µì œí•˜ëŠ” ë°©ë²•ë„ ìˆë‹¤.
    - í•˜ì§€ë§Œ ì¢‹ì€ ì„±ëŠ¥ì„ ê¸°ëŒ€í•  ìˆ˜ ì—†ê³ ,Â CloneableÂ ì•„í‚¤í…ì²˜ì™€ ì–´ìš¸ë¦¬ì§€ ì•ŠëŠ” ë°©ë²•ì´ë‹¤.


### **3ï¸âƒ£ ì¬ì •ì˜ ê°€ëŠ¥í•œ ë©”ì„œë“œ**
> `clone` ë©”ì„œë“œì—ì„œ **ì¬ì •ì˜ ê°€ëŠ¥í•œ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²½ìš°**, ë¬¸ì œê°€ ë°œìƒí•œë‹¤.

- í•˜ìœ„ í´ë˜ìŠ¤ì—ì„œÂ `super.clone()` í˜¸ì¶œ ì‹œ, ìƒìœ„ í´ë˜ìŠ¤ì˜Â `clone` ë©”ì„œë“œì—ì„œ **í•˜ìœ„ í´ë˜ìŠ¤ì˜Â ì¬ì •ì˜ ëœÂ ë©”ì„œë“œ**ê°€ í˜¸ì¶œëœë‹¤.
- ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ë³µì œë³¸ì´ ë§Œë“¤ì–´ì§ˆ ê°€ëŠ¥ì„±ì´ ìƒê¸´ë‹¤.

```java
public class Parent implements Cloneable {
    protected int value = 0;

    @Override
    public Parent clone() {
        super.clone();
        // ì¬ì •ì˜ ê°€ëŠ¥í•œ ë©”ì„œë“œ í˜¸ì¶œ
        overrideableMethod();
        ...
    }

    public void overrideableMethod() {
        value += 1;
    }
}

public class Child extends Parent {
    @Override
    public Parent clone() {
        super.clone();
        ...
    }

    @Override
    public void overrideableMethod() {
        value += 2;
    }
}

```

`Child.clone() -> Parent.clone() -> Child.overrideableMethod()`Â ìˆœìœ¼ë¡œ í˜¸ì¶œëœë‹¤. 

```java
Parent instance = new Child();
instance.clone();
```

> ìƒìœ„(Parent) ë ˆë²¨ì—ì„œ ì¡°ì •ë˜ì–´ì•¼ í•  ê°’ë“¤ì´ **í•˜ìœ„(Child)ì— ì¬ì •ì˜ëœ ë©”ì„œë“œì˜ ë™ì‘ ë°©ì‹**ëŒ€ë¡œ ì¡°ì •ë˜ê³ , ì˜ë„ì¹˜ ì•Šì€ ë°©í–¥ìœ¼ë¡œ ê°’ì´ ë³µì œë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.

- `clone` ë©”ì„œë“œì—ì„œëŠ” ì¬ì •ì˜ ê°€ëŠ¥í•œ ë©”ì„œë“œëŠ” í˜¸ì¶œí•´ì„œëŠ” ì•ˆ ëœë‹¤.
- ë©”ì„œë“œ í˜¸ì¶œì´ í•„ìš”í•˜ë©´ private ë„ìš°ë¯¸ ë©”ì„œë“œë¡œ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.


## **clone ë©”ì„œë“œ ëŒ€ì‹  ê¶Œì¥í•˜ëŠ” ë°©ë²•**
> **ë³µì‚¬ ìƒì„±ì**(ìì‹ ê³¼ ê°™ì€ í´ë˜ìŠ¤ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸ìˆ˜ë¡œ ë°›ëŠ” ìƒì„±ì)ì™€ **ë³µì‚¬ íŒ©í„°ë¦¬**ë¥¼ ì‚¬ìš©í•˜ì.

- ìƒì„±ìë¥¼ ì“°ì§€ ì•Šìœ¼ë©°, ëª¨í˜¸í•œ ê·œì•½, ë¶ˆí•„ìš”í•œ ê²€ì‚¬ ì˜ˆì™¸, final ìš©ë²• ë°©í•´ ë“±ì—ì„œ ë²—ì–´ë‚  ìˆ˜ ìˆë‹¤.
- í•´ë‹¹ í´ë˜ìŠ¤ê°€ êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¸ìˆ˜ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.
- ë²”ìš© ì»¬ë ‰ì…˜ êµ¬í˜„ì²´ëŠ” Collectionì´ë‚˜ Map íƒ€ì…ì„ ë°›ëŠ” ìƒì„±ìë¥¼ ì œê³µí•˜ëŠ”ë°, ì›ë³¸ êµ¬í˜„ íƒ€ì…ì— ì–½ë§¤ì´ì§€ ì•Šê³  í´ë¼ì´ì–¸íŠ¸ê°€ ë³µì œë³¸ì˜ íƒ€ì…ì„ ê²°ì •í•  ìˆ˜ ìˆë‹¤.
    - ex. HashSet ê°ì²´ së¥¼ TreeSet íƒ€ì…ìœ¼ë¡œ ë³µì œ ê°€ëŠ¥í•˜ë‹¤. â†’ `new TreeSet<>(s)`
- **ì½ì–´ë³¼ ê²ƒ)** Josh Bloch on Design, [â€œCopy Constructor versus Cloningâ€](https://www.artima.com/articles/josh-bloch-on-design)

```java
// ë³µì‚¬ ìƒì„±ì
public Stack(Stack s) {
    this.elements = s.elements.clone();
    this.size = s.size;
}

// ë³µì‚¬ íŒ©í„°ë¦¬
public static Stack newInstance(Stack s) {
    return new Stack(s.elements, s.size);
}
```


## **ğŸ’¡ í•µì‹¬ ì •ë¦¬**
- ë°°ì—´ë§Œì´ `clone()` ë©”ì„œë“œë¥¼ ì œëŒ€ë¡œ ì‚¬ìš©í•˜ëŠ” ìœ ì¼í•œ ì˜ˆì‹œ.
- ë‚˜ë¨¸ì§€ëŠ” ì›¬ë§Œí•˜ë©´ **ë³µì‚¬ ìƒì„±ì**ì™€ **ë³µì‚¬ íŒ©í„°ë¦¬**ë¥¼ ì´ìš©í•˜ì.


## **ì°¸ê³  ğŸ•¶ï¸) Unchecked Exception**
- ë‹¨ìˆœíˆ ì²˜ë¦¬í•˜ê¸° ì‰½ê³  í¸í•˜ë‹¤ëŠ” ì´ìœ ë§Œìœ¼ë¡œ RuntimeExceptionì„ ì„ íƒí•˜ì§€ëŠ” ë§ì.
- [Guideline](https://docs.oracle.com/javase/tutorial/essential/exceptions/runtime.html): í´ë¼ì´ì–¸íŠ¸ê°€ í•´ë‹¹ ì˜ˆì™¸ ìƒí™©ì„ ë³µêµ¬í•  ìˆ˜ ìˆë‹¤ë©´ ê²€ì‚¬ ì˜ˆì™¸ë¥¼ ì‚¬ìš©í•˜ê³ , í•´ë‹¹ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ì•„ë¬´ê²ƒë„ í•  ìˆ˜ ì—†ë‹¤ë©´, ë¹„ê²€ì‚¬ ì˜ˆì™¸ë¡œ ë§Œë“ ë‹¤.
