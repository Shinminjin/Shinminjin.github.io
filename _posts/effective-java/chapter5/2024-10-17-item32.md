---
title: Item 32 - ì œë„¤ë¦­ê³¼ ê°€ë³€ì¸ìˆ˜ë¥¼ í•¨ê»˜ ì“¸ ë•ŒëŠ” ì‹ ì¤‘í•˜ë¼
date: 2024-10-17 20:20:00 +0900
categories: [ì´í™í‹°ë¸Œ ìë°”, chapter5]
tags: [ì´í™í‹°ë¸Œ ìë°”]
---

## **ê°€ë³€ì¸ìˆ˜ì™€ ì œë„¤ë¦­**

> **ê°€ë³€ì¸ìˆ˜ ë©”ì„œë“œ**ì™€ **ì œë„¤ë¦­**ì€ ìë°” 5 ë•Œ í•¨ê»˜ ì¶”ê°€ë˜ì—ˆì§€ë§Œ **ì˜ ì–´ìš°ëŸ¬ì§€ì§€ ì•ŠëŠ”ë‹¤. ğŸ™…**


**ê°€ë³€ì¸ìˆ˜ ë©”ì„œë“œ êµ¬í˜„ë°©ì‹ì˜ í—ˆì  ğŸ¤”**

- ê°€ë³€ ì¸ìˆ˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ê°€ë³€ì¸ìˆ˜ë¥¼ ë‹´ê¸° ìœ„í•œ ë°°ì—´ì´ ìë™ìœ¼ë¡œ í•˜ë‚˜ ë§Œë“¤ì–´ì§„ë‹¤.
- ì´ ë°°ì—´ì„ ë‚´ë¶€ë¡œ ê°ì·„ì–´ì•¼ í–ˆëŠ”ë°, í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œí•´ë²„ë ¤ì„œ **ì œë„¤ë¦­ì´ë‚˜ ë§¤ê°œë³€ìˆ˜í™” íƒ€ì…ì´ í¬í•¨ë˜ë©´ ì»´íŒŒì¼ ê²½ê³ ê°€ ë°œìƒí•œë‹¤.**

> **ì‹¤ì²´í™” ë¶ˆê°€ íƒ€ì…ì€ ëŸ°íƒ€ì„ì—ëŠ” ì»´íŒŒì¼íƒ€ì„ë³´ë‹¤ íƒ€ì…ê´€ë ¨ ì •ë³´ë¥¼ ì ê²Œ ë‹´ê³  ìˆë‹¤. (ì•„ì´í…œ 28)**


ê·¸ë¦¬ê³  ê±°ì˜ ëª¨ë“  ì œë„¤ë¦­ê³¼ ë§¤ê°œë³€ìˆ˜í™” íƒ€ì…ì€ ì‹¤ì²´í™”ë˜ì§€ ì•ŠëŠ”ë‹¤.

**ì œë„¤ë¦­ê³¼ ê°€ë³€ì¸ìˆ˜(varargs)ë¥¼ í˜¼ìš©í•˜ë©´ íƒ€ì… ì•ˆì •ì„±ì´ ê¹¨ì§„ë‹¤.**

```java
public void print(List<String> ... stringList) {
    List<Integer> intList = List.of(42);
    Object[] objects = stringList;
    objects[0] = intList; // í™ì˜¤ì—¼ ë°œìƒ (ë§¤ê°œë³€ìˆ˜í™” íƒ€ì… ë³€ìˆ˜ê°€ íƒ€ì…ì´ ë‹¤ë¥¸ ê°ì²´ ì°¸ì¡°í•´ì„œ)
    String s = stringList[0].get(0); // ClassCastException
}
```

ì œë„¤ë¦­ ë°°ì—´ì„ í”„ë¡œê·¸ë˜ë¨¸ê°€ ì§ì ‘ ìƒì„±í•˜ëŠ” ê±´ í—ˆìš©í•˜ì§€ ì•Šìœ¼ë©´ì„œ, **ì œë„¤ë¦­ varargs ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ë©”ì„œë“œë¥¼ ì„ ì–¸í•  ìˆ˜ ìˆê²Œ í•œ ì´ìœ ëŠ” ë¬´ì—‡ì¼ê¹Œ? *(ìœ„ ì½”ë“œëŠ” ì˜¤ë¥˜ ëŒ€ì‹  ê²½ê³ ë¡œ ëë‚œë‹¤.)***

- **ì œë„¤ë¦­ì´ë‚˜ ë§¤ê°œë³€ìˆ˜í™” íƒ€ì…ì˜ varargs ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ë©”ì„œë“œ**ê°€ ì‹¤ë¬´ì—ì„œ ë§¤ìš° ìœ ìš©í•˜ë¯€ë¡œ.
- ex) `Arrays.asList(Tâ€¦ a)`, `Collections.addAll(Collection<? super T> c)`


## **@SafeVarargs ì• ë„ˆí…Œì´ì…˜**
- ìë°” 7ë¶€í„° **`@SafeVarargs` ì• ë„ˆí…Œì´ì…˜**ì´ ì¶”ê°€ë˜ì—ˆë‹¤.
- ì œë„¤ë¦­ ê°€ë³€ì¸ìˆ˜ ë©”ì„œë“œ ì‘ì„±ìê°€ í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ë°œìƒí•˜ëŠ” ê²½ê³ ë¥¼ ìˆ¨ê¸¸ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.
- `@SafeVarargs` ì• ë„ˆí…Œì´ì…˜ì€ ë©”ì„œë“œ ì‘ì„±ìê°€ ê·¸ ë©”ì„œë“œê°€ íƒ€ì… ì•ˆì „í•¨ì„ ë³´ì¥í•˜ëŠ” ì¥ì¹˜ë‹¤.


**ì œë„¤ë¦­ varargs ë©”ì„œë“œê°€ íƒ€ì… ì•ˆì „í•˜ë ¤ë©´..?**
- varargs ë§¤ê°œë³€ìˆ˜ ë°°ì—´ì— ì•„ë¬´ê²ƒë„ ì €ì¥í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ê·¸ ë°°ì—´ì„ ì‹ ë¢°í•  ìˆ˜ ì—†ëŠ” ì½”ë“œì— ë…¸ì¶œí•˜ì§€ ì•ŠëŠ”ë‹¤.


```java
// ì œë„¤ë¦­ varargs ë§¤ê°œë³€ìˆ˜ ë°°ì—´ì— ë‹¤ë¥¸ ë©”ì„œë“œê°€ ì ‘ê·¼í•˜ë„ë¡ í—ˆìš©í•˜ë©´ ì•ˆì „í•˜ì§€ ì•Šë‹¤..
public class PickTwo {
    static <T> T[] toArray(T... args) {
        return args;
    }
	
    static <T> T[] pickTwo(T a, T b, T c) {
        switch(ThreadLocalRandom.current().nextInt(3)) {
            case 0: return toArray(a, b);
            case 1: return toArray(a, c);
            case 2: return toArray(b, c);
        }
        throw new AssertionError(); // Can't get here.
    }
	
	public static void main(String[] args) {
        // Object[]ëŠ” String[]ì˜ í•˜ìœ„íƒ€ì…ì´ ì•„ë‹ˆë¯€ë¡œ  ClassCastException ë°œìƒ
        String[] attributes = pickTwo("Good", "Fast", "Cheap");
        System.out.prinln(Arrays.toString(attributes));
    }
}
```

## **ì œë„¤ë¦­ varargs ë§¤ê°œë³€ìˆ˜ë¥¼ ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ë²•**

- **ì œë„¤ë¦­ì´ë‚˜ ë§¤ê°œë³€ìˆ˜í™” íƒ€ì…ì˜ varargs ë§¤ê°œë³€ìˆ˜ë¥¼ ë°›ëŠ” ë©”ì„œë“œì— `@SafeVarargs`ë¥¼ ë‹¬ì•„ë¼.**
    - ì¦‰, ì•ˆì „í•œ ë©”ì„œë“œë§Œ ì‘ì„±í•´ë¼.
- **ì•„ì´í…œ 28ì˜ ì¡°ì–¸ì„ ë”°ë¼ varargs ë§¤ê°œë³€ìˆ˜ë¥¼ List ë§¤ê°œë³€ìˆ˜ë¡œ ë°”ê¿€ ìˆ˜ ë„ ìˆë‹¤.**

```java
@SafeVarargs
static <T> List<T> flatten(List<? extends T>... lists) {
    // ...
}

// ìœ„ ë©”ì„œë“œë¥¼ List ë§¤ê°œë³€ìˆ˜ë¡œ ëŒ€ì²´
static <T> List<T> flatten(List<List<? extends T>> lists) {
    // ...
}
```

**ìœ„ì˜ pickTwoë¥¼ List ë²„ì „ìœ¼ë¡œ ë°”ê¾¸ë©´?**

ì œë„¤ë¦­ì€ ë°°ì—´ê³¼ ë‹¤ë¥´ê²Œ ëŸ°íƒ€ì„ ì‹œì ì— íƒ€ì… ì •ë³´ë¥¼ ì†Œê±°í•˜ë¯€ë¡œ ìºìŠ¤íŒ… ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ë‹¤.

```java
static <T> List<T> pickTwo(T a, T b, T c) {
    System.out.println(a.getClass().getName());
    switch (ThreadLocalRandom.current().nextInt(3)) {
        case 0:
            return Arrays.asList(a, b);
        case 1:
            return Arrays.asList(b, c);
        case 2:
            return Arrays.asList(a, c);
    }
    throw new AssertionError();
}

public static void main(String[] args) {
    String[] attributes = pickTwo("Good", "Fast", "Cheap");
}
```


## **ğŸ’¡ í•µì‹¬ ì •ë¦¬**
- ê°€ë³€ì¸ìˆ˜ì™€ ì œë„¤ë¦­ì€ ê¶í•©ì´ ì¢‹ì§€ ì•Šë‹¤. ğŸ™…
    - ê°€ë³€ì¸ìˆ˜ ê¸°ëŠ¥ì€ ë°°ì—´ì„ ë…¸ì¶œí•˜ì—¬ ì¶”ìƒí™”ê°€ ì™„ë²½í•˜ì§€ ëª»í•˜ë‹¤.
    - ë°°ì—´ê³¼ ì œë„¤ë¦­ì˜ íƒ€ì… ê·œì¹™ì´ ì„œë¡œ ë‹¤ë¥´ë‹¤.
- ì œë„¤ë¦­ varargs ë§¤ê°œë³€ìˆ˜ëŠ” íƒ€ì… ì•ˆì „í•˜ì§„ ì•Šì§€ë§Œ, í—ˆìš©ëœë‹¤. (ìœ ìš©í•˜ê¸° ë•Œë¬¸)
- ì œë„¤ë¦­ varargs ë§¤ê°œë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìœ¼ë©´, ê·¸ ë©”ì„œë“œê°€ íƒ€ì… ì•ˆì „í•œì§€ í™•ì¸í•œ í›„ `@SafeVarargs`ë¥¼ ë‹¬ì.


## **ì°¸ê³  ğŸ•¶ï¸**

### **ì“°ë ˆë“œ ì§€ì—­ ë³€ìˆ˜**

- [https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html](https://docs.oracle.com/javase/8/docs/api/java/lang/ThreadLocal.html)
- ëª¨ë“  ë©¤ë²„ ë³€ìˆ˜ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì—¬ëŸ¬ ì“°ë ˆë“œì—ì„œ ê³µìœ í•´ì„œ ì“°ì¼ ìˆ˜ ìˆë‹¤.
- ì´ë•Œ ì“°ë ˆë“œ ì•ˆì „ì„±ê³¼ ê´€ë ¨ëœ ì—¬ëŸ¬ ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤.
    - ê²½í•© ë˜ëŠ” ê²½ìŸì¡°ê±´ (Race-Condition)
    - êµì°©ìƒíƒœ (deadlock)
    - Livelock
- ë™ê¸°í™”ë¥¼ í•˜ì§€ ì•Šì•„ë„ í•œ ì“°ë ˆë“œì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ê°’ì´ê¸° ë•Œë¬¸ì— ì•ˆì „í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
- í•œ ì“°ë ˆë“œ ë‚´ì—ì„œ ê³µìœ í•˜ëŠ” ë°ì´í„°ë¡œ, ë©”ì„œë“œ ë§¤ê°œë³€ìˆ˜ì— ë§¤ë²ˆ ì „ë‹¬í•˜ì§€ ì•Šê³  ì „ì—­ ë³€ìˆ˜ì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.


### **ìŠ¤ë ˆë“œ ì§€ì—­ ëœë¤ê°’ ìƒì„±ê¸°**
- [https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadLocalRandom.html](https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ThreadLocalRandom.html)
- `java.util.Random`ì€ ë©€í‹° ìŠ¤ë ˆë“œ í™˜ê²½ì—ì„œ CAS(CompareAndSet)ë¡œ ì¸í•´ ì‹¤íŒ¨ í•  ê°€ëŠ¥ì„±ì´ ìˆê¸° ë•Œë¬¸ì— ì„±ëŠ¥ì´ ì¢‹ì§€ ì•Šë‹¤.
- `ThreadLocalRandom`ì„ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ ìŠ¤ë ˆë“œ ì „ìš© Randomì´ë¼ ê°„ì„­ì´ ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
