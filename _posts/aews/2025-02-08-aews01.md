---
title: AEWS 1ì£¼ì°¨ ì •ë¦¬
date: 2025-02-08 20:20:00 +0900
categories: [EKS]
tags: [AEWS]
---

## **[Arch Linux](https://archlinux.org/)ì—ì„œ AWS CLI ì„¤ì¹˜ ë° EKS êµ¬ì¶• êµ¬ì¶• ê³¼ì • ê¸°ë¡**

## **ğŸ”‘ 1. IAM User ìƒì„±**

**AWS IAMì—ì„œ ê´€ë¦¬ ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë¥¼ ìƒì„±**

1. **IAM ì½˜ì†” ì ‘ì†**
    
    AWS ì½˜ì†”ì—ì„œ **IAM** ì„œë¹„ìŠ¤ë¡œ ì´ë™
    
2. **ì‚¬ìš©ì ì¶”ê°€**
    - **ì‚¬ìš©ì ì´ë¦„**: `eks-user` (ì˜ˆì‹œ)
    - **ê¶Œí•œ ì„¤ì •**: `AdministratorAccess` (ëª¨ë“  ê¶Œí•œ ë¶€ì—¬)
3. **ìƒì„± ì™„ë£Œ**
    
    ìƒì„±ëœ IAM ì‚¬ìš©ìì˜ **ì•¡ì„¸ìŠ¤ í‚¤**ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€

![Image](https://github.com/user-attachments/assets/d17f04c9-de6e-44f4-aac5-cea3a38eae8d)

## **ğŸ” 2. Access Key ë°œê¸‰**

**IAM ì‚¬ìš©ì(`eks-user`)ì˜ Access Keyë¥¼ ìƒì„±í•˜ì—¬ ì¸ì¦ ì •ë³´ í™•ë³´**

1. **IAM ì½˜ì†”ì—ì„œ ì‚¬ìš©ì ì„ íƒ**
    - IAM â†’ **Users** â†’ `eks-user` ì„ íƒ
2. **Access Key ìƒì„±**
    - **Security credentials**(ë³´ì•ˆ ìê²© ì¦ëª…) íƒ­ ì´ë™
    - **Create access key** í´ë¦­
3. **Access Key ì €ì¥**
    - ìƒì„±ëœ **Access Key ID**ì™€ **Secret Access Key**ë¥¼ ì•ˆì „í•œ ê³³ì— ë³´ê´€
    - Secret Access KeyëŠ” ì´í›„ ë‹¤ì‹œ í™•ì¸í•  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì£¼ì˜


![Image](https://github.com/user-attachments/assets/b5c68166-5932-45ab-92ce-8664884e0111)
![Image](https://github.com/user-attachments/assets/971ec4d2-b944-41b6-82ad-3c23fee90979)

## **ğŸ“¥ 3. AWS CLI ì„¤ì¹˜ ë° ì„¤ì •**

**ë¡œì»¬ PCì—ì„œ AWS CLIë¥¼ ì„¤ì¹˜í•˜ê³  Access Keyë¥¼ ì„¤ì •**

### **1. AWS CLI ì„¤ì¹˜**

Arch Linuxì—ì„œ `yay`ë¥¼ ì‚¬ìš©í•˜ì—¬ AWS CLI v2 ì„¤ì¹˜

```bash
yay -S aws-cli-v2
```

### **2. AWS CLI ì¸ì¦ ì •ë³´ ì„¤ì •**

**ë°œê¸‰ë°›ì€ Access Keyë¥¼ ì‚¬ìš©í•˜ì—¬ AWS CLI ì„¤ì •**

```bash
aws configure
```

**ì…ë ¥ê°’**

- **AWS Access Key ID**: ë°œê¸‰ë°›ì€ Access Key ID
- **AWS Secret Access Key**: ë°œê¸‰ë°›ì€ Secret Access Key
- **Default region name**: `ap-northeast-2` (ì„œìš¸ ë¦¬ì „, ì›í•˜ëŠ” ë¦¬ì „ ì„ íƒ ê°€ëŠ¥)
- **Default output format**: `json` ë˜ëŠ” `yaml` (ê¸°ë³¸ê°’: `json`)


## **ğŸ”‘ 4. AWS CLIë¥¼ ì´ìš©í•œ Key Pair ìƒì„±**

AWS CLIë¥¼ ì‚¬ìš©í•˜ì—¬ EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‚¬ìš©í•  **Key Pair** ìƒì„±

### **1. Key Pair ìƒì„±**

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ Key Pairë¥¼ ìƒì„±í•˜ê³  `.pem` íŒŒì¼ë¡œ ì €ì¥

```bash
aws ec2 create-key-pair --key-name kp-aews --query "KeyMaterial" --output text > kp-aews.pem
```

### **2. ë³´ì•ˆ ì„¤ì • (ê¶Œí•œ ë³€ê²½)**

ìƒì„±ëœ Key Pair íŒŒì¼(`.pem`)ì˜ ê¶Œí•œì„ ë³€ê²½í•˜ì—¬ ì•ˆì „í•˜ê²Œ ë³´í˜¸

```bash
chmod 400 kp-aews.pem
```

ğŸ’¡ **ì°¸ê³ :** `kp-aews.pem` íŒŒì¼ì€ SSH ì ‘ì† ì‹œ ì‚¬ìš©ë˜ë¯€ë¡œ ì•ˆì „í•˜ê²Œ ë³´ê´€



## **ğŸ“œ 5. CloudFormationì„ ì´ìš©í•œ EKS ìŠ¤íƒ ë°°í¬**

AWS CloudFormationì„ ì‚¬ìš©í•˜ì—¬ EKS ìŠ¤íƒ ë°°í¬

### **1. CloudFormation ìŠ¤íƒ ë°°í¬ ì‹¤í–‰**

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ CloudFormationì„ í†µí•´ EKS ë°°í¬

```bash
# yaml íŒŒì¼ ë‹¤ìš´ë¡œë“œ
curl -O https://s3.ap-northeast-2.amazonaws.com/cloudformation.cloudneta.net/K8S/**myeks-1week.yaml

# ë°°í¬**
aws cloudformation deploy --template-file ~/Downloads/myeks-1week.yaml \
--stack-name myeks --parameter-overrides KeyName=kp-aews SgIngressSshCidr=$(curl -s [ipinfo.io/ip](http://ipinfo.io/ip))/32 --region ap-northeast-2
```

### **2. ë°°í¬ ê³¼ì •**

- `myeks-1week.yaml` í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬ **EKS ìŠ¤íƒ** ìƒì„±
- `KeyName=kp-aews`: EC2 SSH ì ‘ì†ì„ ìœ„í•œ Key Pair ì§€ì •
- `SgIngressSshCidr=$(curl -s ipinfo.io/ip)/32`: í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ **ê³µì¸ IPì—ì„œë§Œ SSH ì ‘ì† í—ˆìš©**
- `-region ap-northeast-2`: ì„œìš¸ ë¦¬ì „ì— ë°°í¬

### **3. ë°°í¬ ì™„ë£Œ ë©”ì‹œì§€ í™•ì¸**

ë°°í¬ê°€ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì•„ë˜ ë©”ì‹œì§€ ì¶œë ¥

```bash
Waiting for changeset to be created..
Waiting for stack create/update to complete
Successfully created/updated stack - myeks
```

## **ğŸ–¥ï¸ 6. EC2 ì¸ìŠ¤í„´ìŠ¤ì— SSH ì ‘ì†**

CloudFormationì—ì„œ ìƒì„±ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ **Public IPë¥¼ ìë™ ì¡°íšŒí•˜ì—¬ SSH ì ‘ì†**

```bash
ssh root@$(aws cloudformation describe-stacks --stack-name myeks --query 'Stacks[*].Outputs[0].OutputValue' --output text)
```

**ê¸°ë³¸ ì ‘ì† ì •ë³´** 

- **ì‚¬ìš©ìëª…**: `root`
- **ë¹„ë°€ë²ˆí˜¸**: `qwe123`

ğŸ’¡ ì´ ì •ë³´ëŠ” **CloudFormation í…œí”Œë¦¿ íŒŒì¼**ì—ì„œ ì„¤ì •ëœ ê°’

![Image](https://github.com/user-attachments/assets/b41ba605-c969-4fe7-a6e9-d7b255620930)

## **ğŸ›¡ï¸ 7. IAM ì‚¬ìš©ì ìê²© ì¦ëª… ì„¤ì • ë° VPC í™•ì¸**

AWS CLIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ IAM ì‚¬ìš©ì ìê²© ì¦ëª…ì„ ì„¤ì •í•˜ê³ , EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¡°íšŒí•˜ì—¬ VPC ì •ë³´ í™•ì¸

### **1. ìê²© ì¦ëª… ì„¤ì • í•„ìš” ì—¬ë¶€ í™•ì¸**

AWS CLIì—ì„œ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¡°íšŒí•˜ë ¤ í•˜ë©´, ìê²© ì¦ëª…ì´ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš° ì•„ë˜ ì˜¤ë¥˜ ë°œìƒ

```bash
[root@myeks-host ~]# aws ec2 describe-instances

Unable to locate credentials. You can configure credentials by running "aws configure".
```

ì´ ì˜¤ë¥˜ëŠ” AWS CLIê°€ **IAM ì‚¬ìš©ì ìê²© ì¦ëª…(Access Key, Secret Key)**ì„ ì°¾ì„ ìˆ˜ ì—†ì„ ë•Œ ë°œìƒ

### **2. AWS ìê²© ì¦ëª… ì„¤ì •**

IAM ì‚¬ìš©ì ìê²© ì¦ëª…ì„ ì„¤ì •í•˜ë ¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰

```bash
[root@myeks-host ~]# aws configure
AWS Access Key ID [None]: XXXXXXXXXXXXXXXXXX
AWS Secret Access Key [None]: XXXXXXXXXXXXXXXXXX
Default region name [None]: ap-northeast-2
Default output format [None]: json
```

**ì…ë ¥ê°’**

- **AWS Access Key ID**: ë°œê¸‰ë°›ì€ Access Key ì…ë ¥
- **AWS Secret Access Key**: ë°œê¸‰ë°›ì€ Secret Access Key ì…ë ¥
- **Default region name**: `ap-northeast-2` (ì„œìš¸ ë¦¬ì „, ì›í•˜ëŠ” ë¦¬ì „ ì„ íƒ ê°€ëŠ¥)
- **Default output format**: `json` (í•„ìš” ì‹œ `yaml` ê°€ëŠ¥)

### **3. VPC ë° EC2 ì¸ìŠ¤í„´ìŠ¤ í™•ì¸**

IAM ìê²© ì¦ëª…ì„ ì„¤ì •í•œ í›„, ë‹¤ì‹œ EC2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì¡°íšŒí•˜ë©´ ì •ìƒì ìœ¼ë¡œ ê²°ê³¼ ì¶œë ¥



## **ğŸŒ 8. EKS ë°°í¬ë¥¼ ìœ„í•œ VPC ì •ë³´ ì„¤ì •**

**EKS ë°°í¬ì— í•„ìš”í•œ **VPC ID**ë¥¼ ì¡°íšŒí•˜ê³  í™˜ê²½ ë³€ìˆ˜ë¡œ ì €ì¥**

```bash
[root@myeks-host ~]# export VPCID=$(aws ec2 describe-vpcs --filters "Name=tag:Name,Values=$CLUSTER_NAME-VPC" | jq -r .Vpcs[].VpcId)
[root@myeks-host ~]# echo "export VPCID=$VPCID" >> /etc/profile
[root@myeks-host ~]# echo $VPCID
vpc-06b6b56c0362daea4
```
![Image](https://github.com/user-attachments/assets/dbd83bf5-c167-4c2d-bcf9-84c76a4f158f)

## **ğŸ—ï¸ 9. EKS ë°°í¬ë¥¼ ìœ„í•œ ì„œë¸Œë„· ì„¤ì •**
EKS í´ëŸ¬ìŠ¤í„° ë°°í¬ì— í•„ìš”í•œ í¼ë¸”ë¦­ ì„œë¸Œë„· IDë¥¼ ì¡°íšŒí•˜ê³  í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •


### **1. í¼ë¸”ë¦­ ì„œë¸Œë„· ID ì¡°íšŒ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ **í¼ë¸”ë¦­ ì„œë¸Œë„· ID**ë¥¼ ì¡°íšŒí•˜ê³  í™˜ê²½ ë³€ìˆ˜ì— ì €ì¥

```bash
[root@myeks-host ~]# export PubSubnet1=$(aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet1" --query "Subnets[0].[SubnetId]" --output text)
[root@myeks-host ~]# export PubSubnet2=$(aws ec2 describe-subnets --filters Name=tag:Name,Values="$CLUSTER_NAME-PublicSubnet2" --query "Subnets[0].[SubnetId]" --output text)
```

### **2. ì„¤ì • ì ìš© ë° ìœ ì§€**

ì¬ë¶€íŒ… í›„ì—ë„ ìœ ì§€ë˜ë„ë¡ `/etc/profile`ì— ì¶”ê°€

```bash
[root@myeks-host ~]# echo "export PubSubnet1=$PubSubnet1" >> /etc/profile
[root@myeks-host ~]# echo "export PubSubnet2=$PubSubnet2" >> /etc/profile
```

### **3. ì„¤ì • í™•ì¸**

í™˜ê²½ ë³€ìˆ˜ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸

```bash
[root@myeks-host ~]# echo $PubSubnet1
subnet-03de214d67fde4926
[root@myeks-host ~]# echo $PubSubnet2
subnet-0f906344fd9149770
```
![Image](https://github.com/user-attachments/assets/98b79396-52e9-48aa-9f94-564544517c36)


## **ğŸš€ 10. EKS í´ëŸ¬ìŠ¤í„° ë° ë…¸ë“œ ê·¸ë£¹ ë°°í¬**
EKS í´ëŸ¬ìŠ¤í„°ì™€ ê´€ë¦¬í˜• ë…¸ë“œ ê·¸ë£¹ì„ ë°°í¬ (**ì•½ 15ë¶„ ì†Œìš”**)

### **1. í™˜ê²½ ë³€ìˆ˜ í™•ì¸**

ì„¤ì •ëœ í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•˜ì—¬ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸

```bash
[root@myeks-host ~]# echo $AWS_DEFAULT_REGION
ap-northeast-2
[root@myeks-host ~]# echo $CLUSTER_NAME
myeks
[root@myeks-host ~]# echo $VPCID
vpc-06b6b56c0362daea4
[root@myeks-host ~]# echo $PubSubnet1,$PubSubnet2
subnet-03de214d67fde4926,subnet-0f906344fd9149770
```

### **2. í´ëŸ¬ìŠ¤í„° ë°°í¬ ì‹¤í–‰**

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ EKS í´ëŸ¬ìŠ¤í„° ë° ê´€ë¦¬í˜• ë…¸ë“œ ê·¸ë£¹ ë°°í¬

```bash
**eksctl create cluster --name $CLUSTER_NAME --region=$AWS_DEFAULT_REGION --nodegroup-name=$CLUSTER_NAME-nodegroup --node-type=t3.medium \
--node-volume-size=30 --vpc-public-subnets "$PubSubnet1,$PubSubnet2" --version 1.31 --ssh-access --external-dns-access --verbose 4**
```

### **3. ë°°í¬ ì˜µì…˜ ìš”ì•½**

- **í´ëŸ¬ìŠ¤í„° ë° ê´€ë¦¬í˜• ë…¸ë“œ ê·¸ë£¹ ë°°í¬**
- **t3.medium ì¸ìŠ¤í„´ìŠ¤** ì‚¬ìš©, 30GB EBS í• ë‹¹
- **í¼ë¸”ë¦­ ì„œë¸Œë„·**ì— ë°°í¬
- **SSH ë° ì™¸ë¶€ DNS ì•¡ì„¸ìŠ¤ í—ˆìš©**


## **ğŸ“¡ 11. EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ëª¨ë‹ˆí„°ë§**

EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ **Public IP, Private IP, ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœ**ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§

### **1. ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**

ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸

```bash
**while true; do aws ec2 describe-instances --query "Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,PrivateIPAdd:PrivateIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}" --filters Name=instance-state-name,Values=running --output text ; echo "------------------------------" ; sleep 1; done**
```

### **2. í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ ëª©ë¡ ì¡°íšŒ**

ë°°í¬ ì™„ë£Œ í›„ ì‹¤í–‰ ì¤‘ì¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ í™•ì¸í•˜ë ¤ë©´ ì•„ë˜ ëª…ë ¹ì–´ ì‹¤í–‰

```bash
aws ec2 describe-instances --query "Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,PrivateIPAdd:PrivateIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}" --filters Name=instance-state-name,Values=running --output table
```

### **3. ë°°í¬ ìƒíƒœ**

**ë°°í¬ì¤‘ (ì¸ìŠ¤í„´ìŠ¤ê°€ ìƒì„±ë˜ê³  ë¶€íŒ… ì¤‘)**

![Image](https://github.com/user-attachments/assets/4a513fbf-abec-4a21-92aa-0122b33dd071)
ë°°í¬ì™„ë£Œ (ì¸ìŠ¤í„´ìŠ¤ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë¨)

![Image](https://github.com/user-attachments/assets/3f140bd1-8cca-4ea0-b4f5-4bb6b54d2f92)

![Image](https://github.com/user-attachments/assets/91431772-1a22-49a0-a5d7-38e3165d2b6e)

## **ğŸ¢ 12. EKS í´ëŸ¬ìŠ¤í„° ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° ì—”ë“œí¬ì¸íŠ¸ í™•ì¸**

EKS í´ëŸ¬ìŠ¤í„°ì˜ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ì„¤ì •í•˜ê³ , API ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸

### **1. ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì„¤ì •**

EKSì—ì„œ **ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤**ë¥¼ `default`ë¡œ ë³€ê²½

```bash
(eks-user@myeks:N/A) [root@myeks-host ~]# k ns default
Context "eks-user@myeks.ap-northeast-2.eksctl.io" modified.
Active namespace is "default".
```


### **2. EKS í´ëŸ¬ìŠ¤í„° ì—”ë“œí¬ì¸íŠ¸ í™•ì¸**

EKS API ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸

```bash
(eks-user@myeks:default) [root@myeks-host ~]# aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint
https://F5010046882B83E478ED4CDA5EA08828.gr7.ap-northeast-2.eks.amazonaws.com
```

### **3. EKS API ì„œë²„ ë„ë©”ì¸ì˜ IP ì£¼ì†Œ ì¡°íšŒ**

EKS API ì„œë²„ì˜ ë„ë©”ì¸ì„ í™•ì¸í•œ í›„ í•´ë‹¹ ë„ë©”ì¸ì˜ **IP ì£¼ì†Œ ì¡°íšŒ**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# APIDNS=$(aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint | cut -d '/' -f 3)
(eks-user@myeks:default) [root@myeks-host ~]# dig +short $APIDNS
3.37.179.56
3.37.34.120
```

âœ… **ì„¤ëª…**

- `aws eks describe-cluster` â†’ í˜„ì¬ ë°°í¬ëœ í´ëŸ¬ìŠ¤í„°ì˜ **API ì„œë²„ ë„ë©”ì¸ í™•ì¸**
- `dig +short` â†’ í•´ë‹¹ ë„ë©”ì¸ì˜ **ê³µì¸ IP ì£¼ì†Œ ì¡°íšŒ**
- ë³´í†µ **NLB(Network Load Balancer)ì— ì—°ê²°ëœ ë‘ ê°œì˜ ê³ ì • ê³µì¸ IP**ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŒ

### **4. EKS API ì„œë²„ì— ì§ì ‘ ìš”ì²­ (403 Forbidden ì‘ë‹µ í™•ì¸)**

EKS API ì„œë²„ì— ì§ì ‘ ìš”ì²­ ì‹œ **ê¶Œí•œ ë¶€ì¡±(403 Forbidden) ì˜¤ë¥˜ ë°œìƒ**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# curl -k -s $(aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint)
{
  "kind": "Status",
  "apiVersion": "v1",
  "metadata": {},
  "status": "Failure",
  "message": "forbidden: User \"system:anonymous\" cannot get path \"/\"",
  "reason": "Forbidden",
  "details": {},
  "code": 403
}
```

âœ… **ì„¤ëª…**

- API ì„œë²„ëŠ” ì¸ì¦ë˜ì§€ ì•Šì€ ìš”ì²­ì„ **ê±°ë¶€** (`403 Forbidden`)
- `system:anonymous` ì‚¬ìš©ìëŠ” ê¸°ë³¸ì ìœ¼ë¡œ API ì„œë²„ì— ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ

### **5. EKS API ì„œë²„ì˜ ë²„ì „ ì •ë³´ í™•ì¸**

API ì„œë²„ì˜ `/version` ì—”ë“œí¬ì¸íŠ¸ë¥¼ í†µí•´ **í´ëŸ¬ìŠ¤í„°ì˜ Kubernetes ë²„ì „ ì •ë³´ í™•ì¸**

```bash
https://f5010046882b83e478ed4cda5ea08828.gr7.ap-northeast-2.eks.amazonaws.com/version
```

![Image](https://github.com/user-attachments/assets/c94dd6c8-1c61-4c69-be21-044faf810e5e)

âœ… **í˜„ì¬ API Server endpoint accessëŠ” Publicìœ¼ë¡œ ì„¤ì •ë¨**

![Image](https://github.com/user-attachments/assets/4a370582-bc88-4f96-af2f-b2be6bfdab1f)

âœ… **Auto Scaling groups ë‘ ê°œê°€ ë°°í¬ë¨**


![Image](https://github.com/user-attachments/assets/1cd8152e-fde9-4477-9db6-6cbf50609e73)

âœ… **ì„¤ì •í•œ ê°’ì´ ì˜¬ë°”ë¥´ê²Œ ë°˜ì˜ë¨**

![Image](https://github.com/user-attachments/assets/550c7973-5f24-4691-ab04-b39470684411)

## **ğŸ” 13. EKS ë…¸ë“œ ê·¸ë£¹ ë° ë…¸ë“œ ì •ë³´ í™•ì¸**

EKS í´ëŸ¬ìŠ¤í„°ì˜ **ë…¸ë“œ ê·¸ë£¹ ë° ê°œë³„ ë…¸ë“œ ì •ë³´ ì¡°íšŒ**

### **1. EKS ë…¸ë“œ ê·¸ë£¹ ì •ë³´ í™•ì¸**

EKSì— ìƒì„±ëœ **ê´€ë¦¬í˜• ë…¸ë“œ ê·¸ë£¹** í™•ì¸

```bash
(eks-user@myeks:default) [root@myeks-host ~]# eksctl get nodegroup --cluster $CLUSTER_NAME --name $CLUSTER_NAME-nodegroup
```

âœ… **ì¶œë ¥**

```bash
CLUSTER	NODEGROUP	STATUS	CREATED			MIN SIZE	MAX SIZE	DESIRED CAPACITY	INSTANCE TYPE	IMAGE ID	ASG NAME						TYPE
myeks	myeks-nodegroup	ACTIVE	2025-02-08T00:56:29Z	2		2	2			t3.medium	AL2_x86_64	eks-myeks-nodegroup-30ca7187-6636-6b8c-0211-b50c446338dd	managed
```

### **2. ê°œë³„ ë…¸ë“œ ì •ë³´ í™•ì¸**

EKSì— ë°°í¬ëœ ê°œë³„ **ë…¸ë“œì˜ ì„¸ë¶€ ì •ë³´** ì¡°íšŒ

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl get node -owide
```

âœ… **ì¶œë ¥**

```bash
NAME                                               STATUS   ROLES    AGE   VERSION               INTERNAL-IP     EXTERNAL-IP     OS-IMAGE         KERNEL-VERSION                  CONTAINER-RUNTIME
ip-192-168-1-206.ap-northeast-2.compute.internal   Ready    <none>   34m   v1.31.4-eks-aeac579   192.168.1.206   43.201.15.139   Amazon Linux 2   5.10.233-223.887.amzn2.x86_64   containerd://1.7.25
ip-192-168-2-123.ap-northeast-2.compute.internal   Ready    <none>   34m   v1.31.4-eks-aeac579   192.168.2.123   54.180.83.125   Amazon Linux 2   5.10.233-223.887.amzn2.x86_64   containerd://1.7.25
```

### **3. EKS API ì„œë²„ì™€ ìê²©ì¦ëª… í™•ì¸**

EKS API ì„œë²„ì— ì§ˆì˜ê°€ ì„±ê³µí•˜ë©´ **IAM ìê²©ì¦ëª…ì´ ì •ìƒì ìœ¼ë¡œ í†µê³¼ë¨**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl get node -v=6
```

âœ… **ì¶œë ¥ (ìê²©ì¦ëª… ì •ìƒ ì‘ë™ í™•ì¸)**

```bash
I0208 10:34:06.947941   10088 loader.go:395] Config loaded from file:  /root/.kube/config
I0208 10:34:07.854366   10088 round_trippers.go:553] GET https://F5010046882B83E478ED4CDA5EA08828.gr7.ap-northeast-2.eks.amazonaws.com/api/v1/nodes?limit=500 200 OK in 891 milliseconds
NAME                                               STATUS   ROLES    AGE   VERSION
ip-192-168-1-206.ap-northeast-2.compute.internal   Ready    <none>   36m   v1.31.4-eks-aeac579
ip-192-168-2-123.ap-northeast-2.compute.internal   Ready    <none>   36m   v1.31.4-eks-aeac579
```

âœ… **ìê²©ì¦ëª… íŒŒì¼ í™•ì¸** 

```bash
(eks-user@myeks:default) [root@myeks-host ~]# cat /root/.kube/config
apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURCVENDQWUyZ0F3SUJBZ0lJRy9USVhYbUhGdlF3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TlRBeU1EZ3dNRFEyTURKYUZ3MHpOVEF5TURZd01EVXhNREphTUJVeApFekFSQmdOVkJBTVRDbXQxWW1WeWJtVjBaWE13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLCkFvSUJBUURQQ1RXRnZQSFAvdGRuSHVSa2k0L3BQN29iZDJDVXp1OEpoT29rVXhzQmxkcmZEMEE3QUxaSk1WOUIKc1p4QnVHMUthdWprVFZHNU5JdkVYZG1FS0NWSkQ0UFZFRWlNd29CTFA3ZkJaS2dmbjAwQ2JSNEdTbFRoK3krdAp5RWUrWGw1ZnpBSEswdVpFUU9WWWIrdkJhdnJzSFlLSEJYYlhmSitjdTVaU25DQmxsNThXTnVFNis5VzFHdWlWCkpLd2VvMHhlM0NGSHRBWXRGaTlUN1puQ29HTkorcW9xOGgyZjZKeHQ2K2RiZzJZVExiYjJoM20rRC9kODV3WW8KMC9XbDBCbGw0ZmJiZXFrWFNIYU1TYVMwc3p5Q1VsZDhKTmIrSmxTRS9TdlBsblFjR01RRkxSNzRxaW5tSjRZNAoveDZvRUJMbk1VQ0MrcWdkWnlUSXpKNFlmbCtaQWdNQkFBR2pXVEJYTUE0R0ExVWREd0VCL3dRRUF3SUNwREFQCkJnTlZIUk1CQWY4RUJUQURBUUgvTUIwR0ExVWREZ1FXQkJUVFN4UHMxNWVEY3Eyd2U3RkYwTzlGQkpoNExqQVYKQmdOVkhSRUVEakFNZ2dwcmRXSmxjbTVsZEdWek1BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQTVoODU0KzBxawpqV24vQWlsZXF6RFk4MHc1VFNEektpQXpqVzR3OEZ4SlZNUVpidEFUQ29KYUU1ZnpUaW5ZbUZTbXRpYTdLRW9iCk80NTkxWC94SlN4cFUxNTdiR2ZvblRPaDRQeWRFd1ZJTzdlOExJU3NqRmE4dFUwWUtwdWdGcDQ5N1ZxWUhqNnoKM3ZPajhVbFAzcVBGVUZVNHBKbzM4b2lzQmRnZmlVb3NpNUxHRVgrUEJhdFd2aWRVSmpaUVkrcGlkRVpEWjJIWApYTDcvQjVsTVBNZlF6V3hXcG9EbklweXQ0anJTS05DczJRVzJWMzExdFRDQXZMVkhUZURLejVpUnhvUEZGcXNvCjQ2RG9NQWIyd2NBTXFJcUxUeGZ5ZmJib052SHVkclNUWCtMamZNQnlzR1pWbWlkd1VUTm1Sck5STGNDNXZZcGsKdnJ3MG1tUnZqM0JKCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://F5010046882B83E478ED4CDA5EA08828.gr7.ap-northeast-2.eks.amazonaws.com
  name: myeks.ap-northeast-2.eksctl.io
contexts:
- context:
    cluster: myeks.ap-northeast-2.eksctl.io
    namespace: default
    user: eks-user@myeks.ap-northeast-2.eksctl.io
  name: eks-user@myeks.ap-northeast-2.eksctl.io
current-context: eks-user@myeks.ap-northeast-2.eksctl.io
kind: Config
preferences: {}
users:
- name: eks-user@myeks.ap-northeast-2.eksctl.io
  user:
    exec:
      apiVersion: client.authentication.k8s.io/v1beta1
      args:
      - eks
      - get-token
      - --output
      - json
      - --cluster-name
      - myeks
      - --region
      - ap-northeast-2
      command: aws
      env:
      - name: AWS_STS_REGIONAL_ENDPOINTS
        value: regional
      interactiveMode: IfAvailable
      provideClusterInfo: false
```

âœ… **ì„¤ëª…**

- `Config loaded from file: /root/.kube/config` ë¡œê·¸ê°€ ë³´ì´ë©´ **ì˜¬ë°”ë¥¸ ì¸ì¦ ì •ë³´ê°€ ë¡œë“œëœ ê²ƒ**
- `GET ... 200 OK` ì‘ë‹µì´ í™•ì¸ë˜ë©´ **EKS API ì„œë²„ì— ì •ìƒì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥**
- `kubectl` ëª…ë ¹ì–´ ì‹¤í–‰ ì‹œ ë¬¸ì œê°€ ì—†ë‹¤ë©´ **IAM ì—­í• ì´ ì˜¬ë°”ë¥´ê²Œ ë¶€ì—¬ë¨**


## **ğŸ“¦ 14. EKS í´ëŸ¬ìŠ¤í„°ì˜ Pod ìƒíƒœ í™•ì¸**

EKS í´ëŸ¬ìŠ¤í„° ë‚´ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ **ì‹œìŠ¤í…œ Pod ì •ë³´ ì¡°íšŒ**

### **1. kube-system ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Pod í™•ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl get pod -n kube-system
NAME                              READY   STATUS    RESTARTS   AGE
aws-node-84cmt                    2/2     Running   0          46m
aws-node-cbpp9                    2/2     Running   0          46m
coredns-9b5bc9468-p2xc5           1/1     Running   0          50m
coredns-9b5bc9468-w46h7           1/1     Running   0          50m
kube-proxy-8rw86                  1/1     Running   0          46m
kube-proxy-cfqch                  1/1     Running   0          46m
metrics-server-86bbfd75bb-qxsx7   1/1     Running   0          50m
metrics-server-86bbfd75bb-wzchv   1/1     Running   0          50m
```

### 2. ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ Pod í™•ì¸

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl get pod -A
NAMESPACE     NAME                              READY   STATUS    RESTARTS   AGE
kube-system   aws-node-84cmt                    2/2     Running   0          47m
kube-system   aws-node-cbpp9                    2/2     Running   0          47m
kube-system   coredns-9b5bc9468-p2xc5           1/1     Running   0          51m
kube-system   coredns-9b5bc9468-w46h7           1/1     Running   0          51m
kube-system   kube-proxy-8rw86                  1/1     Running   0          47m
kube-system   kube-proxy-cfqch                  1/1     Running   0          47m
kube-system   metrics-server-86bbfd75bb-qxsx7   1/1     Running   0          51m
kube-system   metrics-server-86bbfd75bb-wzchv   1/1     Running   0          51m
```

## **ğŸ› ï¸ 15. ë°°í¬ëœ Podì˜ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ í™•ì¸**

í´ëŸ¬ìŠ¤í„°ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ **ëª¨ë“  Podì˜ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ì •ë³´ ì¡°íšŒ**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl get pods --all-namespaces -o jsonpath="{.items[*].spec.containers[*].image}" | tr -s '[[:space:]]' '\n' | sort | uniq -c
2 602401143452.dkr.ecr.ap-northeast-2.amazonaws.com/amazon/aws-network-policy-agent:v1.1.5-eksbuild.1
2 602401143452.dkr.ecr.ap-northeast-2.amazonaws.com/amazon-k8s-cni:v1.19.0-eksbuild.1
2 602401143452.dkr.ecr.ap-northeast-2.amazonaws.com/eks/coredns:v1.11.3-eksbuild.1
2 602401143452.dkr.ecr.ap-northeast-2.amazonaws.com/eks/kube-proxy:v1.31.2-minimal-eksbuild.3
2 602401143452.dkr.ecr.ap-northeast-2.amazonaws.com/eks/metrics-server:v0.7.2-eksbuild.1
```

## **ğŸŒ  16. ì›Œì»¤ ë…¸ë“œ ì ‘ê·¼ ë° ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸**

EKS í´ëŸ¬ìŠ¤í„°ì˜ **ì›Œí¬ ë…¸ë“œ(Worker Node) IPë¥¼ í™•ì¸í•˜ê³  í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •**

### **1. ì‹¤í–‰ ì¤‘ì¸ EC2 ì¸ìŠ¤í„´ìŠ¤ ë° IP í™•ì¸**

EKS ë…¸ë“œ ê·¸ë£¹ì— í¬í•¨ëœ ì¸ìŠ¤í„´ìŠ¤ì˜ **ê³µì¸ IP(Public IP) ë° ì‚¬ì„¤ IP(Private IP) ì¡°íšŒ**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# aws ec2 describe-instances --query "Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,PrivateIPAdd:PrivateIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}" --filters Name=instance-state-name,Values=running --output table
```

âœ… **ì¶œë ¥**

```bash
-----------------------------------------------------------------------------
|                             DescribeInstances                             |
+-----------------------------+----------------+----------------+-----------+
|        InstanceName         | PrivateIPAdd   |  PublicIPAdd   |  Status   |
+-----------------------------+----------------+----------------+-----------+
|  myeks-myeks-nodegroup-Node |  192.168.2.123 |  54.180.83.125 |  running  |
|  myeks-host                 |  192.168.1.100 |  52.78.0.68    |  running  |
|  myeks-myeks-nodegroup-Node |  192.168.1.206 |  43.201.15.139 |  running  |
+-----------------------------+----------------+----------------+-----------+
```

### **2. ë…¸ë“œì˜ Private IPë¥¼ í™˜ê²½ ë³€ìˆ˜ë¡œ ì €ì¥**

ê° ë…¸ë“œì˜ **ì‚¬ì„¤ IP(Private IP)ë¥¼ ë³€ìˆ˜ë¡œ ì €ì¥**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# N1=$(kubectl get node --label-columns=topology.kubernetes.io/zone --selector=topology.kubernetes.io/zone=ap-northeast-2a -o jsonpath={.items[0].status.addresses[0].address})
(eks-user@myeks:default) [root@myeks-host ~]# N2=$(kubectl get node --label-columns=topology.kubernetes.io/zone --selector=topology.kubernetes.io/zone=ap-northeast-2c -o jsonpath={.items[0].status.addresses[0].address})
```

âœ… **ì¶œë ¥**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# echo $N1, $N2
192.168.1.206, 192.168.2.123
```

âœ… **ë³€ìˆ˜ë¥¼ ì‹œìŠ¤í…œì— ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# echo "export N1=$N1" >> /etc/profile
(eks-user@myeks:default) [root@myeks-host ~]# echo "export N2=$N2" >> /etc/profile
```

âœ… ë…¸ë“œ ê·¸ë£¹ ì¸ìŠ¤í„´ìŠ¤ì˜ **ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ê° ë…¸ë“œì˜ Private IPv4 ì£¼ì†Œ(192.168.1.206, 192.168.2.123) í™•ì¸ ê°€ëŠ¥**

![Image](https://github.com/user-attachments/assets/1d9db3d4-d318-46b7-a883-d3b333a63898)

![Image](https://github.com/user-attachments/assets/dd0de208-779e-4ce1-92ad-daa917de0b36)

## **ğŸ”„ 17. ì›Œì»¤ ë…¸ë“œ ë„¤íŠ¸ì›Œí¬ ì„¤ì • ë° SSH ì ‘ì†**

EKS ì›Œì»¤ ë…¸ë“œì— ì ‘ê·¼í•˜ì—¬ **ë„¤íŠ¸ì›Œí¬ ì„¤ì •ì„ í™•ì¸í•˜ê³  SSH ì ‘ì†ì„ í…ŒìŠ¤íŠ¸**

### **1. ì›Œì»¤ ë…¸ë“œì— Ping í…ŒìŠ¤íŠ¸**

EKSì˜ ì›Œì»¤ ë…¸ë“œëŠ” ê¸°ë³¸ ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •ì— ì˜í•´ **Ping ìš”ì²­ì´ ì°¨ë‹¨ë¨**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ping -c 1 $N1
(eks-user@myeks:default) [root@myeks-host ~]# ping -c 1 $N2
```

âœ… **ì¶œë ¥**

```bash
# ping -c 1 $N1 ì¶œë ¥
--- 192.168.1.206 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms

# ping -c 1 $N2 ì¶œë ¥
--- 192.168.2.123 ping statistics ---
1 packets transmitted, 0 received, 100% packet loss, time 0ms
```

### **2. ë…¸ë“œ ë³´ì•ˆ ê·¸ë£¹ ID í™•ì¸ ë° ì €ì¥**

ë…¸ë“œê°€ ì†í•œ **ë³´ì•ˆ ê·¸ë£¹ ID(SG ID) ì¡°íšŒ ë° í™˜ê²½ ë³€ìˆ˜ ì €ì¥**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# aws ec2 describe-security-groups --filters Name=group-name,Values=*nodegroup* --query "SecurityGroups[*].[GroupId]" --output text
sg-0aa71fc3e9206738b
```

```bash
(eks-user@myeks:default) [root@myeks-host ~]# NGSGID=$(aws ec2 describe-security-groups --filters Name=group-name,Values=*nodegroup* --query "SecurityGroups[*].[GroupId]" --output text)
(eks-user@myeks:default) [root@myeks-host ~]# echo $NGSGID
sg-0aa71fc3e9206738b
(eks-user@myeks:default) [root@myeks-host ~]# echo "export NGSGID=$NGSGID" >> /etc/profile

```

### **3. ë³´ì•ˆ ê·¸ë£¹ì— Ping í—ˆìš© ê·œì¹™ ì¶”ê°€**

EKS ì›Œì»¤ ë…¸ë“œì— **myeks-host (192.168.1.100)ì—ì„œì˜ ì ‘ê·¼ í—ˆìš©**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# aws ec2 authorize-security-group-ingress --group-id $NGSGID --protocol '-1' --cidr 192.168.1.100/32
```

âœ… **ì¶œë ¥**

```bash
{
    "Return": true,
    "SecurityGroupRules": [
        {
            "SecurityGroupRuleId": "sgr-0a4bdce9db2440e6a",
            "GroupId": "sg-0aa71fc3e9206738b",
            "GroupOwnerId": "378102432899",
            "IsEgress": false,
            "IpProtocol": "-1",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIpv4": "192.168.1.100/32",
            "SecurityGroupRuleArn": "arn:aws:ec2:ap-northeast-2:378102432899:security-group-rule/sgr-0a4bdce9db2440e6a"
        }
    ]
}
```

### **4. Ping í…ŒìŠ¤íŠ¸ (ë³´ì•ˆ ê·¸ë£¹ ìˆ˜ì • í›„ í—ˆìš©ë¨)**

ë³´ì•ˆ ê·¸ë£¹ì—ì„œ ICMPê°€ í—ˆìš©ë˜ì—ˆìœ¼ë¯€ë¡œ **Pingì´ ì •ìƒì ìœ¼ë¡œ ì‘ë‹µí•¨**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ping -c 2 $N1
PING 192.168.1.206 (192.168.1.206) 56(84) bytes of data.
64 bytes from 192.168.1.206: icmp_seq=1 ttl=255 time=0.416 ms
64 bytes from 192.168.1.206: icmp_seq=2 ttl=255 time=0.453 ms

--- 192.168.1.206 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1017ms
rtt min/avg/max/mdev = 0.416/0.434/0.453/0.027 ms
```

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ping -c 2 $N2
PING 192.168.2.123 (192.168.2.123) 56(84) bytes of data.
64 bytes from 192.168.2.123: icmp_seq=1 ttl=255 time=1.09 ms
64 bytes from 192.168.2.123: icmp_seq=2 ttl=255 time=1.03 ms

--- 192.168.2.123 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 1.035/1.064/1.093/0.029 ms
```

### **5. SSHë¥¼ í†µí•œ ì›Œì»¤ ë…¸ë“œ ì ‘ì†**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ec2-user@$N1 hostname
Warning: Permanently added '192.168.1.206' (ECDSA) to the list of known hosts.
ip-192-168-1-206.ap-northeast-2.compute.internal
```

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ssh -i ~/.ssh/id_rsa -o StrictHostKeyChecking=no ec2-user@$N2 hostname
Warning: Permanently added '192.168.2.123' (ECDSA) to the list of known hosts.
ip-192-168-2-123.ap-northeast-2.compute.internal
```

âœ… **ì„¤ëª…**

- `i ~/.ssh/id_rsa` â†’ SSH í‚¤ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì ‘ì†
- `StrictHostKeyChecking=no` â†’ ì²« ì ‘ì† ì‹œ Host Key ê²½ê³  ë°©ì§€

### **6. SSHë¡œ ì§ì ‘ ì ‘ì†í•˜ì—¬ ì›Œì»¤ ë…¸ë“œ ë¡œê·¸ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ssh ec2-user@$N1
Last login: Mon Feb  3 23:56:27 2025 from 52.94.123.246
   ,     #_
   ~\_  ####_        Amazon Linux 2
  ~~  \_#####\
  ~~     \###|       AL2 End of Life is 2026-06-30.
  ~~       \#/ ___
   ~~       V~' '->
    ~~~         /    A newer version of Amazon Linux is available!
      ~~._.   _/
         _/ _/       Amazon Linux 2023, GA and supported until 2028-03-15.
       _/m/'           https://aws.amazon.com/linux/amazon-linux-2023/

8 package(s) needed for security, out of 8 available
Run "sudo yum update" to apply all updates.
[ec2-user@ip-192-168-1-206 ~]$ 
```

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ssh ec2-user@$N2
Last login: Mon Feb  3 23:56:27 2025 from 52.94.123.246
   ,     #_
   ~\_  ####_        Amazon Linux 2
  ~~  \_#####\
  ~~     \###|       AL2 End of Life is 2026-06-30.
  ~~       \#/ ___
   ~~       V~' '->
    ~~~         /    A newer version of Amazon Linux is available!
      ~~._.   _/
         _/ _/       Amazon Linux 2023, GA and supported until 2028-03-15.
       _/m/'           https://aws.amazon.com/linux/amazon-linux-2023/

8 package(s) needed for security, out of 8 available
Run "sudo yum update" to apply all updates.
[ec2-user@ip-192-168-2-123 ~]$ 
```

**ê´€ë¦¬í˜• Bastion ì„œë²„(192.168.1.100) ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# ip -c a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc mq state UP group default qlen 1000
    link/ether 02:2e:b0:2f:d6:03 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.100/24 brd 192.168.1.255 scope global dynamic eth0
       valid_lft 2859sec preferred_lft 2859sec
    inet6 fe80::2e:b0ff:fe2f:d603/64 scope link 
       valid_lft forever preferred_lft forever
3: docker0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc noqueue state DOWN group default 
    link/ether 02:42:c1:03:5b:35 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0
       valid_lft forever preferred_lft forever
```

âœ… **ì„¤ëª…**

- **eth0 (192.168.1.100)** â†’ ê´€ë¦¬í˜• Bastion ì„œë²„ì˜ ë‚´ë¶€ IP
- **docker0 (172.17.0.1)** â†’ Docker ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤
- **Bastion ì„œë²„ë¥¼ í†µí•´ EKS ë…¸ë“œì— ì ‘ê·¼ ê°€ëŠ¥**


## **ğŸ•µï¸â€â™‚ï¸ 18. ì›Œì»¤ ë…¸ë“œ ì›ê²© ëª…ë ¹ ì‹¤í–‰**

### **1. SSHë¥¼ í†µí•œ ì›ê²© ëª…ë ¹ ì‹¤í–‰ - í˜¸ìŠ¤íŠ¸ ì´ë¦„ í™•ì¸**

ê° ì›Œì»¤ ë…¸ë“œì—ì„œ **í˜¸ìŠ¤íŠ¸ ì´ë¦„ì„ ì¶œë ¥**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# for i in $N1 $N2; do echo ">> node $i <<"; ssh ec2-user@$i hostname; echo; done
```

âœ… **ì¶œë ¥**

```bash
>> node 192.168.1.206 <<
ip-192-168-1-206.ap-northeast-2.compute.internal

>> node 192.168.2.123 <<
ip-192-168-2-123.ap-northeast-2.compute.internal
```

### **2. ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì •ë³´ í™•ì¸**

ê° ì›Œì»¤ ë…¸ë“œì—ì„œ **ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ë° IP ì£¼ì†Œ ì •ë³´ í™•ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# for i in $N1 $N2; do echo ">> node $i <<"; ssh ec2-user@$i sudo ip -c addr; echo; done
```

âœ… **ì¶œë ¥**

```bash
>> node 192.168.1.206 <<
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc mq state UP group default qlen 1000
    link/ether 02:35:bc:e8:8b:b9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.206/24 brd 192.168.1.255 scope global dynamic eth0
       valid_lft 3122sec preferred_lft 3122sec
    inet6 fe80::35:bcff:fee8:8bb9/64 scope link 
       valid_lft forever preferred_lft forever
3: eni22d7019dbe2@if3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default 
    link/ether b2:53:43:26:9e:a7 brd ff:ff:ff:ff:ff:ff link-netns cni-99b00711-77a7-eb8b-591b-b21cdb7a10bd
    inet6 fe80::b053:43ff:fe26:9ea7/64 scope link 
       valid_lft forever preferred_lft forever
4: eni35d9a494c70@if3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default 
    link/ether 42:e9:58:0b:5f:65 brd ff:ff:ff:ff:ff:ff link-netns cni-fda91708-8d7a-41c7-913b-33a8408907ac
    inet6 fe80::40e9:58ff:fe0b:5f65/64 scope link 
       valid_lft forever preferred_lft forever
5: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc mq state UP group default qlen 1000
    link/ether 02:4b:ed:a7:73:5f brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.136/24 brd 192.168.1.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::4b:edff:fea7:735f/64 scope link 
       valid_lft forever preferred_lft forever

>> node 192.168.2.123 <<
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc mq state UP group default qlen 1000
    link/ether 0a:15:fc:9b:15:97 brd ff:ff:ff:ff:ff:ff
    inet 192.168.2.123/24 brd 192.168.2.255 scope global dynamic eth0
       valid_lft 3562sec preferred_lft 3562sec
    inet6 fe80::815:fcff:fe9b:1597/64 scope link 
       valid_lft forever preferred_lft forever
3: eni011365725ba@if3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default 
    link/ether 86:a6:7b:32:54:04 brd ff:ff:ff:ff:ff:ff link-netns cni-b3c96071-26ff-ad52-123c-dde85398a471
    inet6 fe80::84a6:7bff:fe32:5404/64 scope link 
       valid_lft forever preferred_lft forever
4: eni80387e350f8@if3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default 
    link/ether f2:fd:39:93:a1:15 brd ff:ff:ff:ff:ff:ff link-netns cni-9797bb40-a9e7-d43c-fe6c-9335d51bcb6e
    inet6 fe80::f0fd:39ff:fe93:a115/64 scope link 
       valid_lft forever preferred_lft forever
5: eth1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc mq state UP group default qlen 1000
    link/ether 0a:58:fc:6a:2d:07 brd ff:ff:ff:ff:ff:ff
    inet 192.168.2.251/24 brd 192.168.2.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::858:fcff:fe6a:2d07/64 scope link 
       valid_lft forever preferred_lft forever
```

## **ğŸ”— 19. ì›Œì»¤ ë…¸ë“œì˜ TCP ì—°ê²° ìƒíƒœ ë° API ì„œë²„ ì—°ê²° í™•ì¸**

EKS ì›Œì»¤ ë…¸ë“œì—ì„œ **í˜„ì¬ í™œì„±í™”ëœ TCP ì—°ê²°ì„ í™•ì¸í•˜ê³ , kubelet ë° kube-proxyê°€ API ì„œë²„ì™€ ì–´ë–»ê²Œ ì—°ê²°ë˜ëŠ”ì§€ ë¶„ì„**

### **1. ì›Œì»¤ ë…¸ë“œì—ì„œ TCP ì—°ê²° ìƒíƒœ í™•ì¸**

ê° ì›Œì»¤ ë…¸ë“œì—ì„œ **í˜„ì¬ í™œì„±í™”ëœ TCP ì—°ê²° ë° í”„ë¡œì„¸ìŠ¤ ì •ë³´ ì¡°íšŒ**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# for i in $N1 $N2; do echo ">> node $i <<"; ssh ec2-user@$i sudo ss -tnp; echo; done
```

âœ… **ì¶œë ¥**

```bash
>> node 192.168.1.206 <<
State Recv-Q Send-Q          Local Address:Port           Peer Address:Port Process                                                 
ESTAB 0      0               192.168.1.206:38756         52.95.195.109:443   users:(("ssm-agent-worke",pid=2462,fd=14))             
ESTAB 0      0               192.168.1.206:42540           3.37.179.56:443   users:(("aws-k8s-agent",pid=3366,fd=7))                
ESTAB 0      56              192.168.1.206:22            192.168.1.100:43702 users:(("sshd",pid=61805,fd=3),("sshd",pid=61773,fd=3))
ESTAB 0      0               192.168.1.206:53470           3.37.34.120:443   users:(("kube-proxy",pid=3109,fd=9))                   
ESTAB 0      0               192.168.1.206:48848            10.100.0.1:443   users:(("controller",pid=3482,fd=12))                  
ESTAB 0      0               192.168.1.206:57918           3.37.179.56:443   users:(("kubelet",pid=2889,fd=28))                     
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.1.21]:41106 users:(("kubelet",pid=2889,fd=13))                     
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.2.91]:45266 users:(("kubelet",pid=2889,fd=22))                     

>> node 192.168.2.123 <<
State Recv-Q Send-Q          Local Address:Port           Peer Address:Port Process                                                 
ESTAB 0      56              192.168.2.123:22            192.168.1.100:47978 users:(("sshd",pid=61493,fd=3),("sshd",pid=61461,fd=3))
ESTAB 0      0               192.168.2.123:32834            10.100.0.1:443   users:(("controller",pid=3499,fd=12))                  
ESTAB 0      0               192.168.2.123:60346           3.37.179.56:443   users:(("kube-proxy",pid=3113,fd=9))                   
ESTAB 0      0               192.168.2.123:47652           3.37.34.120:443   users:(("aws-k8s-agent",pid=3376,fd=7))                
ESTAB 0      0               192.168.2.123:40712          52.95.195.99:443   users:(("ssm-agent-worke",pid=2482,fd=14))             
ESTAB 0      0               192.168.2.123:35944           3.37.34.120:443   users:(("kubelet",pid=2896,fd=12))                     
ESTAB 0      0      [::ffff:192.168.2.123]:10250 [::ffff:192.168.1.21]:39610 users:(("kubelet",pid=2896,fd=13))                     
ESTAB 0      0      [::ffff:192.168.2.123]:10250 [::ffff:192.168.2.91]:49546 users:(("kubelet",pid=2896,fd=24))                     
```

### **2. ì›Œì»¤ ë…¸ë“œì˜ API ì„œë²„ ì—°ê²° ë¶„ì„**

**ì›Œì»¤ ë…¸ë“œ 1 (Node1: 192.168.1.206)ì˜ API ì„œë²„ ì—°ê²°**

| ë¡œì»¬ ì£¼ì†Œ | ëŒ€ìƒ (API ì„œë²„) | ì—°ê²°ëœ í”„ë¡œì„¸ìŠ¤ | ì„¤ëª… |
| --- | --- | --- | --- |
| **192.168.1.206:53470** | **3.37.179.56:443** | kube-proxy | **kube-proxyê°€ API ì„œë²„ì™€ ì—°ê²°** |
| **192.168.1.206:57918** | **3.37.34.120:443** | kubelet | **kubeletì´ API ì„œë²„ì™€ ì—°ê²°** |

- Public í´ëŸ¬ìŠ¤í„°ì´ë¯€ë¡œ **ì¸í„°ë„·ì„ í†µí•´ API ì„œë²„ì™€ í†µì‹ **
- API ì„œë²„ì™€ì˜ ì—°ê²°ì´ **ì™¸ë¶€ íŠ¸ë˜í”½ìœ¼ë¡œ ë‚˜ê°”ë‹¤ê°€ ë‹¤ì‹œ ë“¤ì–´ì˜¤ëŠ” êµ¬ì¡°**

**ì›Œì»¤ ë…¸ë“œ 2 (Node2: 192.168.2.123)ì˜ API ì„œë²„ ì—°ê²°**

| ë¡œì»¬ ì£¼ì†Œ | ëŒ€ìƒ (API ì„œë²„) | ì—°ê²°ëœ í”„ë¡œì„¸ìŠ¤ | ì„¤ëª… |
| --- | --- | --- | --- |
| **192.168.2.123:60346** | **3.37.179.56:443** | kube-proxy | **kube-proxyê°€ API ì„œë²„ì™€ ì—°ê²°** |
| **192.168.2.123:35944** | **3.37.34.120:443** | kubelet | **kubeletì´ API ì„œë²„ì™€ ì—°ê²°** |

- Node1ê³¼ ë™ì¼í•˜ê²Œ **Public í´ëŸ¬ìŠ¤í„° ë°©ì‹ìœ¼ë¡œ API ì„œë²„ì™€ í†µì‹ **
- **ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ API ì„œë²„ì— ì ‘ê·¼**í•˜ëŠ” êµ¬ì¡°

### **3. API ì„œë²„ì˜ ê³µì¸ IP ì£¼ì†Œ í™•ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# APIDNS=$(aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint | cut -d '/' -f 3)
(eks-user@myeks:default) [root@myeks-host ~]# dig +short $APIDNS
```

âœ… **ì¶œë ¥**

```bash
3.37.34.120
3.37.179.56
```

âœ… **ì„¤ëª…**

- API ì„œë²„ëŠ” **í¼ë¸”ë¦­ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ ì ‘ê·¼ ê°€ëŠ¥**
- `kube-proxy`, `kubelet`ì´ **EKS API ì„œë²„ì™€ ì—°ê²°ì„ ìœ ì§€í•˜ë©° ìƒíƒœë¥¼ ë™ê¸°í™”**


![Image](https://github.com/user-attachments/assets/d25495d5-923c-499e-a4fd-9d1fc9ef34fe)

## **ğŸ›œ 20. Netshoot ì»¨í…Œì´ë„ˆë¥¼ ì´ìš©í•œ ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹… ë° API ì„œë²„ ì—°ê²° í™•ì¸**

EKS í´ëŸ¬ìŠ¤í„°ì—ì„œ **Netshoot ì»¨í…Œì´ë„ˆë¥¼ í™œìš©í•˜ì—¬ ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹…ì„ ìˆ˜í–‰í•˜ê³ , API ì„œë²„ì™€ kubelet ê°„ì˜ ì—°ê²° íë¦„ì„ ë¶„ì„**

### **1. Netshoot ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ë° ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸**

NetshootëŠ” ë„¤íŠ¸ì›Œí¬ ë””ë²„ê¹… ë„êµ¬ê°€ í¬í•¨ëœ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€

**1.1 Netshoot ì»¨í…Œì´ë„ˆ ì‹¤í–‰**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl run -it --rm netdebug --image=nicolaka/netshoot --restart=Never -- zsh
If you don't see a command prompt, try pressing enter.
                    dP            dP                           dP   
                    88            88                           88   
88d888b. .d8888b. d8888P .d8888b. 88d888b. .d8888b. .d8888b. d8888P 
88'  `88 88ooood8   88   Y8ooooo. 88'  `88 88'  `88 88'  `88   88   
88    88 88.  ...   88         88 88    88 88.  .88 88.  .88   88   
dP    dP `88888P'   dP   `88888P' dP    dP `88888P' `88888P'   dP   
                                                                    
Welcome to Netshoot! (github.com/nicolaka/netshoot)
Version: 0.13
```

**1.2 Netshoot ì»¨í…Œì´ë„ˆì˜ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ í™•ì¸**

```
ip -c a
```

âœ… **ì¶œë ¥**

```
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
3: eth0@if6: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 9001 qdisc noqueue state UP group default 
    link/ether 0e:d0:75:ed:87:3f brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 192.168.2.179/32 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::cd0:75ff:feed:873f/64 scope link 
       valid_lft forever preferred_lft forever
```

### **2. API ì„œë²„ì™€ kubelet ì—°ê²° í™•ì¸**

**2.1 Netshoot ì»¨í…Œì´ë„ˆì—ì„œ kubelet ì—°ê²° ê°ì§€**

```bash
watch uptime
```

âœ… ì„¤ëª…

- ì§€ì†ì ì¸ API í˜¸ì¶œì„ ë°œìƒì‹œì¼œ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ë³€í™”ë¥¼ ê°ì§€ ê°€ëŠ¥

**2.2 ì›Œì»¤ ë…¸ë“œì—ì„œ TCP ì—°ê²° ìƒíƒœ í™•ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# for i in $N1 $N2; do echo ">> node $i <<"; ssh ec2-user@$i sudo ss -tnp; echo; done
```

âœ… **ì¶œë ¥**

```bash
>> node 192.168.1.206 <<
State Recv-Q Send-Q          Local Address:Port           Peer Address:Port Process                                                 
ESTAB 0      0               192.168.1.206:38756         52.95.195.109:443   users:(("ssm-agent-worke",pid=2462,fd=14))             
ESTAB 0      0               192.168.1.206:42540           3.37.179.56:443   users:(("aws-k8s-agent",pid=3366,fd=7))                
ESTAB 0      56              192.168.1.206:22            192.168.1.100:51074 users:(("sshd",pid=71668,fd=3),("sshd",pid=71636,fd=3))
ESTAB 0      0               192.168.1.206:53470           3.37.34.120:443   users:(("kube-proxy",pid=3109,fd=9))                   
ESTAB 0      0               192.168.1.206:48848            10.100.0.1:443   users:(("controller",pid=3482,fd=12))                  
ESTAB 0      0               192.168.1.206:57918           3.37.179.56:443   users:(("kubelet",pid=2889,fd=28))                     
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.1.21]:41106 users:(("kubelet",pid=2889,fd=13))                     
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.2.91]:45266 users:(("kubelet",pid=2889,fd=22))                     

>> node 192.168.2.123 <<
State Recv-Q Send-Q          Local Address:Port            Peer Address:Port Process                                                 
ESTAB 0      56              192.168.2.123:22             192.168.1.100:34654 users:(("sshd",pid=72153,fd=3),("sshd",pid=72121,fd=3))
ESTAB 0      0                   127.0.0.1:52426              127.0.0.1:34123 users:(("kubelet",pid=2896,fd=27))                     
ESTAB 0      0               192.168.2.123:32834             10.100.0.1:443   users:(("controller",pid=3499,fd=12))                  
ESTAB 0      0               192.168.2.123:60346            3.37.179.56:443   users:(("kube-proxy",pid=3113,fd=9))                   
ESTAB 0      0               192.168.2.123:47652            3.37.34.120:443   users:(("aws-k8s-agent",pid=3376,fd=7))                
ESTAB 0      0                   127.0.0.1:34123              127.0.0.1:52426 users:(("containerd",pid=2770,fd=88))                  
ESTAB 0      0               192.168.2.123:40712           52.95.195.99:443   users:(("ssm-agent-worke",pid=2482,fd=14))             
ESTAB 0      0               192.168.2.123:35944            3.37.34.120:443   users:(("kubelet",pid=2896,fd=12))                     
ESTAB 0      0      [::ffff:192.168.2.123]:10250  [::ffff:192.168.1.21]:39610 users:(("kubelet",pid=2896,fd=13))                     
ESTAB 0      0      [::ffff:192.168.2.123]:10250 [::ffff:192.168.2.163]:47628 users:(("kubelet",pid=2896,fd=26))                     
ESTAB 0      0      [::ffff:192.168.2.123]:10250  [::ffff:192.168.2.91]:49546 users:(("kubelet",pid=2896,fd=24)) 
```

âœ… **kubelet í”„ë¡œì„¸ìŠ¤(PID 2896)ê°€ EKS Owned ENI(192.168.2.163)ì™€ ì—°ê²°ë¨**

```bash
ESTAB 0      0      [::ffff:192.168.2.123]:10250 [::ffff:192.168.2.163]:47628 users:(("kubelet",pid=2896,fd=26))
```

![Image](https://github.com/user-attachments/assets/f49b484a-912c-4320-8974-f4a64c549955)

**âœ… ì„¤ëª…**

- `192.168.2.123:10250` â†’ Worker Node 2ì˜ kubelet API í¬íŠ¸
- `192.168.2.163:47628` â†’ EKS Owned ENI (API ì„œë²„ê°€ ì‚¬ìš©í•˜ëŠ” ENI)
- kubeletì´ **EKS Owned ENIë¥¼ í†µí•´ API ì„œë²„ì™€ ì—°ê²°ë¨**


### **3. Netshoot ì»¨í…Œì´ë„ˆ ì¢…ë£Œ í›„ ì—°ê²° ë³€í™” í™•ì¸**

```bash
exit
pod "netdebug" deleted
pod default/netdebug terminated (Error)
```

**âœ… ì¢…ë£Œ í›„ TCP ì—°ê²° í™•ì¸**

```bash
for i in $N1 $N2; do echo ">> node $i <<"; ssh ec2-user@$i sudo ss -tnp; echo; done
```

```bash
ESTAB 0      0      [::ffff:192.168.2.123]:10250 [::ffff:192.168.2.163]:47628 users:(("kubelet",pid=2896,fd=26))
```

**ğŸš€ Netshoot ì¢…ë£Œ í›„, API ì„œë²„ì™€ kubelet ê°„ì˜ ì—°ê²°ì´ ì‚¬ë¼ì§**

### **4. API ì„œë²„ì™€ EKS Owned ENI ì—°ê²° íë¦„**

**ì—°ê²° íë¦„ ìš”ì•½**

> kubectl ì‹¤í–‰ â†’ API ì„œë²„ í˜¸ì¶œ (ê³µì¸ IP) â†’ EKS Owned ENI ê²½ìœ  â†’ ì›Œì»¤ ë…¸ë“œ kubelet
> 

âœ… ì„¤ëª…

- Public Cluster Endpoint Access í™˜ê²½ì—ì„œë„ API ì„œë²„ëŠ” **ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ kubeletê³¼ ì—°ê²°ë¨**
- kubeletì€ **EKS Owned ENIë¥¼ í†µí•´ API ì„œë²„ì™€ í†µì‹ **

ğŸš€ í¼ë¸”ë¦­ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í•´ë„ ë‚´ë¶€ì ìœ¼ë¡œ kubeletê³¼ í†µì‹ í•  ë•ŒëŠ” **Private ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©**

### **5. EKS Owned ENIì˜ ì†Œìœ ê¶Œ ë¶„ì„**

![Image](https://github.com/user-attachments/assets/d681e9a9-b8ef-491e-8e13-8e31ad85b0cf)
âœ… **EKS Owned ENIëŠ” ë‚´ AWS ê³„ì •(378102432899) ì†Œìœ ì´ì§€ë§Œ, ì—°ê²°ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ ì†Œìœ ìëŠ” AWS(514342867336)**

âœ… **ì†Œìœ ê¶Œ ì°¨ì´ ë¶„ì„** 

- **ENI(ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤)ëŠ” AWS ê³„ì •(378102432899) ì†Œìœ **
- **í•´ë‹¹ ENIê°€ ì—°ê²°ëœ EC2 ì¸ìŠ¤í„´ìŠ¤ëŠ” AWS ê´€ë¦¬í˜• ë¦¬ì†ŒìŠ¤**

ğŸš€ **ì¦‰, API ì„œë²„ëŠ” í¼ë¸”ë¦­ ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì œê³µí•˜ì§€ë§Œ ë‚´ë¶€ì ìœ¼ë¡œ kubeletê³¼ í†µì‹ í•  ë•ŒëŠ” Private ë„¤íŠ¸ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë©° ë³´ì•ˆì„±ê³¼ ê´€ë¦¬ í¸ì˜ì„±ì„ ìœ ì§€í•¨**


---

## **ğŸ”§ EKS Cluster Endpointë¥¼ Public(IPì œí•œ)+Private ë¡œ ë³€ê²½**

EKS í´ëŸ¬ìŠ¤í„°ì˜ API Server Endpoint ì„¤ì •ì„ **Public(ì œí•œëœ IPë§Œ ì ‘ê·¼ ê°€ëŠ¥) + Private**ë¡œ ë³€ê²½í•˜ì—¬, ë‚´ë¶€ íŠ¸ë˜í”½ì€ Private Endpointë¥¼ ì‚¬ìš©í•˜ê³  ì™¸ë¶€ íŠ¸ë˜í”½ì€ íŠ¹ì • IPì—ì„œë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •

### **1. í˜„ì¬ ì„¤ì • í™•ì¸**

âœ… **í˜„ì¬ API Server Endpoint ìƒíƒœ**

- Public Endpoint í™œì„±í™” (`0.0.0.0/0` í—ˆìš©)
- Private Endpoint ë¹„í™œì„±í™”

![Image](https://github.com/user-attachments/assets/407edbf7-0f2d-42ad-8972-d3d4c0d00714)

âœ… **í´ëŸ¬ìŠ¤í„° ë„ë©”ì¸ ì£¼ì†Œ (F5010046882B83E478ED4CDA5EA08828.gr7.ap-northeast-2.eks.amazonaws.com) í™•ì¸**

![Image](https://github.com/user-attachments/assets/4bd282c9-e491-405e-bd1d-b0170b80659c)

âœ… **API ì„œë²„ ë„ë©”ì¸ ì¡°íšŒ**

```bash
while true; do dig +short F5010046882B83E478ED4CDA5EA08828.gr7.ap-northeast-2.eks.amazonaws.com ; echo "------------------------------" ; date; sleep 1; done
```

âœ… **ì¶œë ¥**

```bash
3.37.34.120
3.37.179.56
------------------------------
Sat Feb  8 04:28:56 PM KST 2025
```

- í˜„ì¬ API ì„œë²„ ë„ë©”ì¸ì´ ê³µì¸ IPë¥¼ ì‘ë‹µí•˜ëŠ” ìƒíƒœ


### **2. ë…¸ë“œì™€ Control Plane ê°„ì˜ í†µì‹  ìƒíƒœ ëª¨ë‹ˆí„°ë§**

âœ… **kube-proxy, kubeletì´ ì–´ë–¤ IPì™€ ì—°ê²°ë˜ëŠ”ì§€ ëª¨ë‹ˆí„°ë§**

```bash
N1=$(kubectl get node --label-columns=topology.kubernetes.io/zone --selector=topology.kubernetes.io/zone=ap-northeast-2a -o jsonpath={.items[0].status.addresses[0].address})
N2=$(kubectl get node --label-columns=topology.kubernetes.io/zone --selector=topology.kubernetes.io/zone=ap-northeast-2c -o jsonpath={.items[0].status.addresses[0].address})
**while true; do ssh ec2-user@$N1 sudo ss -tnp | egrep 'kubelet|kube-proxy' ; echo ; ssh ec2-user@$N2 sudo ss -tnp | egrep 'kubelet|kube-proxy' ; echo "------------------------------" ; date; sleep 1; done**
```

âœ… **ì„¤ëª…**

- **kube-proxy, kubeletì´ í˜„ì¬ ê³µì¸ IPë¥¼ í†µí•´ API ì„œë²„ì™€ í†µì‹  ì¤‘**
- **ë³€ê²½ í›„, ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œëŠ” Private IPë¥¼ ì‚¬ìš©í•˜ë„ë¡ í™•ì¸í•  ì˜ˆì •**

### **3. EKS í´ëŸ¬ìŠ¤í„° Endpoint ì„¤ì • ë³€ê²½**

âœ… **Public Endpointë¥¼ íŠ¹ì • IP(50.1.1.1)ë§Œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ ì œí•œ, Private Endpoint í™œì„±í™”**

```bash
aws eks update-cluster-config --region $AWS_DEFAULT_REGION --name $CLUSTER_NAME --resources-vpc-config **endpointPublicAccess=true,publicAccessCidrs="50.1.1.1/32",endpointPrivateAccess=true**
```

âœ… **ì„¤ëª…**

- `endpointPublicAccess=true` â†’ Public Endpoint ìœ ì§€
- `publicAccessCidrs="50.1.1.1/32"` â†’ **ì™¸ë¶€ì—ì„œ 50.1.1.1 IPì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥ (ê°•ì˜ì™€ ë™ì¼í•˜ê²Œ ì„¤ì •í•¨.. í…ŒìŠ¤íŠ¸ ê¼¬ì„ë°©ì§€)**
- `endpointPrivateAccess=true` â†’ **VPC ë‚´ë¶€ì—ì„œ Private Endpoint ì‚¬ìš© ê°€ëŠ¥**

âœ… **ì—…ë°ì´íŠ¸ ì§„í–‰ ì¤‘ì¸ ìƒíƒœ í™•ì¸**

![Image](https://github.com/user-attachments/assets/b5804dc7-10d1-438d-92d7-799b8c015be4)

### **4. ë³€ê²½ëœ API ì„œë²„ ë„ë©”ì¸ ì •ë³´ í™•ì¸**

âœ… **API ì„œë²„ ì—”ë“œí¬ì¸íŠ¸ ì¡°íšŒ**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# APIDNS=$(aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint | cut -d '/' -f 3)
(eks-user@myeks:default) [root@myeks-host ~]# dig +short $APIDNS
3.37.179.56
3.37.34.120
```

âœ… **ë³€ê²½ í›„ ì§€ì†ì ì¸ í™•ì¸**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# while true; do dig +short $APIDNS ; echo "------------------------------" ; date; sleep 1; done
3.37.34.120
3.37.179.56
------------------------------
Sat Feb  8 16:38:45 KST 2025
```

âœ… **ì—…ë°ì´íŠ¸ ì™„ë£Œ**

Publicê³¼ Private Endpointê°€ ì ìš©ë˜ì–´, ë‚´ë¶€ì—ì„œëŠ” Private IPë¥¼, ì™¸ë¶€ì—ì„œëŠ” Public IPë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.


![Image](https://github.com/user-attachments/assets/0d5bb2d4-36ba-443d-83bd-f46a5e67334e)

### **5. ë„ë©”ì¸ ì§ˆì˜ ì‘ë‹µ ê²°ê³¼ ë¹„êµ**

âœ… **VPC ë‚´ë¶€ì—ì„œ ì‹¤í–‰í•œ ë„ë©”ì¸ ì§ˆì˜ ê²°ê³¼ (Private Endpoint í™•ì¸) - ì˜¤ë¥¸ìª½ ìƒë‹¨**

- ë‚´ë¶€ì—ì„œëŠ” **EKS Owned ENIì˜ Private IP**ê°€ ë°˜í™˜ë¨
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ API ì„œë²„ì— ì§ì ‘ ì—°ê²° ê°€ëŠ¥

âœ… **ì™¸ë¶€ì—ì„œ ì‹¤í–‰í•œ ë„ë©”ì¸ ì§ˆì˜ ê²°ê³¼ (Public Endpoint í™•ì¸) - ì˜¤ë¥¸ìª½ í•˜ë‹¨**

- ì™¸ë¶€ì—ì„œëŠ” **Public IP**ê°€ ë°˜í™˜ë¨
- ì„¤ì •í•œ **Public Access CIDR(í—ˆìš©ëœ IP ë²”ìœ„ ë‚´)**ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥


![Image](https://github.com/user-attachments/assets/98199bf9-e1c1-4f12-9eb1-907d73367bea)

**âœ… ê²°ê³¼ ë¶„ì„**

- ë‚´ë¶€ VPC í™˜ê²½ì—ì„œëŠ” Private IPë¥¼ ì‚¬ìš©í•˜ì—¬ API ì„œë²„ì— ì ‘ê·¼ ê°€ëŠ¥
- ì™¸ë¶€ì—ì„œëŠ” Public IPë¥¼ í†µí•´ ì œí•œëœ ì ‘ê·¼ë§Œ ê°€ëŠ¥
- Private Endpoint í™œì„±í™” í›„ `kubelet` ë° `kube-proxy`ê°€ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ í†µì‹ í•˜ë„ë¡ ì„¤ì • ì™„ë£Œ



### **6. EKS Owned ENI ì ìš© ë° ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •**

âœ… **EKS API ì„œë²„ê°€ Owned ENIë¥¼ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½ë¨**

- ë‚´ë¶€ VPCì—ì„œ API ì„œë²„ì— ì ‘ê·¼í•  ë•Œ **EKS Owned ENIì˜ Private IP**ê°€ ë°˜í™˜ë¨
- VPC ë‚´ **Bastion Host**ê°€ EKS Owned ENIë¡œ ì ‘ê·¼í•´ì•¼ í•¨
- í•˜ì§€ë§Œ í˜„ì¬ ì™¸ë¶€ì—ì„œëŠ” ì—¬ì „íˆ **Public IP**ë¥¼ ë°˜í™˜ ì¤‘

**6-1. EKS Control Plane ë³´ì•ˆ ê·¸ë£¹ì— ì‘ì—…ìš© EC2 ì ‘ê·¼ í—ˆìš©**

EKS Owned ENIë¥¼ í†µí•´ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ API ì„œë²„ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´, **Control Plane ë³´ì•ˆ ê·¸ë£¹**ì— ì ‘ê·¼ í—ˆìš© ë£°ì„ ì¶”ê°€

âœ… **Control Plane ë³´ì•ˆ ê·¸ë£¹ ID í™•ì¸**

```bash
# EKS ControlPlane ë³´ì•ˆê·¸ë£¹ ID í™•ì¸
(eks-user@myeks:default) [root@myeks-host ~]# CPSGID=$(aws ec2 describe-security-groups --filters Name=group-name,Values=*ControlPlaneSecurityGroup* --query "SecurityGroups[*].[GroupId]" --output text)
(eks-user@myeks:default) [root@myeks-host ~]# echo $CPSGID
sg-0b8417747083986a6
```

âœ… **Bastion Host(192.168.1.100)ì—ì„œ API ì„œë²„ ì ‘ê·¼ í—ˆìš© ì¶”ê°€**

```bash
# ë…¸ë“œ ë³´ì•ˆê·¸ë£¹ì— eksctl-host ì—ì„œ ë…¸ë“œ(íŒŒë“œ)ì— ì ‘ì† ê°€ëŠ¥í•˜ê²Œ ë£°(Rule) ì¶”ê°€ ì„¤ì •
(eks-user@myeks:default) [root@myeks-host ~]# aws ec2 authorize-security-group-ingress --group-id $CPSGID --protocol '-1' --cidr 192.168.1.100/32
{
    "Return": true,
    "SecurityGroupRules": [
        {
            "SecurityGroupRuleId": "sgr-0e1cbc756c940c815",
            "GroupId": "sg-0b8417747083986a6",
            "GroupOwnerId": "378102432899",
            "IsEgress": false,
            "IpProtocol": "-1",
            "FromPort": -1,
            "ToPort": -1,
            "CidrIpv4": "192.168.1.100/32",
            "SecurityGroupRuleArn": "arn:aws:ec2:ap-northeast-2:378102432899:security-group-rule/sgr-0e1cbc756c940c815"
        }
    ]
}
```


**6-2. ì—…ë°ì´íŠ¸ í›„ ë‹¤ì‹œ ë„ë©”ì¸ ì§ˆì˜**

```bash
APIDNS=$(aws eks describe-cluster --name $CLUSTER_NAME | jq -r .cluster.endpoint | cut -d '/' -f 3)
dig +short $APIDNS
while true; do dig +short $APIDNS ; echo "------------------------------" ; date; sleep 1; done
```

âœ…**ì´ì œ VPC ë‚´ë¶€ì—ì„œ API ì„œë²„ ë„ë©”ì¸ì„ ì§ˆì˜í•˜ë©´, EKS Owned ENIì˜ Private IPê°€ ë°˜í™˜ë¨**

âœ… ë‚´ë¶€ íŠ¸ë˜í”½ì´ Public IPë¥¼ ê±°ì¹˜ì§€ ì•Šê³  Private ë„¤íŠ¸ì›Œí¬ì—ì„œ ì²˜ë¦¬ë¨


![Image](https://github.com/user-attachments/assets/157f5335-52bf-4688-9f7e-49fd74fcf0d6)

EKS API ì„œë²„ì˜ **ë„ë©”ì¸ ì§ˆì˜ ê²°ê³¼ê°€ EKS Owned ENIë¡œ ë³€ê²½ëœ ê²ƒ**ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

âœ… **VPC ë‚´ë¶€ì—ì„œ API ì„œë²„ ë„ë©”ì¸ì„ ì§ˆì˜í•˜ë©´,**

- ë™ì¼í•œ ë„ë©”ì¸ì´ì§€ë§Œ **EKS Owned ENIì˜ Private IP**ë¥¼ ë°˜í™˜
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ API ì„œë²„ì™€ **Private í†µì‹  ê°€ëŠ¥**

ğŸš€ **ì¦‰, ë‚´ë¶€ íŠ¸ë˜í”½ì€ Public IPë¥¼ ê±°ì¹˜ì§€ ì•Šê³  Private ë„¤íŠ¸ì›Œí¬ì—ì„œ ì²˜ë¦¬ë¨**


![Image](https://github.com/user-attachments/assets/63e5ff2b-f0a0-4813-9009-b98d3868f11c)


### **7. `kube-proxy` ë° `kubelet`ì˜ API ì„œë²„ ì—°ê²° ë°©ì‹ ë³€ê²½**

âœ… **ê¸°ì¡´ ìƒíƒœ**

- `kube-proxy`ì™€ `kubelet`ì´ **ê³µì¸ IP(ì˜ˆ: `3.37.34.120`, `3.37.179.56`)** ë¥¼ í†µí•´ API ì„œë²„ì™€ í†µì‹ 
- ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œë„ íŠ¸ë˜í”½ì´ ì™¸ë¶€ë¡œ ë‚˜ê°”ë‹¤ê°€ ë‹¤ì‹œ API ì„œë²„ë¡œ ì „ë‹¬ë˜ëŠ” êµ¬ì¡°

âœ… **ì¶œë ¥ (ë³€ê²½ ì „ ìƒíƒœ)**

```bash
------------------------------
Sat Feb  8 16:56:19 KST 2025
ESTAB 0      0               192.168.1.206:53470           3.37.34.120:443   users:(("kube-proxy",pid=3109,fd=9))                     
ESTAB 0      0               192.168.1.206:57918           3.37.179.56:443   users:(("kubelet",pid=2889,fd=28))                       
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.1.21]:41106 users:(("kubelet",pid=2889,fd=13))                       
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.2.91]:45266 users:(("kubelet",pid=2889,fd=22))                       

ESTAB 0      0               192.168.2.119:41294           3.37.34.120:443   users:(("kubelet",pid=2892,fd=26))                       
ESTAB 0      0               192.168.2.119:34822           3.37.179.56:443   users:(("kube-proxy",pid=3170,fd=9))                     
ESTAB 0      0      [::ffff:192.168.2.119]:10250 [::ffff:192.168.1.21]:52840 users:(("kubelet",pid=2892,fd=12))                       
ESTAB 0      0      [::ffff:192.168.2.119]:10250 [::ffff:192.168.2.91]:33510 users:(("kubelet",pid=2892,fd=15))                       
------------------------------
```

âœ… **ì„¤ì • ë³€ê²½ ì ìš©**  (`kube-proxy`ê°€ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ API ì„œë²„ì™€ ì—°ê²°ë˜ë„ë¡ ìˆ˜ì •)

`kube-proxy` ë°ëª¬ì…‹ ì¬ì‹œì‘

```bash
(eks-user@myeks:default) [root@myeks-host ~]# kubectl rollout restart ds/kube-proxy -n kube-system
daemonset.apps/kube-proxy restarted
```

âœ… ë³€ê²½ í›„ `kube-proxy`ì˜ API ì„œë²„ ì ‘ê·¼ ë°©ì‹ í™•ì¸

`kube-proxy`ê°€ **Public IP(**`3.37.34.120:443`)**ê°€ ì•„ë‹Œ EKS Owned ENIì˜ Private IP**(`192.168.1.219`)ë¡œ API ì„œë²„ì— ì—°ê²°ë¨

```bash
------------------------------
Sat Feb  8 17:05:07 KST 2025
ESTAB 0      0               192.168.1.206:35464         192.168.1.219:443   users:(("kube-proxy",pid=243935,fd=9))                   
ESTAB 0      0               192.168.1.206:57918           3.37.179.56:443   users:(("kubelet",pid=2889,fd=28))                       
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.1.21]:41106 users:(("kubelet",pid=2889,fd=13))                       
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.2.91]:45266 users:(("kubelet",pid=2889,fd=22))                       

ESTAB 0      0               192.168.2.119:49312         192.168.1.219:443   users:(("kube-proxy",pid=144393,fd=9))                   
ESTAB 0      0               192.168.2.119:41294           3.37.34.120:443   users:(("kubelet",pid=2892,fd=26))                       
ESTAB 0      0      [::ffff:192.168.2.119]:10250 [::ffff:192.168.1.21]:52840 users:(("kubelet",pid=2892,fd=12))                       
ESTAB 0      0      [::ffff:192.168.2.119]:10250 [::ffff:192.168.2.91]:33510 users:(("kubelet",pid=2892,fd=15))                       
------------------------------
```

âœ… **`kubelet`ë„ ë™ì¼í•˜ê²Œ ë³€ê²½ ì ìš©**

**ê° ë…¸ë“œì—ì„œ `kubelet`ì„ ì¬ì‹œì‘í•˜ì—¬ ì„¤ì • ë°˜ì˜**

```bash
(eks-user@myeks:default) [root@myeks-host ~]# for i in $N1 $N2; do echo ">> node $i <<"; ssh ec2-user@$i sudo systemctl restart kubelet; echo; done
>> node 192.168.1.206 <<

>> node 192.168.2.123 <<
```

âœ… **ë³€ê²½ í›„ `kubelet`ì˜ API ì„œë²„ ì ‘ê·¼ ë°©ì‹ í™•ì¸**

- **ë³€ê²½ ì „:** `3.37.179.56:443` (Public IP)
- **ë³€ê²½ í›„:** `192.168.2.163:443` (EKS Owned ENIì˜ Private IP)

```bash
------------------------------
Sat Feb  8 17:09:05 KST 2025
ESTAB 0      0               192.168.1.206:35464         192.168.1.219:443   users:(("kube-proxy",pid=243935,fd=9))                   
ESTAB 0      0               192.168.1.206:51064         192.168.2.163:443   users:(("kubelet",pid=252609,fd=18))                     
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.1.21]:48944 users:(("kubelet",pid=252609,fd=23))                     
ESTAB 0      0      [::ffff:192.168.1.206]:10250 [::ffff:192.168.2.91]:37384 users:(("kubelet",pid=252609,fd=24))                     

ESTAB 0      0               192.168.2.119:49312         192.168.1.219:443   users:(("kube-proxy",pid=144393,fd=9))                   
ESTAB 0      0               192.168.2.119:41294           3.37.34.120:443   users:(("kubelet",pid=2892,fd=26))                       
ESTAB 0      0      [::ffff:192.168.2.119]:10250 [::ffff:192.168.1.21]:52840 users:(("kubelet",pid=2892,fd=12))                       
ESTAB 0      0      [::ffff:192.168.2.119]:10250 [::ffff:192.168.2.91]:33510 users:(("kubelet",pid=2892,fd=15))                       
------------------------------
```

âœ… **ê²°ê³¼**

- **ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ `kubelet`ê³¼ `kube-proxy`ê°€ Public IPë¥¼ ê±°ì¹˜ì§€ ì•Šê³  API ì„œë²„ì— ì§ì ‘ ì—°ê²°**
- **EKS Owned ENIë¥¼ í™œìš©í•˜ì—¬ ë‚´ë¶€ íŠ¸ë˜í”½ì´ Private ë„¤íŠ¸ì›Œí¬ì—ì„œ ì²˜ë¦¬ë¨**
- **API ì„œë²„ ë³´ì•ˆ ê°•í™” ë° ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥ ìµœì í™” ì™„ë£Œ**


---

## **ì„ ì–¸í˜• (ë©±ë“±ì„±) ì•Œì•„ë³´ê¸°**

### **1. íŒŒë“œ ìƒì„± ë° ëª¨ë‹ˆí„°ë§**

**í„°ë¯¸ë„ 1:** ì‹¤ì‹œê°„ìœ¼ë¡œ íŒŒë“œ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§

```bash
watch -d 'kubectl get pod'
```


í„°ë¯¸ë„ 2: `Deployment`ë¥¼ ìƒì„±í•˜ê³  **ë ˆí”Œë¦¬ì¹´(3ê°œ) ì„¤ì •**

```bash
kubectl create deployment **my-webs** --image=gcr.io/google-samples/kubernetes-bootcamp:v1 **--replicas=3**
```

![Image](https://github.com/user-attachments/assets/b8f2c900-e5d5-4858-9a12-e48215e40549)


### **2. íŒŒë“œ ê°œìˆ˜ ì¡°ì • (í™•ì¥ & ì¶•ì†Œ)**

**íŒŒë“œ ê°œìˆ˜ ì¦ê°€ (3ê°œ â†’ 6ê°œ)**

```bash
kubectl scale deployment my-webs **--replicas=6** && kubectl get pod -w
```

![Image](https://github.com/user-attachments/assets/5cba5b9a-2bde-4854-bba3-ab6c640ee30c)


**íŒŒë“œ ê°œìˆ˜ ê°ì†Œ (6ê°œ â†’ 3ê°œ)**

```bash
# íŒŒë“œ ê°ì†Œ
kubectl scale **deployment** my-webs **--replicas=3**
```

![Image](https://github.com/user-attachments/assets/470b4b99-5c0a-49ed-b893-3a46e980949f)

![Image](https://github.com/user-attachments/assets/2af0bbe4-bfec-4022-8e1d-e6d6a93592ce)


### **3. ê°•ì œ ì‚­ì œ í›„ ìë™ ë³µêµ¬ í™•ì¸**

**ëª¨ë“  íŒŒë“œ ì‚­ì œ (ê°•ì œ ì œê±°)**
```

```bash
kubectl delete pod --all && kubectl get pod -w
```


![Image](https://github.com/user-attachments/assets/aa0b7a84-73ed-48e6-9eb8-44b6310dd569)


**ì‚­ì œ í›„ì—ë„ `Deployment` ì„¤ì •ì— ë”°ë¼ ìë™ìœ¼ë¡œ 3ê°œê°€ ë‹¤ì‹œ ìƒì„±ë¨**


![Image](https://github.com/user-attachments/assets/b41fbdde-1777-4041-b29a-f87c85b03dd7)


âœ… **ê²°ê³¼:** KubernetesëŠ” ì„ ì–¸í˜• ë°©ì‹ìœ¼ë¡œ ê´€ë¦¬ë˜ë¯€ë¡œ,

- `Deployment`ì—ì„œ ì„¤ì •í•œ **replicas=3**ì— ë§ì¶° **ìë™ìœ¼ë¡œ íŒŒë“œë¥¼ ë³µêµ¬**
- ì´ë¥¼ í†µí•´ **ë©±ë“±ì„±(Idempotency)** ê°œë…ì„ ì‹¤ìŠµ ê°€ëŠ¥

**ì‹¤ìŠµ ì™„ë£Œ í›„ Deployment ì‚­ì œ**

```bash
kubectl delete deploy my-webs
```


## **EC2 ë° EKS ë…¸ë“œ ê·¸ë£¹ ëª¨ë‹ˆí„°ë§ & í™•ì¥ ì‹¤ìŠµ**

### **1. EC2 ì¸ìŠ¤í„´ìŠ¤ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**

âœ… **í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒíƒœë¥¼ ì§€ì†ì ìœ¼ë¡œ í™•ì¸**

```bash
while true; do aws ec2 describe-instances --query "Reservations[*].Instances[*].{PublicIPAdd:PublicIpAddress,PrivateIPAdd:PrivateIpAddress,InstanceName:Tags[?Key=='Name']|[0].Value,Status:State.Name}" --filters Name=instance-state-name,Values=running --output text ; echo "------------------------------" ; sleep 1; done
```

âœ… **ê²°ê³¼**

- **EC2 ì¸ìŠ¤í„´ìŠ¤ì˜ Public/Private IP, ì´ë¦„, ìƒíƒœ**ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¶œë ¥
- í´ëŸ¬ìŠ¤í„° ë…¸ë“œì˜ ì¦ê°€/ê°ì†Œ ìƒíƒœë¥¼ ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥

### **2. í˜„ì¬ EKS ë…¸ë“œ ê·¸ë£¹ ì •ë³´ í™•ì¸**

```bash
eksctl get nodegroup --cluster $CLUSTER_NAME --name $CLUSTER_NAME-nodegroup
```

### **3. EKS ë…¸ë“œ ê·¸ë£¹ í¬ê¸° í™•ì¥ (2ê°œ â†’ 3ê°œë¡œ ì¦ê°€)**

**ê¸°ì¡´ ë…¸ë“œ ê°œìˆ˜(2ê°œ)ë¥¼ 3ê°œë¡œ í™•ì¥**

```bash
# ë…¸ë“œ 2ê°œ â†’ 3ê°œ ì¦ê°€
eksctl scale nodegroup --cluster $CLUSTER_NAME --name $CLUSTER_NAME-nodegroup --nodes 3 --nodes-min 3 --nodes-max 6
```

âœ… **ê²°ê³¼**

- **ìƒˆë¡œìš´ ë…¸ë“œ (`192.168.2.119`)ê°€ ì¶”ê°€ë¨**
- ê¸°ì¡´ **2ê°œ â†’ 3ê°œë¡œ í™•ì¥ ì™„ë£Œ**
- í´ëŸ¬ìŠ¤í„° ë…¸ë“œ ê°œìˆ˜ ì¡°ì •
    - **ìµœì†Œ 3ê°œ (`-nodes-min=3`)**
    - **ìµœëŒ€ 6ê°œ (`-nodes-max=6`)**
    - **í˜„ì¬ 3ê°œ (`-nodes=3`)**

ğŸš€ **í™•ì¥ í›„, `192.168.2.119` ë…¸ë“œê°€ ì¶”ê°€ë˜ì–´ í´ëŸ¬ìŠ¤í„° ìš©ëŸ‰ ì¦ê°€**


![Image](https://github.com/user-attachments/assets/914eadc0-f3db-4805-9ed3-42f6108c0c60)




