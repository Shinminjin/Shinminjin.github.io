---
title: AEWS 8ì£¼ì°¨ ì •ë¦¬
date: 2025-03-29 21:30:00 +0900
categories: [EKS]
tags: [AEWS]
---

## **ğŸ”§ ì‹¤ìŠµí™˜ê²½ êµ¬ì„±**

### **1. docker-compose-plugin ì„¤ì¹˜ - x86_64**

```bash
sudo mkdir -p /usr/local/lib/docker/cli-plugins
sudo curl -SL https://github.com/docker/compose/releases/latest/download/docker-compose-linux-x86_64 -o /usr/local/lib/docker/cli-plugins/docker-compose
sudo chmod +x /usr/local/lib/docker/cli-plugins/docker-compose
docker compose version
```

### **2. ì‘ì—… ë””ë ‰í† ë¦¬ ìƒì„± í›„ ì´ë™**

```bash
mkdir cicd-labs
cd cicd-labs
```

### **3. Docker Compose íŒŒì¼ ìƒì„± íŒŒì¼ ìƒì„±**

```bash
cat <<EOT > docker-compose.yaml
services:

  jenkins:
    container_name: jenkins
    image: jenkins/jenkins
    restart: unless-stopped
    networks:
      - cicd-network
    ports:
      - "8080:8080"
      - "50000:50000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - jenkins_home:/var/jenkins_home

  gogs:
    container_name: gogs
    image: gogs/gogs
    restart: unless-stopped
    networks:
      - cicd-network
    ports:
      - "10022:22"
      - "3000:3000"
    volumes:
      - gogs-data:/data

volumes:
  jenkins_home:
  gogs-data:

networks:
  cicd-network:
    driver: bridge
EOT
```

### **4. Docker Compose ì‹¤í–‰**

```bash
docker compose up -d
```

âœ…Â **ì¶œë ¥**

```bash
[+] Running 21/21
 âœ” jenkins Pulled                                                                                                                           20.4s 
   âœ” 7cd785773db4 Pull complete                                                                                                              9.6s 
   âœ” 4323b613447d Pull complete                                                                                                             11.4s 
   âœ” eec1952536a9 Pull complete                                                                                                             11.6s 
   âœ” b9fcd549558d Pull complete                                                                                                             11.6s 
   âœ” 743c1c69eb66 Pull complete                                                                                                             11.6s 
   âœ” 2b005e8acf52 Pull complete                                                                                                             15.3s 
   âœ” e7e22a1da8f6 Pull complete                                                                                                             15.4s 
   âœ” 5daee7ea5eb6 Pull complete                                                                                                             15.5s 
   âœ” bbb418a8a466 Pull complete                                                                                                             17.0s 
   âœ” ccfc3f9a95cb Pull complete                                                                                                             17.0s 
   âœ” b6a32e0eef53 Pull complete                                                                                                             17.0s 
   âœ” 5faefa2d0cdc Pull complete                                                                                                             17.0s 
 âœ” gogs Pulled                                                                                                                              22.8s 
   âœ” f18232174bc9 Pull complete                                                                                                             14.2s 
   âœ” b6b017e7a7f5 Pull complete                                                                                                             16.8s 
   âœ” c80b57c5e4ee Pull complete                                                                                                             16.8s 
   âœ” 1760f004baf4 Pull complete                                                                                                             16.8s 
   âœ” 629cc8eb21da Pull complete                                                                                                             16.9s 
   âœ” 894de22ca6a0 Pull complete                                                                                                             19.3s 
   âœ” af5aa0b7df25 Pull complete                                                                                                             19.4s 
[+] Running 5/5
 âœ” Network cicd-labs_cicd-network   Created                                                                                                  0.0s 
 âœ” Volume "cicd-labs_gogs-data"     Created                                                                                                  0.0s 
 âœ” Volume "cicd-labs_jenkins_home"  Created                                                                                                  0.0s 
 âœ” Container gogs                   Started                                                                                                  0.2s 
 âœ” Container jenkins                Started                                                                                                  0.2s 
```

### **5. ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸**

```bash
docker compose ps
```

âœ…Â **ì¶œë ¥**

```bash
NAME      IMAGE             COMMAND                  SERVICE   CREATED          STATUS                             PORTS
gogs      gogs/gogs         "/app/gogs/docker/stâ€¦"   gogs      12 seconds ago   Up 12 seconds (health: starting)   0.0.0.0:3000->3000/tcp, [::]:3000->3000/tcp, 0.0.0.0:10022->22/tcp, [::]:10022->22/tcp
jenkins   jenkins/jenkins   "/usr/bin/tini -- /uâ€¦"   jenkins   12 seconds ago   Up 12 seconds                      0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp, 0.0.0.0:50000->50000/tcp, [::]:50000->50000/tcp
```

### **6. ì»¨í…Œì´ë„ˆ ê¸°ë³¸ ì •ë³´ í™•ì¸**

```bash
for i in gogs jenkins ; do echo ">> container : $i <<"; docker compose exec $i sh -c "whoami && pwd"; echo; done
```

âœ…Â **ì¶œë ¥**

```bash
>> container : gogs <<
root
/app/gogs

>> container : jenkins <<
jenkins
/
```

### **7. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì ‘ì† ë° ì¢…ë£Œ**

```bash
docker compose exec jenkins bash

jenkins@12f4b7ed7515:/$ exit
exit
```

```bash
docker compose exec gogs bash

a0dda4a63d1b:/app/gogs# exit
exit
```

### **8. Jenkins ì´ˆê¸° ì•”í˜¸ í™•ì¸**

```bash
docker compose exec jenkins cat /var/jenkins_home/secrets/initialAdminPassword
```

âœ…Â **ì¶œë ¥**

```bash
57a5b0cc2ff2402ba1ccb00d8fda37f0
```

### **9. Jenkins ì›¹ ì´ˆê¸° ì„¤ì • ì§„í–‰**

**(1) http://127.0.0.1:8080 ì ‘ì† í›„, ì´ˆê¸° ì•”í˜¸ ì…ë ¥**

![Image](https://github.com/user-attachments/assets/23371c5f-74c3-452c-adb4-0b7780770918)

**(2) Install suggested plugins**

![Image](https://github.com/user-attachments/assets/d29a6f7a-e16e-43fe-9341-264696ce7c4c)

**(3) ê¸°ë³¸ ê´€ë¦¬ì ê³„ì • (admin / qwe123) ì„¤ì •**

![Image](https://github.com/user-attachments/assets/c89c3c6d-f013-45e2-adec-af8fac148092)

**(4) IP í™•ì¸ ë° ì„¤ì •**

```bash
ifconfig | grep 192.168.
```

âœ…Â **ì¶œë ¥**

```bash
        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255
        inet 192.168.219.103  netmask 255.255.255.0  broadcast 192.168.219.255
```

![Image](https://github.com/user-attachments/assets/727c1137-c542-427a-ad77-bdd43bef2ab8)

**(5) http://192.168.219.103:8080 ì ‘ì† í›„, ë¡œê·¸ì¸ (admin / qwe123)**

![Image](https://github.com/user-attachments/assets/de538cf7-c02c-4e26-b858-abcaf8ed67b7)
![Image](https://github.com/user-attachments/assets/8e249c67-f3d2-476b-971e-9e436f296853)

---

## **ğŸ³ Jenkins ì»¨í…Œì´ë„ˆì—ì„œ í˜¸ìŠ¤íŠ¸ì— ë„ì»¤ ë°ëª¬ ì‚¬ìš© ì„¤ì •**

![Image](https://github.com/user-attachments/assets/117f492d-2595-4bd0-b0c7-78e737c37a56)

### **1. Jenkins ì»¨í…Œì´ë„ˆì— root ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì ‘ì†**

```bash
docker compose exec --privileged -u root jenkins bash

# ê²°ê³¼
root@12f4b7ed7515:/# 
```

### **2. Docker CLI ì„¤ì¹˜ ë° í™˜ê²½ êµ¬ì„±**

```bash
root@12f4b7ed7515:/# id

curl -fsSL https://download.docker.com/linux/debian/gpg -o /etc/apt/keyrings/docker.asc
chmod a+r /etc/apt/keyrings/docker.asc
echo \
  "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/debian \
  $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
  tee /etc/apt/sources.list.d/docker.list > /dev/null
apt-get update && apt install docker-ce-cli curl tree jq yq -y
```

âœ…Â **ì¶œë ¥**

```bash
uid=0(root) gid=0(root) groups=0(root)
Get:1 http://deb.debian.org/debian bookworm InRelease [151 kB]
Get:2 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]                
Get:3 http://deb.debian.org/debian-security bookworm-security InRelease [48.0 kB]
Get:4 https://download.docker.com/linux/debian bookworm InRelease [47.0 kB]
Get:5 http://deb.debian.org/debian bookworm/main amd64 Packages [8792 kB]
Get:6 https://download.docker.com/linux/debian bookworm/stable amd64 Packages [38.1 kB]
Get:7 http://deb.debian.org/debian bookworm-updates/main amd64 Packages [512 B]
Get:8 http://deb.debian.org/debian-security bookworm-security/main amd64 Packages [250 kB]
Fetched 9382 kB in 1s (7293 kB/s)                         
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
curl is already the newest version (7.88.1-10+deb12u12).
The following additional packages will be installed:
  docker-buildx-plugin docker-compose-plugin libjq1 libnsl2 libonig5 libpython3-stdlib libpython3.11-minimal libpython3.11-stdlib
  libtirpc-common libtirpc3 libyaml-0-2 media-types python3 python3-argcomplete python3-importlib-metadata python3-minimal
  python3-more-itertools python3-toml python3-typing-extensions python3-xmltodict python3-yaml python3-zipp python3.11 python3.11-minimal
Suggested packages:
  python3-doc python3-tk python3-venv python3.11-venv python3.11-doc binutils binfmt-support
The following NEW packages will be installed:
  docker-buildx-plugin docker-ce-cli docker-compose-plugin jq libjq1 libnsl2 libonig5 libpython3-stdlib libpython3.11-minimal
  libpython3.11-stdlib libtirpc-common libtirpc3 libyaml-0-2 media-types python3 python3-argcomplete python3-importlib-metadata python3-minimal
  python3-more-itertools python3-toml python3-typing-extensions python3-xmltodict python3-yaml python3-zipp python3.11 python3.11-minimal tree
  yq
0 upgraded, 28 newly installed, 0 to remove and 1 not upgraded.
Need to get 71.5 MB of archives.
After this operation, 240 MB of additional disk space will be used.
Get:1 http://deb.debian.org/debian bookworm/main amd64 libpython3.11-minimal amd64 3.11.2-6+deb12u5 [816 kB]
Get:2 https://download.docker.com/linux/debian bookworm/stable amd64 docker-buildx-plugin amd64 0.22.0-1~debian.12~bookworm [35.3 MB]
Get:3 http://deb.debian.org/debian bookworm/main amd64 python3.11-minimal amd64 3.11.2-6+deb12u5 [2067 kB]
Get:4 http://deb.debian.org/debian bookworm/main amd64 python3-minimal amd64 3.11.2-1+b1 [26.3 kB]
Get:5 http://deb.debian.org/debian bookworm/main amd64 media-types all 10.0.0 [26.1 kB]
Get:6 http://deb.debian.org/debian bookworm/main amd64 libtirpc-common all 1.3.3+ds-1 [14.0 kB]
Get:7 http://deb.debian.org/debian bookworm/main amd64 libtirpc3 amd64 1.3.3+ds-1 [85.2 kB]
Get:8 http://deb.debian.org/debian bookworm/main amd64 libnsl2 amd64 1.3.0-2 [39.5 kB]
Get:9 http://deb.debian.org/debian bookworm/main amd64 libpython3.11-stdlib amd64 3.11.2-6+deb12u5 [1797 kB]
Get:10 http://deb.debian.org/debian bookworm/main amd64 python3.11 amd64 3.11.2-6+deb12u5 [573 kB]
Get:11 http://deb.debian.org/debian bookworm/main amd64 libpython3-stdlib amd64 3.11.2-1+b1 [9312 B]
Get:12 http://deb.debian.org/debian bookworm/main amd64 python3 amd64 3.11.2-1+b1 [26.3 kB]
Get:13 http://deb.debian.org/debian bookworm/main amd64 libonig5 amd64 6.9.8-1 [188 kB]
Get:14 http://deb.debian.org/debian bookworm/main amd64 libjq1 amd64 1.6-2.1 [135 kB]
Get:15 http://deb.debian.org/debian bookworm/main amd64 jq amd64 1.6-2.1 [64.9 kB]
Get:16 http://deb.debian.org/debian bookworm/main amd64 libyaml-0-2 amd64 0.2.5-1 [53.6 kB]
Get:17 http://deb.debian.org/debian bookworm/main amd64 python3-typing-extensions all 4.4.0-1 [45.2 kB]
Get:18 http://deb.debian.org/debian bookworm/main amd64 python3-more-itertools all 8.10.0-2 [53.0 kB]
Get:19 http://deb.debian.org/debian bookworm/main amd64 python3-zipp all 1.0.0-6 [6696 B]      
Get:20 http://deb.debian.org/debian bookworm/main amd64 python3-importlib-metadata all 4.12.0-1 [24.9 kB]
Get:21 http://deb.debian.org/debian bookworm/main amd64 python3-argcomplete all 2.0.0-1 [34.7 kB]   
Get:22 http://deb.debian.org/debian bookworm/main amd64 python3-toml all 0.10.2-1 [16.2 kB] 
Get:23 http://deb.debian.org/debian bookworm/main amd64 python3-xmltodict all 0.13.0-1 [16.7 kB]
Get:24 http://deb.debian.org/debian bookworm/main amd64 python3-yaml amd64 6.0-3+b2 [119 kB]
Get:25 http://deb.debian.org/debian bookworm/main amd64 tree amd64 2.1.0-1 [52.5 kB]
Get:26 http://deb.debian.org/debian bookworm/main amd64 yq all 3.1.0-3 [19.2 kB]
Get:27 https://download.docker.com/linux/debian bookworm/stable amd64 docker-ce-cli amd64 5:28.0.4-1~debian.12~bookworm [15.8 MB]
Get:28 https://download.docker.com/linux/debian bookworm/stable amd64 docker-compose-plugin amd64 2.34.0-1~debian.12~bookworm [14.1 MB]
Fetched 71.5 MB in 4s (18.9 MB/s)                 
debconf: delaying package configuration, since apt-utils is not installed
Selecting previously unselected package libpython3.11-minimal:amd64.
(Reading database ... 10537 files and directories currently installed.)
Preparing to unpack .../libpython3.11-minimal_3.11.2-6+deb12u5_amd64.deb ...
Unpacking libpython3.11-minimal:amd64 (3.11.2-6+deb12u5) ...
Selecting previously unselected package python3.11-minimal.
Preparing to unpack .../python3.11-minimal_3.11.2-6+deb12u5_amd64.deb ...
Unpacking python3.11-minimal (3.11.2-6+deb12u5) ...
Setting up libpython3.11-minimal:amd64 (3.11.2-6+deb12u5) ...
Setting up python3.11-minimal (3.11.2-6+deb12u5) ...
Selecting previously unselected package python3-minimal.
(Reading database ... 10844 files and directories currently installed.)
Preparing to unpack .../0-python3-minimal_3.11.2-1+b1_amd64.deb ...
Unpacking python3-minimal (3.11.2-1+b1) ...
Selecting previously unselected package media-types.
Preparing to unpack .../1-media-types_10.0.0_all.deb ...
Unpacking media-types (10.0.0) ...
....
```

### **3. ì„¤ì¹˜ í™•ì¸ ë° ë„ì»¤ ì •ë³´ ê²€ì¦**

**(1) ë„ì»¤ í´ë¼ì´ì–¸íŠ¸ ë° ì„œë²„ ì •ë³´ í™•ì¸**

```bash
root@12f4b7ed7515:/# docker info
```

âœ…Â **ì¶œë ¥**

```bash
Client: Docker Engine - Community
 Version:    28.0.4
 Context:    default
 Debug Mode: false
 Plugins:
  buildx: Docker Buildx (Docker Inc.)
    Version:  v0.22.0
    Path:     /usr/libexec/docker/cli-plugins/docker-buildx
  compose: Docker Compose (Docker Inc.)
    Version:  v2.34.0
    Path:     /usr/libexec/docker/cli-plugins/docker-compose

Server:
 Containers: 5
  Running: 5
  Paused: 0
  Stopped: 0
 Images: 6
 Server Version: 28.0.1
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: true
  Using metacopy: true
  Native Overlay Diff: false
  userxattr: false
 Logging Driver: json-file
 Cgroup Driver: systemd
 Cgroup Version: 2
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 1a43cb6a1035441f9aca8f5666a9b3ef9e70ab20.m
 runc version: 
 init version: de40ad0
 Security Options:
  seccomp
   Profile: builtin
  cgroupns
 Kernel Version: 6.13.7-arch1-1
 Operating System: Arch Linux
 OSType: linux
 Architecture: x86_64
 CPUs: 18
 Total Memory: 30.9GiB
 Name: gram88
 ID: 7b6ceb90-0683-4037-a905-12f0f9197c48
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Experimental: false
 Insecure Registries:
  ::1/128
  127.0.0.0/8
 Live Restore Enabled: false
```

**(2) ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ ì¡°íšŒ**

```bash
root@12f4b7ed7515:/# docker ps
```

âœ…Â **ì¶œë ¥**

```bash
CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS                    PORTS                                                                                          NAMES
12f4b7ed7515   jenkins/jenkins        "/usr/bin/tini -- /uâ€¦"   25 minutes ago   Up 25 minutes             0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp, 0.0.0.0:50000->50000/tcp, [::]:50000->50000/tcp   jenkins
a0dda4a63d1b   gogs/gogs              "/app/gogs/docker/stâ€¦"   25 minutes ago   Up 25 minutes (healthy)   0.0.0.0:3000->3000/tcp, [::]:3000->3000/tcp, 0.0.0.0:10022->22/tcp, [::]:10022->22/tcp         gogs
0730dcf6eb6f   kindest/node:v1.30.4   "/usr/local/bin/entrâ€¦"   2 days ago       Up 50 minutes                                                                                                            myk8s-worker
720250bf1479   kindest/node:v1.30.4   "/usr/local/bin/entrâ€¦"   2 days ago       Up 50 minutes                                                                                                            myk8s-worker2
12914ca62737   kindest/node:v1.30.4   "/usr/local/bin/entrâ€¦"   2 days ago       Up 50 minutes             0.0.0.0:30000-30002->30000-30002/tcp, 127.0.0.1:44509->6443/tcp                                myk8s-control-plane
```

**(3) ë„ì»¤ ì‹¤í–‰ íŒŒì¼ ìœ„ì¹˜ í™•ì¸**

```bash
root@12f4b7ed7515:/# which docker
```

âœ…Â **ì¶œë ¥**

```bash
/usr/bin/docker
```

### **4. Jenkins ìœ ì €ì— ëŒ€í•œ Docker ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬**

```bash
root@12f4b7ed7515:/# groupadd -g 1001 -f docker
root@12f4b7ed7515:/# chgrp docker /var/run/docker.sock

root@12f4b7ed7515:/# ls -l /var/run/docker.sock
srw-rw---- 1 root docker 0 Mar 29 02:44 /var/run/docker.sock

root@12f4b7ed7515:/# usermod -aG docker jenkins

root@12f4b7ed7515:/# cat /etc/group | grep docker
docker:x:1001:jenkins

root@12f4b7ed7515:/# exit
exit
```

### **5. Jenkins ì»¨í…Œì´ë„ˆ ì¬ê¸°ë™**

```bash
docker compose restart jenkins
```

âœ…Â **ì¶œë ¥**

```bash
[+] Restarting 1/1
 âœ” Container jenkins  Started    
```

### **6. Jenkins ì»¨í…Œì´ë„ˆ ë‚´ ë„ì»¤ í™˜ê²½ ìƒíƒœ ë° ì‚¬ìš©ì ê¶Œí•œ ì ê²€**

**(1) Jenkins ì»¨í…Œì´ë„ˆ ë‚´ë¶€ ì‚¬ìš©ì ë° ê¶Œí•œ í™•ì¸**

```bash
docker compose exec jenkins id
```

âœ…Â **ì¶œë ¥**

```bash
uid=1000(jenkins) gid=1000(jenkins) groups=1000(jenkins),1001(docker)
```

**(2) ë„ì»¤ ì •ë³´ í™•ì¸**

```bash
docker compose exec jenkins docker info
```

âœ…Â **ì¶œë ¥**

```bash
Client: Docker Engine - Community
 Version:    28.0.4
 Context:    default
 Debug Mode: false
 Plugins:
  buildx: Docker Buildx (Docker Inc.)
    Version:  v0.22.0
    Path:     /usr/libexec/docker/cli-plugins/docker-buildx
  compose: Docker Compose (Docker Inc.)
    Version:  v2.34.0
    Path:     /usr/libexec/docker/cli-plugins/docker-compose

Server:
 Containers: 5
  Running: 5
  Paused: 0
  Stopped: 0
 Images: 6
 Server Version: 28.0.4
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: true
  Using metacopy: true
  Native Overlay Diff: false
  userxattr: false
 Logging Driver: json-file
 Cgroup Driver: systemd
 Cgroup Version: 2
 Plugins:
  Volume: local
  Network: bridge host ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file local splunk syslog
 Swarm: inactive
 Runtimes: io.containerd.runc.v2 runc
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 1a43cb6a1035441f9aca8f5666a9b3ef9e70ab20.m
 runc version: 
 init version: de40ad0
 Security Options:
  seccomp
   Profile: builtin
  cgroupns
 Kernel Version: 6.13.8-arch1-1
 Operating System: Arch Linux
 OSType: linux
 Architecture: x86_64
 CPUs: 18
 Total Memory: 30.9GiB
 Name: gram88
 ID: 7b6ceb90-0683-4037-a905-12f0f9197c48
 Docker Root Dir: /var/lib/docker
 Debug Mode: false
 Experimental: false
 Insecure Registries:
  ::1/128
  127.0.0.0/8
 Live Restore Enabled: false
```

**(3) ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ëª©ë¡ í™•ì¸**

```bash
docker compose exec jenkins docker ps
```

âœ…Â **ì¶œë ¥**

```bash
CONTAINER ID   IMAGE                  COMMAND                  CREATED             STATUS                   PORTS                                                                                          NAMES
12f4b7ed7515   jenkins/jenkins        "/usr/bin/tini -- /uâ€¦"   About an hour ago   Up About a minute        0.0.0.0:8080->8080/tcp, [::]:8080->8080/tcp, 0.0.0.0:50000->50000/tcp, [::]:50000->50000/tcp   jenkins
a0dda4a63d1b   gogs/gogs              "/app/gogs/docker/stâ€¦"   About an hour ago   Up 5 minutes (healthy)   0.0.0.0:3000->3000/tcp, [::]:3000->3000/tcp, 0.0.0.0:10022->22/tcp, [::]:10022->22/tcp         gogs
0730dcf6eb6f   kindest/node:v1.30.4   "/usr/local/bin/entrâ€¦"   2 days ago          Up 5 minutes                                                                                                            myk8s-worker
720250bf1479   kindest/node:v1.30.4   "/usr/local/bin/entrâ€¦"   2 days ago          Up 5 minutes                                                                                                            myk8s-worker2
12914ca62737   kindest/node:v1.30.4   "/usr/local/bin/entrâ€¦"   2 days ago          Up 5 minutes             0.0.0.0:30000-30002->30000-30002/tcp, 127.0.0.1:44509->6443/tcp                                myk8s-control-plane
```

### **7. Gogs ì´ˆê¸° ì„¤ì¹˜ ì ‘ì† (http://127.0.0.1:3000/install)**

- **ë°ì´í„°ë² ì´ìŠ¤ ìœ í˜•: `SQLite3`**

![Image](https://github.com/user-attachments/assets/bb42b261-35e7-4f8c-bf2d-22d9118cb983)

- **ì• í”Œë¦¬ì¼€ì´ì…˜ URL: `192.168.219.103`**

![Image](https://github.com/user-attachments/assets/0fc31cce-b58f-42d9-9ec9-a2db53629065)

- **ê´€ë¦¬ì ê³„ì •: `devops` / `qwe123`**

![Image](https://github.com/user-attachments/assets/1896ab58-4736-4143-a4a8-ac909bdd69b9)

### **8. Gogs í† í° ìƒì„± ë° ì„¤ì •**

- **ë¡œê·¸ì¸ í›„ "Your Settings" â†’ "Applications" ë©”ë‰´ë¡œ ì´ë™**
- **"Generate New Token" í´ë¦­ í›„, Token ì´ë¦„(ex. `k8s-cicd`) ì…ë ¥**

![Image](https://github.com/user-attachments/assets/19272650-089d-4394-b2ec-df6e39e0ac53)

- **"Generate Token"ì„ í´ë¦­í•˜ì—¬ í† í°ì„ ìƒì„±í•˜ê³ , ìƒì„±ëœ í† í° ê°’ì„ ë©”ëª¨í•´ë‘ **

![Image](https://github.com/user-attachments/assets/b8b9948c-d154-481d-8dab-ecb7fd53ceda)

### **9. ë‘ ê°œì˜ ë ˆí¬ì§€í† ë¦¬ ìƒì„± ë° ì„¤ì •**

- **dev-app - ê°œë°œíŒ€ìš©**

![Image](https://github.com/user-attachments/assets/aeddcb81-8839-45e0-b055-4797ecc933c2)

- **ops-deploy - ë°ë¸Œì˜µìŠ¤íŒ€ìš©**

![Image](https://github.com/user-attachments/assets/03bc2a19-e864-4c60-af2a-de7d7b39553d)
![Image](https://github.com/user-attachments/assets/cc86fca8-24c6-4c09-aeb8-52ae7f0f707a)

---

## **ğŸ“ Gogs ì‹¤ìŠµì„ ìœ„í•œ ì €ì¥ì†Œ ì„¤ì •**

### **1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

```bash
TOKEN=<ê°ì Gogs Token>
TOKEN=fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04

MyIP=<ê°ì ìì‹ ì˜ PC IP>
MyIP=192.168.219.103
```

### **2. ê°œë°œíŒ€ìš© ì €ì¥ì†Œ í´ë¡  ë° Git ì´ˆê¸° ì„¤ì •**

**(1) Gogsì— ìƒì„±ëœ ê°œë°œíŒ€ìš© ì €ì¥ì†Œ(dev-app) í´ë¡ **

```bash
git clone http://devops:$TOKEN@$MyIP:3000/devops/dev-app.git

# ê²°ê³¼
Cloning into 'dev-app'...
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (3/3), done.
remote: Total 4 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)
Unpacking objects: 100% (4/4), 692 bytes | 692.00 KiB/s, done.
```

**(2) í´ë¡  í›„ ì‘ì—… ë””ë ‰í† ë¦¬ë¡œ ì´ë™**

```bash
cd dev-app
```

**(3) ë¡œì»¬ Git ì„¤ì • ë³€ê²½**

```bash
git --no-pager config --local --list
git config --local user.name "devops"
git config --local user.email "abc@abc.com"
git config --local init.defaultBranch main
git config --local credential.helper store
git --no-pager config --local --list
```

**(4) `.git/config` íŒŒì¼ í™•ì¸**

```bash
cat .git/config
```

âœ…Â **ì¶œë ¥**

```bash
core.repositoryformatversion=0
core.filemode=true
core.bare=false
core.logallrefupdates=true
remote.origin.url=http://devops:fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04@192.168.219.103:3000/devops/dev-app.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.main.remote=origin
branch.main.merge=refs/heads/main
core.repositoryformatversion=0
core.filemode=true
core.bare=false
core.logallrefupdates=true
remote.origin.url=http://devops:fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04@192.168.219.103:3000/devops/dev-app.git
remote.origin.fetch=+refs/heads/*:refs/remotes/origin/*
branch.main.remote=origin
branch.main.merge=refs/heads/main
user.name=devops
user.email=abc@abc.com
init.defaultbranch=main
credential.helper=store
[core]
	repositoryformatversion = 0
	filemode = true
	bare = false
	logallrefupdates = true
[remote "origin"]
	url = http://devops:fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04@192.168.219.103:3000/devops/dev-app.git
	fetch = +refs/heads/*:refs/remotes/origin/*
[branch "main"]
	remote = origin
	merge = refs/heads/main
[user]
	name = devops
	email = abc@abc.com
[init]
	defaultBranch = main
[credential]
	helper = store
```

**(5) í˜„ì¬ ë¸Œëœì¹˜ ë° ì›ê²© ì •ë³´ í™•ì¸**

```bash
git --no-pager branch
git remote -v
```

âœ…Â **ì¶œë ¥**

```bash
* main
origin	http://devops:fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04@192.168.219.103:3000/devops/dev-app.git (fetch)
origin	http://devops:fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04@192.168.219.103:3000/devops/dev-app.git (push)
```

### **3. ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ì‘ì„± ë° í…ŒìŠ¤íŠ¸**

**(1) `server.py` íŒŒì¼ ì‘ì„±**

```bash
cat > server.py <<EOF
from http.server import ThreadingHTTPServer, BaseHTTPRequestHandler
from datetime import datetime
import socket

class RequestHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        match self.path:
            case '/':
                now = datetime.now()
                hostname = socket.gethostname()
                response_string = now.strftime("The time is %-I:%M:%S %p, VERSION 0.0.1\n")
                response_string += f"Server hostname: {hostname}\n"                
                self.respond_with(200, response_string)
            case '/healthz':
                self.respond_with(200, "Healthy")
            case _:
                self.respond_with(404, "Not Found")

    def respond_with(self, status_code: int, content: str) -> None:
        self.send_response(status_code)
        self.send_header('Content-type', 'text/plain')
        self.end_headers()
        self.wfile.write(bytes(content, "utf-8")) 

def startServer():
    try:
        server = ThreadingHTTPServer(('', 80), RequestHandler)
        print("Listening on " + ":".join(map(str, server.server_address)))
        server.serve_forever()
    except KeyboardInterrupt:
        server.shutdown()

if __name__== "__main__":
    startServer()
EOF
```

**(2) ì„œë²„ ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸**

```bash
sudo python3 server.py
curl localhost
curl localhost/healthz
```

![Image](https://github.com/user-attachments/assets/b75b5ecf-cf68-4e6b-837c-5e84991dd6e0)

### 4. Dockerfile ë° ë²„ì „ íŒŒì¼ ìƒì„±

**(1) `Dockerfile` ìƒì„±**

```bash
cat > Dockerfile <<EOF
FROM python:3.12
ENV PYTHONUNBUFFERED 1
COPY . /app
WORKDIR /app 
CMD python3 server.py
EOF
```

**(2) `VERSION` íŒŒì¼ ìƒì„±**

```bash
echo "0.0.1" > VERSION
```

**(3) í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸**

```bash
tree
```

âœ…Â **ì¶œë ¥**

```bash
.
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ README.md
â”œâ”€â”€ server.py
â””â”€â”€ VERSION

1 directory, 4 files
```

### **5. Git ì»¤ë°‹ ë° ì›ê²© ì €ì¥ì†Œë¡œ í‘¸ì‹œ**

**(1) ë³€ê²½ ì‚¬í•­ í™•ì¸**

```bash
git status
```

âœ…Â **ì¶œë ¥**

```bash
On branch main
Your branch is up to date with 'origin/main'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	Dockerfile
	VERSION
	server.py

nothing added to commit but untracked files present (use "git add" to track)
```

**(2) ìŠ¤í…Œì´ì§•**

```bash
git add .
```

**(3) ì»¤ë°‹**

```bash
git commit -m "Add dev-app"
```

âœ…Â **ì¶œë ¥**

```bash
[main 99e9476] Add dev-app
 3 files changed, 40 insertions(+)
 create mode 100644 Dockerfile
 create mode 100644 VERSION
 create mode 100644 server.py
```

**(4) ì»¤ë°‹ ë‚´ìš©ì„ ì›ê²© ì €ì¥ì†Œì— í‘¸ì‹œí•˜ì—¬ ë°˜ì˜**

```bash
git push -u origin main
```

âœ…Â **ì¶œë ¥**

```bash
Enumerating objects: 6, done.
Counting objects: 100% (6/6), done.
Delta compression using up to 18 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (5/5), 1015 bytes | 1015.00 KiB/s, done.
Total 5 (delta 0), reused 0 (delta 0), pack-reused 0 (from 0)
To http://192.168.219.103:3000/devops/dev-app.git
   1b07e97..99e9476  main -> main
branch 'main' set up to track 'origin/main'.
```

![Image](https://github.com/user-attachments/assets/3c32ff27-432f-49e9-9dfe-fe1420e58a36)

### **6. Docker Hub ì €ì¥ì†Œ ìƒì„± ë° Personal Access Token(PAT) ë°œê¸‰**

**(1) ìì‹ ì˜ Docker Hub ê³„ì •ì— dev-app (Private) ì €ì¥ì†Œ ìƒì„±**

![Image](https://github.com/user-attachments/assets/1d858f82-c125-49d9-b909-053c4c964c68)

**(2) ê³„ì • â†’ Account settings**

![Image](https://github.com/user-attachments/assets/8ff8f099-80c4-4eab-bf9b-757aa43d4b85)

**(3) Security â†’ Personal access tokens â†’ Generate new token**

- ë§Œë£Œì¼(í¸í•œëŒ€ë¡œ), Access permissions(Read, Write, Delete)

![Image](https://github.com/user-attachments/assets/1a48989e-f287-42b7-8b6a-c2b0d19c3c72)

- ìƒì„±ëœ í† í°ì„ ë©”ëª¨í•˜ì—¬ ì´í›„ ì¸ì¦ ë° í‘¸ì‹œ ì‘ì—…ì— í™œìš©

![Image](https://github.com/user-attachments/assets/ee64cbf5-ff3b-4723-920b-8a2b4cffe91f)

---

## **ğŸš€ kind ë¡œ k8s ë°°í¬**

### **1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

```bash
MyIP=<ê°ì ìì‹ ì˜ PC IP>
MyIP=192.168.219.103
```

### **2. í´ëŸ¬ìŠ¤í„° êµ¬ì„± íŒŒì¼ ì‘ì„±**

- **cicd-labs ë””ë ‰í„°ë¦¬ì—ì„œ ì•„ë˜ íŒŒì¼ ì‘ì„±**

```bash
cd ..
cat > kind-3node.yaml <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
networking:
  apiServerAddress: "$MyIP"
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  - containerPort: 30003
    hostPort: 30003
- role: worker
- role: worker
EOF
```

### **3. í´ëŸ¬ìŠ¤í„° ìƒì„±**

```bash
kind create cluster --config kind-3node.yaml --name myk8s --image kindest/node:v1.32.2
```

âœ…Â **ì¶œë ¥**

```bash
Creating cluster "myk8s" ...
 âœ“ Ensuring node image (kindest/node:v1.32.2) ğŸ–¼ 
 âœ“ Preparing nodes ğŸ“¦ ğŸ“¦ ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
 âœ“ Joining worker nodes ğŸšœ 
Set kubectl context to "kind-myk8s"
You can now use your cluster with:

kubectl cluster-info --context kind-myk8s

Have a question, bug, or feature request? Let us know! https://kind.sigs.k8s.io/#community ğŸ™‚
```

### **4. ë…¸ë“œ ëª©ë¡ í™•ì¸**

```bash
kind get nodes --name myk8s
```

âœ…Â **ì¶œë ¥**

```bash
myk8s-worker
myk8s-worker2
myk8s-control-plane
```

### **5. ê¸°ë³¸ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ í™œì„±í™”**

```bash
kubens default
```

âœ…Â **ì¶œë ¥**

```bash
âœ” Active namespace is "default"
```

### **6. Docker ë„¤íŠ¸ì›Œí¬ ëª©ë¡ í™•ì¸**

**(1) Docker ë„¤íŠ¸ì›Œí¬ ëª©ë¡ í™•ì¸**

```bash
docker network ls
```

âœ…Â **ì¶œë ¥**

```bash
NETWORK ID     NAME                     DRIVER    SCOPE
823451dd3cf5   bridge                   bridge    local
8dc45b4bfaf3   cicd-labs_cicd-network   bridge    local
bb4d74152d4a   host                     host      local
dbf072d0a217   kind                     bridge    local
056dcb2c01d1   none                     null      local
```

**(2) kind ë„¤íŠ¸ì›Œí¬ ìƒì„¸ ì •ë³´ í™•ì¸**

```bash
docker inspect kind | jq
```

âœ…Â **ì¶œë ¥**

```bash
[
  {
    "Name": "kind",
    "Id": "dbf072d0a217f53e0b62f42cee01bcecc1b2f6ea216475178db001f2e38681f5",
    "Created": "2025-01-26T16:18:22.33980443+09:00",
    "Scope": "local",
    "Driver": "bridge",
    "EnableIPv4": true,
    "EnableIPv6": true,
    "IPAM": {
      "Driver": "default",
      "Options": {},
      "Config": [
        {
          "Subnet": "172.18.0.0/16",
          "Gateway": "172.18.0.1"
        },
        {
          "Subnet": "fc00:f853:ccd:e793::/64",
          "Gateway": "fc00:f853:ccd:e793::1"
        }
      ]
    },
    "Internal": false,
    "Attachable": false,
    "Ingress": false,
    "ConfigFrom": {
      "Network": ""
    },
    "ConfigOnly": false,
    "Containers": {
      "33b78e624fbd6ec1dc97e16c3a0accfb709d191ac8ebf2d3a632daaab2bfed7e": {
        "Name": "myk8s-worker2",
        "EndpointID": "2408ab1a6b39536a8ce5f13b1c65538e1093687cbe24e0d0605cfcd3c37e5fb8",
        "MacAddress": "7e:91:b1:5c:f9:f8",
        "IPv4Address": "172.18.0.3/16",
        "IPv6Address": "fc00:f853:ccd:e793::3/64"
      },
      "921a8848ddd4294e46a8e1531e206702b919d0f1e3d1fef1c7b621020b9ec05a": {
        "Name": "myk8s-worker",
        "EndpointID": "4757fa8c31137275765f9f9558975032574808b70c2d2c55256aae4b0fa22c2a",
        "MacAddress": "d6:1f:1a:3b:8f:15",
        "IPv4Address": "172.18.0.2/16",
        "IPv6Address": "fc00:f853:ccd:e793::2/64"
      },
      "f4b058d07f4a2710b835d42a1d8499d43b7f26c7f737735010ab0d1587cf3373": {
        "Name": "myk8s-control-plane",
        "EndpointID": "e2c1ffbc055525505bb4ed6c8a84261cdaaa2f829b135a099c21dafe363ded1c",
        "MacAddress": "e6:5f:e9:6b:10:06",
        "IPv4Address": "172.18.0.4/16",
        "IPv6Address": "fc00:f853:ccd:e793::4/64"
      }
    },
    "Options": {
      "com.docker.network.bridge.enable_ip_masquerade": "true",
      "com.docker.network.driver.mtu": "1500"
    },
    "Labels": {}
  }
]
```

### **7. ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„° ì •ë³´ í™•ì¸**

```bash
kubectl cluster-info
```

âœ…Â **ì¶œë ¥**

```bash
Kubernetes control plane is running at https://192.168.219.103:36865
CoreDNS is running at https://192.168.219.103:36865/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy

To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.
```

### **8. ì¿ ë²„ë„¤í‹°ìŠ¤ ë…¸ë“œ ì •ë³´ í™•ì¸**

```bash
kubectl get node -o wide
```

âœ…Â **ì¶œë ¥**

```bash
NAME                  STATUS   ROLES           AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
myk8s-control-plane   Ready    control-plane   20m   v1.32.2   172.18.0.4    <none>        Debian GNU/Linux 12 (bookworm)   6.13.8-arch1-1   containerd://2.0.3
myk8s-worker          Ready    <none>          20m   v1.32.2   172.18.0.2    <none>        Debian GNU/Linux 12 (bookworm)   6.13.8-arch1-1   containerd://2.0.3
myk8s-worker2         Ready    <none>          20m   v1.32.2   172.18.0.3    <none>        Debian GNU/Linux 12 (bookworm)   6.13.8-arch1-1   containerd://2.0.3
```

### **9. ì¿ ë²„ë„¤í‹°ìŠ¤ íŒŒë“œ ìƒíƒœ í™•ì¸**

```bash
kubectl get pod -A -o wide
```

âœ…Â **ì¶œë ¥**

```bash
NAMESPACE            NAME                                          READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES
kube-system          coredns-668d6bf9bc-9jr7l                      1/1     Running   0          20m   10.244.0.3   myk8s-control-plane   <none>           <none>
kube-system          coredns-668d6bf9bc-wwd8c                      1/1     Running   0          20m   10.244.0.2   myk8s-control-plane   <none>           <none>
kube-system          etcd-myk8s-control-plane                      1/1     Running   0          20m   172.18.0.4   myk8s-control-plane   <none>           <none>
kube-system          kindnet-gjp2z                                 1/1     Running   0          20m   172.18.0.3   myk8s-worker2         <none>           <none>
kube-system          kindnet-m45kh                                 1/1     Running   0          20m   172.18.0.4   myk8s-control-plane   <none>           <none>
kube-system          kindnet-sbjrk                                 1/1     Running   0          20m   172.18.0.2   myk8s-worker          <none>           <none>
kube-system          kube-apiserver-myk8s-control-plane            1/1     Running   0          20m   172.18.0.4   myk8s-control-plane   <none>           <none>
kube-system          kube-controller-manager-myk8s-control-plane   1/1     Running   0          20m   172.18.0.4   myk8s-control-plane   <none>           <none>
kube-system          kube-proxy-8zvnt                              1/1     Running   0          20m   172.18.0.2   myk8s-worker          <none>           <none>
kube-system          kube-proxy-pqrln                              1/1     Running   0          20m   172.18.0.3   myk8s-worker2         <none>           <none>
kube-system          kube-proxy-xjbwl                              1/1     Running   0          20m   172.18.0.4   myk8s-control-plane   <none>           <none>
kube-system          kube-scheduler-myk8s-control-plane            1/1     Running   0          20m   172.18.0.4   myk8s-control-plane   <none>           <none>
local-path-storage   local-path-provisioner-7dc846544d-7hx2m       1/1     Running   0          20m   10.244.0.4   myk8s-control-plane   <none>           <none>
```

### **10. ì¿ ë²„ë„¤í‹°ìŠ¤ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ëª©ë¡ í™•ì¸**

```bash
kubectl get namespaces
```

âœ…Â **ì¶œë ¥**

```bash
NAME                 STATUS   AGE
default              Active   21m
kube-node-lease      Active   21m
kube-public          Active   21m
kube-system          Active   21m
local-path-storage   Active   21m
```

### **11. ë„ì»¤ ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸**

```bash
docker ps
```

âœ…Â **ì¶œë ¥**

```bash
CONTAINER ID   IMAGE                  COMMAND                  CREATED          STATUS          PORTS                                                                   NAMES
921a8848ddd4   kindest/node:v1.32.2   "/usr/local/bin/entrâ€¦"   21 minutes ago   Up 21 minutes                                                                           myk8s-worker
33b78e624fbd   kindest/node:v1.32.2   "/usr/local/bin/entrâ€¦"   21 minutes ago   Up 21 minutes                                                                           myk8s-worker2
f4b058d07f4a   kindest/node:v1.32.2   "/usr/local/bin/entrâ€¦"   21 minutes ago   Up 21 minutes   0.0.0.0:30000-30003->30000-30003/tcp, 192.168.219.103:36865->6443/tcp   myk8s-control-plan
```

### **12. kube-ops-view ì„¤ì¹˜**

```bash
helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
helm install kube-ops-view geek-cookbook/kube-ops-view --version 1.2.2 --set service.main.type=NodePort,service.main.ports.http.nodePort=30001 --set env.TZ="Asia/Seoul" --namespace kube-system
```

âœ…Â **ì¶œë ¥**

```bash
NAME: kube-ops-view
LAST DEPLOYED: Sat Mar 29 14:50:17 2025
NAMESPACE: kube-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace kube-system -o jsonpath="{.spec.ports[0].nodePort}" services kube-ops-view)
  export NODE_IP=$(kubectl get nodes --namespace kube-system -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
```

### **13. kube-ops-view ì„¤ì¹˜ í™•ì¸**

```bash
kubectl get deploy,pod,svc,ep -n kube-system -l app.kubernetes.io/instance=kube-ops-view
```

âœ…Â **ì¶œë ¥**

```bash
NAME                            READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/kube-ops-view   1/1     1            1           53s

NAME                                 READY   STATUS    RESTARTS   AGE
pod/kube-ops-view-6658c477d4-w247s   1/1     Running   0          53s

NAME                    TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
service/kube-ops-view   NodePort   10.96.236.75   <none>        8080:30001/TCP   53s

NAME                      ENDPOINTS         AGE
endpoints/kube-ops-view   10.244.3.2:8080   53s
```

**`http://127.0.0.1:30001/#scale=1.5` ì ‘ì†**

![Image](https://github.com/user-attachments/assets/2fa7c497-6075-4802-880a-672979452130)

---

## âš™ï¸ ì  í‚¨ìŠ¤ ì„¤ì • ë° CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì„±

### **1. ì  í‚¨ìŠ¤ í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜**

- **Plugins ë©”ë‰´ ì„ íƒ**

![Image](https://github.com/user-attachments/assets/576ca1cb-4df0-48ce-a009-ff08579ffb0c)

- **Available plugins: `Pipeline Stage View`, `Docker Pipeline`, `Gogs` í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜**

![Image](https://github.com/user-attachments/assets/02c32261-60b8-40d9-a6e2-5d0b2797acc1)

### **2. ìê²©ì¦ëª… ì„¤ì •**

- **Jenkins ê´€ë¦¬ â†’ Credentials â†’ Domains(global) â†’ Add Credentials**

![Image](https://github.com/user-attachments/assets/e437caaf-095e-4664-875f-9b7c767d0810)
![Image](https://github.com/user-attachments/assets/6184dc7e-e8ff-4361-9e97-e3b1ec26335b)

- **Gogs Repo ìê²©ì¦ëª… ì„¤ì • : `gogs-crd`**
- Kind : `Username with password`
- Username : `devops` / Password(Gogs í† í°) : `fef3afd3ae1c5e0869a5e6d3233ff0949f1e4e04` / ID : `gogs-crd`

![Image](https://github.com/user-attachments/assets/67b27656-ae7a-4dcf-b212-7f38d733d2b6)

- **ë„ì»¤ í—ˆë¸Œ ìê²©ì¦ëª… ì„¤ì • : `dockerhub-crd`**
- Kind : `Username with password`
- Username : `shinminjin` / Password : `xxxxxxxxxxxxxxxxxxxxx` / ID : `dockerhub-crd`

![Image](https://github.com/user-attachments/assets/1af36ecd-6ddb-4beb-92bd-fdff88a49891)

- **k8s(kind) ìê²©ì¦ëª… ì„¤ì • : k8s-crd**
- Kind : `Secret file` / File : `<kubeconfig íŒŒì¼ ì—…ë¡œë“œ>` / ID : `k8s-crd`

```bash
cp ~/.kube/config ./kube-config
```

![Image](https://github.com/user-attachments/assets/7e955557-6302-4705-ae28-6093434c88e5)

- **3ê°œì˜ ìê²©ì¦ëª… ì…‹íŒ… ì™„ë£Œ**

![Image](https://github.com/user-attachments/assets/06cd95db-e221-425b-830c-b441e7e9591d)

### **3. ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ ì…‹íŒ…**

- **íŒŒì´í”„ë¼ì¸ ìƒì„±**

![Image](https://github.com/user-attachments/assets/f4fdcd6f-b088-4844-b7c9-0f29168535d3)

- **íŒŒì´í”„ë¼ì¸ ìŠ¤í¬ë¦½íŠ¸**

```bash
pipeline {
    agent any
    environment {
        DOCKER_IMAGE = 'shinminjin/dev-app' // Docker ì´ë¯¸ì§€ ì´ë¦„, <ìì‹ ì˜ ë„ì»¤ í—ˆë¸Œ ê³„ì •>/dev-app
    }
    stages {
        stage('Checkout') {
            steps {
                 git branch: 'main',
                 url: 'http://192.168.219.103:3000/devops/dev-app.git',  // Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ, <ìì‹ ì˜ ì§‘ IP>
                 credentialsId: 'gogs-crd'  // Credentials ID
            }
        }
        stage('Read VERSION') {
            steps {
                script {
                    // VERSION íŒŒì¼ ì½ê¸°
                    def version = readFile('VERSION').trim()
                    echo "Version found: ${version}"
                    // í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
                    env.DOCKER_TAG = version
                }
            }
        }
        stage('Docker Build and Push') {
            steps {
                script {
                    docker.withRegistry('https://index.docker.io/v1/', 'dockerhub-crd') {
                        // DOCKER_TAG ì‚¬ìš©
                        def appImage = docker.build("${DOCKER_IMAGE}:${DOCKER_TAG}")
                        appImage.push()
                        appImage.push("latest")
                    }
                }
            }
        }
    }
    post {
        success {
            echo "Docker image ${DOCKER_IMAGE}:${DOCKER_TAG} has been built and pushed successfully!"
        }
        failure {
            echo "Pipeline failed. Please check the logs."
        }
    }
}
```

![Image](https://github.com/user-attachments/assets/0e519acf-e4eb-4080-83c9-0a880a03a927)

### **4. íŒŒì´í”„ë¼ì¸ ì‹¤í–‰**

![Image](https://github.com/user-attachments/assets/6d005495-15f5-4072-8138-6db07ae84781)
![Image](https://github.com/user-attachments/assets/6402a8bd-6e35-44cb-a860-b24789d99282)

---

## **ğŸ“¡ k8s ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ ë° ê²€ì¦ (Jenkins Pipeline CI)**

### **1. Timeserver Deployment ìƒì„±**

```bash
DHUSER=<ë„ì»¤ í—ˆë¸Œ ê³„ì •ëª…>
DHUSER=shinminjin

cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: timeserver
spec:
  replicas: 2
  selector:
    matchLabels:
      pod: timeserver-pod
  template:
    metadata:
      labels:
        pod: timeserver-pod
    spec:
      containers:
      - name: timeserver-container
        image: docker.io/$DHUSER/dev-app:0.0.1
        livenessProbe:
          initialDelaySeconds: 30
          periodSeconds: 30
          httpGet:
            path: /healthz
            port: 80
            scheme: HTTP
          timeoutSeconds: 5
          failureThreshold: 3
          successThreshold: 1
EOF

# ê²°ê³¼
deployment.apps/timeserver created
```

![Image](https://github.com/user-attachments/assets/7b110db5-92ae-4804-a14e-25bd73aefc8b)

### **2. ì´ë¯¸ì§€ í’€ ì—ëŸ¬ ë° ì´ë²¤íŠ¸ í™•ì¸**

```bash
kubectl get events -w --sort-by '.lastTimestamp'
```

âœ…Â **ì¶œë ¥**

```bash
warning: --watch requested, --sort-by will be ignored for watch events received
LAST SEEN   TYPE      REASON                    OBJECT                             MESSAGE
11m         Normal    Starting                  node/myk8s-control-plane           
96s         Normal    Scheduled                 pod/timeserver-6cd9654cc7-l4v9d    Successfully assigned default/timeserver-6cd9654cc7-l4v9d to myk8s-worker
96s         Normal    Scheduled                 pod/timeserver-6cd9654cc7-f7ck7    Successfully assigned default/timeserver-6cd9654cc7-f7ck7 to myk8s-worker2
11m         Normal    Starting                  node/myk8s-worker2                 
11m         Normal    Starting                  node/myk8s-worker                  
11m         Normal    NodeAllocatableEnforced   node/myk8s-worker2                 Updated Node Allocatable limit across pods
11m         Normal    Starting                  node/myk8s-worker2                 Starting kubelet.
11m         Normal    Starting                  node/myk8s-worker                  Starting kubelet.
11m         Normal    NodeHasSufficientPID      node/myk8s-control-plane           Node myk8s-control-plane status is now: NodeHasSufficientPID
11m         Normal    NodeHasNoDiskPressure     node/myk8s-control-plane           Node myk8s-control-plane status is now: NodeHasNoDiskPressure
11m         Normal    Starting                  node/myk8s-control-plane           Starting kubelet.
11m         Normal    NodeAllocatableEnforced   node/myk8s-worker                  Updated Node Allocatable limit across pods
11m         Normal    NodeAllocatableEnforced   node/myk8s-control-plane           Updated Node Allocatable limit across pods
11m         Normal    NodeHasSufficientMemory   node/myk8s-control-plane           Node myk8s-control-plane status is now: NodeHasSufficientMemory
11m         Normal    NodeHasNoDiskPressure     node/myk8s-worker                  Node myk8s-worker status is now: NodeHasNoDiskPressure
11m         Normal    NodeHasSufficientMemory   node/myk8s-worker2                 Node myk8s-worker2 status is now: NodeHasSufficientMemory
11m         Normal    NodeHasNoDiskPressure     node/myk8s-worker2                 Node myk8s-worker2 status is now: NodeHasNoDiskPressure
11m         Normal    NodeHasSufficientPID      node/myk8s-worker2                 Node myk8s-worker2 status is now: NodeHasSufficientPID
11m         Normal    NodeHasSufficientPID      node/myk8s-worker                  Node myk8s-worker status is now: NodeHasSufficientPID
11m         Normal    NodeHasSufficientMemory   node/myk8s-worker                  Node myk8s-worker status is now: NodeHasSufficientMemory
11m         Normal    RegisteredNode            node/myk8s-worker                  Node myk8s-worker event: Registered Node myk8s-worker in Controller
11m         Normal    RegisteredNode            node/myk8s-worker2                 Node myk8s-worker2 event: Registered Node myk8s-worker2 in Controller
11m         Normal    RegisteredNode            node/myk8s-control-plane           Node myk8s-control-plane event: Registered Node myk8s-control-plane in Controller
96s         Normal    ScalingReplicaSet         deployment/timeserver              Scaled up replica set timeserver-6cd9654cc7 from 0 to 2
96s         Normal    SuccessfulCreate          replicaset/timeserver-6cd9654cc7   Created pod: timeserver-6cd9654cc7-f7ck7
96s         Normal    SuccessfulCreate          replicaset/timeserver-6cd9654cc7   Created pod: timeserver-6cd9654cc7-l4v9d
24s         Warning   Failed                    pod/timeserver-6cd9654cc7-l4v9d    Error: ImagePullBackOff
24s         Normal    BackOff                   pod/timeserver-6cd9654cc7-l4v9d    Back-off pulling image "docker.io/shinminjin/dev-app:0.0.1"
23s         Normal    BackOff                   pod/timeserver-6cd9654cc7-f7ck7    Back-off pulling image "docker.io/shinminjin/dev-app:0.0.1"
23s         Warning   Failed                    pod/timeserver-6cd9654cc7-f7ck7    Error: ImagePullBackOff
9s          Normal    Pulling                   pod/timeserver-6cd9654cc7-f7ck7    Pulling image "docker.io/shinminjin/dev-app:0.0.1"
9s          Normal    Pulling                   pod/timeserver-6cd9654cc7-l4v9d    Pulling image "docker.io/shinminjin/dev-app:0.0.1"
7s          Warning   Failed                    pod/timeserver-6cd9654cc7-f7ck7    Error: ErrImagePull
7s          Warning   Failed                    pod/timeserver-6cd9654cc7-l4v9d    Error: ErrImagePull
7s          Warning   Failed                    pod/timeserver-6cd9654cc7-l4v9d    Failed to pull image "docker.io/shinminjin/dev-app:0.0.1": failed to pull and unpack image "docker.io/shinminjin/dev-app:0.0.1": failed to resolve reference "docker.io/shinminjin/dev-app:0.0.1": pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed
7s          Warning   Failed                    pod/timeserver-6cd9654cc7-f7ck7    Failed to pull image "docker.io/shinminjin/dev-app:0.0.1": failed to pull and unpack image "docker.io/shinminjin/dev-app:0.0.1": failed to resolve reference "docker.io/shinminjin/dev-app:0.0.1": pull access denied, repository does not exist or may require authorization: server message: insufficient_scope: authorization failed
0s          Normal    BackOff                   pod/timeserver-6cd9654cc7-f7ck7    Back-off pulling image "docker.io/shinminjin/dev-app:0.0.1"
0s          Warning   Failed                    pod/timeserver-6cd9654cc7-f7ck7    Error: ImagePullBackOff
```

- Private ì €ì¥ì†Œë¼ ì´ë¯¸ì§€ í’€ ê¶Œí•œì´ ì—†ì–´ì„œ `ImagePullBackOff` ì—ëŸ¬ ë°œìƒ

### **3. ë„ì»¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬ ìê²©ì¦ëª… ì„¤ì •**

```bash
DHUSER=<ë„ì»¤ í—ˆë¸Œ ê³„ì •>
DHPASS=<ë„ì»¤ í—ˆë¸Œ ì•”í˜¸ í˜¹ì€ í† í°>
```

```bash
kubectl create secret docker-registry dockerhub-secret \
  --docker-server=https://index.docker.io/v1/ \
  --docker-username=$DHUSER \
  --docker-password=$DHPASS

# ê²°ê³¼
secret/dockerhub-secret created
```

### **4. ì¿ ë²„ë„¤í‹°ìŠ¤ Secret ëª©ë¡ í™•ì¸**

```bash
kubectl get secret
```

âœ…Â **ì¶œë ¥**

```bash
NAME               TYPE                             DATA   AGE
dockerhub-secret   kubernetes.io/dockerconfigjson   1      22s
```

### **5. ë°°í¬ ìƒíƒœ ë° íŒŒë“œ í™•ì¸**

```bash
kubectl get deploy,pod
```

âœ…Â **ì¶œë ¥**

```bash
NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/timeserver   2/2     2            2           9m2s

NAME                              READY   STATUS    RESTARTS   AGE
pod/timeserver-69c87f9f8c-jn2zv   1/1     Running   0          51s
pod/timeserver-69c87f9f8c-r5j6l   1/1     Running   0          83s
```

### **6. ì ‘ì† í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ Curl íŒŒë“œ ìƒì„±**

```bash
kubectl run curl-pod --image=curlimages/curl:latest --command -- sh -c "while true; do sleep 3600; done"

# ê²°ê³¼
pod/curl-pod created
```

### **7. Timeserver íŒŒë“œ IP í™•ì¸ ë° ì ‘ì† í…ŒìŠ¤íŠ¸**

**(1) Timeserver íŒŒë“œ IP í™•ì¸**

```bash
kubectl get pod -owide
```

âœ…Â **ì¶œë ¥**

```bash
NAME                          READY   STATUS    RESTARTS   AGE     IP           NODE            NOMINATED NODE   READINESS GATES
curl-pod                      1/1     Running   0          20s     10.244.1.4   myk8s-worker    <none>           <none>
timeserver-69c87f9f8c-jn2zv   1/1     Running   0          2m34s   10.244.1.3   myk8s-worker    <none>           <none>
timeserver-69c87f9f8c-r5j6l   1/1     Running   0          3m6s    10.244.3.4   myk8s-worker2   <none>           <none
```

**(2) Timeserver íŒŒë“œ ì¤‘ í•œ ê°œì˜ IP(ex. 10.244.1.3)ë¥¼ ë³€ìˆ˜ `PODIP1`ì— í• ë‹¹**

```bash
PODIP1=<timeserver-Y íŒŒë“œ IP>
PODIP1=10.244.1.3
```

**(3) curl-pod ì—ì„œ í•´ë‹¹ IPë¡œ ì ‘ì†í•˜ì—¬ ê¸°ë³¸ ì—”ë“œí¬ì¸íŠ¸(`/`) ì‘ë‹µ í™•ì¸**

```bash
kubectl exec -it curl-pod -- curl $PODIP1
```

âœ…Â **ì¶œë ¥**

```bash
The time is 6:53:49 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-jn2zv
```

**(4) `/healthz` ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì‘ë‹µ í™•ì¸**

```bash
kubectl exec -it curl-pod -- curl $PODIP1/healthz
```

âœ…Â **ì¶œë ¥**

```bash
Healthy%
```

### **8. íŒŒë“œ ë¡œê·¸ ëª¨ë‹ˆí„°ë§**

```bash
kubectl stern deploy/timeserver
```

âœ…Â **ì¶œë ¥**

```bash
+ timeserver-69c87f9f8c-r5j6l â€º timeserver-container
+ timeserver-69c87f9f8c-jn2zv â€º timeserver-container
timeserver-69c87f9f8c-jn2zv timeserver-container Listening on 0.0.0.0:80
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:50:49] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:51:19] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:51:49] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:52:19] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:52:49] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:53:19] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.4 - - [29/Mar/2025 06:53:49] "GET / HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:53:49] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:54:19] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.4 - - [29/Mar/2025 06:54:22] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-jn2zv timeserver-container 10.244.1.1 - - [29/Mar/2025 06:54:49] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container Listening on 0.0.0.0:80
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:50:17] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:50:47] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:51:17] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:51:47] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:52:17] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:52:47] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:53:17] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:53:47] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:54:17] "GET /healthz HTTP/1.1" 200 -
timeserver-69c87f9f8c-r5j6l timeserver-container 10.244.3.1 - - [29/Mar/2025 06:54:47] "GET /healthz HTTP/1.1" 200 -
```

### **9. ì„œë¹„ìŠ¤ ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Service
metadata:
  name: timeserver
spec:
  selector:
    pod: timeserver-pod
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
    nodePort: 30000
  type: NodePort
EOF

# ê²°ê³¼
service/timeserver created
```

### **10. ìƒì„±ëœ ì„œë¹„ìŠ¤ì™€ ì—”ë“œí¬ì¸íŠ¸ í™•ì¸**

```bash
kubectl get service,ep timeserver -owide
```

âœ…Â **ì¶œë ¥**

```bash
NAME                 TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE   SELECTOR
service/timeserver   NodePort   10.96.206.165   <none>        80:30000/TCP   68s   pod=timeserver-pod

NAME                   ENDPOINTS                     AGE
endpoints/timeserver   10.244.1.3:80,10.244.3.4:80   68s
```

### **11. ì„œë¹„ìŠ¤ ì ‘ì† ë° ì™¸ë¶€ ì ‘ê·¼ í™•ì¸**

**(1) curl-pod ë‚´ì—ì„œ ì ‘ê·¼ í™•ì¸**

```bash
kubectl exec -it curl-pod -- curl timeserver
kubectl exec -it curl-pod -- curl timeserver/healthz
```

âœ…Â **ì¶œë ¥**

```bash
The time is 7:02:54 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-jn2zv

Healthy%
```

**(2) ë¡œì»¬ì—ì„œ ì ‘ê·¼ í™•ì¸**

```bash
curl http://127.0.0.1:30000
curl http://127.0.0.1:30000/healthz
```

âœ…Â **ì¶œë ¥**

```bash
The time is 7:04:09 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-jn2zv

Healthy%
```

### **12. ë¶€í•˜ ë¶„ì‚° í…ŒìŠ¤íŠ¸**

**(1) ë¬´í•œ ë°˜ë³µìœ¼ë¡œ `curl` ëª…ë ¹ ì‹¤í–‰**

```bash
while true; do curl -s --connect-timeout 1 http://127.0.0.1:30000 ; sleep 1 ; done
```

âœ…Â **ì¶œë ¥**

```bash
The time is 9:08:08 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-r5j6l
The time is 9:08:09 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-jn2zv
The time is 9:08:10 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-jn2zv
The time is 9:08:11 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-r5j6l
The time is 9:08:12 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-r5j6l
The time is 9:08:13 AM, VERSION 0.0.1
Server hostname: timeserver-69c87f9f8c-jn2zv
...
```

**(2) 100ë²ˆì˜ í˜¸ì¶œ ê²°ê³¼ ì§‘ê³„**

```bash
for i in {1..100};  do curl -s http://127.0.0.1:30000 | grep name; done | sort | uniq -c | sort -nr
```

âœ…Â **ì¶œë ¥**

```bash
     59 Server hostname: timeserver-69c87f9f8c-jn2zv
     41 Server hostname: timeserver-69c87f9f8c-r5j6l
```

---

## **ğŸ”„ ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ì„ í™œìš©í•œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì—…ë°ì´íŠ¸**

![Image](https://github.com/user-attachments/assets/a05aa06a-3aee-4e6d-ba88-911dfac24ebc)

### **1. ìƒ˜í”Œ ì•± server.py ì½”ë“œ ë³€ê²½**

- `VERSION` íŒŒì¼ ë³€ê²½ : `0.0.2`
- `server.py`  íŒŒì¼ ë³€ê²½ : `0.0.2`

![Image](https://github.com/user-attachments/assets/f1627ff3-2c3d-49f4-855b-a1fde831d4b0)

### **2. Git ì»¤ë°‹ / í‘¸ì‹œ**

```bash
git add . && git commit -m "VERSION $(cat VERSION) Changed" && git push -u origin main
```

âœ…Â **ì¶œë ¥**

```bash
[main e0e3cf9] VERSION 0.0.2 Changed
 2 files changed, 2 insertions(+), 2 deletions(-)
Enumerating objects: 7, done.
Counting objects: 100% (7/7), done.
Delta compression using up to 18 threads
Compressing objects: 100% (3/3), done.
Writing objects: 100% (4/4), 343 bytes | 343.00 KiB/s, done.
Total 4 (delta 2), reused 0 (delta 0), pack-reused 0 (from 0)
To http://192.168.219.103:3000/devops/dev-app.git
   99e9476..e0e3cf9  main -> main
branch 'main' set up to track 'origin/main'.
```

### **3. ì¿ ë²„ë„¤í‹°ìŠ¤ Deployment ì—…ë°ì´íŠ¸ ì‹œë„ ë° ë¬¸ì œ ë°œìƒ**

```bash
kubectl set image deployment timeserver timeserver-container=$DHUSER/dev-app:0.0.2 && watch -d "kubectl get deploy,ep timeserver; echo; kubectl get rs,pod"
```

âœ…Â **ì¶œë ¥**

```bash
Every 2.0s: kubectl get deploy,ep timeserver; echo; kubectl get rs,pod                                                         gram88: 06:20:02 PM
                                                                                                                                     in 0.175s (0)
NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/timeserver   2/2     1            2           158m

NAME                   ENDPOINTS                     AGE
endpoints/timeserver   10.244.1.3:80,10.244.3.4:80   138m

NAME                                    DESIRED   CURRENT   READY   AGE
replicaset.apps/timeserver-69c87f9f8c   2         2         2       151m
replicaset.apps/timeserver-6cd9654cc7   0         0         0       158m
replicaset.apps/timeserver-79d564b95c   1         1         0       7s

NAME                              READY   STATUS         RESTARTS   AGE
pod/curl-pod                      1/1     Running        0          148m
pod/timeserver-69c87f9f8c-jn2zv   1/1     Running        0          150m
pod/timeserver-69c87f9f8c-r5j6l   1/1     Running        0          151m
pod/timeserver-79d564b95c-nck7r   0/1     ErrImagePull   0          7s
```

- ìƒˆ íƒœê·¸ `0.0.2`ì˜ ì´ë¯¸ì§€ê°€ ì¡´ì¬í•˜ì§€ ì•Šì•„ ì´ë¯¸ì§€ í’€ ì—ëŸ¬(`ErrImagePull`) ë°œìƒ

![Image](https://github.com/user-attachments/assets/8bd2c910-7970-4ce3-b8ed-eb29dce03cf9)

### **4. ì  í‚¨ìŠ¤ ë¹Œë“œë¥¼ í†µí•œ ìƒˆë¡œìš´ ì´ë¯¸ì§€ ìƒì„± ë° ë°°í¬ ì—…ë°ì´íŠ¸**

- ì  í‚¨ìŠ¤(ì§€ê¸ˆ ë¹Œë“œ ì‹¤í–‰) : ìƒˆ *0.0.2* ë²„ì „ íƒœê·¸ë¡œ ì»¨í…Œì´ë„ˆ ì´ë¯¸ì§€ ë¹Œë“œ
- ì»¨í…Œì´ë„ˆ ì €ì¥ì†Œ Push â‡’ k8s deployment ì—…ë°ì´íŠ¸ ë°°í¬

![Image](https://github.com/user-attachments/assets/c97c2a8c-8408-4f02-9471-a5b0028bcec1)

- 0.0.2 ë²„ì „ì˜ ì´ë¯¸ì§€ê°€ ë°°í¬ë¨

![Image](https://github.com/user-attachments/assets/e0915f82-711e-44bf-a7c7-bfbffe12feb4)

```bash
kubectl set image deployment timeserver timeserver-container=$DHUSER/dev-app:0.0.2 && watch -d "kubectl get deploy,ep timeserver; echo; kubectl get rs,pod"
```

âœ…Â **ì¶œë ¥**

```bash
Every 2.0s: kubectl get deploy,ep timeserver; echo; kubectl get rs,pod                                                         gram88: 06:27:20 PM
                                                                                                                                     in 0.243s (0)
NAME                         READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/timeserver   2/2     2            2           166m

NAME                   ENDPOINTS                     AGE
endpoints/timeserver   10.244.1.5:80,10.244.3.5:80   146m

NAME                                    DESIRED   CURRENT   READY   AGE
replicaset.apps/timeserver-69c87f9f8c   0         0         0       158m
replicaset.apps/timeserver-6cd9654cc7   0         0         0       166m
replicaset.apps/timeserver-79d564b95c   2         2         2       7m25s

NAME                              READY   STATUS    RESTARTS   AGE
pod/curl-pod                      1/1     Running   0          155m
pod/timeserver-79d564b95c-74gpz   1/1     Running   0          113s
pod/timeserver-79d564b95c-nck7r   1/1     Running   0          7m25s
```

### **5. Gogs ì„¤ì • ë³€ê²½ ë° ì›¹í›… ë“±ë¡**

**(1) gogs ì»¨í…Œì´ë„ˆ ë‚´ `/data/gogs/conf/app.ini` íŒŒì¼ ìˆ˜ì •**

```bash
docker compose exec gogs bash

a0dda4a63d1b:/# cd /data/gogs/conf/
a0dda4a63d1b:/data/gogs/conf# vi app.ini
```

**`LOCAL_NETWORK_ALLOWLIST = 192.168.219.103` ì¶”ê°€**

```bash
[security]
INSTALL_LOCK = true
SECRET_KEY   = 0QLuknjrgYnZbGu
LOCAL_NETWORK_ALLOWLIST = 192.168.219.103
```

![Image](https://github.com/user-attachments/assets/e23ed4c1-20eb-4f75-aeae-d35cc26b469e)

**(2) ì»¨í…Œì´ë„ˆ ì¬ê¸°ë™**

```bash
docker compose restart gogs

# ê²°ê³¼
[+] Restarting 1/1
 âœ” Container gogs  Started
```

**(3) Gogs Webhook ì„¤ì •**

- **Webhooks > Gogs ì„ íƒ**

![Image](https://github.com/user-attachments/assets/785f51d3-13f2-45f4-8560-49d06dfa9e56)

- Payload URL :  `http://192.168.219.103:8080/gogs-webhook/?job=SCM-Pipeline/` <ìì‹ ì˜ ì§‘ IP>
- Content Type : `application/json` / Secret : `qwe123`
- When should this webhook be triggered? : `Just the push event` / Active : **Check**

![Image](https://github.com/user-attachments/assets/f7f2344d-1664-4f30-bef0-9732d560e897)

### **6. ì  í‚¨ìŠ¤ íŒŒì´í”„ë¼ì¸ ì„¤ì •**

![Image](https://github.com/user-attachments/assets/f9e1eb43-0113-4ac9-8f98-1ea5e974a07b)

- GitHub project : `http://192.168.219.103:3000/devops/dev-app` <ìì‹ ì˜ ì§‘ IP>
- Use Gogs secret : `qwe123`
- Build Triggers : `Build when a change is pushed to Gogs` ì„ íƒ

![Image](https://github.com/user-attachments/assets/b5a9fedd-c22a-45e2-8b39-cab6e25ae426)

- Pipeline script from SCM / SCM : `Git`
- Repo URL(`http://192.168.219.103:3000/devops/dev-app`) / Credentials(`devops**/*****`) / Branch(`*/main`)
- Script Path : `Jenkinsfile`

![Image](https://github.com/user-attachments/assets/4aa1336d-656c-4296-86b0-cc97e02b614b)

### **7. Jenkinsfile ë° ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ ì—…ë°ì´íŠ¸**

```bash
# Jenkinsfile ë¹ˆ íŒŒì¼ ì‘ì„±
touch Jenkinsfile

# VERSION íŒŒì¼ : 0.0.3 ìˆ˜ì •
# server.py íŒŒì¼ : 0.0.3 ìˆ˜ì •
```

`Jenkinsfile` ì‘ì„±

```bash
pipeline {
    agent any
    environment {
        DOCKER_IMAGE = 'shinminjin/dev-app' // Docker ì´ë¯¸ì§€ ì´ë¦„, <ìì‹ ì˜ ë„ì»¤ í—ˆë¸Œ ê³„ì •>/dev-app
    }
    stages {
        stage('Checkout') {
            steps {
                 git branch: 'main',
                 url: 'http://192.168.219.103:3000/devops/dev-app.git',  // Gitì—ì„œ ì½”ë“œ ì²´í¬ì•„ì›ƒ, <ìì‹ ì˜ ì§‘ IP>:3000
                 credentialsId: 'gogs-crd'  // Credentials ID
            }
        }
        stage('Read VERSION') {
            steps {
                script {
                    // VERSION íŒŒì¼ ì½ê¸°
                    def version = readFile('VERSION').trim()
                    echo "Version found: ${version}"
                    // í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
                    env.DOCKER_TAG = version
                }
            }
        }
        stage('Docker Build and Push') {
            steps {
                script {
                    docker.withRegistry('https://index.docker.io/v1/', 'dockerhub-crd') {
                        // DOCKER_TAG ì‚¬ìš©
                        def appImage = docker.build("${DOCKER_IMAGE}:${DOCKER_TAG}")
                        appImage.push()
                        appImage.push("latest")
                    }
                }
            }
        }
    }
    post {
        success {
            echo "Docker image ${DOCKER_IMAGE}:${DOCKER_TAG} has been built and pushed successfully!"
        }
        failure {
            echo "Pipeline failed. Please check the logs."
        }
    }
}
```

### **8. ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° Git Push**

```bash
git add . && git commit -m "VERSION $(cat VERSION) Changed" && git push -u origin main
```

âœ…Â **ì¶œë ¥**

```bash
[main 6f80ffb] VERSION 0.0.3 Changed
 3 files changed, 48 insertions(+), 2 deletions(-)
 create mode 100644 Jenkinsfile
Enumerating objects: 8, done.
Counting objects: 100% (8/8), done.
Delta compression using up to 18 threads
Compressing objects: 100% (4/4), done.
Writing objects: 100% (5/5), 1.07 KiB | 1.07 MiB/s, done.
Total 5 (delta 1), reused 0 (delta 0), pack-reused 0 (from 0)
To http://192.168.219.103:3000/devops/dev-app.git
   e0e3cf9..6f80ffb  main -> main
branch 'main' set up to track 'origin/main'.
```

![Image](https://github.com/user-attachments/assets/07b9b9b2-9ed9-4966-9103-e36e0a603b9d)

### **9. ì  í‚¨ìŠ¤ Job ë¹Œë“œ ì‹¤í–‰**

![Image](https://github.com/user-attachments/assets/de76af56-0924-495e-addb-8ec6a4376bb0)
![Image](https://github.com/user-attachments/assets/55c2583c-3861-4a7e-8335-5c2dac73a9ff)

