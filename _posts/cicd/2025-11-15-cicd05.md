---
title: CI/CD 5ì£¼ì°¨ ì •ë¦¬
date: 2025-11-15 18:00:00 +0900
categories: [CI/CD]
tags: [CI/CD]
---

## **ğŸš€ ì‹¤ìŠµí™˜ê²½ ì¤€ë¹„**

### **1. xt_multiport ì»¤ë„ ëª¨ë“ˆ ë¡œë“œ**

```bash
sudo modprobe xt_multiport

lsmod | grep xt_multiport
xt_multiport           16384  1
x_tables               65536  14 xt_conntrack,xt_statistic,nft_compat,xt_multiport,xt_tcpudp,xt_addrtype,xt_nat,xt_comment,xt_set,ipt_REJECT,xt_nfacct,ip_tables,xt_MASQUERADE,xt_mark
```

- iptablesìš© `xt_multiport` ì»¤ë„ ëª¨ë“ˆ ë¡œë“œí•¨

### **2. kind ê¸°ë°˜ Kubernetes í´ëŸ¬ìŠ¤í„°(myk8s) ìƒì„±**

```bash
kind create cluster --name myk8s --image kindest/node:v1.32.8 --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  labels:
    ingress-ready: true
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  - containerPort: 30003
    hostPort: 30003
EOF

# ê²°ê³¼
Creating cluster "myk8s" ...
 âœ“ Ensuring node image (kindest/node:v1.32.8) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-myk8s"
You can now use your cluster with:

kubectl cluster-info --context kind-myk8s

Not sure what to do next? ğŸ˜…  Check out https://kind.sigs.k8s.io/docs/user/quick-start/
```

### **3. ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ë…¸ë“œ ë¼ë²¨ í™•ì¸**

```bash
kubectl get nodes myk8s-control-plane -o jsonpath={.metadata.labels} | jq

{
  "beta.kubernetes.io/arch": "amd64",
  "beta.kubernetes.io/os": "linux",
  "ingress-ready": "true",
  "kubernetes.io/arch": "amd64",
  "kubernetes.io/hostname": "myk8s-control-plane",
  "kubernetes.io/os": "linux",
  "node-role.kubernetes.io/control-plane": ""
}
```

### **4. NGINX Ingress Controller ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì ìš©**

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml

namespace/ingress-nginx created
serviceaccount/ingress-nginx created
serviceaccount/ingress-nginx-admission created
role.rbac.authorization.k8s.io/ingress-nginx created
role.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrole.rbac.authorization.k8s.io/ingress-nginx created
clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created
rolebinding.rbac.authorization.k8s.io/ingress-nginx created
rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
configmap/ingress-nginx-controller created
service/ingress-nginx-controller created
service/ingress-nginx-controller-admission created
deployment.apps/ingress-nginx-controller created
job.batch/ingress-nginx-admission-create created
job.batch/ingress-nginx-admission-patch created
ingressclass.networking.k8s.io/nginx created
validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created
```

### **5. Ingress NGINX Controller ê¸°ë³¸ ìƒíƒœ í™•ì¸**

```bash
kubectl get deploy,svc,ep ingress-nginx-controller -n ingress-nginx

NAME                                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/ingress-nginx-controller   0/1     1            0           4s

NAME                               TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
service/ingress-nginx-controller   LoadBalancer   10.96.226.252   <pending>     80:30185/TCP,443:30620/TCP   4s

NAME                                 ENDPOINTS   AGE
endpoints/ingress-nginx-controller   <none>      4s
```

- READY: `0/1` â†’ ì»¨íŠ¸ë¡¤ëŸ¬ Podê°€ ì•„ì§ Available ìƒíƒœ ì „í™˜ ì „ ì‹œì 

### **6. Ingress NGINX Controller Deployment ìƒì„¸ ì„¤ì • ì ê²€**

```bash
kubectl describe -n ingress-nginx deployments/ingress-nginx-controller

Name:                   ingress-nginx-controller
Namespace:              ingress-nginx
CreationTimestamp:      Sat, 15 Nov 2025 10:08:37 +0900
Labels:                 app.kubernetes.io/component=controller
                        app.kubernetes.io/instance=ingress-nginx
                        app.kubernetes.io/name=ingress-nginx
                        app.kubernetes.io/part-of=ingress-nginx
                        app.kubernetes.io/version=1.14.0
Annotations:            deployment.kubernetes.io/revision: 1
Selector:               app.kubernetes.io/component=controller,app.kubernetes.io/instance=ingress-nginx,app.kubernetes.io/name=ingress-nginx
Replicas:               1 desired | 1 updated | 1 total | 0 available | 1 unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        0
RollingUpdateStrategy:  1 max unavailable, 25% max surge
Pod Template:
  Labels:           app.kubernetes.io/component=controller
                    app.kubernetes.io/instance=ingress-nginx
                    app.kubernetes.io/name=ingress-nginx
                    app.kubernetes.io/part-of=ingress-nginx
                    app.kubernetes.io/version=1.14.0
  Service Account:  ingress-nginx
  Containers:
   controller:
    Image:           registry.k8s.io/ingress-nginx/controller:v1.14.0@sha256:e4127065d0317bd11dc64c4dd38dcf7fb1c3d72e468110b4086e636dbaac943d
    Ports:           80/TCP (http), 443/TCP (https), 8443/TCP (webhook)
    Host Ports:      80/TCP (http), 443/TCP (https), 0/TCP (webhook)
    SeccompProfile:  RuntimeDefault
    Args:
      /nginx-ingress-controller
      --election-id=ingress-nginx-leader
      --controller-class=k8s.io/ingress-nginx
      --ingress-class=nginx
      --configmap=$(POD_NAMESPACE)/ingress-nginx-controller
      --validating-webhook=:8443
      --validating-webhook-certificate=/usr/local/certificates/cert
      --validating-webhook-key=/usr/local/certificates/key
      --watch-ingress-without-class=true
      --publish-status-address=localhost
    Requests:
      cpu:      100m
      memory:   90Mi
    Liveness:   http-get http://:10254/healthz delay=10s timeout=1s period=10s #success=1 #failure=5
    Readiness:  http-get http://:10254/healthz delay=10s timeout=1s period=10s #success=1 #failure=3
    Environment:
      POD_NAME:        (v1:metadata.name)
      POD_NAMESPACE:   (v1:metadata.namespace)
      LD_PRELOAD:     /usr/local/lib/libmimalloc.so
    Mounts:
      /usr/local/certificates/ from webhook-cert (ro)
  Volumes:
   webhook-cert:
    Type:          Secret (a volume populated by a Secret)
    SecretName:    ingress-nginx-admission
    Optional:      false
  Node-Selectors:  kubernetes.io/os=linux
  Tolerations:     node-role.kubernetes.io/control-plane:NoSchedule
                   node-role.kubernetes.io/master:NoSchedule
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    ReplicaSetUpdated
OldReplicaSets:  <none>
NewReplicaSet:   ingress-nginx-controller-8676d56f78 (1/1 replicas created)
Events:
  Type    Reason             Age   From                   Message
  ----    ------             ----  ----                   -------
  Normal  ScalingReplicaSet  12s   deployment-controller  Scaled up replica set ingress-nginx-controller-8676d56f78 from 0 to 1
```

---

## **ğŸ” Argo CD ì„¤ì¹˜ + Ingress by Helm**

- [https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd#ingress-configuration](https://github.com/argoproj/argo-helm/tree/main/charts/argo-cd#ingress-configuration)
- [https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#kubernetesingress-nginx](https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#kubernetesingress-nginx)
- [https://github.com/argoproj/argo-helm/issues/2477](https://github.com/argoproj/argo-helm/issues/2477)

### **1. Argo CDìš© self-signed TLS í‚¤Â·ì¸ì¦ì„œ ìƒì„±**

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout argocd.example.com.key \
  -out argocd.example.com.crt \
  -subj "/CN=argocd.example.com/O=argocd"
```

### **2. TLS í‚¤Â·ì¸ì¦ì„œ íŒŒì¼ ìƒì„± ë° ê¶Œí•œ í™•ì¸**

```bash
ls -l argocd.example.com.*

.rw-r--r-- 1.2k devshin 15 Nov 10:09 argocd.example.com.crt
.rw------- 1.7k devshin 15 Nov 10:09 argocd.example.com.key
```

### **3. ì¸ì¦ì„œ ìƒì„¸ ì •ë³´ ê²€ì¦ (openssl x509)**

```bash
openssl x509 -noout -text -in argocd.example.com.crt

...
        Issuer: CN=argocd.example.com, O=argocd
        Validity
            Not Before: Nov 15 01:09:25 2025 GMT
            Not After : Nov 15 01:09:25 2026 GMT
        Subject: CN=argocd.example.com, O=argocd
        ...
            X509v3 Basic Constraints: critical
                CA:TRUE
```

- Issuerì™€ Subject ë‘˜ ë‹¤ `CN=argocd.example.com, O=argocd` â†’ self-signed ì¸ì¦ì„œ
- `X509v3 Basic Constraints: critical / CA:TRUE` ë¡œ, ìì²´ CA ì—­í• ë„ ê°€ëŠ¥í•œ ì¸ì¦ì„œë¡œ ìƒì„±ë¨

### **4. Argo CD ì „ìš© ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ìƒì„±**

```bash
kubectl create ns argocd

namespace/argocd created
```

### **5. TLS Secret(argocd-server-tls) ìƒì„±**

```bash
kubectl -n argocd create secret tls argocd-server-tls \
  --cert=argocd.example.com.crt \
  --key=argocd.example.com.key

secret/argocd-server-tls created
```

### **6. TLS Secret ìƒì„± ìƒíƒœ í™•ì¸**

```bash
kubectl get secret -n argocd

NAME                TYPE                DATA   AGE
argocd-server-tls   kubernetes.io/tls   2      9s
```

### **7. Argo CD Helm Values íŒŒì¼ ì‘ì„±**

```bash
cat <<EOF > argocd-values.yaml
global:
  domain: argocd.example.com

server:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/ssl-passthrough: "true"
    tls: true
EOF
```

### **8. Helm Chartë¡œ Argo CD(v3.1.9) ì„¤ì¹˜**

```bash
helm repo add argo https://argoproj.github.io/argo-helm
helm install argocd argo/argo-cd --version 9.0.5 -f argocd-values.yaml --namespace argocd

NAME: argocd
LAST DEPLOYED: Sat Nov 15 10:10:38 2025
NAMESPACE: argocd
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
In order to access the server UI you have the following options:

1. kubectl port-forward service/argocd-server -n argocd 8080:443

    and then open the browser on http://localhost:8080 and accept the certificate

2. enable ingress in the values file `server.ingress.enabled` and either
      - Add the annotation for ssl passthrough: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-1-ssl-passthrough
      - Set the `configs.params."server.insecure"` in the values file and terminate SSL at your ingress: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-2-multiple-ingress-objects-and-hosts

After reaching the UI the first time you can login with username: admin and the random password generated during the installation. You can find the password by running:

kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

(You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://argo-cd.readthedocs.io/en/stable/getting_started/#4-login-using-the-cli)
```

### **9. Argo CD ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ì ê²€**

```bash
kubectl get pod,ingress,svc,ep,secret,cm -n argocd

NAME                                                   READY   STATUS    RESTARTS   AGE
pod/argocd-application-controller-0                    1/1     Running   0          118s
pod/argocd-applicationset-controller-bbff79c6f-h4p69   1/1     Running   0          118s
pod/argocd-dex-server-6877ddf4f8-cg5ss                 1/1     Running   0          118s
pod/argocd-notifications-controller-7b5658fc47-4qq4j   1/1     Running   0          118s
pod/argocd-redis-7d948674-v7d7s                        1/1     Running   0          118s
pod/argocd-repo-server-7679dc55f5-gjqzw                1/1     Running   0          118s
pod/argocd-server-7d769b6f48-kznpf                     1/1     Running   0          118s

NAME                                      CLASS   HOSTS                ADDRESS     PORTS     AGE
ingress.networking.k8s.io/argocd-server   nginx   argocd.example.com   localhost   80, 443   118s

NAME                                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE
service/argocd-applicationset-controller   ClusterIP   10.96.118.107   <none>        7000/TCP            119s
service/argocd-dex-server                  ClusterIP   10.96.141.129   <none>        5556/TCP,5557/TCP   119s
service/argocd-redis                       ClusterIP   10.96.8.99      <none>        6379/TCP            119s
service/argocd-repo-server                 ClusterIP   10.96.111.208   <none>        8081/TCP            119s
service/argocd-server                      ClusterIP   10.96.252.68    <none>        80/TCP,443/TCP      119s

NAME                                         ENDPOINTS                           AGE
endpoints/argocd-applicationset-controller   10.244.0.13:7000                    118s
endpoints/argocd-dex-server                  10.244.0.11:5557,10.244.0.11:5556   118s
endpoints/argocd-redis                       10.244.0.9:6379                     118s
endpoints/argocd-repo-server                 10.244.0.12:8081                    118s
endpoints/argocd-server                      10.244.0.15:8080,10.244.0.15:8080   119s

NAME                                  TYPE                 DATA   AGE
secret/argocd-initial-admin-secret    Opaque               1      117s
secret/argocd-notifications-secret    Opaque               0      119s
secret/argocd-redis                   Opaque               1      2m2s
secret/argocd-secret                  Opaque               3      119s
secret/argocd-server-tls              kubernetes.io/tls    2      2m50s
secret/sh.helm.release.v1.argocd.v1   helm.sh/release.v1   1      2m21s

NAME                                      DATA   AGE
configmap/argocd-cm                       18     119s
configmap/argocd-cmd-params-cm            20     119s
configmap/argocd-gpg-keys-cm              0      119s
configmap/argocd-notifications-cm         1      119s
configmap/argocd-rbac-cm                  4      119s
configmap/argocd-redis-health-configmap   2      119s
configmap/argocd-ssh-known-hosts-cm       1      119s
configmap/argocd-tls-certs-cm             0      119s
configmap/kube-root-ca.crt                1      2m54s
```

### **10. argocd-server Ingress ì„¤ì • ìƒì„¸ í™•ì¸**

```bash
kubectl describe ingress -n argocd argocd-server

Name:             argocd-server
Labels:           app.kubernetes.io/component=server
                  app.kubernetes.io/instance=argocd
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/name=argocd-server
                  app.kubernetes.io/part-of=argocd
                  app.kubernetes.io/version=v3.1.9
                  helm.sh/chart=argo-cd-9.0.5
Namespace:        argocd
Address:          localhost
Ingress Class:    nginx
Default backend:  <default>
TLS:
  argocd-server-tls terminates argocd.example.com
Rules:
  Host                Path  Backends
  ----                ----  --------
  argocd.example.com  
                      /   argocd-server:443 (10.244.0.15:8080)
Annotations:          meta.helm.sh/release-name: argocd
                      meta.helm.sh/release-namespace: argocd
                      nginx.ingress.kubernetes.io/force-ssl-redirect: true
                      nginx.ingress.kubernetes.io/ssl-passthrough: true
Events:
  Type    Reason  Age                  From                      Message
  ----    ------  ----                 ----                      -------
  Normal  Sync    73s (x2 over 2m12s)  nginx-ingress-controller  Scheduled for sync
```

```bash
kubectl get ingress -n argocd argocd-server

NAME            CLASS   HOSTS                ADDRESS     PORTS     AGE
argocd-server   nginx   argocd.example.com   localhost   80, 443   2m29s
```

### **11. Ingress YAML ì •ë¦¬ ì¶œë ¥ ë° TLS/Backend spec í™•ì¸**

```bash
kubectl get ingress -n argocd argocd-server -o yaml | kubectl neat |yq

...
      "nginx.ingress.kubernetes.io/force-ssl-redirect": "true",
      "nginx.ingress.kubernetes.io/ssl-passthrough": "true"
		...
    "name": "argocd-server",
    "namespace": "argocd"
  },
  "spec": {
    "ingressClassName": "nginx",
    "rules": [
      {
        "host": "argocd.example.com",
        "http": {
          "paths": [
            {
              "backend": {
                "service": {
                  "name": "argocd-server",
                  "port": {
                    "number": 443
                  }
                }
              },
              "path": "/",
              "pathType": "Prefix"
            }
          ]
        }
      }
    ],
    "tls": [
      {
        "hosts": [
          "argocd.example.com"
        ],
        "secretName": "argocd-server-tls"
      }
    ]
  }
}
```

### **12. `/etc/hosts` ì— ë„ë©”ì¸ ë§¤í•‘ ì„¤ì •**

```bash
echo "127.0.0.1 argocd.example.com" | sudo tee -a /etc/hosts
```

```bash
cat /etc/hosts
...
127.0.0.1 argocd.example.com
```

### **13. curl ë¡œ HTTPS ì ‘ì† ë° TLS í•¸ë“œì…°ì´í¬/ë¦¬ë””ë ‰ì…˜ í™•ì¸**

```bash
curl -vk https://argocd.example.com/

* Host argocd.example.com:443 was resolved.
* IPv6: (none)
* IPv4: 127.0.0.1
*   Trying 127.0.0.1:443...
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* SSL Trust: peer verification disabled
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
* SSL connection using TLSv1.3 / TLS_AES_256_GCM_SHA384 / X25519MLKEM768 / RSASSA-PSS
* ALPN: server accepted h2
* Server certificate:
*   subject: CN=argocd.example.com; O=argocd
*   start date: Nov 15 01:09:25 2025 GMT
*   expire date: Nov 15 01:09:25 2026 GMT
*   issuer: CN=argocd.example.com; O=argocd
*   Certificate level 0: Public key type RSA (2048/112 Bits/secBits), signed using sha256WithRSAEncryption
* SSL certificate OpenSSL verify result: self-signed certificate (18)
*  SSL certificate verification failed, continuing anyway!
* Established connection to argocd.example.com (127.0.0.1 port 443) from 127.0.0.1 port 56882 
* using HTTP/2
* [HTTP/2] [1] OPENED stream for https://argocd.example.com/
* [HTTP/2] [1] [:method: GET]
* [HTTP/2] [1] [:scheme: https]
* [HTTP/2] [1] [:authority: argocd.example.com]
* [HTTP/2] [1] [:path: /]
* [HTTP/2] [1] [user-agent: curl/8.17.0]
* [HTTP/2] [1] [accept: */*]
> GET / HTTP/2
> Host: argocd.example.com
> User-Agent: curl/8.17.0
> Accept: */*
> 
* Request completely sent off
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
* TLSv1.3 (IN), TLS handshake, Newsession Ticket (4):
< HTTP/2 307 
< date: Sat, 15 Nov 2025 01:19:03 GMT
< content-type: text/html; charset=utf-8
< content-length: 63
< location: https://argocd.example.com/
< strict-transport-security: max-age=31536000; includeSubDomains
< 
<a href="https://argocd.example.com/">Temporary Redirect</a>.

* Connection #0 to host argocd.example.com:443 left intact
```

### **14. Ingress NGINX ì»¨íŠ¸ë¡¤ëŸ¬ ë¡œê·¸ë¡œ Argo CD ìš”ì²­ íë¦„ í™•ì¸**

```bash
kubectl -n ingress-nginx logs deploy/ingress-nginx-controller

...
172.18.0.1 - - [15/Nov/2025:01:19:03 +0000] "GET / HTTP/2.0" 307 63 "-" "curl/8.17.0" 33 0.001 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 bc2372edab531a25b00d5e8e9b55bc36
```

- Ingressê°€ `argocd-argocd-server-443` ë°±ì—”ë“œë¡œ íŠ¸ë˜í”½ì„ ë„˜ê¸°ê³ , ìµœì¢…ì ìœ¼ë¡œ Argo CD ì„œë²„ Pod (`10.244.0.15:8080`)ê¹Œì§€ ë¼ìš°íŒ…ë˜ê³  ìˆìŒì„ í™•ì¸

### **15. Argo CD ì„œë²„ ë¡œê·¸ì—ì„œ TLS Secret ë¡œë”© í™•ì¸**

```bash
kubectl -n argocd logs deploy/argocd-server

...
time="2025-11-15T01:20:02Z" level=info msg="Loading TLS configuration from secret argocd/argocd-server-tls"
time="2025-11-15T01:20:03Z" level=info msg="invalidated cache for resource in namespace: argocd with the name: argocd-notifications-cm"
time="2025-11-15T01:20:03Z" level=info msg="invalidated cache for resource in namespace: argocd with the name: argocd-notifications-secret"
```

### **16. ì´ˆê¸° admin ê³„ì • ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ**

```bash
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d ;echo
uikd9ka0nmfTTcmV
```

### **17. ë¸Œë¼ìš°ì €ë¡œ Argo CD UI ì ‘ì† ì‹œë„ ë° ë™ì‘ í™•ì¸**

```bash
http://argocd.example.com
```
![](https://velog.velcdn.com/images/tlsalswls123/post/cfe2b8eb-c0ba-47ca-add1-77defca0f0ef/image.png)

```bash
kubectl -n ingress-nginx logs deploy/ingress-nginx-controller

172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/1.1" 308 164 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 338 0.000 [argocd-argocd-server-443] [] - - - - 44eb99d55dce95412869019493c5b074
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 3a96052abfc7451ecb06aeb95f4075e4
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 72be6e4174ab0fbe86366faf21a6916e
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 137c63efef77d9f6c11429a9fbc10593
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.001 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 b8f42975e9f718a00fb0b497291d935d
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 20fa026fe954afe7756977ccb5d973c9
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 15f6af309ff20d89650573cd3240039b
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 51588e07b31e78e14ccfa5fd85354764
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 7000eed8384feb8d52188c25fc32e623
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 6d78d3a9c5a11fb93eb8b1d80e2eeb59
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 0c671ca13070b605fe689052b8278be7
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 215cf83536bb7b697111fa5bdc233cf4
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.001 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 a319cd1ddfffa8403d76b870aac5b355
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.001 307 92edf9f438425a11767dfc6ac06023c7
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 1bb6c1268d4d63efc8d7cf978746b8bd
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 8ac0291d43e0dba665d422bef78a3531
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.001 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 24793ccc9f08837d4f4d46cfb2302325
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 14a3a471899e1ea07a77d1548dbed123
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 f1187b04a1eb41b878342479267c9445
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 e6bb18b1b9fbac5a042e6abc7d93fbfe
172.18.0.1 - - [15/Nov/2025:02:01:23 +0000] "GET / HTTP/2.0" 307 63 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:145.0) Gecko/20100101 Firefox/145.0" 17 0.000 [argocd-argocd-server-443] [] 10.244.0.15:8080 63 0.000 307 24d9dd37dd24e42dc29e05dbc5e4d9fb
```
- `GET / HTTP/1.1` â†’ 308, ì´í›„ ë‹¤ìˆ˜ì˜ `GET / HTTP/2.0` â†’ 307 ì‘ë‹µ ë¡œê·¸ê°€ ì—°ì† ì¶œë ¥
- ëª¨ë‘ `backend: [argocd-argocd-server-443]` â†’ `10.244.0.15:8080` ìœ¼ë¡œ í¬ì›Œë”©ë˜ëŠ” 307 ë¦¬ë””ë ‰ì…˜

### **18. Ingress Controllerì— SSL Passthrough ê¸°ëŠ¥ í™œì„±í™”**

```bash
kubectl edit -n ingress-nginx deployments/ingress-nginx-controller

- --enable-ssl-passthrough ì¶”ê°€
```
![](https://velog.velcdn.com/images/tlsalswls123/post/4aff6833-ab8d-496a-9b64-e673e8b96a3e/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/e95c1647-71b1-42d8-9c84-bf5f17a5a431/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/5b78a74b-5396-496c-b08f-4e667e3b4df8/image.png)

### **19. Argo CD CLIë¡œ ì„œë²„ ë¡œê·¸ì¸ (admin ê³„ì •)**

```bash
argocd login argocd.example.com --insecure
Username: admin
Password: uikd9ka0nmfTTcmV

'admin:login' logged in successfully
Context 'argocd.example.com' updated
```

```bash
argocd cluster list

SERVER                          NAME        VERSION  STATUS   MESSAGE                                                  PROJECT
https://kubernetes.default.svc  in-cluster           Unknown  Cluster has no applications and is not being monitored.  
```

```bash
argocd account list

NAME   ENABLED  CAPABILITIES
admin  true     login
```

---

## **â›” ì ‘ê·¼ ì œì–´**

### **1. íŒ¨ë“œì›Œë“œ ë³€ê²½**

```bash
argocd account update-password
*** Enter password of currently logged in user (admin): uikd9ka0nmfTTcmV
*** Enter new password for user admin: qwe12345
*** Confirm new password for user admin: qwe12345

Password updated
Context 'argocd.example.com' updated
```

### **2. argocd-cm ConfigMap ê¸°ë³¸ ì„¤ì • í™•ì¸**

```bash
kubectl get cm -n argocd argocd-cm -o yaml

apiVersion: v1
data:
  admin.enabled: "true"
  application.instanceLabelKey: argocd.argoproj.io/instance
  application.sync.impersonation.enabled: "false"
  exec.enabled: "false"
  resource.customizations.ignoreResourceUpdates.ConfigMap: |
    jqPathExpressions:
      # Ignore the cluster-autoscaler status
      - '.metadata.annotations."cluster-autoscaler.kubernetes.io/last-updated"'
      # Ignore the annotation of the legacy Leases election
      - '.metadata.annotations."control-plane.alpha.kubernetes.io/leader"'
  resource.customizations.ignoreResourceUpdates.Endpoints: |
    jsonPointers:
      - /metadata
      - /subsets
  resource.customizations.ignoreResourceUpdates.all: |
    jsonPointers:
      - /status
  resource.customizations.ignoreResourceUpdates.apps_ReplicaSet: |
    jqPathExpressions:
      - '.metadata.annotations."deployment.kubernetes.io/desired-replicas"'
      - '.metadata.annotations."deployment.kubernetes.io/max-replicas"'
      - '.metadata.annotations."rollout.argoproj.io/desired-replicas"'
  resource.customizations.ignoreResourceUpdates.argoproj.io_Application: |
    jqPathExpressions:
      - '.metadata.annotations."notified.notifications.argoproj.io"'
      - '.metadata.annotations."argocd.argoproj.io/refresh"'
      - '.metadata.annotations."argocd.argoproj.io/hydrate"'
      - '.operation'
  resource.customizations.ignoreResourceUpdates.argoproj.io_Rollout: |
    jqPathExpressions:
      - '.metadata.annotations."notified.notifications.argoproj.io"'
  resource.customizations.ignoreResourceUpdates.autoscaling_HorizontalPodAutoscaler: |
    jqPathExpressions:
      - '.metadata.annotations."autoscaling.alpha.kubernetes.io/behavior"'
      - '.metadata.annotations."autoscaling.alpha.kubernetes.io/conditions"'
      - '.metadata.annotations."autoscaling.alpha.kubernetes.io/metrics"'
      - '.metadata.annotations."autoscaling.alpha.kubernetes.io/current-metrics"'
  resource.customizations.ignoreResourceUpdates.discovery.k8s.io_EndpointSlice: |
    jsonPointers:
      - /metadata
      - /endpoints
      - /ports
  resource.exclusions: |
    ### Network resources created by the Kubernetes control plane and excluded to reduce the number of watched events and UI clutter
    - apiGroups:
      - ''
      - discovery.k8s.io
      kinds:
      - Endpoints
      - EndpointSlice
    ### Internal Kubernetes resources excluded reduce the number of watched events
    - apiGroups:
      - coordination.k8s.io
      kinds:
      - Lease
    ### Internal Kubernetes Authz/Authn resources excluded reduce the number of watched events
    - apiGroups:
      - authentication.k8s.io
      - authorization.k8s.io
      kinds:
      - SelfSubjectReview
      - TokenReview
      - LocalSubjectAccessReview
      - SelfSubjectAccessReview
      - SelfSubjectRulesReview
      - SubjectAccessReview
    ### Intermediate Certificate Request excluded reduce the number of watched events
    - apiGroups:
      - certificates.k8s.io
      kinds:
      - CertificateSigningRequest
    - apiGroups:
      - cert-manager.io
      kinds:
      - CertificateRequest
    ### Cilium internal resources excluded reduce the number of watched events and UI Clutter
    - apiGroups:
      - cilium.io
      kinds:
      - CiliumIdentity
      - CiliumEndpoint
      - CiliumEndpointSlice
    ### Kyverno intermediate and reporting resources excluded reduce the number of watched events and improve performance
    - apiGroups:
      - kyverno.io
      - reports.kyverno.io
      - wgpolicyk8s.io
      kinds:
      - PolicyReport
      - ClusterPolicyReport
      - EphemeralReport
      - ClusterEphemeralReport
      - AdmissionReport
      - ClusterAdmissionReport
      - BackgroundScanReport
      - ClusterBackgroundScanReport
      - UpdateRequest
  server.rbac.log.enforce.enable: "false"
  statusbadge.enabled: "false"
  timeout.hard.reconciliation: 0s
  timeout.reconciliation: 180s
  url: https://argocd.example.com
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: argocd
    meta.helm.sh/release-namespace: argocd
  creationTimestamp: "2025-11-15T01:11:01Z"
  labels:
    app.kubernetes.io/component: server
    app.kubernetes.io/instance: argocd
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
    app.kubernetes.io/version: v3.1.9
    helm.sh/chart: argo-cd-9.0.5
  name: argocd-cm
  namespace: argocd
  resourceVersion: "822"
  uid: a5429648-110c-4b8e-bee5-09939f3b23b6
```

### **3. ë¡œì»¬ ì‚¬ìš©ì alice ê³„ì • ì •ì˜**

```bash
kubectl edit cm -n argocd argocd-cm

accounts.alice: apiKey, login # ì¶”ê°€
configmap/argocd-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/4e39e71b-c6d5-4d36-bde1-ba4b60a67af8/image.png)

### **4. Argo CD ê³„ì • ëª©ë¡ì—ì„œ alice ìƒì„± ì—¬ë¶€ í™•ì¸**

```bash
argocd account list

NAME   ENABLED  CAPABILITIES
admin  true     login
alice  true     apiKey, login
```
![](https://velog.velcdn.com/images/tlsalswls123/post/eee0b8e0-dd62-429f-acfc-30f605d4d3d2/image.png)

### **5. alice ê³„ì • ë¹„ë°€ë²ˆí˜¸ ì„¤ì •**

```bash
argocd account update-password \
  --account alice \
  --current-password qwe12345 \
  --new-password alice12345

Password updated
```

### **6. argocd-secret ì—ì„œ ê³„ì • ì •ë³´(bcrypt í•´ì‹œ/í† í°) í™•ì¸**

```bash
kubectl get secret -n argocd argocd-secret -o jsonpath='{.data}' | jq

{
  "accounts.alice.password": "JDJhJDEwJGRWU2RZTkY4MjlHVXRaZ2FIckdrNy53Umt6Q1Ztb3QwL2tqTi81UHNyZENIcmNLSEVYZFlT",
  "accounts.alice.passwordMtime": "MjAyNS0xMS0xNVQwMzo0NzoxNVo=",
  "accounts.alice.tokens": "bnVsbA==",
  "admin.password": "JDJhJDEwJERaQXRMRUJWV1pydmc2WmI0OEhzUGVZSVRNdVVWbFo0ODRQc0tRay9jSmRQYXFwT1drS0l1",
  "admin.passwordMtime": "MjAyNS0xMS0xNVQwMzozODoxMlo=",
  "server.secretkey": "bVdDajNmSlU0YlVtT2o1YmdUZkNSVzJIZ0VSaUcxUmVJRU5QUy9sQzVSST0="
}
```

### **7. alice í† í° ìƒíƒœ í™•ì¸ (ì•„ì§ í† í° ì—†ìŒ)**

```bash
kubectl get secret -n argocd argocd-secret -o jsonpath='{.data.accounts\.alice\.tokens}' | base64 -d ; echo
null
```

### **8. ìƒ˜í”Œ ì• í”Œë¦¬ì¼€ì´ì…˜ Guestbook ë°°í¬**

- [https://github.com/argoproj/argocd-example-apps/tree/master/helm-guestbook](https://github.com/argoproj/argocd-example-apps/tree/master/helm-guestbook)

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: guestbook
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values.yaml
    path: helm-guestbook
    repoURL: https://github.com/argoproj/argocd-example-apps
    targetRevision: HEAD
  syncPolicy:
    automated:
      enabled: true
      prune: true
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: guestbook
    server: https://kubernetes.default.svc
EOF

Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/611290d8-618d-4367-a148-367808f6871e/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/2df264c0-f526-48c4-857b-5d49a8e1ae7d/image.png)

### **9. alice ê³„ì •ìœ¼ë¡œ UI ë¡œê·¸ì¸ í›„ ê¶Œí•œ ì œí•œ í™•ì¸ (RBAC ê¸°ë³¸ê°’)**
- admin ë¡œê·¸ì•„ì›ƒ í›„, UI ì—ì„œ `alice` / `alice12345` ë¡œ ë¡œê·¸ì¸
- Application ëª©ë¡/Cluster ì •ë³´ê°€ ë³´ì´ì§€ ì•ŠìŒ

![](https://velog.velcdn.com/images/tlsalswls123/post/99ff9ce1-5ae2-4465-a1fc-8fb53b0777e7/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/e2aff5a3-1580-4863-a832-0c3aa4b25ac8/image.png)

---

## **ğŸ‘¤ ê¶Œí•œ ë¶€ì—¬ RBAC**

### **1. Argo CD RBAC ì„¤ì • ìƒíƒœ í™•ì¸ (ì´ˆê¸°ê°’ ì ê²€)**

```bash
kubectl get cm -n argocd argocd-rbac-cm -o jsonpath='{.data}' | jq

{
  "policy.csv": "", # ì •ì±… ë¹„ì–´ ìˆìŒ
  "policy.default": "", # ê¸°ë³¸ ì •ì±… ë¯¸ì„¤ì •
  "policy.matchMode": "glob",
  "scopes": "[groups]"
}
```

### **2. argocd-rbac-cm í¸ì§‘ìœ¼ë¡œ alice ê¶Œí•œ ì •ì±… ì •ì˜**

```bash
kubectl edit cm -n argocd argocd-rbac-cm

configmap/argocd-rbac-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/c19e47cc-c598-42e6-aa67-eb6856fd1237/image.png)

### **3. alice UI ê¶Œí•œ ê²€ì¦ â€“ Application / Cluster ì¡°íšŒ ê°€ëŠ¥, ì‚­ì œ ë¶ˆê°€**

**(1) Applications í™”ë©´: `guestbook` ì•±ì´ ëª©ë¡ì— í‘œì‹œë¨**
![](https://velog.velcdn.com/images/tlsalswls123/post/c47a8573-43b4-4cf5-a449-b9bea04f7f10/image.png)

**(2) Clusters í™”ë©´: `in-cluster` í´ëŸ¬ìŠ¤í„° ì •ë³´ ì¡°íšŒ ê°€ëŠ¥**
![](https://velog.velcdn.com/images/tlsalswls123/post/6aaa4f20-666b-4d33-af12-2521bb812d60/image.png)

**(3) RBAC ì •ì±… ìƒ `delete` ê¶Œí•œì´ ì—†ì–´ ì‚­ì œëŠ” ë¶ˆê°€**
![](https://velog.velcdn.com/images/tlsalswls123/post/90e45a83-eaa6-4ffe-9667-852b670c7eb8/image.png)

### **4. alice ê³„ì •ìœ¼ë¡œ CLI ë¡œê·¸ì¸ ë° ê¶Œí•œ í™•ì¸ (cluster/app)**

```bash
argocd login argocd.example.com --insecure --username alice
Password: alice12345

'alice:login' logged in successfully
Context 'argocd.example.com' updated
```

```bash
argocd cluster list

SERVER                          NAME        VERSION  STATUS      MESSAGE  PROJECT
https://kubernetes.default.svc  in-cluster  1.32     Successful           
```

```bash
argocd app list

NAME              CLUSTER                         NAMESPACE  PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                             PATH            TARGET
argocd/guestbook  https://kubernetes.default.svc  guestbook  default  Synced  Healthy  Auto-Prune  <none>      https://github.com/argoproj/argocd-example-apps  helm-guestbook  HEAD
```

### **5. admin ê³„ì • ë¹„í™œì„±í™” ì„¤ì •**

```bash
kubectl edit cm -n argocd argocd-cm

 admin.enabled: "false"
configmap/argocd-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/fe054b96-16bf-4257-a5fd-4355e0080e73/image.png)

```bash
argocd account list

NAME   ENABLED  CAPABILITIES
admin  false    login
alice  true     apiKey, login
```

---

## **ğŸ§ª ë¡œì»¬ ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ RBAC**

### **1. ë¡œì»¬ ì„œë¹„ìŠ¤ ì–´ì¹´ìš´íŠ¸ìš© gitops-ci ê³„ì • ìƒì„±**

```bash
kubectl edit cm -n argocd argocd-cm

accounts.gitops-ci: apiKey
configmap/argocd-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/c8f8dd1b-fdc2-4e0c-9e7f-6e1debf2df8b/image.png)

```bash
argocd account list

NAME       ENABLED  CAPABILITIES
admin      false    login
alice      true     apiKey, login
gitops-ci  true     apiKey
```

### **2. alice ê³„ì •ìœ¼ë¡œ gitops-ci í† í° ìƒì„± ì‹œë„ (ê¶Œí•œ ë¶€ì¡± ì˜¤ë¥˜)**

```bash
argocd account generate-token -a gitops-ci

{"level":"fatal","msg":"rpc error: code = PermissionDenied desc = permission denied: accounts, update, gitops-ci, sub: alice, iat: 2025-11-15T04:00:47Z","time":"2025-11-15T13:09:41+09:00"}
```

### **3. user-update ì—­í•  ìƒì„± ë° aliceì— ê³„ì • ê´€ë¦¬ ê¶Œí•œ ë¶€ì—¬**

- [https://argo-cd.readthedocs.io/en/stable/operator-manual/rbac/](https://argo-cd.readthedocs.io/en/stable/operator-manual/rbac/)

```bash
kubectl edit cm -n argocd argocd-rbac-cm

  policy.csv: |
    p, role:user-update, accounts, update, *, allow
    p, role:user-update, accounts, get, *, allow
    g, alice, role:user-update
    
configmap/argocd-rbac-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/5a075a41-053a-46f4-80b9-debd503f5f0d/image.png)

### **4. gitops-ci ê³„ì • í† í° ìƒì„± ë° JWT íšë“**

```bash
argocd account generate-token -a gitops-ci

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJnaXRvcHMtY2k6YXBpS2V5IiwibmJmIjoxNzYzMTgwMDg5LCJpYXQiOjE3NjMxODAwODksImp0aSI6IjJjYWY4NWU5LWViNTQtNDg3ZC1iZjZmLWNkYjk4ZjAzODc1NSJ9.YvM1Xo5sQ941vTdJ-8cU9e_u35z5loCV_Cvwxqkd__g
```

### **5. gitops-ci í† í° ë™ì‘ ê²€ì¦**

```bash
argocd account get-user-info --auth-token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJnaXRvcHMtY2k6YXBpS2V5IiwibmJmIjoxNzYzMTgwMDg5LCJpYXQiOjE3NjMxODAwODksImp0aSI6IjJjYWY4NWU5LWViNTQtNDg3ZC1iZjZmLWNkYjk4ZjAzODc1NSJ9.YvM1Xo5sQ941vTdJ-8cU9e_u35z5loCV_Cvwxqkd__g

Logged In: true
Username: gitops-ci
Issuer: argocd
Groups: 
```

---

## **ğŸ§© í”„ë¡œì íŠ¸ ì—­í• ê³¼ í† í° TOKEN**

### **1. sample-apps AppProject ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: AppProject
metadata:
  name: sample-apps
  namespace: argocd
spec:
  roles:
    - name: read-sync
      description: read and sync privileges
      policies:
        - p, proj:sample-apps:read-sync, applications, get, sample-apps/*, allow
        - p, proj:sample-apps:read-sync, applications, sync, sample-apps/*, allow
  clusterResourceWhitelist:
    - group: '*'
      kind: '*'
  description: Project to configure argocd self-manage application
  destinations:
    - namespace: test
      server: https://kubernetes.default.svc
  sourceRepos:
    - https://github.com/argoproj/argocd-example-apps.git
EOF

appproject.argoproj.io/sample-apps created
```

```bash
kubectl get appproject -n argocd

NAME          AGE
default       3h8m
sample-apps   16s
```
![](https://velog.velcdn.com/images/tlsalswls123/post/2151cf7d-1fe3-4c57-ae62-0334dcbd60af/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/32362230-5ccf-4c9e-94ab-1e5cc0f28fef/image.png)

### **2. sample-apps í”„ë¡œì íŠ¸ì— pre-post-sync ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: pre-post-sync
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: sample-apps
  source:
    path: pre-post-sync
    repoURL: https://github.com/argoproj/argocd-example-apps
    targetRevision: master
  destination:
    namespace: test
    server: https://kubernetes.default.svc
  syncPolicy:
    automated:
      enabled: false
    syncOptions:
    - CreateNamespace=true
EOF

Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/pre-post-sync created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d967711c-462a-411b-8e08-bce4db96acb6/image.png)

```bash
argocd app list

NAME                  CLUSTER                         NAMESPACE  PROJECT      STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                             PATH            TARGET
argocd/guestbook      https://kubernetes.default.svc  guestbook  default      Synced     Healthy  Auto-Prune  <none>      https://github.com/argoproj/argocd-example-apps  helm-guestbook  HEAD
argocd/pre-post-sync  https://kubernetes.default.svc  test       sample-apps  OutOfSync  Missing  Manual      <none>      https://github.com/argoproj/argocd-example-apps  pre-post-sync   master
```

### **3. alice ê³„ì •ìœ¼ë¡œ pre-post-sync Sync ì‹œë„ â†’ ê¶Œí•œ ë¶€ì¡±ìœ¼ë¡œ ì‹¤íŒ¨**

```bash
argocd app sync argocd/pre-post-sync

{"level":"fatal","msg":"rpc error: code = PermissionDenied desc = permission denied: applications, sync, sample-apps/pre-post-sync, sub: alice, iat: 2025-11-15T04:00:47Z","time":"2025-11-15T13:24:55+09:00"}
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d7ce452d-b0c7-4508-9929-f50db63e92c1/image.png)

### **4. í”„ë¡œì íŠ¸ ì—­í•  í† í° ë°œê¸‰ì„ ìœ„í•´ aliceì— projects ì—…ë°ì´íŠ¸ ê¶Œí•œ ë¶€ì—¬**

```bash
kubectl edit cm -n argocd argocd-rbac-cm

p, role:user-update, projects, update, sample-apps, allow
configmap/argocd-rbac-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/926ebf01-1cca-46d4-be4d-8be4fb7d1da8/image.png)

### **5. sample-apps read-sync ì—­í• ìš© í”„ë¡œì íŠ¸ í† í° ìƒì„±**

```bash
argocd proj role create-token sample-apps read-sync

Create token succeeded for proj:sample-apps:read-sync.
  ID: 29542016-a082-46c8-bc3e-4887a96ed15a
  Issued At: 2025-11-15T13:28:10+09:00
  Expires At: Never
  Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJwcm9qOnNhbXBsZS1hcHBzOnJlYWQtc3luYyIsIm5iZiI6MTc2MzE4MDg5MCwiaWF0IjoxNzYzMTgwODkwLCJqdGkiOiIyOTU0MjAxNi1hMDgyLTQ2YzgtYmMzZS00ODg3YTk2ZWQxNWEifQ.ESFPIoHR3iYE10zYvrGDb8-yRt4_6iwPsRXy3Dg_Mic
```

### **6. alice ê³„ì •ì€ ì—¬ì „íˆ ì§ì ‘ sync ë¶ˆê°€ (ì‚¬ìš©ì RBACì™€ ë³„ê°œ)**

```bash
argocd app sync argocd/pre-post-sync

{"level":"fatal","msg":"rpc error: code = PermissionDenied desc = permission denied: applications, sync, sample-apps/pre-post-sync, sub: alice, iat: 2025-11-15T04:00:47Z","time":"2025-11-15T13:28:52+09:00"}
```

### **7. read-sync ì—­í•  í† í°ìœ¼ë¡œ pre-post-sync ìˆ˜ë™ ë™ê¸°í™” ì„±ê³µ**

```bash
TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJwcm9qOnNhbXBsZS1hcHBzOnJlYWQtc3luYyIsIm5iZiI6MTc2MzE4MDg5MCwiaWF0IjoxNzYzMTgwODkwLCJqdGkiOiIyOTU0MjAxNi1hMDgyLTQ2YzgtYmMzZS00ODg3YTk2ZWQxNWEifQ.ESFPIoHR3iYE10zYvrGDb8-yRt4_6iwPsRXy3Dg_Mic
argocd app sync argocd/pre-post-sync --auth-token $TOKEN

TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME                    STATUS    HEALTH        HOOK  MESSAGE
2025-11-15T13:30:16+09:00            Service        test  pre-post-sync-kustomize-guestbook-ui  OutOfSync  Missing              
2025-11-15T13:30:16+09:00   apps  Deployment        test  pre-post-sync-kustomize-guestbook-ui  OutOfSync  Missing              
2025-11-15T13:30:17+09:00          Namespace                              test   Running   Synced              namespace/test created
2025-11-15T13:30:17+09:00  batch         Job        test  pre-post-sync-before            Progressing              
2025-11-15T13:30:19+09:00  batch         Job        test  pre-post-sync-before   Running   Synced     PreSync  job.batch/pre-post-sync-before created
2025-11-15T13:30:35+09:00            Service        test  pre-post-sync-kustomize-guestbook-ui    Synced  Healthy                  
2025-11-15T13:30:35+09:00   apps  Deployment        test  pre-post-sync-kustomize-guestbook-ui    Synced  Progressing              
2025-11-15T13:30:36+09:00   apps  Deployment        test  pre-post-sync-kustomize-guestbook-ui    Synced  Healthy              
2025-11-15T13:30:37+09:00  batch         Job        test  pre-post-sync-before                  Succeeded   Synced     PreSync  Reached expected number of succeeded pods
2025-11-15T13:30:37+09:00            Service        test  pre-post-sync-kustomize-guestbook-ui    Synced   Healthy              service/pre-post-sync-kustomize-guestbook-ui created
2025-11-15T13:30:37+09:00   apps  Deployment        test  pre-post-sync-kustomize-guestbook-ui    Synced   Healthy              deployment.apps/pre-post-sync-kustomize-guestbook-ui created
2025-11-15T13:30:37+09:00  batch         Job        test   pre-post-sync-after   Running   Synced    PostSync  job.batch/pre-post-sync-after created
2025-11-15T13:30:52+09:00  batch         Job        test   pre-post-sync-after  Succeeded   Synced    PostSync  Reached expected number of succeeded pods

Name:               argocd/pre-post-sync
Project:            sample-apps
Server:             https://kubernetes.default.svc
Namespace:          test
URL:                https://argocd.example.com/applications/argocd/pre-post-sync
Source:
- Repo:             https://github.com/argoproj/argocd-example-apps
  Target:           master
  Path:             pre-post-sync
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to master (0d521c6)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      0d521c6e049889134f3122eb32d7ed342f43ca0d
Phase:              Succeeded
Start:              2025-11-15 13:30:17 +0900 KST
Finished:           2025-11-15 13:30:52 +0900 KST
Duration:           35s
Message:            successfully synced (no more tasks)

GROUP  KIND        NAMESPACE  NAME                                  STATUS     HEALTH   HOOK      MESSAGE
       Namespace              test                                  Running    Synced             namespace/test created
batch  Job         test       pre-post-sync-before                  Succeeded           PreSync   Reached expected number of succeeded pods
       Service     test       pre-post-sync-kustomize-guestbook-ui  Synced     Healthy            service/pre-post-sync-kustomize-guestbook-ui created
apps   Deployment  test       pre-post-sync-kustomize-guestbook-ui  Synced     Healthy            deployment.apps/pre-post-sync-kustomize-guestbook-ui created
batch  Job         test       pre-post-sync-after                   Succeeded           PostSync  Reached expected number of succeeded pods
```
![](https://velog.velcdn.com/images/tlsalswls123/post/917b8114-5b29-47cc-97f7-9fb285b1cc00/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/0fec6463-e2b0-4510-ba71-557aa8790f0c/image.png)

---

## **ğŸ³ keycloak ë°°í¬ ë° ê¸°ë³¸ ì„¤ì •**

- [https://www.keycloak.org/](https://www.keycloak.org/)

### **1. Argo CD admin ê³„ì • ì¬í™œì„±í™” ë° ë¡œê·¸ì¸**

```bash
kubectl edit cm -n argocd argocd-cm

  admin.enabled: "true"
configmap/argocd-cm edited
```

```bash
argocd login argocd.example.com --username admin --password qwe12345 --insecure

'admin:login' logged in successfully
Context 'argocd.example.com' updated
```

```bash
argocd app list

NAME                  CLUSTER                         NAMESPACE  PROJECT      STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                             PATH            TARGET
argocd/guestbook      https://kubernetes.default.svc  guestbook  default      Synced  Healthy  Auto-Prune  <none>      https://github.com/argoproj/argocd-example-apps  helm-guestbook  HEAD
argocd/pre-post-sync  https://kubernetes.default.svc  test       sample-apps  Synced  Healthy  Manual      <none>      https://github.com/argoproj/argocd-example-apps  pre-post-sync   master
```

### **2. Dockerë¡œ Keycloak ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (start-dev ëª¨ë“œ)**

```bash
docker run -d -e KEYCLOAK_ADMIN=admin -e KEYCLOAK_ADMIN_PASSWORD=admin --net host --name dev-keycloak quay.io/keycloak/keycloak:22.0.0 start-dev
```

```bash
docker ps

CONTAINER ID   IMAGE                              COMMAND                  CREATED          STATUS          PORTS                                                                                                       NAMES
a7451ea9ebdf   quay.io/keycloak/keycloak:22.0.0   "/opt/keycloak/bin/kâ€¦"   22 seconds ago   Up 22 seconds                                                                                                               dev-keycloak
87eae0036123   kindest/node:v1.32.8               "/usr/local/bin/entrâ€¦"   4 hours ago      Up 4 hours      0.0.0.0:80->80/tcp, 0.0.0.0:443->443/tcp, 0.0.0.0:30000-30003->30000-30003/tcp, 127.0.0.1:38967->6443/tcp   myk8s-control-plane
```

### **3. Keycloak Admin ì½˜ì†” ì ‘ì† ë° ì´ˆê¸° ë¡œê·¸ì¸**

```bash
http://localhost:8080/admin
admin ì›¹ ì½˜ì†” ì ‘ì† : admin / admin
```
![](https://velog.velcdn.com/images/tlsalswls123/post/3f9e1fd3-8705-45d5-8e60-e52f7ea248bd/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/14e7078c-b288-4c27-8311-65e50724a496/image.png)

### **4. Keycloakì— bob ì‚¬ìš©ì ìƒì„± ë° ë¹„ë°€ë²ˆí˜¸ ì„¤ì •**

```bash
username: bob
password: bob123
```
![](https://velog.velcdn.com/images/tlsalswls123/post/699cd7d7-856c-41bb-976e-9926b2912057/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/82335f01-e167-4ded-bf28-ba45df9dfec9/image.png)

---

## ğŸ”‘ Keycloakì— Argo CDìš© OIDC Client ìƒì„±

- [https://argo-cd.readthedocs.io/en/stable/operator-manual/user-management/keycloak/](https://argo-cd.readthedocs.io/en/stable/operator-manual/user-management/keycloak/)

### **1. Keycloakì—ì„œ Argo CD ì—°ë™ìš© í´ë¼ì´ì–¸íŠ¸ ìƒì„±**

**(1) General Settings**

```bash
client ID : argocd
name : argocd client
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d3bfc36a-d402-44dd-8276-e3d59bd00e34/image.png)

**(2) Capability Config**

```bash
Client authentication : ON
```
![](https://velog.velcdn.com/images/tlsalswls123/post/6b952fda-c2c6-428e-b5d6-fa79060c212f/image.png)

**(3) Login Settings**

```bash
Root URL : https://argocd.example.com/
Home URL : /applications
Valid redirect URIs : https://argocd.example.com/auth/callback
Valid post logout redirect URIs : https://argocd.example.com/applications
Web origins : +
```
![](https://velog.velcdn.com/images/tlsalswls123/post/43002029-6577-42fd-a5f6-aea998110aa1/image.png)

### **2. Argo CD Client Secret í™•ì¸ ë° ë©”ëª¨**

![](https://velog.velcdn.com/images/tlsalswls123/post/ffc972f3-12c1-44da-86a6-5233a7e32321/image.png)


```bash
Credentials íƒ­ì—ì„œ í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ í™•ì¸
t6dmKRr76nGQDNfcwYAsVSZFXLpeM6hc
```
![](https://velog.velcdn.com/images/tlsalswls123/post/6f142e7f-b812-4dca-91db-f283178e6efc/image.png)

---

## **ğŸŒ Configuring ArgoCD OIDC**

### **1. Argo CD OIDC í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ ì €ì¥**

```bash
kubectl -n argocd patch secret argocd-secret --patch='{"stringData": { "oidc.keycloak.clientSecret": "t6dmKRr76nGQDNfcwYAsVSZFXLpeM6hc" }}'
secret/argocd-secret patched
```

```bash
kubectl get secret -n argocd argocd-secret -o jsonpath='{.data}' | jq

{
  "accounts.alice.password": "JDJhJDEwJGRWU2RZTkY4MjlHVXRaZ2FIckdrNy53Umt6Q1Ztb3QwL2tqTi81UHNyZENIcmNLSEVYZFlT",
  "accounts.alice.passwordMtime": "MjAyNS0xMS0xNVQwMzo0NzoxNVo=",
  "accounts.alice.tokens": "bnVsbA==",
  "accounts.gitops-ci.tokens": "W3siaWQiOiIyY2FmODVlOS1lYjU0LTQ4N2QtYmY2Zi1jZGI5OGYwMzg3NTUiLCJpYXQiOjE3NjMxODAwODl9XQ==",
  "admin.password": "JDJhJDEwJERaQXRMRUJWV1pydmc2WmI0OEhzUGVZSVRNdVVWbFo0ODRQc0tRay9jSmRQYXFwT1drS0l1",
  "admin.passwordMtime": "MjAyNS0xMS0xNVQwMzozODoxMlo=",
  "oidc.keycloak.clientSecret": "dDZkbUtScjc2bkdRRE5mY3dZQXNWU1pGWExwZU02aGM=",
  "server.secretkey": "bVdDajNmSlU0YlVtT2o1YmdUZkNSVzJIZ0VSaUcxUmVJRU5QUy9sQzVSST0="
}
```

- `oidc.keycloak.clientSecret` í•­ëª©ì´ base64 ì¸ì½”ë”©ëœ ê°’ìœ¼ë¡œ ì¶”ê°€ëœ ê²ƒ í™•ì¸ë¨

### **2. Keycloak Issuer URL êµ¬ì„±ì„ ìœ„í•œ í˜¸ìŠ¤íŠ¸ IP í™•ì¸**

```bash
ifconfig | grep 192.

        inet 192.168.219.107  netmask 255.255.255.0  broadcast 192.168.219.255
```

- Keycloakì€ host ë„¤íŠ¸ì›Œí¬ë¡œ ë„ì›Œì ¸ ìˆìœ¼ë¯€ë¡œ, í˜¸ìŠ¤íŠ¸ì˜ IPë¥¼ ê·¸ëŒ€ë¡œ issuerì— ì‚¬ìš©í•´ì•¼ í•¨

### **3. Argo CD OIDC ì„¤ì •(oidc.config) ì¶”ê°€**

```bash
kubectl edit cm -n argocd argocd-cm

data:
  oidc.config: |
    name: Keycloak
    issuer: http://192.168.219.107:8080/realms/master
    clientID: argocd
    clientSecret: t6dmKRr76nGQDNfcwYAsVSZFXLpeM6hc
    requestedScopes: ["openid", "profile", "email"]
    
configmap/argocd-cm edited    
```
![](https://velog.velcdn.com/images/tlsalswls123/post/457cd322-093c-4608-9438-4d89b0fd134a/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/aa80a77f-8bac-4d2d-ad55-391f3dfd7282/image.png)

### **4. Argo CD ì„œë²„ ë¡¤ë§ ì¬ì‹œì‘ìœ¼ë¡œ OIDC ì„¤ì • ë°˜ì˜**

```bash
kubectl rollout restart deploy argocd-server -n argocd

deployment.apps/argocd-server restarted
```

**(1) Argo CD ë¡œê·¸ì¸ í™”ë©´ì— Keycloak ë²„íŠ¼ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/02a32ccf-5597-4943-afc2-3d450cef2045/image.png)

**(2) ì„¤ì •í•œ Issuer/Client ì •ë³´ ê¸°ë°˜ìœ¼ë¡œ OIDC í”Œë¡œìš° ë™ì‘**
![](https://velog.velcdn.com/images/tlsalswls123/post/92c3785c-e0f6-455e-b7ef-d5c5fa8a18cd/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/4d46e653-3f40-4e04-95b3-8caaef138786/image.png)

### **5. Keycloak ì‚¬ìš©ì bob ìœ¼ë¡œ Argo CD SSO ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/e51c68b0-28c2-4cc3-8b66-f038abc14e87/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/2ce4e00b-ea27-4c7e-a902-9f37b0cbce57/image.png)

- **Argo CD ì ‘ì† ì„±ê³µ**

### **6. ìƒˆë¡œìš´ Keycloak ì‚¬ìš©ì tom ìƒì„± ë° SSO ë¡œê·¸ì¸ ê²€ì¦**

**(1) Keycloak Admin ì½˜ì†”ì—ì„œ ì‚¬ìš©ì `tom` ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/149a11ca-bf46-407e-b6c4-4890969e8d67/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/a200a8bc-1091-4539-9fa9-9a76a5f5ca2a/image.png)

**(2) bob ì„¸ì…˜ì„ Keycloakì—ì„œ sign out**
![](https://velog.velcdn.com/images/tlsalswls123/post/0ad52520-f3c4-41e8-9d92-db6842c70287/image.png)

**(3) tomìœ¼ë¡œ ë¡œê·¸ì¸ì‹œë„ â†’ Argo CD ì ‘ì† ì„±ê³µ**
![](https://velog.velcdn.com/images/tlsalswls123/post/8cfed81c-b9d6-4b5b-8c7b-eee5b34f2948/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/c27a9e51-a46d-4525-a9f1-c8bea9dc9300/image.png)

> argoê°€ ê³„ì •ê´€ë¦¬ë¥¼ ì•ˆ í•´ë„ ë˜ê³ , code(í† í°/ì •ì±…)ê°€ ê¶Œí•œì´ë‹¤

---

## **âœ¨ Argo Rollout**

- [https://argoproj.github.io/argo-rollouts/](https://argoproj.github.io/argo-rollouts/)
- [https://argoproj.github.io/argo-rollouts/getting-started/](https://argoproj.github.io/argo-rollouts/getting-started/)

### **1. Argo Rollouts ì„¤ì¹˜ ì¤€ë¹„**

```bash
kubectl create ns argo-rollouts

namespace/argo-rollouts created
```

```bash
cat <<EOT > argorollouts-values.yaml
dashboard:
  enabled: true
  service:
    type: NodePort
    nodePort: 30003
EOT
```

### **2. Argo Rollouts Helm ì„¤ì¹˜ ë° ë¦¬ì†ŒìŠ¤/CRD í™•ì¸**

```bash
helm install argo-rollouts argo/argo-rollouts --version 2.40.5 -f argorollouts-values.yaml --namespace argo-rollouts

NAME: argo-rollouts
LAST DEPLOYED: Sat Nov 15 15:11:43 2025
NAMESPACE: argo-rollouts
STATUS: deployed
REVISION: 1
TEST SUITE: None
```

```bash
kubectl get all -n argo-rollouts

NAME                                           READY   STATUS    RESTARTS   AGE
pod/argo-rollouts-658dd58fc8-x4kcq             1/1     Running   0          46s
pod/argo-rollouts-658dd58fc8-x7bxd             1/1     Running   0          46s
pod/argo-rollouts-dashboard-6bc9fff6fc-j87hr   1/1     Running   0          46s

NAME                              TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE
service/argo-rollouts-dashboard   NodePort   10.96.112.188   <none>        3100:30003/TCP   46s

NAME                                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/argo-rollouts             2/2     2            2           46s
deployment.apps/argo-rollouts-dashboard   1/1     1            1           46s

NAME                                                 DESIRED   CURRENT   READY   AGE
replicaset.apps/argo-rollouts-658dd58fc8             2         2         2       46s
replicaset.apps/argo-rollouts-dashboard-6bc9fff6fc   1         1         1       46s
```

```bash
kubectl get crds

NAME                                   CREATED AT
analysisruns.argoproj.io               2025-11-15T06:11:44Z
analysistemplates.argoproj.io          2025-11-15T06:11:44Z
applications.argoproj.io               2025-11-15T01:11:01Z
applicationsets.argoproj.io            2025-11-15T01:11:01Z
appprojects.argoproj.io                2025-11-15T01:11:01Z
clusteranalysistemplates.argoproj.io   2025-11-15T06:11:44Z
experiments.argoproj.io                2025-11-15T06:11:44Z
rollouts.argoproj.io                   2025-11-15T06:11:44Z
```

### **3. Argo Rollouts ëŒ€ì‹œë³´ë“œ ì ‘ì†**

```bash
http://127.0.0.1:30003
```
![](https://velog.velcdn.com/images/tlsalswls123/post/35f0e328-d401-4b2a-99c0-ab12f7151609/image.png)

- ì„¤ì¹˜ ì§í›„ì—ëŠ” Rollout ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“¤ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— **ì•„ë¬´ ë¦¬ì†ŒìŠ¤ë„ ë³´ì´ì§€ ì•ŠëŠ” ìƒíƒœ**ë¡œ í‘œì‹œë¨

### **4. Argo CDì— Rollout Extension ì—°ë™ (UI í†µí•©)**

```bash
cat <<EOF > argocd-values.yaml
global:
  domain: argocd.example.com

certificate:
  enabled: true

server:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/ssl-passthrough: "true"
    tls: true
  extensions:
    enabled: true
    extensionList:
      - name: rollout-extension
        env:
          - name: EXTENSION_URL
            value: https://github.com/argoproj-labs/rollout-extension/releases/download/v0.3.7/extension.tar
EOF
```

```bash
helm upgrade -i argocd argo/argo-cd --version 9.0.5 -f argocd-values.yaml --namespace argocd

Release "argocd" has been upgraded. Happy Helming!
NAME: argocd
LAST DEPLOYED: Sat Nov 15 15:18:15 2025
NAMESPACE: argocd
STATUS: deployed
REVISION: 2
TEST SUITE: None
NOTES:
In order to access the server UI you have the following options:

1. kubectl port-forward service/argocd-server -n argocd 8080:443

    and then open the browser on http://localhost:8080 and accept the certificate

2. enable ingress in the values file `server.ingress.enabled` and either
      - Add the annotation for ssl passthrough: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-1-ssl-passthrough
      - Set the `configs.params."server.insecure"` in the values file and terminate SSL at your ingress: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-2-multiple-ingress-objects-and-hosts

After reaching the UI the first time you can login with username: admin and the random password generated during the installation. You can find the password by running:

kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

(You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://argo-cd.readthedocs.io/en/stable/getting_started/#4-login-using-the-cli)
```

```bash
kubectl describe deploy -n argocd argocd-server

...
  Init Containers:
   rollout-extension:
    Image:           quay.io/argoprojlabs/argocd-extension-installer:v0.0.8
    Port:            <none>
    Host Port:       <none>
    SeccompProfile:  RuntimeDefault
    Environment:
      EXTENSION_URL:  https://github.com/argoproj-labs/rollout-extension/releases/download/v0.3.7/extension.tar
    Mounts:
      /tmp from tmp (rw)
      /tmp/extensions/ from extensions (rw)
...      
```

### **5. GitHub my-sample-app ë ˆí¬ ì¤€ë¹„ ë° Rollout ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ì»¤ë°‹**

**(1) GitHub Personal Access Token ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/f4eaf8f0-abfd-47b0-a187-64e611309c79/image.png)

**(2) my-sample-app ë ˆí¬ ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/f8607fd3-889f-4bca-8e9d-889722046a06/image.png)

**(3) ë¡œì»¬ì—ì„œ ìƒ˜í”Œ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‹¤ìš´ë¡œë“œ**

```bash
mkdir my-sample-app && cd my-sample-app
mkdir argo-rollouts && cd argo-rollouts
wget https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/rollout.yaml
wget https://raw.githubusercontent.com/argoproj/argo-rollouts/master/docs/getting-started/basic/service.yaml
```

**(4) Git ì´ˆê¸°í™” ë° í‘¸ì‹œ**

```bash
cd ..
git init
git add .
git commit -m "Add sample yaml"
git branch -M main
git remote add origin https://github.com/Shinminjin/my-sample-app.git
git push -u origin main
```
![](https://velog.velcdn.com/images/tlsalswls123/post/2f908b96-641a-467b-b7cb-66d0a82b4ae7/image.png)

### **6. Argo CDì—ì„œ rollout-test ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ë° Sync**

**(1) GIT connection ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/47568cea-53e2-41ce-a4e1-1ac063df69f5/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/e60ebf0a-6b1c-469f-8a3c-63b5231a0a58/image.png)

**(2) ì–´í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±**

```bash
App name: rollout-test
Project: default
Sync policy: Manual
Set deletion finalizer: ì²´í¬
Auto-create namespace: ì²´í¬
Repo URL: https://github.com/Shinminjin/my-sample-app (ì‹¤ìŠµ ê¸°ì¤€ URL)
Path: argo-rollouts
Destination: https://kubernetes.default.svc
Namespace: test
```
![](https://velog.velcdn.com/images/tlsalswls123/post/f9979152-d57b-4949-914a-da5c573b12e9/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/b27f24ac-2d6c-4251-97d0-32f3260d1d29/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/b0c17c5c-1cb1-431a-84b2-3a206d64bfd4/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/1cd86734-38c8-43f8-b09c-459ec64850af/image.png)

**(3) ìƒì„± í›„, SYNC ì‹¤í–‰**
![](https://velog.velcdn.com/images/tlsalswls123/post/0f3633e0-7c47-4730-8c51-4e3306984399/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/18fb0f35-e940-4dc5-b796-19048242caee/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/eab86fee-d0af-45bf-868b-8ffa19c87508/image.png)

### **7. ê¸°ë³¸ Rollout ìƒíƒœ í™•ì¸ â€“ blue ë²„ì „ ë°°í¬**

```bash
kubectl get rollout -n test

NAME            DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE
rollouts-demo   5         5         5            5           3m33s
```

```bash
kubectl get rollouts rollouts-demo -n test -o json | grep rollouts-demo

...
                        "image": "argoproj/rollouts-demo:blue",
                        "name": "rollouts-demo",
```

- ì´ˆê¸° ìƒíƒœëŠ” `argoproj/rollouts-demo:blue` ì´ë¯¸ì§€ë¡œ 5ê°œì˜ Podê°€ ëª¨ë‘ ì„œë¹„ìŠ¤ ì¤‘ì¸ ìƒíƒœ

### **8. Rollout ì—…ë°ì´íŠ¸ â€“ yellow ì´ë¯¸ì§€ë¡œ ì ì§„ ë°°í¬**

```bash
kubectl edit rollouts rollouts-demo -n test

...
     - image: argoproj/rollouts-demo:yellow
...     
rollout.argoproj.io/rollouts-demo edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d7c4d80c-6d08-46aa-aa21-d8af2dfad214/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/c1cd305e-0681-4e20-a6e2-8814d5159fa4/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/125b052b-70bb-41d3-8161-759f3604bbb9/image.png)

- old 4 / new 1 êµ¬ì¡°ë¡œ íŠ¸ë˜í”½ ì¼ë¶€ë§Œ ìƒˆ ë²„ì „ìœ¼ë¡œ ì „í™˜ëœ ëª¨ìŠµ í™•ì¸

### **9. ìƒˆ ë²„ì „ Promote â€“ Canaryì—ì„œ ì „ì²´ ì „í™˜ ì™„ë£Œ**

![](https://velog.velcdn.com/images/tlsalswls123/post/9f843f4f-615c-4ffb-9400-1b5e1ae8d482/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/fedcda3d-3770-43f7-a094-78b5cb5ce1b5/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/cb02d3d5-d0d8-471d-9371-bf407ce18f1d/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/6b4e3f32-cbdf-43ab-ae9b-7261b6ea0935/image.png)

