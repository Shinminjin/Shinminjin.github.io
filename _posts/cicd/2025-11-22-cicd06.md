---
title: CI/CD 6ì£¼ì°¨ ì •ë¦¬
date: 2025-11-22 17:00:00 +0900
categories: [CI/CD]
tags: [CI/CD]
---

## **ğŸ”§ kind mgmt k8s ë°°í¬ + ingress-nginx + Argo CD**

### **1. kind mgmt í´ëŸ¬ìŠ¤í„° ìƒì„±**

```bash
kind create cluster --name mgmt --image kindest/node:v1.32.8 --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  labels:
    ingress-ready: true
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
  - containerPort: 30000
    hostPort: 30000
EOF

Creating cluster "mgmt" ...
 âœ“ Ensuring node image (kindest/node:v1.32.8) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-mgmt"
You can now use your cluster with:

kubectl cluster-info --context kind-mgmt

Have a nice day! ğŸ‘‹
```

### **2. NGINX Ingress Controller ë°°í¬**

```bash
kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/main/deploy/static/provider/kind/deploy.yaml

namespace/ingress-nginx created
serviceaccount/ingress-nginx created
serviceaccount/ingress-nginx-admission created
role.rbac.authorization.k8s.io/ingress-nginx created
role.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrole.rbac.authorization.k8s.io/ingress-nginx created
clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created
rolebinding.rbac.authorization.k8s.io/ingress-nginx created
rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
configmap/ingress-nginx-controller created
service/ingress-nginx-controller created
service/ingress-nginx-controller-admission created
deployment.apps/ingress-nginx-controller created
job.batch/ingress-nginx-admission-create created
job.batch/ingress-nginx-admission-patch created
ingressclass.networking.k8s.io/nginx created
validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created
```

### **3. Ingress SSL Passthrough ì˜µì…˜ í™œì„±í™”**

```bash
kubectl get deployment ingress-nginx-controller -n ingress-nginx -o yaml \
| sed '/- --publish-status-address=localhost/a\
        - --enable-ssl-passthrough' | kubectl apply -f -

deployment.apps/ingress-nginx-controller configured
```

### **4. Argo CDìš© Self-Signed ì¸ì¦ì„œ ìƒì„±**

```bash
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout argocd.example.com.key \
  -out argocd.example.com.crt \
  -subj "/CN=argocd.example.com/O=argocd"
```

### **5. Argo CD ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë° TLS Secret ìƒì„±**

```bash
kubectl create ns argocd

namespace/argocd created
```

```bash
kubectl -n argocd create secret tls argocd-server-tls \
  --cert=argocd.example.com.crt \
  --key=argocd.example.com.key

secret/argocd-server-tls created
```

### **6. Helmìœ¼ë¡œ Argo CD ì„¤ì¹˜**

```bash
cat <<EOF > argocd-values.yaml
global:
  domain: argocd.example.com

server:
  ingress:
    enabled: true
    ingressClassName: nginx
    annotations:
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/ssl-passthrough: "true"
    tls: true
EOF
```

```bash
helm repo add argo https://argoproj.github.io/argo-helm
helm install argocd argo/argo-cd --version 9.0.5 -f argocd-values.yaml --namespace argocd

NAME: argocd
LAST DEPLOYED: Mon Nov 17 20:00:25 2025
NAMESPACE: argocd
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
In order to access the server UI you have the following options:

1. kubectl port-forward service/argocd-server -n argocd 8080:443

    and then open the browser on http://localhost:8080 and accept the certificate

2. enable ingress in the values file `server.ingress.enabled` and either
      - Add the annotation for ssl passthrough: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-1-ssl-passthrough
      - Set the `configs.params."server.insecure"` in the values file and terminate SSL at your ingress: https://argo-cd.readthedocs.io/en/stable/operator-manual/ingress/#option-2-multiple-ingress-objects-and-hosts

After reaching the UI the first time you can login with username: admin and the random password generated during the installation. You can find the password by running:

kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d

(You should delete the initial secret afterwards as suggested by the Getting Started Guide: https://argo-cd.readthedocs.io/en/stable/getting_started/#4-login-using-the-cli)
```

### **7. /etc/hostsì— Argo CD ë„ë©”ì¸ ë“±ë¡**

```bash
echo "127.0.0.1 argocd.example.com" | sudo tee -a /etc/hosts
cat /etc/hosts

...
127.0.0.1 argocd.example.com
```

- ë¡œì»¬ í™˜ê²½ì—ì„œ `argocd.example.com` ë„ë©”ì¸ì„ 127.0.0.1ë¡œ í•´ì„í•˜ë„ë¡ `/etc/hosts`ì— ë“±ë¡

### **8. curlë¡œ Argo CD HTTPS ì ‘ì† í™•ì¸**

```bash
curl -vk https://argocd.example.com/

* Host argocd.example.com:443 was resolved.
* IPv6: (none)
* IPv4: 127.0.0.1
*   Trying 127.0.0.1:443...
* ALPN: curl offers h2,http/1.1
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* SSL Trust: peer verification disabled
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.3 (IN), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (IN), TLS handshake, Encrypted Extensions (8):
* TLSv1.3 (IN), TLS handshake, Certificate (11):
* TLSv1.3 (IN), TLS handshake, CERT verify (15):
* TLSv1.3 (IN), TLS handshake, Finished (20):
* TLSv1.3 (OUT), TLS change cipher, Change cipher spec (1):
* TLSv1.3 (OUT), TLS handshake, Finished (20):
* SSL connection using TLSv1.3 / TLS_AES_128_GCM_SHA256 / X25519MLKEM768 / RSASSA-PSS
...
```

### **9. Argo CD ì´ˆê¸° admin ë¹„ë°€ë²ˆí˜¸ ì¡°íšŒ ë° ë³€ìˆ˜ì„¤ì •**

```bash
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d ;echo
r0PAK1j7tcDasX7Q
```

```bash
ARGOPW=<ìµœì´ˆ ì ‘ì† ì•”í˜¸>
ARGOPW=r0PAK1j7tcDasX7Q
```

### **10. Argo CD CLI ë¡œê·¸ì¸ ìˆ˜í–‰**

```bash
argocd login argocd.example.com --insecure --username admin --password $ARGOPW

'admin:login' logged in successfully
Context 'argocd.example.com' updated
```

### **11. admin ê³„ì • ë¹„ë°€ë²ˆí˜¸ ë³€ê²½**

```bash
argocd account update-password --current-password $ARGOPW --new-password qwe12345

Password updated
Context 'argocd.example.com' updated
```

- ê³„ì • ì•”í˜¸ : **`qwe12345`**

### **12. Argo CD ì›¹ ì½˜ì†” ì ‘ì† ì£¼ì†Œ í™•ì¸**

```bash
https://argocd.example.com
```
![](https://velog.velcdn.com/images/tlsalswls123/post/581f8b89-4262-482a-b1b5-9c2ffe7bed50/image.png)

---

## **ğŸŒ± kind dev/prd k8s ë°°í¬ & k8s ìê²©ì¦ëª… ìˆ˜ì •**

### **1. ì„¤ì¹˜ ì „ kubectl ì»¨í…ìŠ¤íŠ¸ ìƒíƒœ í™•ì¸**

```bash
kubectl config get-contexts

CURRENT   NAME        CLUSTER     AUTHINFO    NAMESPACE
*         kind-mgmt   kind-mgmt   kind-mgmt   
```

- ì•„ì§ì€ `kind-mgmt` í´ëŸ¬ìŠ¤í„°ë§Œ ì¡´ì¬í•˜ê³ , ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸ë„ `kind-mgmt`ë¡œ ì„¤ì •ë˜ì–´ ìˆìŒ

### **2. kind ë„ì»¤ ë„¤íŠ¸ì›Œí¬ ì •ë³´ í™•ì¸**

```bash
docker network ls

NETWORK ID     NAME      DRIVER    SCOPE
f5ad53882464   bridge    bridge    local
bec308f23ee5   host      host      local
1da18f85ffec   kind      bridge    local
225e867f21f9   none      null      local
```

### **3. mgmt-control-plane ì»¨í…Œì´ë„ˆ IP í™•ì¸**

```bash
docker network inspect kind | jq

[
  {
    "Name": "kind",
    "Id": "1da18f85ffecfc8a2170a57b9369bf4387586703d6c83f3accf900e9145b7772",
    "Created": "2025-10-18T15:06:51.081819223+09:00",
    "Scope": "local",
    "Driver": "bridge",
    "EnableIPv4": true,
    "EnableIPv6": true,
    "IPAM": {
      "Driver": "default",
      "Options": {},
      "Config": [
        {
          "Subnet": "172.18.0.0/16",
          "Gateway": "172.18.0.1"
        },
        {
          "Subnet": "fc00:f853:ccd:e793::/64",
          "Gateway": "fc00:f853:ccd:e793::1"
        }
      ]
    },
    "Internal": false,
    "Attachable": false,
    "Ingress": false,
    "ConfigFrom": {
      "Network": ""
    },
    "ConfigOnly": false,
    "Containers": {
      "4466ac122129f82aef62ae613cf1b1fa9025f61e3337f49bd9f810c5090054b3": {
        "Name": "mgmt-control-plane",
        "EndpointID": "b831183bd631a8adfdfe4f5659ebdc5192fa74b0c5e9ddada9b2e4b638190565",
        "MacAddress": "0e:cf:0f:10:0d:55",
        "IPv4Address": "172.18.0.2/16",
        "IPv6Address": "fc00:f853:ccd:e793::2/64"
      }
    },
    "Options": {
      "com.docker.network.bridge.enable_ip_masquerade": "true",
      "com.docker.network.driver.mtu": "1500"
    },
    "Labels": {}
  }
]
```

- `mgmt-control-plane` ì»¨í…Œì´ë„ˆì˜ IPv4 ì£¼ì†Œê°€ `172.18.0.2`ì¸ ê²ƒì„ í™•ì¸
- ì´í›„ dev/prd í´ëŸ¬ìŠ¤í„°ì™€ í†µì‹  ë° kubeconfig ìˆ˜ì • ì‹œ ì°¸ê³ ìš©ìœ¼ë¡œ ì‚¬ìš©

### **4. kind dev/prd í´ëŸ¬ìŠ¤í„° ìƒì„±**

```bash
kind create cluster --name dev --image kindest/node:v1.32.8 --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 31000
    hostPort: 31000
EOF

Creating cluster "dev" ...
 âœ“ Ensuring node image (kindest/node:v1.32.8) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-dev"
You can now use your cluster with:

kubectl cluster-info --context kind-dev

Have a nice day! ğŸ‘‹
```

```bash
kind create cluster --name prd --image kindest/node:v1.32.8 --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 32000
    hostPort: 32000
EOF

Creating cluster "prd" ...
 âœ“ Ensuring node image (kindest/node:v1.32.8) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-prd"
You can now use your cluster with:

kubectl cluster-info --context kind-prd

Have a nice day! ğŸ‘‹
```

### **5. dev/prd í´ëŸ¬ìŠ¤í„° ìƒì„± í›„ ì»¨í…ìŠ¤íŠ¸ ëª©ë¡ í™•ì¸**

```bash
kubectl config get-contexts

CURRENT   NAME        CLUSTER     AUTHINFO    NAMESPACE
          kind-dev    kind-dev    kind-dev    
          kind-mgmt   kind-mgmt   kind-mgmt   
*         kind-prd    kind-prd    kind-prd    
```

- í´ëŸ¬ìŠ¤í„° ìƒì„± í›„ kubeconfigì— `kind-dev`, `kind-prd` ì»¨í…ìŠ¤íŠ¸ê°€ ì¶”ê°€ë¨
- ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸ëŠ” ì œì¼ ë§ˆì§€ë§‰ìœ¼ë¡œ ìƒì„±ëœ í´ëŸ¬ìŠ¤í„°ì¸  `kind-prd`ë¡œ ì§€ì •ëœ ìƒíƒœì„

### **6. mgmt í´ëŸ¬ìŠ¤í„°ë¡œ ì»¨í…ìŠ¤íŠ¸ ë³€ê²½**

```bash
kubectl config use-context kind-mgmt

Switched to context "kind-mgmt".
```

```bash
kubectl config get-contexts

CURRENT   NAME        CLUSTER     AUTHINFO    NAMESPACE
          kind-dev    kind-dev    kind-dev    
*         kind-mgmt   kind-mgmt   kind-mgmt   
          kind-prd    kind-prd    kind-prd    
```

### **7. ê° í´ëŸ¬ìŠ¤í„° ë…¸ë“œ ìƒíƒœ í™•ì¸ (mgmt/dev/prd)**

```bash
kubectl get node -v=6 --context kind-mgmt
kubectl get node -v=6 --context kind-dev
kubectl get node -v=6 --context kind-prd

I1117 20:13:19.217800  121966 cmd.go:527] kubectl command headers turned on
I1117 20:13:19.224307  121966 loader.go:402] Config loaded from file:  /home/devshin/.kube/config
I1117 20:13:19.225823  121966 envvar.go:172] "Feature gate default state" feature="ClientsPreferCBOR" enabled=false
I1117 20:13:19.225838  121966 envvar.go:172] "Feature gate default state" feature="InOrderInformers" enabled=true
I1117 20:13:19.225843  121966 envvar.go:172] "Feature gate default state" feature="InformerResourceVersion" enabled=false
I1117 20:13:19.225847  121966 envvar.go:172] "Feature gate default state" feature="WatchListClient" enabled=false
I1117 20:13:19.225852  121966 envvar.go:172] "Feature gate default state" feature="ClientsAllowCBOR" enabled=false
I1117 20:13:19.237944  121966 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:42415/api/v1/nodes?limit=500" status="200 OK" milliseconds=7
NAME                 STATUS   ROLES           AGE   VERSION
mgmt-control-plane   Ready    control-plane   17m   v1.32.8

I1117 20:13:19.286485  121989 cmd.go:527] kubectl command headers turned on
I1117 20:13:19.293572  121989 loader.go:402] Config loaded from file:  /home/devshin/.kube/config
I1117 20:13:19.295187  121989 envvar.go:172] "Feature gate default state" feature="InOrderInformers" enabled=true
I1117 20:13:19.295222  121989 envvar.go:172] "Feature gate default state" feature="InformerResourceVersion" enabled=false
I1117 20:13:19.295233  121989 envvar.go:172] "Feature gate default state" feature="WatchListClient" enabled=false
I1117 20:13:19.295243  121989 envvar.go:172] "Feature gate default state" feature="ClientsAllowCBOR" enabled=false
I1117 20:13:19.295253  121989 envvar.go:172] "Feature gate default state" feature="ClientsPreferCBOR" enabled=false
I1117 20:13:19.305632  121989 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:35871/api?timeout=32s" status="200 OK" milliseconds=10
I1117 20:13:19.307735  121989 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:35871/apis?timeout=32s" status="200 OK" milliseconds=1
I1117 20:13:19.315440  121989 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:35871/api/v1/nodes?limit=500" status="200 OK" milliseconds=2
NAME                STATUS   ROLES           AGE     VERSION
dev-control-plane   Ready    control-plane   2m21s   v1.32.8

I1117 20:13:19.363680  122008 cmd.go:527] kubectl command headers turned on
I1117 20:13:19.369643  122008 loader.go:402] Config loaded from file:  /home/devshin/.kube/config
I1117 20:13:19.370592  122008 envvar.go:172] "Feature gate default state" feature="ClientsAllowCBOR" enabled=false
I1117 20:13:19.370614  122008 envvar.go:172] "Feature gate default state" feature="ClientsPreferCBOR" enabled=false
I1117 20:13:19.370620  122008 envvar.go:172] "Feature gate default state" feature="InOrderInformers" enabled=true
I1117 20:13:19.370625  122008 envvar.go:172] "Feature gate default state" feature="InformerResourceVersion" enabled=false
I1117 20:13:19.370631  122008 envvar.go:172] "Feature gate default state" feature="WatchListClient" enabled=false
I1117 20:13:19.378161  122008 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:34469/api?timeout=32s" status="200 OK" milliseconds=7
I1117 20:13:19.380831  122008 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:34469/apis?timeout=32s" status="200 OK" milliseconds=1
I1117 20:13:19.388897  122008 round_trippers.go:632] "Response" verb="GET" url="https://127.0.0.1:34469/api/v1/nodes?limit=500" status="200 OK" milliseconds=2
NAME                STATUS   ROLES           AGE    VERSION
prd-control-plane   Ready    control-plane   106s   v1.32.8
```

### **8. ê° í´ëŸ¬ìŠ¤í„° Pod ìƒíƒœ í™•ì¸**

```bash
kubectl get pod -A --context kind-mgmt
kubectl get pod -A --context kind-dev
kubectl get pod -A --context kind-prd

NAMESPACE            NAME                                               READY   STATUS    RESTARTS   AGE
argocd               argocd-application-controller-0                    1/1     Running   0          13m
argocd               argocd-applicationset-controller-bbff79c6f-9qcf8   1/1     Running   0          13m
argocd               argocd-dex-server-6877ddf4f8-fvfll                 1/1     Running   0          13m
argocd               argocd-notifications-controller-7b5658fc47-26p24   1/1     Running   0          13m
argocd               argocd-redis-7d948674-xnl9k                        1/1     Running   0          13m
argocd               argocd-repo-server-7679dc55f5-swj2g                1/1     Running   0          13m
argocd               argocd-server-7d769b6f48-2ts94                     1/1     Running   0          13m
ingress-nginx        ingress-nginx-controller-5b89cb54f9-5gvfh          1/1     Running   0          16m
kube-system          coredns-668d6bf9bc-d5bn7                           1/1     Running   0          17m
kube-system          coredns-668d6bf9bc-vb4p7                           1/1     Running   0          17m
kube-system          etcd-mgmt-control-plane                            1/1     Running   0          18m
kube-system          kindnet-jtm8t                                      1/1     Running   0          17m
kube-system          kube-apiserver-mgmt-control-plane                  1/1     Running   0          18m
kube-system          kube-controller-manager-mgmt-control-plane         1/1     Running   0          18m
kube-system          kube-proxy-b9pmh                                   1/1     Running   0          17m
kube-system          kube-scheduler-mgmt-control-plane                  1/1     Running   0          18m
local-path-storage   local-path-provisioner-7dc846544d-wltkn            1/1     Running   0          17m

NAMESPACE            NAME                                        READY   STATUS    RESTARTS   AGE
kube-system          coredns-668d6bf9bc-lddkn                    1/1     Running   0          3m17s
kube-system          coredns-668d6bf9bc-ltg98                    1/1     Running   0          3m17s
kube-system          etcd-dev-control-plane                      1/1     Running   0          3m23s
kube-system          kindnet-2gks8                               1/1     Running   0          3m18s
kube-system          kube-apiserver-dev-control-plane            1/1     Running   0          3m23s
kube-system          kube-controller-manager-dev-control-plane   1/1     Running   0          3m23s
kube-system          kube-proxy-zmdnk                            1/1     Running   0          3m18s
kube-system          kube-scheduler-dev-control-plane            1/1     Running   0          3m23s
local-path-storage   local-path-provisioner-7dc846544d-qtmxj     1/1     Running   0          3m17s

NAMESPACE            NAME                                        READY   STATUS    RESTARTS   AGE
kube-system          coredns-668d6bf9bc-2hm7g                    1/1     Running   0          2m42s
kube-system          coredns-668d6bf9bc-7kbbg                    1/1     Running   0          2m42s
kube-system          etcd-prd-control-plane                      1/1     Running   0          2m48s
kube-system          kindnet-lqc7k                               1/1     Running   0          2m42s
kube-system          kube-apiserver-prd-control-plane            1/1     Running   0          2m48s
kube-system          kube-controller-manager-prd-control-plane   1/1     Running   0          2m48s
kube-system          kube-proxy-kkhxb                            1/1     Running   0          2m42s
kube-system          kube-scheduler-prd-control-plane            1/1     Running   0          2m49s
local-path-storage   local-path-provisioner-7dc846544d-dj54f     1/1     Running   0          2m42s
```

### **9. kubectl alias ì„¤ì •**

```bash
alias k8s1='kubectl --context kind-mgmt'
alias k8s2='kubectl --context kind-dev'
alias k8s3='kubectl --context kind-prd'
```

```bash
# ê° ë…¸ë“œ ê°„ë‹¨í•œ ì •ë³´ í™•ì¸
k8s1 get node -owide
k8s2 get node -owide
k8s3 get node -owide

NAME                 STATUS   ROLES           AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
mgmt-control-plane   Ready    control-plane   19m   v1.32.8   172.18.0.2    <none>        Debian GNU/Linux 12 (bookworm)   6.17.8-arch1-1   containerd://2.1.3

NAME                STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
dev-control-plane   Ready    control-plane   4m16s   v1.32.8   172.18.0.3    <none>        Debian GNU/Linux 12 (bookworm)   6.17.8-arch1-1   containerd://2.1.3

NAME                STATUS   ROLES           AGE     VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME
prd-control-plane   Ready    control-plane   3m41s   v1.32.8   172.18.0.4    <none>        Debian GNU/Linux 12 (bookworm)   6.17.8-arch1-1   containerd://2.1.3
```

### **10. docker ë„¤íŠ¸ì›Œí¬ì—ì„œ ê° ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ IP ì¬í™•ì¸**

```bash
docker network inspect kind | grep -E 'Name|IPv4Address'

        "Name": "kind",
                "Name": "prd-control-plane",
                "IPv4Address": "172.18.0.4/16",
                "Name": "mgmt-control-plane",
                "IPv4Address": "172.18.0.2/16",
                "Name": "dev-control-plane",
                "IPv4Address": "172.18.0.3/16",
```

### **11. ë„ë©”ì¸ í†µì‹  í™•ì¸**

```bash
docker exec -it mgmt-control-plane curl -sk https://dev-control-plane:6443/version

{
  "major": "1",
  "minor": "32",
  "gitVersion": "v1.32.8",
  "gitCommit": "2e83bc4bf31e88b7de81d5341939d5ce2460f46f",
  "gitTreeState": "clean",
  "buildDate": "2025-08-13T14:21:22Z",
  "goVersion": "go1.23.11",
  "compiler": "gc",
  "platform": "linux/amd64"
}
```

```bash
docker exec -it mgmt-control-plane curl -sk https://prd-control-plane:6443/version

{
  "major": "1",
  "minor": "32",
  "gitVersion": "v1.32.8",
  "gitCommit": "2e83bc4bf31e88b7de81d5341939d5ce2460f46f",
  "gitTreeState": "clean",
  "buildDate": "2025-08-13T14:21:22Z",
  "goVersion": "go1.23.11",
  "compiler": "gc",
  "platform": "linux/amd64"
}
```

```bash
docker exec -it dev-control-plane curl -sk https://prd-control-plane:6443/version

{
  "major": "1",
  "minor": "32",
  "gitVersion": "v1.32.8",
  "gitCommit": "2e83bc4bf31e88b7de81d5341939d5ce2460f46f",
  "gitTreeState": "clean",
  "buildDate": "2025-08-13T14:21:22Z",
  "goVersion": "go1.23.11",
  "compiler": "gc",
  "platform": "linux/amd64"
}
```

- `mgmt-control-plane`ì—ì„œ `dev-control-plane`, `prd-control-plane`ì˜ API ì„œë²„ `/version` ì—”ë“œí¬ì¸íŠ¸ë¥¼ curlë¡œ í˜¸ì¶œ
- `dev-control-plane`ì—ì„œë„ `prd-control-plane` API ì„œë²„ `/version` ì—”ë“œí¬ì¸íŠ¸ë¥¼ curlë¡œ í˜¸ì¶œ

### **12. í˜¸ìŠ¤íŠ¸ì—ì„œ kind ë„¤íŠ¸ì›Œí¬ IPì— ping í…ŒìŠ¤íŠ¸ ìˆ˜í–‰**

```bash
ping -c 1 172.18.0.2

PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.
64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.129 ms

--- 172.18.0.2 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.129/0.129/0.129/0.000 ms
```

```bash
ping -c 1 172.18.0.3

PING 172.18.0.3 (172.18.0.3) 56(84) bytes of data.
64 bytes from 172.18.0.3: icmp_seq=1 ttl=64 time=0.079 ms

--- 172.18.0.3 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.079/0.079/0.079/0.000 ms
```

```bash
ping -c 1 172.18.0.4

PING 172.18.0.4 (172.18.0.4) 56(84) bytes of data.
64 bytes from 172.18.0.4: icmp_seq=1 ttl=64 time=0.172 ms

--- 172.18.0.4 ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 0.172/0.172/0.172/0.000 ms
```

- í˜¸ìŠ¤íŠ¸ â†” ì»¨íŠ¸ë¡¤ í”Œë ˆì¸ ì»¨í…Œì´ë„ˆ ê°„ í†µì‹ ì´ ì •ìƒì ìœ¼ë¡œ ê°€ëŠ¥í•œ ê²ƒì„ í™•ì¸

### **13. dev/prd kubeconfigì˜ API ì„œë²„ ì£¼ì†Œë¥¼ ì»¨í…Œì´ë„ˆ IPë¡œ ë³€ê²½**

```bash
vi ~/.kube/config

...
    server: https://172.18.0.3:6443
  name: kind-dev
  ...
    server: https://172.18.0.4:6443
  name: kind-prd
...
```
![](https://velog.velcdn.com/images/tlsalswls123/post/8dc37ae1-a368-4efb-80e6-85f1c5ddbac4/image.png)

### **14. kubeconfig ìˆ˜ì • í›„ dev/prd API ì„œë²„ ì—°ê²° ì¬ê²€ì¦**

```bash
kubectl get node -v=6 --context kind-dev
kubectl get node -v=6 --context kind-prd

I1117 23:24:11.853566  160346 cmd.go:527] kubectl command headers turned on
I1117 23:24:11.859417  160346 loader.go:402] Config loaded from file:  /home/devshin/.kube/config
I1117 23:24:11.860050  160346 envvar.go:172] "Feature gate default state" feature="ClientsAllowCBOR" enabled=false
I1117 23:24:11.860066  160346 envvar.go:172] "Feature gate default state" feature="ClientsPreferCBOR" enabled=false
I1117 23:24:11.860073  160346 envvar.go:172] "Feature gate default state" feature="InOrderInformers" enabled=true
I1117 23:24:11.860080  160346 envvar.go:172] "Feature gate default state" feature="InformerResourceVersion" enabled=false
I1117 23:24:11.860086  160346 envvar.go:172] "Feature gate default state" feature="WatchListClient" enabled=false
I1117 23:24:11.866956  160346 round_trippers.go:632] "Response" verb="GET" url="https://172.18.0.3:6443/api?timeout=32s" status="200 OK" milliseconds=6
I1117 23:24:11.868615  160346 round_trippers.go:632] "Response" verb="GET" url="https://172.18.0.3:6443/apis?timeout=32s" status="200 OK" milliseconds=0
I1117 23:24:11.876303  160346 round_trippers.go:632] "Response" verb="GET" url="https://172.18.0.3:6443/api/v1/nodes?limit=500" status="200 OK" milliseconds=1
NAME                STATUS   ROLES           AGE     VERSION
dev-control-plane   Ready    control-plane   3h13m   v1.32.8

I1117 23:24:11.918305  160370 cmd.go:527] kubectl command headers turned on
I1117 23:24:11.923330  160370 loader.go:402] Config loaded from file:  /home/devshin/.kube/config
I1117 23:24:11.924213  160370 envvar.go:172] "Feature gate default state" feature="InformerResourceVersion" enabled=false
I1117 23:24:11.924278  160370 envvar.go:172] "Feature gate default state" feature="WatchListClient" enabled=false
I1117 23:24:11.924302  160370 envvar.go:172] "Feature gate default state" feature="ClientsAllowCBOR" enabled=false
I1117 23:24:11.924337  160370 envvar.go:172] "Feature gate default state" feature="ClientsPreferCBOR" enabled=false
I1117 23:24:11.924358  160370 envvar.go:172] "Feature gate default state" feature="InOrderInformers" enabled=true
I1117 23:24:11.929299  160370 round_trippers.go:632] "Response" verb="GET" url="https://172.18.0.4:6443/api?timeout=32s" status="200 OK" milliseconds=4
I1117 23:24:11.930766  160370 round_trippers.go:632] "Response" verb="GET" url="https://172.18.0.4:6443/apis?timeout=32s" status="200 OK" milliseconds=0
I1117 23:24:11.938976  160370 round_trippers.go:632] "Response" verb="GET" url="https://172.18.0.4:6443/api/v1/nodes?limit=500" status="200 OK" milliseconds=1
NAME                STATUS   ROLES           AGE     VERSION
prd-control-plane   Ready    control-plane   3h12m   v1.32.8
```

---

## **ğŸŒ Argo CDì— ë‹¤ë¥¸ K8S Cluster ë“±ë¡**

### **1. Argo CD ê¸°ë³¸ in-cluster í´ëŸ¬ìŠ¤í„° ìƒíƒœ í™•ì¸**

```bash
argocd cluster list

SERVER                          NAME        VERSION  STATUS   MESSAGE                                                  PROJECT
https://kubernetes.default.svc  in-cluster           Unknown  Cluster has no applications and is not being monitored.  
```

```bash
argocd cluster list -o json | jq

[
  {
    "server": "https://kubernetes.default.svc",
    "name": "in-cluster",
    "config": {
      "tlsClientConfig": {
        "insecure": false
      }
    },
    "connectionState": {
      "status": "Unknown",
      "message": "Cluster has no applications and is not being monitored.",
      "attemptedAt": "2025-11-17T14:25:59Z"
    },
    "info": {
      "connectionState": {
        "status": "Unknown",
        "message": "Cluster has no applications and is not being monitored.",
        "attemptedAt": "2025-11-17T14:25:59Z"
      },
      "cacheInfo": {},
      "applicationsCount": 0
    }
  }
]
```

### **2. Argo CD ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ì‹œí¬ë¦¿ ëª©ë¡ í™•ì¸**

```bash
kubectl get secret -n argocd

NAME                           TYPE                 DATA   AGE
argocd-initial-admin-secret    Opaque               1      3h25m
argocd-notifications-secret    Opaque               0      3h25m
argocd-redis                   Opaque               1      3h25m
argocd-secret                  Opaque               3      3h25m
argocd-server-tls              kubernetes.io/tls    2      3h27m
sh.helm.release.v1.argocd.v1   helm.sh/release.v1   1      3h26m
```

### **3. dev/prd í´ëŸ¬ìŠ¤í„° kube-system ServiceAccount ëª©ë¡ í™•ì¸**

```bash
k8s2 get sa -n kube-system

NAME                                          SECRETS   AGE
attachdetach-controller                       0         3h16m
bootstrap-signer                              0         3h16m
certificate-controller                        0         3h16m
clusterrole-aggregation-controller            0         3h16m
coredns                                       0         3h16m
cronjob-controller                            0         3h16m
daemon-set-controller                         0         3h16m
default                                       0         3h16m
deployment-controller                         0         3h16m
disruption-controller                         0         3h16m
endpoint-controller                           0         3h16m
endpointslice-controller                      0         3h16m
endpointslicemirroring-controller             0         3h16m
ephemeral-volume-controller                   0         3h16m
expand-controller                             0         3h16m
generic-garbage-collector                     0         3h16m
horizontal-pod-autoscaler                     0         3h16m
job-controller                                0         3h16m
kindnet                                       0         3h16m
kube-proxy                                    0         3h16m
legacy-service-account-token-cleaner          0         3h16m
namespace-controller                          0         3h16m
node-controller                               0         3h16m
persistent-volume-binder                      0         3h16m
pod-garbage-collector                         0         3h16m
pv-protection-controller                      0         3h16m
pvc-protection-controller                     0         3h16m
replicaset-controller                         0         3h16m
replication-controller                        0         3h16m
resourcequota-controller                      0         3h16m
root-ca-cert-publisher                        0         3h16m
service-account-controller                    0         3h16m
statefulset-controller                        0         3h16m
token-cleaner                                 0         3h16m
ttl-after-finished-controller                 0         3h16m
ttl-controller                                0         3h16m
validatingadmissionpolicy-status-controller   0         3h16m
```

```bash
k8s3 get sa -n kube-system

NAME                                          SECRETS   AGE
attachdetach-controller                       0         3h15m
bootstrap-signer                              0         3h16m
certificate-controller                        0         3h16m
clusterrole-aggregation-controller            0         3h16m
coredns                                       0         3h16m
cronjob-controller                            0         3h16m
daemon-set-controller                         0         3h15m
default                                       0         3h15m
deployment-controller                         0         3h16m
disruption-controller                         0         3h15m
endpoint-controller                           0         3h15m
endpointslice-controller                      0         3h16m
endpointslicemirroring-controller             0         3h16m
ephemeral-volume-controller                   0         3h16m
expand-controller                             0         3h16m
generic-garbage-collector                     0         3h16m
horizontal-pod-autoscaler                     0         3h16m
job-controller                                0         3h16m
kindnet                                       0         3h16m
kube-proxy                                    0         3h16m
legacy-service-account-token-cleaner          0         3h16m
namespace-controller                          0         3h16m
node-controller                               0         3h16m
persistent-volume-binder                      0         3h16m
pod-garbage-collector                         0         3h16m
pv-protection-controller                      0         3h16m
pvc-protection-controller                     0         3h16m
replicaset-controller                         0         3h16m
replication-controller                        0         3h16m
resourcequota-controller                      0         3h15m
root-ca-cert-publisher                        0         3h16m
service-account-controller                    0         3h16m
statefulset-controller                        0         3h15m
token-cleaner                                 0         3h16m
ttl-after-finished-controller                 0         3h16m
ttl-controller                                0         3h16m
validatingadmissionpolicy-status-controller   0         3h16m
```

### **4. dev í´ëŸ¬ìŠ¤í„°ë¥¼ Argo CDì— ë“±ë¡**

```bash
argocd cluster add kind-dev --name dev-k8s
WARNING: This will create a service account `argocd-manager` on the cluster referenced by context `kind-dev` with full cluster level privileges. Do you want to continue [y/N]? y

{"level":"info","msg":"ServiceAccount \"argocd-manager\" created in namespace \"kube-system\"","time":"2025-11-17T23:28:26+09:00"}
{"level":"info","msg":"ClusterRole \"argocd-manager-role\" created","time":"2025-11-17T23:28:26+09:00"}
{"level":"info","msg":"ClusterRoleBinding \"argocd-manager-role-binding\" created","time":"2025-11-17T23:28:26+09:00"}
{"level":"info","msg":"Created bearer token secret \"argocd-manager-long-lived-token\" for ServiceAccount \"argocd-manager\"","time":"2025-11-17T23:28:26+09:00"}
Cluster 'https://172.18.0.3:6443' added
```

### **5. dev í´ëŸ¬ìŠ¤í„°ì— ìƒì„±ëœ argocd-manager ServiceAccount í™•ì¸**

```bash
k8s2 get sa -n kube-system argocd-manager

NAME             SECRETS   AGE
argocd-manager   0         29s
```

### **6. Argo CDì—ì„œ dev í´ëŸ¬ìŠ¤í„°ìš© cluster ì‹œí¬ë¦¿ ìƒì„± í™•ì¸**

```bash
kubectl get secret -n argocd -l argocd.argoproj.io/secret-type=cluster

NAME                            TYPE     DATA   AGE
cluster-172.18.0.3-4100004299   Opaque   3      2m36s
```

### **7. k9së¡œ dev í´ëŸ¬ìŠ¤í„° ì‹œí¬ë¦¿ ë‚´ìš© ë””ì½”ë”©í•´ì„œ í™•ì¸**

```bash
k9s -> : secret argocd -> ì•„ë˜ secret ì—ì„œ d (Describe) -> x (Toggle Decode) ë¡œ í™•ì¸
```
![](https://velog.velcdn.com/images/tlsalswls123/post/1f4b29c7-ccbb-45bf-b307-fe09138fcd2f/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/05bc55e8-55d1-4ffa-8fdb-95e6235ecb0f/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/1c3206b7-c16c-4476-bfa9-88cccb5246cd/image.png)

### **8. dev-k8s ë“±ë¡ ê²°ê³¼ í™•ì¸**

```bash
argocd cluster list

SERVER                          NAME        VERSION  STATUS   MESSAGE                                                  PROJECT
https://172.18.0.3:6443         dev-k8s              Unknown  Cluster has no applications and is not being monitored.  
https://kubernetes.default.svc  in-cluster           Unknown  Cluster has no applications and is not being monitored.  
```

- dev í´ëŸ¬ìŠ¤í„°ê°€ Argo CDì— ë“±ë¡ëœ ê²ƒì„ í™•ì¸í•¨

### **9. prd í´ëŸ¬ìŠ¤í„°ë¥¼ Argo CDì— ë“±ë¡**

```bash
argocd cluster add kind-prd --name prd-k8s --yes

{"level":"info","msg":"ServiceAccount \"argocd-manager\" created in namespace \"kube-system\"","time":"2025-11-17T23:36:08+09:00"}
{"level":"info","msg":"ClusterRole \"argocd-manager-role\" created","time":"2025-11-17T23:36:08+09:00"}
{"level":"info","msg":"ClusterRoleBinding \"argocd-manager-role-binding\" created","time":"2025-11-17T23:36:08+09:00"}
{"level":"info","msg":"Created bearer token secret \"argocd-manager-long-lived-token\" for ServiceAccount \"argocd-manager\"","time":"2025-11-17T23:36:08+09:00"}
Cluster 'https://172.18.0.4:6443' added
```

### **10. prd í´ëŸ¬ìŠ¤í„° argocd-manager ServiceAccount ìƒì„± í™•ì¸**

```bash
k8s3 get sa -n kube-system argocd-manager

NAME             SECRETS   AGE
argocd-manager   0         15s
```

### **11. dev/prd í´ëŸ¬ìŠ¤í„°ìš© Argo CD cluster ì‹œí¬ë¦¿ ëª©ë¡ í™•ì¸**

```bash
kubectl get secret -n argocd -l argocd.argoproj.io/secret-type=cluster

NAME                            TYPE     DATA   AGE
cluster-172.18.0.3-4100004299   Opaque   3      8m18s
cluster-172.18.0.4-568336172    Opaque   3      36s
```

### **12. ìµœì¢… Argo CD í´ëŸ¬ìŠ¤í„° ëª©ë¡ í™•ì¸**

```bash
argocd cluster list

SERVER                          NAME        VERSION  STATUS   MESSAGE                                                  PROJECT
https://172.18.0.3:6443         dev-k8s              Unknown  Cluster has no applications and is not being monitored.  
https://172.18.0.4:6443         prd-k8s              Unknown  Cluster has no applications and is not being monitored.  
https://kubernetes.default.svc  in-cluster           Unknown  Cluster has no applications and is not being monitored.  
```
![](https://velog.velcdn.com/images/tlsalswls123/post/8a70f6ad-33a4-4e2e-b721-8f96228ac4ef/image.png)

---

## **ğŸš€ Argo CDë¡œ 3ê°œì˜ K8S Clusterì— ê°ê° Nginx ë°°í¬**

- [https://github.com/gasida/cicd-study/tree/main/nginx-chart](https://github.com/gasida/cicd-study/tree/main/nginx-chart) í•´ë‹¹ ë ˆí¬ì§€í† ë¦¬ í¬í¬

### **1. kind ë„¤íŠ¸ì›Œí¬ì—ì„œ dev/prd í´ëŸ¬ìŠ¤í„° IP í™•ì¸ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

```bash
docker network inspect kind | grep -E 'Name|IPv4Address'

        "Name": "kind",
                "Name": "prd-control-plane",
                "IPv4Address": "172.18.0.4/16",
                "Name": "mgmt-control-plane",
                "IPv4Address": "172.18.0.2/16",
                "Name": "dev-control-plane",
                "IPv4Address": "172.18.0.3/16",
```

```bash
DEVK8SIP=172.18.0.3
PRDK8SIP=172.18.0.4
echo $DEVK8SIP $PRDK8SIP

172.18.0.3 172.18.0.4
```

### **2. mgmt í´ëŸ¬ìŠ¤í„°ì— Nginx ë°°í¬ìš© Argo CD Application ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: mgmt-nginx
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values.yaml
    path: nginx-chart
    repoURL: https://github.com/Shinminjin/cicd-study
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: mgmt-nginx
    server: https://kubernetes.default.svc
EOF

Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/mgmt-nginx created
```

### **3. dev í´ëŸ¬ìŠ¤í„°ì— Nginx ë°°í¬ìš© Argo CD Application ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: dev-nginx
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values-dev.yaml
    path: nginx-chart
    repoURL: https://github.com/Shinminjin/cicd-study
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: dev-nginx
    server: https://$DEVK8SIP:6443
EOF

Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/dev-nginx created
```

### **4. prd í´ëŸ¬ìŠ¤í„°ì— Nginx ë°°í¬ìš© Argo CD Application ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: prd-nginx
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values-prd.yaml
    path: nginx-chart
    repoURL: https://github.com/Shinminjin/cicd-study
    targetRevision: HEAD
  syncPolicy:
    automated:
      prune: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: prd-nginx
    server: https://$PRDK8SIP:6443
EOF

Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/prd-nginx created
```

### **5. Argo CDì—ì„œ ì„¸ ê°œ Nginx Application ìƒíƒœ í™•ì¸**

```bash
argocd app list

NAME               CLUSTER                         NAMESPACE   PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                      PATH         TARGET
argocd/dev-nginx   https://172.18.0.3:6443         dev-nginx   default  Synced  Healthy  Auto-Prune  <none>      https://github.com/Shinminjin/cicd-study  nginx-chart  HEAD
argocd/mgmt-nginx  https://kubernetes.default.svc  mgmt-nginx  default  Synced  Healthy  Auto-Prune  <none>      https://github.com/Shinminjin/cicd-study  nginx-chart  HEAD
argocd/prd-nginx   https://172.18.0.4:6443         prd-nginx   default  Synced  Healthy  Auto-Prune  <none>      https://github.com/Shinminjin/cicd-study  nginx-chart  HEAD
```

- ê° Applicationì´ ì˜¬ë°”ë¥¸ í´ëŸ¬ìŠ¤í„°ì™€ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— ë§¤í•‘ë˜ì–´ ìˆìŒì„ í™•ì¸

```bash
kubectl get applications -n argocd

NAME         SYNC STATUS   HEALTH STATUS
dev-nginx    Synced        Healthy
mgmt-nginx   Synced        Healthy
prd-nginx    Synced        Healthy
```

- Kubernetes ë¦¬ì†ŒìŠ¤ ê´€ì ì—ì„œë„ Application ìƒíƒœë¥¼ ì¬í™•ì¸í•¨

### **6. mgmt í´ëŸ¬ìŠ¤í„°ì—ì„œ Nginx ë¦¬ì†ŒìŠ¤ ë° NodePort ì‘ë‹µ í™•ì¸**

```bash
kubectl get pod,svc,ep,cm -n mgmt-nginx

NAME                              READY   STATUS    RESTARTS   AGE
pod/mgmt-nginx-6fc86948bc-vh7k8   1/1     Running   0          96s

NAME                 TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
service/mgmt-nginx   NodePort   10.96.10.62   <none>        80:30000/TCP   96s

NAME                   ENDPOINTS        AGE
endpoints/mgmt-nginx   10.244.0.17:80   96s

NAME                         DATA   AGE
configmap/kube-root-ca.crt   1      96s
configmap/mgmt-nginx         1      96s
```

```bash
curl -s http://127.0.0.1:30000

<!DOCTYPE html>
<html>
<head>
  <title>Welcome to Nginx!</title>
</head>
<body>
  <h1>Hello, Kubernetes!</h1>
  <p>Nginx version 1.26.1</p>
</body>
</html>
```

- `mgmt-nginx` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ Pod, Service, Endpoint, ConfigMapì„ í™•ì¸
- í˜¸ìŠ¤íŠ¸ì—ì„œ NodePort `30000`ìœ¼ë¡œ ì ‘ì†í•´ Nginx ê¸°ë³¸ í˜ì´ì§€ ëŒ€ì‹  ì»¤ìŠ¤í…€ HTMLì´ ë…¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸

### **7. dev í´ëŸ¬ìŠ¤í„°ì—ì„œ Nginx ë°°í¬ ë° NodePort ì‘ë‹µ í™•ì¸**

```bash
kubectl get pod,svc,ep,cm -n dev-nginx --context kind-dev

NAME                            READY   STATUS    RESTARTS   AGE
pod/dev-nginx-59f4c8899-9vpvf   1/1     Running   0          2m4s

NAME                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/dev-nginx   NodePort   10.96.108.194   <none>        80:31000/TCP   2m4s

NAME                  ENDPOINTS       AGE
endpoints/dev-nginx   10.244.0.5:80   2m4s

NAME                         DATA   AGE
configmap/dev-nginx          1      2m4s
configmap/kube-root-ca.crt   1      2m4s
```

```bash
curl -s http://127.0.0.1:31000

<!DOCTYPE html>
<html>
<head>
  <title>Welcome to Nginx!</title>
</head>
<body>
  <h1>Hello, Dev - Kubernetes!</h1>
  <p>Nginx version 1.26.1</p>
</body>
</html>
```

- `kind-dev` ì»¨í…ìŠ¤íŠ¸ì—ì„œ `dev-nginx` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ ì¡°íšŒí•¨
- í˜¸ìŠ¤íŠ¸ì—ì„œ `31000` í¬íŠ¸ë¡œ ì ‘ì†í•´ dev í™˜ê²½ìš© ë¬¸êµ¬ê°€ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸

### **8. prd í´ëŸ¬ìŠ¤í„°ì—ì„œ Nginx ë‹¤ì¤‘ Pod/Endpoint ë° NodePort ì‘ë‹µ í™•ì¸**

```bash
kubectl get pod,svc,ep,cm -n prd-nginx --context kind-prd

NAME                             READY   STATUS    RESTARTS   AGE
pod/prd-nginx-86d9bc9f7f-bfgg7   1/1     Running   0          3m47s
pod/prd-nginx-86d9bc9f7f-g24p8   1/1     Running   0          3m47s

NAME                TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/prd-nginx   NodePort   10.96.193.167   <none>        80:32000/TCP   3m47s

NAME                  ENDPOINTS                     AGE
endpoints/prd-nginx   10.244.0.5:80,10.244.0.6:80   3m47s

NAME                         DATA   AGE
configmap/kube-root-ca.crt   1      3m47s
configmap/prd-nginx          1      3m47s
```

```bash
curl -s http://127.0.0.1:32000

<!DOCTYPE html>
<html>
<head>
  <title>Welcome to Nginx!</title>
</head>
<body>
  <h1>Hello, Prd - Kubernetes!</h1>
  <p>Nginx version 1.26.1</p>
</body>
</html>
```

- `kind-prd` ì»¨í…ìŠ¤íŠ¸ì—ì„œ `prd-nginx` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ ë¦¬ì†ŒìŠ¤ë¥¼ í™•ì¸í•¨
    - Pod: `prd-nginx-...` 2ê°œ (Replica 2ê°œë¡œ ìš´ì˜ í™˜ê²½ ìŠ¤ì¼€ì¼ ì„¤ì •)
    - Service: NodePort `80:32000/TCP`
    - Endpoint: ë‘ Pod IPê°€ ëª¨ë‘ ë“±ë¡ë˜ì–´ ìˆìŒ

### **9. Argo CD Application ì‚­ì œ**

```bash
kubectl delete applications -n argocd mgmt-nginx dev-nginx prd-nginx

application.argoproj.io "mgmt-nginx" deleted from argocd namespace
application.argoproj.io "dev-nginx" deleted from argocd namespace
application.argoproj.io "prd-nginx" deleted from argocd namespace
```

---

## **ğŸŒ³ Argo CD App of Apps íŒ¨í„´ ì •ë¦¬**

- Root Application(ìƒìœ„ ì•±) í•˜ë‚˜ì— ì—¬ëŸ¬ Application ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ í¬í•¨í•´ ê´€ë¦¬í•˜ëŠ” íŒ¨í„´
- [https://tech.ktcloud.com/entry/2025-05-ktcloud-kubernetes-gitops-appofapps-êµ¬í˜„í™˜ê²½-ì „ëµ](https://tech.ktcloud.com/entry/2025-05-ktcloud-kubernetes-gitops-appofapps-%EA%B5%AC%ED%98%84%ED%99%98%EA%B2%BD-%EC%A0%84%EB%9E%B5)

### **1. Root Application(apps) ìƒì„±**

```bash
argocd app create apps \
    --dest-namespace argocd \
    --dest-server https://kubernetes.default.svc \
    --repo https://github.com/Shinminjin/cicd-study.git \
    --path apps

application 'apps' created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d753a86e-0180-4ae3-a769-beef3cd21014/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/170a8478-febe-4bda-b825-203605d9b20e/image.png)

- `argocd` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— `apps`ë¼ëŠ” ì´ë¦„ì˜ Root Applicationì„ ìƒì„±í•¨
- `https://github.com/Shinminjin/cicd-study.git` ì €ì¥ì†Œì˜ `apps` ë””ë ‰í„°ë¦¬ë¥¼ ì†ŒìŠ¤ë¡œ ì‚¬ìš©í•¨
- ëª©ì : ì´ `apps` ì•ˆì— ì •ì˜ëœ ì—¬ëŸ¬ Application ë§¤ë‹ˆí˜ìŠ¤íŠ¸ë¥¼ í•œ ë²ˆì— ê´€ë¦¬í•˜ê¸° ìœ„í•¨

### **3. Root Application Sync â†’ í•˜ìœ„ Application ìë™ ìƒì„±**

```bash
argocd app sync apps

TIMESTAMP                  GROUP              KIND    NAMESPACE                  NAME           STATUS    HEALTH        HOOK  MESSAGE
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd  example.helm-guestbook       OutOfSync  Missing              
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd  example.kustomize-guestbook  OutOfSync  Missing              
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd    example.sync-waves         OutOfSync  Missing              
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd  example.helm-guestbook    Synced  Missing              
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd    example.sync-waves         OutOfSync  Missing              application.argoproj.io/example.sync-waves created
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd  example.kustomize-guestbook  OutOfSync  Missing              application.argoproj.io/example.kustomize-guestbook created
2025-11-17T23:58:44+09:00  argoproj.io  Application      argocd  example.helm-guestbook         Synced   Missing              application.argoproj.io/example.helm-guestbook created

Name:               argocd/apps
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          argocd
URL:                https://argocd.example.com/applications/apps
Source:
- Repo:             https://github.com/Shinminjin/cicd-study.git
  Target:           
  Path:             apps
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to  (b2894c6)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      b2894c67f7a64e42b408da5825cb0b87ee306b04
Phase:              Succeeded
Start:              2025-11-17 23:58:44 +0900 KST
Finished:           2025-11-17 23:58:44 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP        KIND         NAMESPACE  NAME                         STATUS  HEALTH  HOOK  MESSAGE
argoproj.io  Application  argocd     example.helm-guestbook       Synced                application.argoproj.io/example.helm-guestbook created
argoproj.io  Application  argocd     example.sync-waves           Synced                application.argoproj.io/example.sync-waves created
argoproj.io  Application  argocd     example.kustomize-guestbook  Synced                application.argoproj.io/example.kustomize-guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/aacf2a52-de7a-4bbc-8566-72349f757a52/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/2ac32c57-e174-4fe6-afd4-8cf6f624c42f/image.png)

### **3. Root Application(apps) ìƒì„¸ ìƒíƒœ í™•ì¸**

```bash
argocd app list

NAME                                CLUSTER                         NAMESPACE            PROJECT  STATUS  HEALTH   SYNCPOLICY  CONDITIONS  REPO                                          PATH                 TARGET
argocd/apps                         https://kubernetes.default.svc  argocd               default  Synced  Healthy  Manual      <none>      https://github.com/Shinminjin/cicd-study.git  apps                 
argocd/example.helm-guestbook       https://kubernetes.default.svc  helm-guestbook       default  Synced  Healthy  Auto-Prune  <none>      https://github.com/gasida/cicd-study          helm-guestbook       main
argocd/example.kustomize-guestbook  https://kubernetes.default.svc  kustomize-guestbook  default  Synced  Healthy  Auto-Prune  <none>      https://github.com/gasida/cicd-study          kustomize-guestbook  main
argocd/example.sync-waves           https://kubernetes.default.svc  sync-waves           default  Synced  Healthy  Auto-Prune  <none>      https://github.com/gasida/cicd-study          sync-waves           main
```

### **4. ì‹¤ì œ ì¿ ë²„ë„¤í‹°ìŠ¤ ë¦¬ì†ŒìŠ¤ ìƒì„± ìƒíƒœ í™•ì¸**

```bash
kubectl get pod -A

NAMESPACE             NAME                                                 READY   STATUS      RESTARTS   AGE
argocd                argocd-application-controller-0                      1/1     Running     0          4h
argocd                argocd-applicationset-controller-bbff79c6f-9qcf8     1/1     Running     0          4h
argocd                argocd-dex-server-6877ddf4f8-fvfll                   1/1     Running     0          4h
argocd                argocd-notifications-controller-7b5658fc47-26p24     1/1     Running     0          4h
argocd                argocd-redis-7d948674-xnl9k                          1/1     Running     0          4h
argocd                argocd-repo-server-7679dc55f5-swj2g                  1/1     Running     0          4h
argocd                argocd-server-7d769b6f48-2ts94                       1/1     Running     0          4h
helm-guestbook        helm-guestbook-667dffd5cf-f24hj                      1/1     Running     0          2m40s
ingress-nginx         ingress-nginx-controller-5b89cb54f9-5gvfh            1/1     Running     0          4h3m
kube-system           coredns-668d6bf9bc-d5bn7                             1/1     Running     0          4h5m
kube-system           coredns-668d6bf9bc-vb4p7                             1/1     Running     0          4h5m
kube-system           etcd-mgmt-control-plane                              1/1     Running     0          4h5m
kube-system           kindnet-jtm8t                                        1/1     Running     0          4h5m
kube-system           kube-apiserver-mgmt-control-plane                    1/1     Running     0          4h5m
kube-system           kube-controller-manager-mgmt-control-plane           1/1     Running     0          4h5m
kube-system           kube-proxy-b9pmh                                     1/1     Running     0          4h5m
kube-system           kube-scheduler-mgmt-control-plane                    1/1     Running     0          4h5m
kustomize-guestbook   kustomize-guestbook-ui-85db984648-mzc87              1/1     Running     0          2m40s
local-path-storage    local-path-provisioner-7dc846544d-wltkn              1/1     Running     0          4h5m
sync-waves            backend-z4kpq                                        1/1     Running     0          2m28s
sync-waves            frontend-x8xjc                                       1/1     Running     0          108s
sync-waves            maint-page-down-scbbs                                0/1     Completed   0          105s
sync-waves            maint-page-up-tr6d2                                  0/1     Completed   0          115s
sync-waves            upgrade-sql-schemab2894c6-presync-1763391525-5qk25   0/1     Completed   0          2m41s
```

### **5. Root Application ì‚­ì œë¡œ App of Apps ì •ë¦¬**

```bash
argocd app delete argocd/apps --yes

application 'argocd/apps' deleted
```

---

## **ğŸ“¦ ApplicationSet List ì œë„¤ë ˆì´í„° ì‹¤ìŠµ**

### **1. List Generator ê¸°ë°˜ ApplicationSet ìƒì„±**

```bash
echo $DEVK8SIP $PRDK8SIP
172.18.0.3 172.18.0.4
```

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: guestbook
  namespace: argocd
spec:
  goTemplate: true
  goTemplateOptions: ["missingkey=error"]
  generators:
  - list:
      elements:
      - cluster: dev-k8s
        url: https://$DEVK8SIP:6443
      - cluster: prd-k8s
        url: https://$PRDK8SIP:6443
  template:
    metadata:
      name: '{{.cluster}}-guestbook'
      labels:
        environment: '{{.cluster}}'
        managed-by: applicationset
    spec:
      project: default
      source:
        repoURL: https://github.com/Shinminjin/cicd-study.git
        targetRevision: HEAD
        path: appset/list/{{.cluster}}
      destination:
        server: '{{.url}}'
        namespace: guestbook
      syncPolicy:
        syncOptions:
          - CreateNamespace=true
EOF

applicationset.argoproj.io/guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/1c1702be-1391-4428-90dc-3a29132a99c7/image.png)

### **2. ApplicationSet guestbook ì •ì˜ í™•ì¸**

```bash
kubectl get applicationsets -n argocd guestbook -o yaml | kubectl neat | yq

{
  "apiVersion": "argoproj.io/v1alpha1",
  "kind": "ApplicationSet",
  "metadata": {
    "name": "guestbook",
    "namespace": "argocd"
  },
  "spec": {
    "generators": [
      {
        "list": {
          "elements": [
            {
              "cluster": "dev-k8s",
              "url": "https://172.18.0.3:6443"
            },
            {
              "cluster": "prd-k8s",
              "url": "https://172.18.0.4:6443"
            }
          ]
        }
      }
    ],
    "goTemplate": true,
    "goTemplateOptions": [
      "missingkey=error"
    ],
    "template": {
      "metadata": {
        "labels": {
          "environment": "{{.cluster}}",
          "managed-by": "applicationset"
        },
        "name": "{{.cluster}}-guestbook"
      },
      "spec": {
        "destination": {
          "namespace": "guestbook",
          "server": "{{.url}}"
        },
        "project": "default",
        "source": {
          "path": "appset/list/{{.cluster}}",
          "repoURL": "https://github.com/Shinminjin/cicd-study.git",
          "targetRevision": "HEAD"
        },
        "syncPolicy": {
          "syncOptions": [
            "CreateNamespace=true"
          ]
        }
      }
    }
  }
}
```

### **3. ApplicationSet ë¦¬ì†ŒìŠ¤ ë° ìƒíƒœ í™•ì¸**

```bash
kubectl get applicationsets -n argocd

NAME        AGE
guestbook   108s
```

```bash
argocd appset list

NAME              PROJECT  SYNCPOLICY  CONDITIONS                                                                                                                                                                                                                                     REPO                                          PATH                      TARGET
argocd/guestbook  default  nil         [{ParametersGenerated Successfully generated parameters for all Applications 2025-11-18 00:09:45 +0900 KST True ParametersGenerated} {ResourcesUpToDate ApplicationSet up to date 2025-11-18 00:09:45 +0900 KST True ApplicationSetUpToDate}]  https://github.com/Shinminjin/cicd-study.git  appset/list/{{.cluster}}  HEAD
```

### **4. ApplicationSetì´ ìƒì„±í•œ Application ëª©ë¡ í™•ì¸**

```bash
argocd app list

NAME                      CLUSTER                  NAMESPACE  PROJECT  STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                          PATH                 TARGET
argocd/dev-k8s-guestbook  https://172.18.0.3:6443  guestbook  default  OutOfSync  Missing  Manual      <none>      https://github.com/Shinminjin/cicd-study.git  appset/list/dev-k8s  HEAD
argocd/prd-k8s-guestbook  https://172.18.0.4:6443  guestbook  default  OutOfSync  Missing  Manual      <none>      https://github.com/Shinminjin/cicd-study.git  appset/list/prd-k8s  HEAD
```

- ApplicationSetì´ ìƒì„±í•œ ë‘ ê°œì˜ Application(`dev-k8s-guestbook`, `prd-k8s-guestbook`)ì„ í™•ì¸
- ì²˜ìŒ ìƒíƒœëŠ” ì•„ì§ Sync ì „ì´ë¼ `OutOfSync / Missing` ìƒíƒœì„

### **5. ApplicationSetì´ ë¶€ì—¬í•œ ë¼ë²¨ ê¸°ë°˜ í•„í„°ë§**

```bash
argocd app list -l managed-by=applicationset

NAME                      CLUSTER                  NAMESPACE  PROJECT  STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                          PATH                 TARGET
argocd/dev-k8s-guestbook  https://172.18.0.3:6443  guestbook  default  OutOfSync  Missing  Manual      <none>      https://github.com/Shinminjin/cicd-study.git  appset/list/dev-k8s  HEAD
argocd/prd-k8s-guestbook  https://172.18.0.4:6443  guestbook  default  OutOfSync  Missing  Manual      <none>      https://github.com/Shinminjin/cicd-study.git  appset/list/prd-k8s  HEAD
```
![](https://velog.velcdn.com/images/tlsalswls123/post/44787c69-e8aa-4fc4-9a36-032742830418/image.png)

- Application í…œí”Œë¦¿ì—ì„œ ë¶€ì—¬í•œ `managed-by=applicationset` ë¼ë²¨ì„ ê¸°ì¤€ìœ¼ë¡œ Argo CD ì•± ëª©ë¡ì„ í•„í„°ë§í•¨

```bash
kubectl get applications -n argocd

NAME                SYNC STATUS   HEALTH STATUS
dev-k8s-guestbook   OutOfSync     Missing
prd-k8s-guestbook   OutOfSync     Missing
```

```bash
kubectl get applications -n argocd --show-labels

NAME                SYNC STATUS   HEALTH STATUS   LABELS
dev-k8s-guestbook   OutOfSync     Missing         environment=dev-k8s,managed-by=applicationset
prd-k8s-guestbook   OutOfSync     Missing         environment=prd-k8s,managed-by=applicationset
```

- Kubernetes ë¦¬ì†ŒìŠ¤ ì¸¡ë©´ì—ì„œë„ Application CRì— ë¼ë²¨ì´ ì˜ ë“¤ì–´ê°”ëŠ”ì§€ í™•ì¸í•¨

### **6. Label Selector ê¸°ë°˜ ì¼ê´„ Sync ìˆ˜í–‰**

```bash
argocd app sync -l managed-by=applicationset

TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE
2025-11-18T00:14:46+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-18T00:14:46+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-18T00:14:46+09:00          Namespace                         guestbook   Running   Synced              namespace/guestbook created

Name:               argocd/dev-k8s-guestbook
Project:            default
Server:             https://172.18.0.3:6443
Namespace:          guestbook
URL:                https://argocd.example.com/applications/argocd/dev-k8s-guestbook
Source:
- Repo:             https://github.com/Shinminjin/cicd-study.git
  Target:           HEAD
  Path:             appset/list/dev-k8s
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to HEAD (b2894c6)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      b2894c67f7a64e42b408da5825cb0b87ee306b04
Phase:              Succeeded
Start:              2025-11-18 00:14:46 +0900 KST
Finished:           2025-11-18 00:14:46 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND        NAMESPACE  NAME          STATUS   HEALTH       HOOK  MESSAGE
       Namespace              guestbook     Running  Synced             namespace/guestbook created
       Service     guestbook  guestbook-ui  Synced   Healthy            service/guestbook-ui created
apps   Deployment  guestbook  guestbook-ui  Synced   Progressing        deployment.apps/guestbook-ui created
TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE
2025-11-18T00:14:47+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-18T00:14:47+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-18T00:14:47+09:00          Namespace                         guestbook   Running   Synced              namespace/guestbook created

Name:               argocd/prd-k8s-guestbook
Project:            default
Server:             https://172.18.0.4:6443
Namespace:          guestbook
URL:                https://argocd.example.com/applications/argocd/prd-k8s-guestbook
Source:
- Repo:             https://github.com/Shinminjin/cicd-study.git
  Target:           HEAD
  Path:             appset/list/prd-k8s
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to HEAD (b2894c6)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      b2894c67f7a64e42b408da5825cb0b87ee306b04
Phase:              Succeeded
Start:              2025-11-18 00:14:47 +0900 KST
Finished:           2025-11-18 00:14:47 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND        NAMESPACE  NAME          STATUS   HEALTH       HOOK  MESSAGE
       Namespace              guestbook     Running  Synced             namespace/guestbook created
       Service     guestbook  guestbook-ui  Synced   Healthy            service/guestbook-ui created
apps   Deployment  guestbook  guestbook-ui  Synced   Progressing        deployment.apps/guestbook-ui created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/97772042-cac1-493a-b38a-f414b6afb6d9/image.png)
- `managed-by=applicationset` ë¼ë²¨ì„ ê¸°ì¤€ìœ¼ë¡œ ë‘ ê°œì˜ guestbook ì•±ì„ **í•œ ë²ˆì— sync** ìˆ˜í–‰í•¨

### **7. Sync ì´í›„ Application ìƒíƒœ ë° ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸**

```bash
k8s2 get pod -n guestbook

NAME                            READY   STATUS    RESTARTS   AGE
guestbook-ui-7cf4fd7cb9-m7l46   1/1     Running   0          118s
```

```bash
k8s3 get pod -n guestbook

NAME                            READY   STATUS    RESTARTS   AGE
guestbook-ui-7cf4fd7cb9-9gkql   1/1     Running   0          2m6s
guestbook-ui-7cf4fd7cb9-hbf9s   1/1     Running   0          2m6s
```

- dev/prd í´ëŸ¬ìŠ¤í„°ì— ì‹¤ì œ ë°°í¬ëœ guestbook Pod ìƒíƒœ í™•ì¸

### **8. ìƒì„±ëœ Application ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ë‚´ìš© í™•ì¸**

```bash
kubectl get applications -n argocd dev-k8s-guestbook -o yaml | kubectl neat | yq

{
  "apiVersion": "argoproj.io/v1alpha1",
  "kind": "Application",
  "metadata": {
    "labels": {
      "environment": "dev-k8s",
      "managed-by": "applicationset"
    },
    "name": "dev-k8s-guestbook",
    "namespace": "argocd"
  },
  "spec": {
    "destination": {
      "namespace": "guestbook",
      "server": "https://172.18.0.3:6443"
    },
    "project": "default",
    "source": {
      "path": "appset/list/dev-k8s",
      "repoURL": "https://github.com/Shinminjin/cicd-study.git",
      "targetRevision": "HEAD"
    },
    "syncPolicy": {
      "syncOptions": [
        "CreateNamespace=true"
      ]
    }
  }
}

```

```bash
kubectl get applications -n argocd prd-k8s-guestbook -o yaml | kubectl neat | yq

{
  "apiVersion": "argoproj.io/v1alpha1",
  "kind": "Application",
  "metadata": {
    "labels": {
      "environment": "prd-k8s",
      "managed-by": "applicationset"
    },
    "name": "prd-k8s-guestbook",
    "namespace": "argocd"
  },
  "spec": {
    "destination": {
      "namespace": "guestbook",
      "server": "https://172.18.0.4:6443"
    },
    "project": "default",
    "source": {
      "path": "appset/list/prd-k8s",
      "repoURL": "https://github.com/Shinminjin/cicd-study.git",
      "targetRevision": "HEAD"
    },
    "syncPolicy": {
      "syncOptions": [
        "CreateNamespace=true"
      ]
    }
  }
}

```

### **9. ApplicationSet ì‚­ì œë¡œ ì œì–´ ë¦¬ì†ŒìŠ¤ ì •ë¦¬**

```bash
argocd appset delete guestbook --yes

applicationset 'guestbook' deleted
```

---

## **ğŸŒ ApplicationSet Cluster ì œë„¤ë ˆì´í„° ì‹¤ìŠµ**

### **1. Cluster ì œë„¤ë ˆì´í„°ë¡œ 3ê°œ í´ëŸ¬ìŠ¤í„°ì— ì¼ê´„ ë°°í¬**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: guestbook
  namespace: argocd
spec:
  goTemplate: true
  goTemplateOptions: ["missingkey=error"]
  generators:
  - clusters: {}
  template:
    metadata:
      name: '{{.name}}-guestbook'
      labels:
        managed-by: applicationset
    spec:
      project: "default"
      source:
        repoURL: https://github.com/Shinminjin/cicd-study
        targetRevision: HEAD
        path: guestbook
      destination:
        server: '{{.server}}'
        namespace: guestbook
      syncPolicy:
        syncOptions:
          - CreateNamespace=true
EOF

applicationset.argoproj.io/guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/bdf899d4-9d5a-4805-990c-e8612e9b23bf/image.png)

- `clusters: {}` ì œë„¤ë ˆì´í„°ë¥¼ ì‚¬ìš©í•´ **Argo CDì— ë“±ë¡ëœ ëª¨ë“  í´ëŸ¬ìŠ¤í„°**ì— guestbook ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•¨
- ê° í´ëŸ¬ìŠ¤í„°ì˜ ì´ë¦„(`.name`)ê³¼ API ì„œë²„ ì£¼ì†Œ(`.server`)ë¥¼ í…œí”Œë¦¿ì—ì„œ ì‚¬ìš©í•˜ì—¬, í´ëŸ¬ìŠ¤í„°ë³„ë¡œ Applicationì´ ìë™ ìƒì„±ë˜ë„ë¡ êµ¬ì„±í•¨

### **2. Cluster ì œë„¤ë ˆì´í„° ApplicationSet ì œê±°**

```bash
argocd appset delete guestbook --yes

applicationset 'guestbook' deleted
```

### **3. dev í´ëŸ¬ìŠ¤í„°ë§Œ ëŒ€ìƒìœ¼ë¡œ í•„í„°ë§ ì¤€ë¹„ (cluster ì‹œí¬ë¦¿ì— ë¼ë²¨ ì¶”ê°€)**

```bash
kubectl get secret -n argocd -l argocd.argoproj.io/secret-type=cluster

NAME                            TYPE     DATA   AGE
cluster-172.18.0.3-4100004299   Opaque   3      51m
cluster-172.18.0.4-568336172    Opaque   3      44m
```

- Argo CDê°€ ê´€ë¦¬ ì¤‘ì¸ í´ëŸ¬ìŠ¤í„° ì‹œí¬ë¦¿ ëª©ë¡ì„ ì¡°íšŒí•´ dev/prd í´ëŸ¬ìŠ¤í„°ë¥¼ ì‹ë³„í•¨

```bash
DEVK8S=cluster-172.18.0.3-4100004299
kubectl label secrets $DEVK8S -n argocd env=stg

secret/cluster-172.18.0.3-4100004299 labeled
```

- dev í´ëŸ¬ìŠ¤í„°ì— í•´ë‹¹í•˜ëŠ” ì‹œí¬ë¦¿ ì´ë¦„ì„ ë³€ìˆ˜ë¡œ ì§€ì •í•˜ê³ , ì—¬ê¸°ì— `env=stg` ë¼ë²¨ì„ ë¶€ì—¬í•¨

```bash
kubectl get secret -n argocd -l env=stg

NAME                            TYPE     DATA   AGE
cluster-172.18.0.3-4100004299   Opaque   3      53m
```

- `env=stg` ë¼ë²¨ì´ ì˜ ë¶™ì—ˆëŠ”ì§€ ì¬í™•ì¸í•¨

### **4. ë¼ë²¨ ì…€ë ‰í„° ê¸°ë°˜ Cluster ì œë„¤ë ˆì´í„° ApplicationSet ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: guestbook
  namespace: argocd
spec:
  goTemplate: true
  goTemplateOptions: ["missingkey=error"]
  generators:
  - clusters:
      selector:
        matchLabels:
          env: "stg"
  template:
    metadata:
      name: '{{.name}}-guestbook'
      labels:
        managed-by: applicationset
    spec:
      project: "default"
      source:
        repoURL: https://github.com/Shinminjin/cicd-study
        targetRevision: HEAD
        path: guestbook
      destination:
        server: '{{.server}}'
        namespace: guestbook
      syncPolicy:
        syncOptions:
          - CreateNamespace=true
        automated:
          prune: true
          selfHeal: true
EOF

applicationset.argoproj.io/guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/6a27601d-97bc-4fde-bac5-0a52e0833fd0/image.png)

### **5. ë¼ë²¨ ê¸°ë°˜ Cluster ApplicationSet ì‹¤ìŠµ ì •ë¦¬**

```bash
argocd appset delete guestbook --yes

applicationset 'guestbook' deleted
```

---

## **ğŸ” keycloak íŒŒë“œë¡œ ë°°í¬**

### **1. Keycloak Deployment/Service/Ingressë¡œ ë°°í¬ ì¤€ë¹„**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: keycloak
  labels:
    app: keycloak
spec:
  replicas: 1
  selector:
    matchLabels:
      app: keycloak
  template:
    metadata:
      labels:
        app: keycloak
    spec:
      containers:
        - name: keycloak
          image: quay.io/keycloak/keycloak:26.4.0
          args: ["start-dev"]     # dev mode ì‹¤í–‰
          env:
            - name: KEYCLOAK_ADMIN
              value: admin
            - name: KEYCLOAK_ADMIN_PASSWORD
              value: admin
          ports:
            - containerPort: 8080
---
apiVersion: v1
kind: Service
metadata:
  name: keycloak
spec:
  selector:
    app: keycloak
  ports:
    - name: http
      port: 80
      targetPort: 8080
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: keycloak
  namespace: default
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
spec:
  ingressClassName: nginx
  rules:
    - host: keycloak.example.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: keycloak
                port:
                  number: 8080
EOF

deployment.apps/keycloak created
service/keycloak created
ingress.networking.k8s.io/keycloak created
```

### **2. Keycloak ë¦¬ì†ŒìŠ¤ ìƒíƒœ í™•ì¸**

```bash
kubectl get deploy,svc,ep keycloak

NAME                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/keycloak   1/1     1            1           40s

NAME               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
service/keycloak   ClusterIP   10.96.249.212   <none>        80/TCP    40s

NAME                 ENDPOINTS          AGE
endpoints/keycloak   10.244.0.25:8080   40s
```

```bash
kubectl get ingress keycloak

NAME       CLASS   HOSTS                  ADDRESS     PORTS   AGE
keycloak   nginx   keycloak.example.com   localhost   80      58s
```

### **3. Ingress + /etc/hosts ì„¤ì •ìœ¼ë¡œ Keycloak ë„ë©”ì¸ ì ‘ê·¼ ê²€ì¦**

```bash
curl -s -H "Host: keycloak.example.com" http://127.0.0.1 -I

HTTP/1.1 302 Found
Date: Tue, 18 Nov 2025 12:02:15 GMT
Connection: keep-alive
Location: http://keycloak.example.com/admin/
Referrer-Policy: no-referrer
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
```

```bash
echo "127.0.0.1 keycloak.example.com" | sudo tee -a /etc/hosts

127.0.0.1 keycloak.example.com
```

```bash
curl -s http://keycloak.example.com -I

HTTP/1.1 302 Found
Date: Tue, 18 Nov 2025 12:04:40 GMT
Connection: keep-alive
Location: http://keycloak.example.com/admin/
Referrer-Policy: no-referrer
Strict-Transport-Security: max-age=31536000; includeSubDomains
X-Content-Type-Options: nosniff
```

### **4. Keycloak Admin ì½˜ì†” ì ‘ì† ë° ë¡œê·¸ì¸**

```bash
http://keycloak.example.com/admin
username, password: admin / admin
```
![](https://velog.velcdn.com/images/tlsalswls123/post/a21a1a4d-df5e-4263-b7c6-0339d4590e55/image.png)

### **5. ìƒˆë¡œìš´ Realm ìƒì„± â€“ myrealm**
![](https://velog.velcdn.com/images/tlsalswls123/post/69a418b0-494c-4fc9-adbd-c4efc259d795/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/6258e1de-9c44-4295-b1f0-659473249399/image.png)

### **6. myrealm ë‚´ í…ŒìŠ¤íŠ¸ ì‚¬ìš©ì alice ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/e03c6e7b-2767-444e-94ac-28ca6392530d/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/d319d92c-5a37-4618-a12e-7ad8422591c2/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/3e572029-d0a3-41da-95c7-96857b31ed3c/image.png)

---

## **ğŸ§ª mgmt k8s in-cluster ë‚´ë¶€ì—ì„œë„ keycloak / argocd ë„ë©”ì¸ í˜¸ì¶œ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •**

### **1. curl í…ŒìŠ¤íŠ¸ìš© íŒŒë“œë¡œ ë„¤íŠ¸ì›Œí¬ ê¸°ë³¸ ìƒíƒœ í™•ì¸**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: curl
  namespace: default
spec:
  containers:
  - name: curl
    image: curlimages/curl:latest
    command: ["sleep", "infinity"]
EOF

pod/curl created
```

- í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œ HTTP/DNSë¥¼ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ `curl` ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²½ëŸ‰ íŒŒë“œë¥¼ ìƒì„±

```bash
kubectl get pod -l app=keycloak -owide

NAME                       READY   STATUS    RESTARTS   AGE   IP            NODE                 NOMINATED NODE   READINESS GATES
keycloak-846cb4c68-lphrw   1/1     Running   0          12m   10.244.0.25   mgmt-control-plane   <none>           <none>
```

```bash
kubectl get pod -l app=keycloak -o jsonpath='{.items[0].status.podIP}'

10.244.0.25
```

```bash
KEYCLOAKIP=$(kubectl get pod -l app=keycloak -o jsonpath='{.items[0].status.podIP}')
echo $KEYCLOAKIP

10.244.0.25
```

- keycloak íŒŒë“œ IP í™•ì¸ í›„, ë³€ìˆ˜ë¡œ ì§€ì •

```bash
kubectl exec -it curl -- ping -c 1 $KEYCLOAKIP

PING 10.244.0.25 (10.244.0.25): 56 data bytes
64 bytes from 10.244.0.25: seq=0 ttl=42 time=0.138 ms

--- 10.244.0.25 ping statistics ---
1 packets transmitted, 1 packets received, 0% packet loss
round-trip min/avg/max = 0.138/0.138/0.138 ms
```

- curl íŒŒë“œì—ì„œ í•´ë‹¹ IPë¡œ pingì´ ì˜ ë˜ëŠ” ê²ƒì„ í™•ì¸í•¨

### **2. cluster DNS ì´ë¦„ìœ¼ë¡œ keycloak OIDC ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ í™•ì¸**

```bash
kubectl exec -it curl -- curl -s http://keycloak.default.svc.cluster.local/realms/myrealm/.well-known/openid-configuration | jq

{
  "issuer": "http://keycloak.default.svc.cluster.local/realms/myrealm",
  "authorization_endpoint": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/auth",
  "token_endpoint": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/token",
  "introspection_endpoint": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/token/introspect",
  "userinfo_endpoint": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/userinfo",
  "end_session_endpoint": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/logout",
  "frontchannel_logout_session_supported": true,
  "frontchannel_logout_supported": true,
  "jwks_uri": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/certs",
  "check_session_iframe": "http://keycloak.default.svc.cluster.local/realms/myrealm/protocol/openid-connect/login-status-iframe.html",
  ...
}
```

### **3. ê·¸ëŸ°ë° `keycloak.example.com` ì€ ì™œ ì•ˆë ê¹Œ?**

```bash
kubectl exec -it curl -- curl -s http://keycloak.example.com -I

command terminated with exit code 6
```

```bash
kubectl exec -it curl -- nslookup -debug keycloak.example.com

Server:		10.96.0.10
Address:	10.96.0.10:53

Query #0 completed in 145ms:
** server can't find keycloak.example.com: NXDOMAIN

Query #1 completed in 299ms:
** server can't find keycloak.example.com: NXDOMAIN

command terminated with exit code 1
```

- Pod ë‚´ë¶€ì—ì„œì˜ DNS ì¡°íšŒëŠ” ë…¸ë“œ `/etc/hosts` ë¥¼ ì§ì ‘ ë³´ì§€ ì•Šê³  CoreDNS(ì„œë¹„ìŠ¤ IP `10.96.0.10`)ë¥¼ ì‚¬ìš©í•¨

### **4. CoreDNS ConfigMap ìˆ˜ì •ìœ¼ë¡œ keycloak / argocd ë„ë©”ì¸ ë“±ë¡**

**(1) ë¨¼ì € Service IP í™•ì¸**

```bash
kubectl get svc keycloak
NAME       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
keycloak   ClusterIP   10.96.249.212   <none>        80/TCP    19m

kubectl get svc -n argocd argocd-server
NAME            TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
argocd-server   ClusterIP   10.96.46.178   <none>        80/TCP,443/TCP   25h
```

**(2) CoreDNS ì„¤ì • ìˆ˜ì •**

```bash
kubectl edit cm -n kube-system coredns

.:53 {
       ...
        kubernetes cluster.local in-addr.arpa ip6.arpa {
           pods insecure
           fallthrough in-addr.arpa ip6.arpa
           ttl 30
        }
        hosts {
           <CLUSTER IP> keycloak.example.com
           <CLUSTER IP> argocd.example.com
           fallthrough
        }
...

configmap/coredns edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/99138926-ce61-4e6f-a97a-ab413b8f33f6/image.png)

### **5. ìˆ˜ì • í›„ in-cluster DNS / ë„ë©”ì¸ í˜¸ì¶œ í™•ì¸**

```bash
kubectl exec -it curl -- nslookup keycloak.example.com

Server:		10.96.0.10
Address:	10.96.0.10:53

Name:	keycloak.example.com
Address: 10.96.249.212
```

---

## **ğŸ”‘ keycloakì— argocdë¥¼ ìœ„í•œ client ìƒì„±**

- [https://argo-cd.readthedocs.io/en/stable/operator-manual/user-management/keycloak/](https://argo-cd.readthedocs.io/en/stable/operator-manual/user-management/keycloak/)

### **1. Argo CD ì—°ë™ìš© Realm / Client ìƒì„±**

```bash
ì‚¬ìš© Realm : myrealm
Client id : argocd
name : argocd client
```
![](https://velog.velcdn.com/images/tlsalswls123/post/a239d5c3-7466-412b-8c88-829442b387b6/image.png)

```bash
Client authentication : ON
```
![](https://velog.velcdn.com/images/tlsalswls123/post/736787e2-4566-4ceb-8d5c-414019b18159/image.png)

```bash
Root URL : https://argocd.example.com/
Home URL : /applications
Valid redirect URIs : https://argocd.example.com/auth/callback
Valid post logout redirect URIs : https://argocd.example.com/applications
Web origins : +
```
![](https://velog.velcdn.com/images/tlsalswls123/post/cff46438-3055-4ffa-ad73-0dde086a0bc1/image.png)

```bash
# ìƒì„±ëœ clientì—ì„œ â†’ Credentials: ë©”ëª¨ í•´ë‘ê¸°
bJnuNqSdHAaWDPn4ixWCAiac7tOP6nrN
```
![](https://velog.velcdn.com/images/tlsalswls123/post/2caed6a3-dde7-427b-a789-6444d92abb7c/image.png)

---

## **ğŸ›¡ï¸ Configuring ArgoCD OIDC**

### **1. Keycloak Client Secret ì„ Argo CD Secret ì— ì €ì¥**

```bash
kubectl -n argocd patch secret argocd-secret --patch='{"stringData": { "oidc.keycloak.clientSecret": "<REPLACE_WITH_CLIENT_SECRET>" }}'
kubectl -n argocd patch secret argocd-secret --patch='{"stringData": { "oidc.keycloak.clientSecret": "bJnuNqSdHAaWDPn4ixWCAiac7tOP6nrN" }}'
secret/argocd-secret patched
```

- Keycloak ì—ì„œ ë°œê¸‰ë°›ì€ `clientSecret` ê°’ì„ `argocd-secret` ì‹œí¬ë¦¿ì— ì¶”ê°€í•¨
- `oidc.keycloak.clientSecret` í‚¤ë¡œ ì €ì¥í•˜ì—¬ OIDC ì„¤ì •ì—ì„œ ì°¸ì¡°í•  ìˆ˜ ìˆê²Œ êµ¬ì„±í•¨

```bash
kubectl get secret -n argocd argocd-secret -o jsonpath='{.data}' | jq

{
  "admin.password": "JDJhJDEwJHRuTDZ3UUt1MzFZVUlIRW5hZkJVeXV6T0hLQWRrZ1hxTXQweTZHQ0taMzhHQTlzb2ZCM1ZP",
  "admin.passwordMtime": "MjAyNS0xMS0xN1QxMTowNDowNlo=",
  "oidc.keycloak.clientSecret": "YkpudU5xU2RIQWFXRFBuNGl4V0NBaWFjN3RPUDZuck4=",
  "server.secretkey": "bFdiZUpzZHhGNS9waGVldGwrcGdPbmUwaGJIRDFWd2E2bnE1TThnQkNRUT0="
}
```

- ì €ì¥ ë‚´ìš© í™•ì¸

### **2. Argo CD ConfigMapì— OIDC ì„¤ì • ì¶”ê°€**

```bash
kubectl patch cm argocd-cm -n argocd --type merge -p '
data:
  oidc.config: |
    name: Keycloak
    issuer: http://keycloak.example.com/realms/myrealm
    clientID: argocd
    clientSecret: bJnuNqSdHAaWDPn4ixWCAiac7tOP6nrN
    requestedScopes: ["openid", "profile", "email"]
'

configmap/argocd-cm patched
```

- `argocd-cm` ConfigMap ì— OIDC ê´€ë ¨ ì„¤ì •ì„ ì¶”ê°€í•¨
- Keycloak ì˜ `myrealm` ê³¼ `argocd` í´ë¼ì´ì–¸íŠ¸ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ OIDC í”„ë¡œë°”ì´ë”ë¥¼ ë“±ë¡í•¨

```bash
kubectl get cm -n argocd argocd-cm -o yaml | grep oidc.config: -A5

  oidc.config: |
    name: Keycloak
    issuer: http://keycloak.example.com/realms/myrealm
    clientID: argocd
    clientSecret: bJnuNqSdHAaWDPn4ixWCAiac7tOP6nrN
    requestedScopes: ["openid", "profile", "email"]
```

- ì„¤ì •ì´ ì •ìƒ ë°˜ì˜ë˜ì—ˆëŠ”ì§€ í™•ì¸í•¨

### **3. Argo CD ì„œë²„ ì¬ì‹œì‘ìœ¼ë¡œ OIDC ì„¤ì • ë°˜ì˜**

```bash
kubectl rollout restart deploy argocd-server -n argocd

deployment.apps/argocd-server restarted
```

---

## **ğŸ‘¨â€ğŸ’» keycloak ì¸ì¦ì„ í†µí•œ Argo CD ë¡œê·¸ì¸ : admin logout í›„ keycloakì„ í†µí•œ alice ë¡œê·¸ì¸**

### **1. Argo CD ë¡œê·¸ì¸ í™”ë©´ì—ì„œ Keycloak ë¡œê·¸ì¸ ì§„ì…**
![](https://velog.velcdn.com/images/tlsalswls123/post/d72005ee-d500-4dd0-829c-96eac480fc39/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/d5f50813-f9c8-4368-a680-22f776ee8758/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/aab653ca-9c4d-4093-a80c-2de2407397f3/image.png)

- ë¸Œë¼ìš°ì €ê°€ `keycloak.example.com` ì˜ **myrealm ë¡œê·¸ì¸ í˜ì´ì§€**ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ë¨

### **2. Keycloakì—ì„œ alice ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸**

```bash
username: alice
password: alice123
# ì‚¬ìš©ì ì •ë³´ ì—…ë°ì´íŠ¸
```
![](https://velog.velcdn.com/images/tlsalswls123/post/a5fd0d48-e968-43dc-84f9-fd853ad40ad7/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/21e8d331-a729-4f9c-b04d-ea39d309da9f/image.png)

### **3. Keycloak ì„¸ì…˜ì—ì„œ Argo CD í´ë¼ì´ì–¸íŠ¸ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/4c6ddfa4-e5da-40dc-af72-38b9e3a02464/image.png)

### **4. sign out**
![](https://velog.velcdn.com/images/tlsalswls123/post/e5ed682c-5b66-4cc4-aef7-0b661f044cbe/image.png)

---

## **ğŸ“˜ jenkins ì§ì ‘ íŒŒë“œë¡œ ë°°í¬**

### **1. Jenkins ë„¤ì„ìŠ¤í˜ì´ìŠ¤/PVC/Deployment/Service/Ingress ìƒì„±**

```bash
kubectl create ns jenkins

cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: jenkins-pvc
  namespace: jenkins
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: jenkins
  namespace: jenkins
spec:
  replicas: 1
  selector:
    matchLabels:
      app: jenkins
  template:
    metadata:
      labels:
        app: jenkins
    spec:
      securityContext:
        fsGroup: 1000
      containers:
        - name: jenkins
          image: jenkins/jenkins:lts
          ports:
            - name: http
              containerPort: 8080
            - name: agent
              containerPort: 50000
          volumeMounts:
            - name: jenkins-home
              mountPath: /var/jenkins_home
      volumes:
        - name: jenkins-home
          persistentVolumeClaim:
            claimName: jenkins-pvc
---
apiVersion: v1
kind: Service
metadata:
  name: jenkins-svc
  namespace: jenkins
spec:
  type: ClusterIP
  selector:
    app: jenkins
  ports:
    - port: 8080
      targetPort: http
      protocol: TCP
      name: http
    - port: 50000
      targetPort: agent
      protocol: TCP
      name: agent
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: jenkins-ingress
  namespace: jenkins
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "0"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "600"
spec:
  ingressClassName: nginx
  rules:
    - host: jenkins.example.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: jenkins-svc
                port:
                  number: 8080
EOF

namespace/jenkins created
persistentvolumeclaim/jenkins-pvc created
deployment.apps/jenkins created
service/jenkins-svc created
ingress.networking.k8s.io/jenkins-ingress created
```

### **2. Jenkins ë¦¬ì†ŒìŠ¤ ìƒíƒœ ë° PVC ë°”ì¸ë”© í™•ì¸**

```bash
kubectl get deploy,svc,ep,pvc -n jenkins

NAME                      READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/jenkins   1/1     1            1           40s

NAME                  TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)              AGE
service/jenkins-svc   ClusterIP   10.96.167.130   <none>        8080/TCP,50000/TCP   40s

NAME                    ENDPOINTS                            AGE
endpoints/jenkins-svc   10.244.0.29:50000,10.244.0.29:8080   40s

NAME                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/jenkins-pvc   Bound    pvc-74ef6288-9211-470f-be55-a26f4628edcc   10Gi       RWO            standard       <unset>                 40s
```

```bash
kubectl get ingress -n jenkins jenkins-ingress

NAME              CLASS   HOSTS                 ADDRESS     PORTS   AGE
jenkins-ingress   nginx   jenkins.example.com   localhost   80      62s
```

### **3. /etc/hosts ë“±ë¡ìœ¼ë¡œ ë¡œì»¬ ë¸Œë¼ìš°ì €ì—ì„œ ë„ë©”ì¸ ì ‘ì† ì¤€ë¹„**

```bash
echo "127.0.0.1 jenkins.example.com" | sudo tee -a /etc/hosts

127.0.0.1 jenkins.example.com
```

### **4. Jenkins ì´ˆê¸° ì•”í˜¸ í™•ì¸ ë° ìµœì´ˆ ì„¤ì •**

```bash
kubectl exec -it -n jenkins deploy/jenkins -- cat /var/jenkins_home/secrets/initialAdminPassword

1e92cb3d52a84da08d5ed47d564d2af1
```

```bash
http://jenkins.example.com
```

**(1) ì´ˆê¸°ì•”í˜¸ ì…ë ¥**
![](https://velog.velcdn.com/images/tlsalswls123/post/9336a85c-9e6e-44b8-bab1-a7ab4f2a4ab5/image.png)

**(2) Install suggested plugins**
![](https://velog.velcdn.com/images/tlsalswls123/post/cf265d12-36b4-4e7e-b07f-8197dee890cd/image.png)

**(3) Create First Admin User**

```bash
# ê´€ë¦¬ì ê³„ì •ì„¤ì •
Username: admin
Password: qwe123
```
![](https://velog.velcdn.com/images/tlsalswls123/post/377df534-aeb6-4b54-a1fb-0e2932d9e605/image.png)

### **5. in-cluster í†µì‹ ì„ ê³ ë ¤í•œ Jenkins ë„ë©”ì¸ ì„¤ì • ë° CoreDNS ì—°ë™**

**(1) Jenkins Service ClusterIP ë©”ëª¨**

```bash
kubectl get svc -n jenkins

NAME          TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)              AGE
jenkins-svc   ClusterIP   10.96.167.130   <none>        8080/TCP,50000/TCP   23m
```

**(2) CoreDNS hosts í”ŒëŸ¬ê·¸ì¸ì— Jenkins ë„ë©”ì¸ ì¶”ê°€**

```bash
kubectl edit cm -n kube-system coredns

.:53 {
       ...
        kubernetes cluster.local in-addr.arpa ip6.arpa {
           pods insecure
           fallthrough in-addr.arpa ip6.arpa
           ttl 30
        }
        hosts {
           <CLUSTER IP> keycloak.example.com
           <CLUSTER IP> argocd.example.com
           <CLUSTER IP> jenkins.example.com
           fallthrough
        }
...
```
![](https://velog.velcdn.com/images/tlsalswls123/post/07af0143-29ef-4892-84bc-00dd4a953595/image.png)

---

## **ğŸ”‘ keycloakì— jenkinsë¥¼ ìœ„í•œ client ìƒì„±**

### **1. ê¸°ë³¸ ì„¤ì •**

```bash
Client ID : jenkins
Name : jenkins client
```
![](https://velog.velcdn.com/images/tlsalswls123/post/ce96fd9d-e04b-4326-a1a0-48720104822b/image.png)

### **2. ì¸ì¦ ë° í”Œë¡œìš° ì„¤ì •**

```bash
Client authentication : Check
Authentication flow : Standard flow
```
![](https://velog.velcdn.com/images/tlsalswls123/post/910a3830-98ff-406f-beeb-94abbad42f6d/image.png)

### **3. ë¡œê·¸ì¸ ì…‹íŒ…**

```bash
Root URL : http://jenkins.example.com/
Home URL : http://jenkins.example.com/
Valid redirect URIs : http://jenkins.example.com/securityRealm/finishLogin
Valid post logout redirect URIs : http://jenkins.example.com
Web origins : +
```
![](https://velog.velcdn.com/images/tlsalswls123/post/eb03c500-c749-4f76-aba8-7c7920ed24cf/image.png)

### **4. Credentials ë©”ëª¨**

```bash
78sizpZAEGkf2MxdwyUkopdgA94ysahc
```
![](https://velog.velcdn.com/images/tlsalswls123/post/954b776e-ea1e-4d80-9eed-bbfcd671b444/image.png)

---

## **ğŸ›°ï¸ Configuring Jenkins OIDC**

- [https://plugins.jenkins.io/oic-auth/](https://plugins.jenkins.io/oic-auth/)

### **1. OpenID Connect Authentication í”ŒëŸ¬ê·¸ì¸ ì„¤ì¹˜**
![](https://velog.velcdn.com/images/tlsalswls123/post/83cc5c2c-21a5-4386-bf6f-64744cd1c9d6/image.png)

### **2. Jenkins ë³´ì•ˆ ì„¤ì •ì—ì„œ OIDC ì‚¬ìš© ì„¤ì •**

```bash
Manage Jenkins â†’ Security : Security Realm ì„¤ì • â†’ í•˜ë‹¨ Save
Login with Openid Connect
Client id : jenkins
Client secret : <keycloak ì—ì„œ jenkins client ì—ì„œ credentials>
Configuration mode : Discoveryâ€¦
- Well-know configuration endpoint http://keycloak.example.com/realms/myrealm/.well-known/openid-configuration
- Override scopes : openid email profile
Logout from OpenID Provider : Check
Security configuration
- Disable ssl verification : Check
```
![](https://velog.velcdn.com/images/tlsalswls123/post/05e2f5c9-fd87-4e4b-bf66-ad5640cbe79c/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/99c164ca-07c7-464f-bdb6-7e5fe8993bb3/image.png)

### **3. Keycloak ì—°ë™ ë¡œê·¸ì¸ ë™ì‘ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/1a6eb3fd-368d-4f6a-be9e-34a478c1427b/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/9cda860a-43cb-44ad-a579-703be08f973c/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/51a483fc-19a5-48dc-b1f7-0eb275cb759d/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/28850d8d-7a9d-487e-9ae2-b9b81500172d/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/ba4c1c99-0827-4e58-90be-f932b52e3e4d/image.png)

- ì´ë¯¸ ë¸Œë¼ìš°ì €ì— `alice` ë¡œ Keycloak ì„¸ì…˜ì´ ì‚´ì•„ìˆëŠ” ìƒíƒœë¼ì„œ login via keyclock í´ë¦­í–ˆë”ë‹ˆ ë°”ë¡œ ì§„ì…

### **4. Keycloak ì„¸ì…˜ì—ì„œ Jenkins/Argo CD ë™ì‹œ ì—°ë™ ìƒíƒœ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/ec95c156-48ef-404c-908e-01591e0742ec/image.png)

### **5. Jenkins / Argo CD ì‚¬ìš©ì ì •ë³´ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/9aab8dcb-51b9-4680-b92e-ba8b33603607/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/1f3eabf6-e75e-4fec-b476-d2f71a4472bf/image.png)

---

## **ğŸ—‚ï¸ LDAP(Lightweight Directory Access Protocol)**

### **1. LDAP ì„ íšŒì‚¬ ì£¼ì†Œë¡ + ì¶œì…ì¦ ì‹œìŠ¤í…œìœ¼ë¡œ ë¹„ìœ **

- ì‰½ê²Œ ë§í•´, â€œì¡°ì§ ë‚´ ì‚¬ìš©ì, ê·¸ë£¹, ê¶Œí•œ ë“±ì˜ ì •ë³´ë¥¼ íŠ¸ë¦¬ êµ¬ì¡°ë¡œ ì €ì¥í•˜ê³  ì¡°íšŒí•˜ëŠ” ì‹œìŠ¤í…œâ€

```bash
dc=example,dc=org     # Base DN(Root DN)
 â”œâ”€â”€ ou=people
 â”‚    â”œâ”€â”€ uid=alice
 â”‚    â””â”€â”€ uid=bob
 â””â”€â”€ ou=groups
      â”œâ”€â”€ cn=devs
      â””â”€â”€ cn=admins
```

### **2. ì‚¬ì „ ì‘ì—… : Keycloak ì—ì„œ alice ì‚¬ìš©ì ì •ë¦¬**
![](https://velog.velcdn.com/images/tlsalswls123/post/21f9b3e7-d484-435a-8e5a-cc1eb5610dd7/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/20cce899-d1fe-4d30-989e-0719a5168d18/image.png)

### **3. OpenLDAP + phpLDAPadmin K8s ë°°í¬**

- [https://www.openldap.org/](https://www.openldap.org/)

```bash
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Namespace
metadata:
  name: openldap
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: openldap
  namespace: openldap
spec:
  replicas: 1
  selector:
    matchLabels:
      app: openldap
  template:
    metadata:
      labels:
        app: openldap
    spec:
      containers:
        - name: openldap
          image: osixia/openldap:1.5.0
          ports:
            - containerPort: 389
              name: ldap
            - containerPort: 636
              name: ldaps
          env:
            - name: LDAP_ORGANISATION    # ê¸°ê´€ëª…, LDAP ê¸°ë³¸ ì •ë³´ ìƒì„± ì‹œ ì‚¬ìš©
              value: "Example Org"
            - name: LDAP_DOMAIN          # LDAP ê¸°ë³¸ Base DN ì„ ìë™ ìƒì„±
              value: "example.org"
            - name: LDAP_ADMIN_PASSWORD  # LDAP ê´€ë¦¬ì íŒ¨ìŠ¤ì›Œë“œ
              value: "admin"
            - name: LDAP_CONFIG_PASSWORD
              value: "admin"
        - name: phpldapadmin
          image: osixia/phpldapadmin:0.9.0
          ports:
            - containerPort: 80
              name: phpldapadmin
          env:
            - name: PHPLDAPADMIN_HTTPS
              value: "false"
            - name: PHPLDAPADMIN_LDAP_HOSTS
              value: "openldap"   # LDAP hostname inside cluster
---
apiVersion: v1
kind: Service
metadata:
  name: openldap
  namespace: openldap
spec:
  selector:
    app: openldap
  ports:
    - name: phpldapadmin
      port: 80
      targetPort: 80
      nodePort: 30000
    - name: ldap
      port: 389
      targetPort: 389
    - name: ldaps
      port: 636
      targetPort: 636
  type: NodePort
EOF

namespace/openldap created
deployment.apps/openldap created
service/openldap created
```

```bash
kubectl get deploy,pod,svc,ep -n openldap

NAME                       READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/openldap   1/1     1            1           33s

NAME                            READY   STATUS    RESTARTS   AGE
pod/openldap-54857b746c-rnwvf   2/2     Running   0          33s

NAME               TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                                    AGE
service/openldap   NodePort   10.96.59.112   <none>        80:30000/TCP,389:32686/TCP,636:30808/TCP   33s

NAME                 ENDPOINTS                                        AGE
endpoints/openldap   10.244.0.30:80,10.244.0.30:389,10.244.0.30:636   33s
```

```bash
# ê¸°ë³¸ LDAP ì •ë³´ : ì•„ë˜ Bind DNê³¼ PWë¡œ ë¡œê·¸ì¸
## Base DN: dc=example,dc=org
## Bind DN: cn=admin,dc=example,dc=org
## Password: admin
http://127.0.0.1:30000
```
![](https://velog.velcdn.com/images/tlsalswls123/post/1824302d-6529-49b2-b2bd-4df1bddabd86/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/38e8f92e-5732-4a28-b374-0239bc2e00fb/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/10937739-d062-4445-a437-197b55f43299/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/6fdb189e-585f-48aa-b6dd-f83a4e58b036/image.png)

### **4. OpenLDAP ì»¨í…Œì´ë„ˆ ë‚´ë¶€ í”„ë¡œì„¸ìŠ¤ í™•ì¸**

**(1) openldap ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì§„ì…**

```bash
kubectl -n openldap exec -it deploy/openldap -c openldap -- bash
root@openldap-54857b746c-rnwvf:/# 
```

**(2) slapd ë°ëª¬ í”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬ í™•ì¸**

```bash
root@openldap-54857b746c-rnwvf:/# pstree -aplpst

run,1 -u /container/tool/run
  â””â”€slapd,440 -h ldap://openldap-54857b746c-rnwvf:389 ldaps://openldap-54857b746c-rnwvf:636 ldapi:/// -u openldap -g openldap -d 256
      â”œâ”€{slapd},443
      â”œâ”€{slapd},444
      â””â”€{slapd},445
```

### **5. LDAP ê´€ë¦¬ì ì¸ì¦ ë° ê¸°ë³¸ ì—”íŠ¸ë¦¬ ì¡°íšŒ í…ŒìŠ¤íŠ¸**

```bash
root@openldap-54857b746c-rnwvf:/# ldapsearch -x -H ldap://localhost:389 -b dc=example,dc=org -D "cn=admin,dc=example,dc=org" -w admin

# extended LDIF
#
# LDAPv3
# base <dc=example,dc=org> with scope subtree
# filter: (objectclass=*)
# requesting: ALL
#

# example.org
dn: dc=example,dc=org
objectClass: top
objectClass: dcObject
objectClass: organization
o: Example Org
dc: example

# search result
search: 2
result: 0 Success

# numResponses: 2
# numEntries: 1
```

### **6. ì‹¤ìŠµìš© ìµœì¢… LDAP íŠ¸ë¦¬ êµ¬ì¡° ì„¤ê³„**

```bash
dc=example,dc=org
â”œâ”€â”€ ou=people
â”‚   â”œâ”€â”€ uid=alice
â”‚   â”‚   â”œâ”€â”€ cn: Alice
â”‚   â”‚   â”œâ”€â”€ sn: Kim
â”‚   â”‚   â”œâ”€â”€ uid: alice
â”‚   â”‚   â””â”€â”€ mail: alice@example.org
â”‚   â””â”€â”€ uid=bob
â”‚       â”œâ”€â”€ cn: Bob
â”‚       â”œâ”€â”€ sn: Lee
â”‚       â”œâ”€â”€ uid: bob
â”‚       â””â”€â”€ mail: bob@example.org
â””â”€â”€ ou=groups
    â”œâ”€â”€ cn=devs
    â”‚   â””â”€â”€ member: uid=bob,ou=people,dc=example,dc=org
    â””â”€â”€ cn=admins
        â””â”€â”€ member: uid=alice,ou=people,dc=example,dc=org
```

### **7. ldapadd ë¡œ OU(organizationalUnit) ìƒì„±**

```bash
root@openldap-54857b746c-rnwvf:/# cat <<EOF | ldapadd -x -D "cn=admin,dc=example,dc=org" -w admin
> dn: ou=people,dc=example,dc=org
> objectClass: organizationalUnit
> ou: people
> 
> dn: ou=groups,dc=example,dc=org
> objectClass: organizationalUnit
> ou: groups
> EOF

adding new entry "ou=people,dc=example,dc=org"
adding new entry "ou=groups,dc=example,dc=org"
```
![](https://velog.velcdn.com/images/tlsalswls123/post/48513f2d-3516-46de-bcec-a6c089e49c47/image.png)

### **8. ldapadd ë¡œ ì‚¬ìš©ì(alice, bob) ì¶”ê°€ (inetOrgPerson)**

```bash
root@openldap-54857b746c-rnwvf:/# cat <<EOF | ldapadd -x -D "cn=admin,dc=example,dc=org" -w admin
> dn: uid=alice,ou=people,dc=example,dc=org
> objectClass: inetOrgPerson
> cn: Alice
> sn: Kim
> uid: alice
> mail: alice@example.org
> userPassword: alice123
> 
> dn: uid=bob,ou=people,dc=example,dc=org
> objectClass: inetOrgPerson
> cn: Bob
> sn: Lee
> uid: bob
> mail: bob@example.org
> userPassword: bob123
> EOF

adding new entry "uid=alice,ou=people,dc=example,dc=org"
adding new entry "uid=bob,ou=people,dc=example,dc=org"
```
![](https://velog.velcdn.com/images/tlsalswls123/post/b5e5ca5b-3c97-4132-ae56-94804a220fe8/image.png)

### **9. ldapadd ë¡œ ê·¸ë£¹(devs, admins) ì¶”ê°€ (groupOfNames)**

```bash
root@openldap-54857b746c-rnwvf:/# cat <<EOF | ldapadd -x -D "cn=admin,dc=example,dc=org" -w admin
> dn: cn=devs,ou=groups,dc=example,dc=org
> objectClass: groupOfNames
> cn: devs
> member: uid=bob,ou=people,dc=example,dc=org
> 
> dn: cn=admins,ou=groups,dc=example,dc=org
> objectClass: groupOfNames
> cn: admins
> member: uid=alice,ou=people,dc=example,dc=org
> EOF

adding new entry "cn=devs,ou=groups,dc=example,dc=org"
adding new entry "cn=admins,ou=groups,dc=example,dc=org"
```
![](https://velog.velcdn.com/images/tlsalswls123/post/18ec179b-6537-49d6-8451-8bbdf98386bd/image.png)

### **10. ldapsearch ë¡œ OU / ì‚¬ìš©ì / ê·¸ë£¹ ì¡°íšŒ**

**(1) OU ëª©ë¡ ì¡°íšŒ**

```bash
root@openldap-54857b746c-rnwvf:/# ldapsearch -x -D "cn=admin,dc=example,dc=org" -w admin \
>   -b "dc=example,dc=org" "(objectClass=organizationalUnit)" ou

# extended LDIF
#
# LDAPv3
# base <dc=example,dc=org> with scope subtree
# filter: (objectClass=organizationalUnit)
# requesting: ou 
#

# people, example.org
dn: ou=people,dc=example,dc=org
ou: people

# groups, example.org
dn: ou=groups,dc=example,dc=org
ou: groups

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
```

**(2) ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ**

```bash
root@openldap-54857b746c-rnwvf:/# ldapsearch -x -D "cn=admin,dc=example,dc=org" -w admin \
>   -b "ou=people,dc=example,dc=org" "(uid=*)" uid cn mail

# extended LDIF
#
# LDAPv3
# base <ou=people,dc=example,dc=org> with scope subtree
# filter: (uid=*)
# requesting: uid cn mail 
#

# bob, people, example.org
dn: uid=bob,ou=people,dc=example,dc=org
cn: Bob
uid: bob
mail: bob@example.org

# alice, people, example.org
dn: uid=alice,ou=people,dc=example,dc=org
cn: Alice
uid: alice
mail: alice@example.org

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
```

**(3) ê·¸ë£¹ ë° ë©¤ë²„ ê´€ê³„ ì¡°íšŒ**

```bash
root@openldap-54857b746c-rnwvf:/# ldapsearch -x -D "cn=admin,dc=example,dc=org" -w admin \
>   -b "ou=groups,dc=example,dc=org" "(objectClass=groupOfNames)" cn member

# extended LDIF
#
# LDAPv3
# base <ou=groups,dc=example,dc=org> with scope subtree
# filter: (objectClass=groupOfNames)
# requesting: cn member 
#

# devs, groups, example.org
dn: cn=devs,ou=groups,dc=example,dc=org
cn: devs
member: uid=bob,ou=people,dc=example,dc=org

# admins, groups, example.org
dn: cn=admins,ou=groups,dc=example,dc=org
cn: admins
member: uid=alice,ou=people,dc=example,dc=org

# search result
search: 2
result: 0 Success

# numResponses: 3
# numEntries: 2
```

### **11. LDAP ì‚¬ìš©ì(alice) ì¸ì¦ í…ŒìŠ¤íŠ¸**

```bash
root@openldap-54857b746c-rnwvf:/# ldapwhoami -x -D "uid=alice,ou=people,dc=example,dc=org" -w alice123

dn:uid=alice,ou=people,dc=example,dc=org
```

---

## **ğŸ”— KeyCloakì—ì„œ LDAP ì„¤ì • ì‹¤ìŠµ**

### **1. myrealm ì— LDAP Provider ì¶”ê°€**

```bash
[Realm] myrealm â†’ User Federation â†’ Add LDAP providers
```
![](https://velog.velcdn.com/images/tlsalswls123/post/a5948d49-c3ba-41e1-8777-ed3bb79bfcff/image.png)

```bash
UI display name: ldap
Vendor: Other
Connection URL:  ldap://openldap.openldap.svc:389
Bind DN: (= Login DN) cn=admin,dc=example,dc=org
Bind Credential: admin â‡’ Test authentication
```
![](https://velog.velcdn.com/images/tlsalswls123/post/34dcfe5a-7fd1-4fe8-9825-683491150194/image.png)

```bash
Edit mode: WRITABLE
Users DN: ou=people,dc=example,dc=org
Username LDAP attribute: uid
RDN LDAP attribute: uid
UUID LDAP attribute: uid
User Object Classes: inetOrgPerson
Search scope: Subtree (OU í•˜ìœ„ ëª¨ë‘ íƒìƒ‰)
```
![](https://velog.velcdn.com/images/tlsalswls123/post/eb48287c-7a20-4827-b35d-6669f3e6579a/image.png)

```bash
Import Users: On (LDAP â†’ KeyCloak : Sync OK)
Sync Registrations: Off (KeyCloak â†’ LDAP : Sync OK)
```
![](https://velog.velcdn.com/images/tlsalswls123/post/ae16873e-e758-4a35-9f0a-0f7a54ffc17c/image.png)

### 2. LDAP Provider ì˜ Mappers í™•ì¸

```bash
User Federation â†’ LDAP Provider ì„ íƒ â†’ Mappers
: userì— ëŒ€í•œ Mappersê°€ ê¸°ë³¸ ì¡´ì¬
```
![](https://velog.velcdn.com/images/tlsalswls123/post/9b650e55-2087-4c53-a48f-a8d58e8e2011/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/a4584106-7054-48b1-994c-e484d1847365/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/f19e7b64-1b61-4167-bb6d-c29fc15e624f/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/f68bdf9d-888f-4d72-88c6-e4cf81305eea/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/27aabcc8-2a95-4d4e-9f66-c4c6708ee54a/image.png)

### **3. LDAP ì—°ë™ í›„ Argo CD / Jenkins ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**

**(1) Argo CD ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**

```bash
Argo CD ì— bob(ì•”í˜¸ bob123) ë¡œê·¸ì¸ ì‹œë„
â†’ ì´í›„ alice(ì•”í˜¸ alice123)ìœ¼ë¡œë„ ë¡œê·¸ì¸ ì‹œë„
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d69b0914-923d-4dae-b229-84e6f0968d1c/image.png)

**(2) Jenkins ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/da8b7bd0-b0db-4400-8297-fcf9cf90cc3e/image.png)

- Jenkins ëŠ” ì´ë¯¸ Keycloak OIDC ë¡œ ì—°ë™ëœ ìƒíƒœë¼ í™”ë©´ì—ì„œ ë³„ë‹¤ë¥¸ ì¶”ê°€ ë¡œê·¸ì¸ ì ˆì°¨ ì—†ì´ ëŒ€ì‹œë³´ë“œë¡œ ì§„ì…ë˜ëŠ” ê²ƒ í™•ì¸í•¨

**(3) Keycloak ì„¸ì…˜ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/824a6491-790e-48e2-9399-1a4434a7756f/image.png)

- Argo CD, Jenkins ì–‘ìª½ ëª¨ë‘ ë™ì¼í•œ Id(Predicate: uid)ë¥¼ ì‚¬ìš©í•´ SSO ê²½í—˜ì„ ì œê³µí•  ìˆ˜ ìˆëŠ” êµ¬ì¡°ê°€ ì™„ì„±ë¨

---

## **ğŸš§ Argo CD ì‚¬ìš©ì ì‚¬ìš© ì‹œë„ : LDAP devs ê·¸ë£¹ bob ê³„ì •**

### **1. ìƒ˜í”Œ ApplicationSetìœ¼ë¡œ guestbook ë‹¤ì¤‘ í´ëŸ¬ìŠ¤í„° ë°°í¬**

**(1) ApplicationSet ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: guestbook
  namespace: argocd
spec:
  goTemplate: true
  goTemplateOptions: ["missingkey=error"]
  generators:
  - clusters: {}
  template:
    metadata:
      name: '{{.name}}-guestbook'
      labels:
        managed-by: applicationset
    spec:
      project: "default"
      source:
        repoURL: https://github.com/gasida/cicd-study
        targetRevision: HEAD
        path: guestbook
      destination:
        server: '{{.server}}'
        namespace: guestbook
      syncPolicy:
        syncOptions:
          - CreateNamespace=true
EOF

applicationset.argoproj.io/guestbook created
```

**(2) ApplicationSet ë¼ë²¨ ê¸°ë°˜ ë™ê¸°í™” ì‹¤í–‰**

```bash
argocd app sync -l managed-by=applicationset

TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE
2025-11-19T00:03:17+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-19T00:03:17+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-19T00:03:17+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              deployment.apps/guestbook-ui created
2025-11-19T00:03:17+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              service/guestbook-ui created

Name:               argocd/dev-k8s-guestbook
Project:            default
Server:             https://172.18.0.3:6443
Namespace:          guestbook
URL:                https://argocd.example.com/applications/argocd/dev-k8s-guestbook
Source:
- Repo:             https://github.com/gasida/cicd-study
  Target:           HEAD
  Path:             guestbook
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to HEAD (b2894c6)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      b2894c67f7a64e42b408da5825cb0b87ee306b04
Phase:              Succeeded
Start:              2025-11-19 00:03:17 +0900 KST
Finished:           2025-11-19 00:03:17 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND        NAMESPACE  NAME          STATUS  HEALTH       HOOK  MESSAGE
       Service     guestbook  guestbook-ui  Synced  Healthy            service/guestbook-ui created
apps   Deployment  guestbook  guestbook-ui  Synced  Progressing        deployment.apps/guestbook-ui created
TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE
2025-11-19T00:03:18+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-19T00:03:18+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-19T00:03:18+09:00          Namespace                         guestbook   Running   Synced              namespace/guestbook created
2025-11-19T00:03:18+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              service/guestbook-ui created
2025-11-19T00:03:18+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              deployment.apps/guestbook-ui created

Name:               argocd/in-cluster-guestbook
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          guestbook
URL:                https://argocd.example.com/applications/argocd/in-cluster-guestbook
Source:
- Repo:             https://github.com/gasida/cicd-study
  Target:           HEAD
  Path:             guestbook
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to HEAD (b2894c6)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      b2894c67f7a64e42b408da5825cb0b87ee306b04
Phase:              Succeeded
Start:              2025-11-19 00:03:18 +0900 KST
Finished:           2025-11-19 00:03:18 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND        NAMESPACE  NAME          STATUS   HEALTH       HOOK  MESSAGE
       Namespace              guestbook     Running  Synced             namespace/guestbook created
       Service     guestbook  guestbook-ui  Synced   Healthy            service/guestbook-ui created
apps   Deployment  guestbook  guestbook-ui  Synced   Progressing        deployment.apps/guestbook-ui created
TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME    STATUS    HEALTH        HOOK  MESSAGE
2025-11-19T00:03:19+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-19T00:03:19+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              
2025-11-19T00:03:19+09:00            Service   guestbook          guestbook-ui  OutOfSync  Missing              service/guestbook-ui created
2025-11-19T00:03:19+09:00   apps  Deployment   guestbook          guestbook-ui  OutOfSync  Missing              deployment.apps/guestbook-ui created

Name:               argocd/prd-k8s-guestbook
Project:            default
Server:             https://172.18.0.4:6443
Namespace:          guestbook
URL:                https://argocd.example.com/applications/argocd/prd-k8s-guestbook
Source:
- Repo:             https://github.com/gasida/cicd-study
  Target:           HEAD
  Path:             guestbook
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to HEAD (b2894c6)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      b2894c67f7a64e42b408da5825cb0b87ee306b04
Phase:              Succeeded
Start:              2025-11-19 00:03:19 +0900 KST
Finished:           2025-11-19 00:03:19 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND        NAMESPACE  NAME          STATUS  HEALTH       HOOK  MESSAGE
       Service     guestbook  guestbook-ui  Synced  Healthy            service/guestbook-ui created
apps   Deployment  guestbook  guestbook-ui  Synced  Progressing        deployment.apps/guestbook-ui created
```

### **2. ê° í´ëŸ¬ìŠ¤í„°ì— ë°°í¬ëœ guestbook íŒŒë“œ ìƒíƒœ í™•ì¸**

```bash
k8s1 get pod -n guestbook # mgmt
k8s2 get pod -n guestbook # dev
k8s3 get pod -n guestbook # prd

NAME                            READY   STATUS    RESTARTS   AGE
guestbook-ui-85db984648-8rch8   1/1     Running   0          32s

NAME                            READY   STATUS    RESTARTS   AGE
guestbook-ui-85db984648-k7wms   1/1     Running   0          33s

NAME                            READY   STATUS    RESTARTS   AGE
guestbook-ui-85db984648-7bb75   1/1     Running   0          32s
```

### **3. bob(LDAP devs ê·¸ë£¹) ê³„ì •ìœ¼ë¡œ Argo CD UI ì ‘ì† ê²°ê³¼**

**(1) Applications í™”ë©´**
![](https://velog.velcdn.com/images/tlsalswls123/post/3c59a779-f7f7-40a7-8a2c-d28c2eff85d0/image.png)

- ì‹¤ì œë¡œëŠ” `dev-k8s-guestbook`, `in-cluster-guestbook`, `prd-k8s-guestbook`ì´ ì¡´ì¬í•˜ì§€ë§Œ bob ê³„ì • ì…ì¥ì—ì„œëŠ” ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆëŠ” ìƒíƒœë¡œ ë³´ì„

**(2) Clusters í™”ë©´**
![](https://velog.velcdn.com/images/tlsalswls123/post/bb00fbeb-000a-47d6-87e4-a6b24f78985f/image.png)

- mgmt, dev, prd í´ëŸ¬ìŠ¤í„° ëª¨ë‘ ì—°ê²°ë˜ì–´ ìˆì§€ë§Œ bob ê¶Œí•œìœ¼ë¡œëŠ” ì¡°íšŒ ë¶ˆê°€í•¨

---

## **ğŸ‘¥ OpenLDAP ê·¸ë£¹ ì •ë³´ë¥¼ Keycloak ë™ê¸°í™”**

### **1. LDAP Provider ì§„ì…**

```bash
Keycloak myrealm â†’ User Federation â†’ LDAP Provider ì§„ì… í›„
Mappers íƒ­ì—ì„œ Add mapper í´ë¦­
```
![](https://velog.velcdn.com/images/tlsalswls123/post/b7b5d75d-2ea0-4750-b432-6e34ea661bba/image.png)

### **2. Mapper ì„¤ì •**

```bash
name : ldap-groups
Mapper type: group-ldap-mapper
LDAP Groups DN : ou=groups,dc=example,dc=org
Group Name LDAP Attribute: cn
Group Object Classed: groupOfNames
Membership LDAP attribute: member
Membership attribute type: DN
Mode: READ_ONLY
```
![](https://velog.velcdn.com/images/tlsalswls123/post/bd6274f9-5bda-443c-bff5-3437f1f4da91/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/3e9352aa-cca0-4d3d-8b44-c655582f8d51/image.png)

### **3. Sync LDAP groups to Keycloak**
![](https://velog.velcdn.com/images/tlsalswls123/post/8eff1f15-8cd4-4d13-b4cc-39aa5d523047/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/f604ddac-0bdd-420c-9ae1-1f0c85061bce/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/8b322691-bbeb-4871-a33e-76b14326bbf4/image.png)

---

## **ğŸŒ€ Keycloakì—ì„œ í† í°ì— Group ì „ë‹¬ì„ ìœ„í•œ ì„¤ì • : ArgoCD Client ì„¤ì •**

### **1. groups Client Scope ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/adeb0a18-d871-474d-9fc8-88823d924828/image.png)

Name (groups), ë‚˜ë¨¸ì§€ëŠ” ê¸°ë³¸ê°’
![](https://velog.velcdn.com/images/tlsalswls123/post/2a146221-c455-4b74-a96b-6334b79503ab/image.png)

### **2. groups Scopeì— Group Membership ë§¤í¼ ì¶”ê°€**

**í•´ë‹¹ client scopesì—ì„œ mappers í´ë¦­ â†’ [Configure a new mapper] í´ë¦­**
![](https://velog.velcdn.com/images/tlsalswls123/post/9c7e53ec-4d6a-4be6-9547-58622a3a4a10/image.png)

**'Group Membership' ì„ íƒ í›„ Name, Token Claim Name ì— groups ì…ë ¥**
![](https://velog.velcdn.com/images/tlsalswls123/post/a07f4456-0a7f-4840-a0c8-cd55c37f771a/image.png)

### **3. argocd í´ë¼ì´ì–¸íŠ¸ì— groups Scope ì—°ê²°**

**clientsì—ì„œ argocd í´ë¦­**
![](https://velog.velcdn.com/images/tlsalswls123/post/f5e76b33-1e0d-44e1-9bea-8ddcd29eb879/image.png)

**[Client scopes] íƒ­ ì´ë™**
![](https://velog.velcdn.com/images/tlsalswls123/post/3df2b392-729a-46c6-bf81-a82b26eb095d/image.png)

**Add client scope í´ë¦­ í›„ ìƒì„±í•œ groups ì„ íƒ / [Add] ì„ íƒ í›„ ë“œë¡­ë‹¤ìš´ì˜ Default ì„ íƒ**
![](https://velog.velcdn.com/images/tlsalswls123/post/fa11129d-9ed2-4e27-9197-a610f0a7e254/image.png)

### **4. Argo CD OIDC ì„¤ì •ì— groups scope ì¶”ê°€**

```bash
kubectl edit cm -n argocd argocd-cm

...
    requestedScopes: ["openid", "profile", "email" , "groups"]
-> ì ìš©ì„ ìœ„í•´ì„œ 15ì´ˆ ì •ë„ í›„ì— ì•„ë˜ ë¡œê·¸ì¸ ì§„í–‰

configmap/argocd-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/9dfc248d-a2be-4557-a7a5-918d7510e79b/image.png)

### **5. ê²°ê³¼ í™•ì¸**

**scopeì— groupsê°€ ì¶”ê°€ë¨**
![](https://velog.velcdn.com/images/tlsalswls123/post/b6618a44-3e95-4328-ab68-c87ced860f53/image.png)

**user infoì— groupì´ ì¶”ê°€ë¨**
![](https://velog.velcdn.com/images/tlsalswls123/post/5bcf8a9f-1aa7-4e0c-be4a-88d577e787c5/image.png)

**í•˜ì§€ë§Œ Argo CD í™”ë©´ì—ì„œëŠ” ì—¬ì „íˆ Applications, Clustersê°€ ë³´ì´ì§€ ì•ŠìŒ**
![](https://velog.velcdn.com/images/tlsalswls123/post/c8b48db8-6c0e-4335-a26c-5afac69db351/image.png)

---

## **ğŸ§‘â€âš–ï¸ Argo CD RBAC í• ë‹¹**

### **1. Argo CD RBAC ì„¤ì • ConfigMap ìˆ˜ì •**

```bash
kubectl edit cm argocd-rbac-cm -n argocd
...
data:
  policy.csv: |
    g, devs, role:admin
...

configmap/argocd-rbac-cm edited
```
![](https://velog.velcdn.com/images/tlsalswls123/post/6d301d16-f000-42a7-ae4c-6025ae266df1/image.png)

- `g, <ê·¸ë£¹ëª…>, <ì—­í• >` í˜•ì‹ì˜ RBAC ê·œì¹™
- `devs` ê·¸ë£¹ì— ì†í•œ ì‚¬ìš©ìëŠ” ëª¨ë‘ `role:admin` ê¶Œí•œì„ ê°€ì§

### **2. ì ìš© ê²°ê³¼ í™•ì¸**
![](https://velog.velcdn.com/images/tlsalswls123/post/ca6f10e0-13cc-444f-96b8-e6da02843ac7/image.png)

---

## **ğŸªª Jenkinsì˜ OIDC ì¸ì¦ ì‹œ scopeì— groups ì¶”ê°€ ì„¤ì •**

### **1. jenkins í´ë¼ì´ì–¸íŠ¸ì— groups scope ì¶”ê°€**

**jenkins client ì—ì„œ add client scope í´ë¦­ í›„ groupsë¥¼ default ë¡œ ì¶”ê°€**
![](https://velog.velcdn.com/images/tlsalswls123/post/623be0dd-e61d-4121-9ad3-640d663f2946/image.png)

### **2. Jenkins OIDC ì„¤ì •ì—ì„œ groups scope ë°˜ì˜**

**ì„¤ì • â†’ Security â†’ ì•„ë˜ ì²˜ëŸ¼ scopesì— groupsì™€ groups fileld nameì— groups ì¶”ê°€**
![](https://velog.velcdn.com/images/tlsalswls123/post/8a870ada-5ef7-459f-a29e-dccfcf52a67b/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/e94870bd-744e-4f08-ae8f-51acc1e3bad6/image.png)

**ë‹¤ì‹œ ë¡œê·¸ì¸í•˜ë©´ ì‚¬ìš©ì ìƒì„¸ í™”ë©´ì— Groups í•­ëª©ì´ í‘œì‹œ**
![](https://velog.velcdn.com/images/tlsalswls123/post/1c0c6ddf-46f9-45c1-82ec-f9c1a162155b/image.png)

### **3. ì •ë¦¬ ì‘ì—…**

**(1) kind ë¡œ ë§Œë“  ì„¸ ê°œì˜ í´ëŸ¬ìŠ¤í„° ì‚­ì œ**

```bash
kind delete cluster --name mgmt ; kind delete cluster --name dev ; kind delete cluster --name prd

Deleting cluster "mgmt" ...
Deleted nodes: ["mgmt-control-plane"]
Deleting cluster "dev" ...
Deleted nodes: ["dev-control-plane"]
Deleting cluster "prd" ...
Deleted nodes: ["prd-control-plane"]
```

**(2) `/etc/hosts` ì— ì¶”ê°€í–ˆë˜ ì‹¤ìŠµ ë„ë©”ì¸ ì œê±°**
