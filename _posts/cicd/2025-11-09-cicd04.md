---
title: CI/CD 4ì£¼ì°¨ ì •ë¦¬
date: 2025-11-09 01:00:00 +0900
categories: [CI/CD]
tags: [CI/CD]
---

## **ğŸŒŠ ê¹ƒì˜µìŠ¤ì™€ ì¿ ë²„ë„¤í‹°ìŠ¤**

### **1. kind í´ëŸ¬ìŠ¤í„° ìƒì„± ë° ê¸°ë³¸ í™˜ê²½ êµ¬ì„±**

```bash
kind create cluster --name myk8s --image kindest/node:v1.32.8 --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  - containerPort: 30003
    hostPort: 30003
EOF

# ê²°ê³¼
Creating cluster "myk8s" ...
 âœ“ Ensuring node image (kindest/node:v1.32.8) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-myk8s"
You can now use your cluster with:

kubectl cluster-info --context kind-myk8s

Thanks for using kind!
```

### **2. kube-ops-view ì„¤ì¹˜**

```bash
helm repo add geek-cookbook https://geek-cookbook.github.io/charts/
helm install kube-ops-view geek-cookbook/kube-ops-view --version 1.2.2 --set service.main.type=NodePort,service.main.ports.http.nodePort=30001 --set env.TZ="Asia/Seoul" --namespace kube-system
```
![](https://velog.velcdn.com/images/tlsalswls123/post/6bf8ec7f-4dbe-4878-865d-b3457ac785c1/image.png)

### **3. GitOps ì‹¤ìŠµìš© ì†ŒìŠ¤ì½”ë“œ ë‹¤ìš´ë¡œë“œ**

```bash
git clone https://github.com/PacktPublishing/ArgoCD-in-Practice.git
cd ArgoCD-in-Practice/ch01/basic-gitops-operator/
```

### **4. GitOps ì˜¤í¼ë ˆì´í„° ì‹¤í–‰ ë° ìƒíƒœ í™•ì¸**

**(1) GitOps ì˜¤í¼ë ˆì´í„° êµ¬ë™**

```bash
go run main.go

# ê²°ê³¼
 next sync in 5s 
start repo sync
start manifests apply
deployment.apps/nginx unchanged
namespace/nginx unchanged

 next sync in 5s 
start repo sync
start manifests apply
deployment.apps/nginx unchanged
namespace/nginx unchanged

 next sync in 5s 
start repo sync
start manifests apply
deployment.apps/nginx unchanged
namespace/nginx unchanged

 next sync in 5s 
start repo sync
start manifests apply
deployment.apps/nginx unchanged
namespace/nginx unchanged

...
```
![](https://velog.velcdn.com/images/tlsalswls123/post/a4e94607-77fe-49c2-bcf1-85fbab7414fc/image.png)

**(2) ë¦¬ì†ŒìŠ¤ ìƒì„± í™•ì¸**

```bash
kubectl get deploy,pod -n nginx

NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx   1/1     1            1           2m26s

NAME                         READY   STATUS    RESTARTS   AGE
pod/nginx-5869d7778c-xfthr   1/1     Running   0          2m26s
```

### **5. ë¦¬ì†ŒìŠ¤ ê°•ì œ ì‚­ì œ í›„ ìë™ ë³µêµ¬ í™•ì¸**

**(1) Deployment ìˆ˜ë™ ì‚­ì œ**

```bash
kubectl delete deploy -n nginx nginx
deployment.apps "nginx" deleted from nginx namespace
```

**(2) Deployment ìë™ìœ¼ë¡œ ì¬ìƒì„±**

```bash
kubectl get deploy,pod -n nginx

NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/nginx   1/1     1            1           12s

NAME                         READY   STATUS    RESTARTS   AGE
pod/nginx-5869d7778c-jhkpc   1/1     Running   0          12s
```

- GitOpsì˜ ìê¸°ë³µêµ¬(Self-healing) ë©”ì»¤ë‹ˆì¦˜ ê²€ì¦

### **6. ì‹¤ìŠµ ë¦¬ì†ŒìŠ¤ ì •ë¦¬**

```bash
kubectl delete ns nginx
namespace "nginx" deleted
```

---

## **âš“ Argo CD ì„¤ì¹˜ by Helm**

### **1. Argo CDìš© Namespace ë° Helm values íŒŒì¼ ìƒì„±**

```bash
cd ../..

kubectl create ns argocd

cat <<EOF > argocd-values.yaml
server:
  service:
    type: NodePort
    nodePortHttps: 30002
  extraArgs:
    - --insecure  # HTTPS ëŒ€ì‹  HTTP ì‚¬ìš©
EOF
```

### **2. Helmì„ ì´ìš©í•œ Argo CD ì„¤ì¹˜**

```bash
helm repo add argo https://argoproj.github.io/argo-helm
helm install argocd argo/argo-cd --version 9.0.5 -f argocd-values.yaml --namespace argocd
```

### **3. Argo CD êµ¬ì„±ìš”ì†Œ ë° ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸**

```bash
kubectl get pod,svc,ep,secret,cm -n argocd

NAME                                                   READY   STATUS    RESTARTS   AGE
pod/argocd-application-controller-0                    1/1     Running   0          70s
pod/argocd-applicationset-controller-bbff79c6f-9psnw   1/1     Running   0          70s
pod/argocd-dex-server-6877ddf4f8-nr747                 1/1     Running   0          70s
pod/argocd-notifications-controller-7b5658fc47-vtj57   1/1     Running   0          70s
pod/argocd-redis-7d948674-tmg72                        1/1     Running   0          70s
pod/argocd-repo-server-7679dc55f5-z9x7q                1/1     Running   0          70s
pod/argocd-server-787fb5f956-hxbfc                     1/1     Running   0          70s

NAME                                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
service/argocd-applicationset-controller   ClusterIP   10.96.232.145   <none>        7000/TCP                     70s
service/argocd-dex-server                  ClusterIP   10.96.16.247    <none>        5556/TCP,5557/TCP            70s
service/argocd-redis                       ClusterIP   10.96.183.36    <none>        6379/TCP                     70s
service/argocd-repo-server                 ClusterIP   10.96.145.59    <none>        8081/TCP                     70s
service/argocd-server                      NodePort    10.96.86.67     <none>        80:30080/TCP,443:30002/TCP   70s

NAME                                         ENDPOINTS                           AGE
endpoints/argocd-applicationset-controller   10.244.0.13:7000                    70s
endpoints/argocd-dex-server                  10.244.0.12:5557,10.244.0.12:5556   70s
endpoints/argocd-redis                       10.244.0.10:6379                    70s
endpoints/argocd-repo-server                 10.244.0.14:8081                    70s
endpoints/argocd-server                      10.244.0.16:8080,10.244.0.16:8080   70s

NAME                                  TYPE                 DATA   AGE
secret/argocd-initial-admin-secret    Opaque               1      68s
secret/argocd-notifications-secret    Opaque               0      70s
secret/argocd-redis                   Opaque               1      74s
secret/argocd-secret                  Opaque               3      70s
secret/sh.helm.release.v1.argocd.v1   helm.sh/release.v1   1      96s

NAME                                      DATA   AGE
configmap/argocd-cm                       18     70s
configmap/argocd-cmd-params-cm            20     70s
configmap/argocd-gpg-keys-cm              0      70s
configmap/argocd-notifications-cm         1      70s
configmap/argocd-rbac-cm                  4      70s
configmap/argocd-redis-health-configmap   2      70s
configmap/argocd-ssh-known-hosts-cm       1      70s
configmap/argocd-tls-certs-cm             0      70s
configmap/kube-root-ca.crt                1      2m57s
```

### **4. ê¸°ë³¸ AppProject ì„¤ì • í™•ì¸**

```bash
kubectl get appproject -n argocd -o yaml

apiVersion: v1
items:
- apiVersion: argoproj.io/v1alpha1
  kind: AppProject
  metadata:
    creationTimestamp: "2025-11-08T07:37:33Z"
    generation: 1
    name: default
    namespace: argocd
    resourceVersion: "2364"
    uid: 6410f993-adb8-427a-be8a-c0cf4929212f
  spec:
    clusterResourceWhitelist:
    - group: '*'
      kind: '*'
    destinations:
    - namespace: '*'
      server: '*'
    sourceRepos:
    - '*'
  status: {}
kind: List
metadata:
  resourceVersion: ""
```

- ëª¨ë“  Cluster ë¦¬ì†ŒìŠ¤(`*/*`), ëª¨ë“  ë„¤ì„ìŠ¤í˜ì´ìŠ¤, ëª¨ë“  Git ì €ì¥ì†Œ(`*`)ë¥¼ í—ˆìš©í•˜ëŠ” ê¸°ë³¸ ì •ì±…ì´ ì„¤ì •ëœ ìƒíƒœì„ì„ í™•ì¸í•¨

### **5. ServiceAccount êµ¬ì„± í™•ì¸**

```bash
ubectl get sa -n argocd

NAME                               SECRETS   AGE
argocd-application-controller      0         2m45s
argocd-applicationset-controller   0         2m45s
argocd-dex-server                  0         2m45s
argocd-notifications-controller    0         2m45s
argocd-redis-secret-init           0         3m11s
argocd-repo-server                 0         2m45s
argocd-server                      0         2m45s
default                            0         4m32s
```

### **6. ì´ˆê¸° ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ë° ì›¹ ì½˜ì†” ì ‘ì†**

```bash
kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d ;echo

417jqWCgQRqPJtnT
```

```bash
http://127.0.0.1:30002
admin / 417jqWCgQRqPJtnT
```
![](https://velog.velcdn.com/images/tlsalswls123/post/1be64c03-7e07-48cb-9b4e-da7c24b26b91/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/38e88f9e-2524-40ae-aee1-924885e4e93a/image.png)

### **7. ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ë³€ê²½**

```bash
qwe12345
```
![](https://velog.velcdn.com/images/tlsalswls123/post/cf3e231b-fa53-4014-b7e4-8603a9d18b3d/image.png)

---

## **ğŸš€ ì²« ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰í•˜ê¸°**

### **1. Guestbook Helm ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±**

- [https://github.com/argoproj/argocd-example-apps/tree/master/helm-guestbook](https://github.com/argoproj/argocd-example-apps/tree/master/helm-guestbook)

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: guestbook
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values.yaml
    path: helm-guestbook
    repoURL: https://github.com/argoproj/argocd-example-apps
    targetRevision: HEAD
  syncPolicy:
    automated:
      enabled: true
      prune: true
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: guestbook
    server: https://kubernetes.default.svc
EOF

# ê²°ê³¼
Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/guestbook created
```

### **2. Argo CDì—ì„œ ë™ê¸°í™” ë° ìƒíƒœ í™•ì¸**

```bash
kubectl get applications -n argocd guestbook

NAME        SYNC STATUS   HEALTH STATUS
guestbook   Synced        Healthy
```
![](https://velog.velcdn.com/images/tlsalswls123/post/2fdc714b-0be7-4cb5-8d24-ddbf4d31643c/image.png)

### **3. Guestbook ë°°í¬ ë¦¬ì†ŒìŠ¤ í™•ì¸**

```bash
kubectl get pod,svc,ep -n guestbook

NAME                                            READY   STATUS    RESTARTS   AGE
pod/guestbook-helm-guestbook-6585c766d6-6svkc   1/1     Running   0          85s

NAME                               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
service/guestbook-helm-guestbook   ClusterIP   10.96.200.126   <none>        80/TCP    85s

NAME                                 ENDPOINTS        AGE
endpoints/guestbook-helm-guestbook   10.244.0.17:80   85s
```

- ì„œë¹„ìŠ¤ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `ClusterIP` íƒ€ì…ìœ¼ë¡œ ìƒì„±ë˜ì–´ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•œ ìƒíƒœì„

### **4. NodePort ë³€ê²½ ì‹œë„ ë° Self-Heal ë™ì‘ ê´€ì°°**

```bash
kubectl patch svc -n guestbook guestbook-helm-guestbook -p '{"spec":{"type":"NodePort","ports":[{"port":80,"targetPort":80,"nodePort":30003}]}}'

service/guestbook-helm-guestbook patched
```
- `kubectl patch`ë¥¼ ì‚¬ìš©í•´ Service íƒ€ì…ì„ `NodePort`ë¡œ ë³€ê²½í•˜ê³  `30003` í¬íŠ¸ë¡œ ë…¸ì¶œí•˜ë ¤ê³  ì‹œë„í•¨


![](https://velog.velcdn.com/images/tlsalswls123/post/0dab3656-f50c-4d7b-94b8-aff2a93f4652/image.png)

```bash
kubectl get svc -n guestbook

NAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)   AGE
guestbook-helm-guestbook   ClusterIP   10.96.200.126   <none>        80/TCP    2m47s
```

- í•˜ì§€ë§Œ Argo CD `selfHeal` ê¸°ëŠ¥ìœ¼ë¡œ ì¸í•´ ì›ë³¸ Helm ì •ì˜(`ClusterIP`) ìƒíƒœë¡œ ê³„ì† ë˜ëŒì•„ê°€ëŠ” í˜„ìƒì„ í™•ì¸í•¨

### **5. Self-Heal ë¹„í™œì„±í™” í›„ NodePort ì¬ì„¤ì •**

![](https://velog.velcdn.com/images/tlsalswls123/post/46310283-1d05-4824-8550-e1c1b5afb0ae/image.png)

- Argo CDì—ì„œ í•´ë‹¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ `selfHeal` ì˜µì…˜ì„ ë¹„í™œì„±í™”í•œ ë’¤, ë‹¤ì‹œ `kubectl patch`ë¡œ Serviceë¥¼ `NodePort: 30003`ìœ¼ë¡œ ìˆ˜ì •í•¨

```bash
kubectl patch svc -n guestbook guestbook-helm-guestbook -p '{"spec":{"type":"NodePort","ports":[{"port":80,"targetPort":80,"nodePort":30003}]}}'
service/guestbook-helm-guestbook patched

kubectl get svc -n guestbook
NAME                       TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
guestbook-helm-guestbook   NodePort   10.96.200.126   <none>        80:30003/TCP   7m14s
```
![](https://velog.velcdn.com/images/tlsalswls123/post/53595259-eab2-4c6c-aba1-9261a5bcc098/image.png)

### **6. NodePortë¥¼ í†µí•œ Guestbook ì ‘ì† ê²€ì¦**

```bash
curl http://127.0.0.1:30003

<html ng-app="redis">
  <head>
    <title>Guestbook</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.12/angular.min.js"></script>
    <script src="controllers.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/2.5.6/ui-bootstrap-tpls.js"></script>
  </head>
  <body ng-controller="RedisCtrl">
    <div style="width: 50%; margin-left: 20px">
      <h2>Guestbook</h2>
    <form>
    <fieldset>
    <input ng-model="msg" placeholder="Messages" class="form-control" type="text" name="input"><br>
    <button type="button" class="btn btn-primary" ng-click="controller.onRedis()">Submit</button>
    </fieldset>
    </form>
    <div>
      <div ng-repeat="msg in messages track by $index">
        {{msg}}
      </div>
    </div>
    </div>
  </body>
</html>
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d86d049a-cbbd-41ee-8544-eabc382eac96/image.png)

### **7. ì• í”Œë¦¬ì¼€ì´ì…˜ ì •ë¦¬**

```bash
kubectl delete applications -n argocd guestbook

application.argoproj.io "guestbook" deleted from argocd namespace
```

---

## **ğŸ§° Argo CLI**

### **1. Argo CD CLI ì„¤ì¹˜ ë° ë²„ì „ í™•ì¸**

- [https://argo-cd.readthedocs.io/en/stable/cli_installation/](https://argo-cd.readthedocs.io/en/stable/cli_installation/)

```bash
sudo pacman -S argocd # Arch Linux
```

```bash
argocd version --client

argocd: v3.2.0+unknown
  BuildDate: 2025-11-05T05:15:54Z
  GitCommit: 
  GitTreeState: 
  GitTag: 3.2.0
  GoVersion: go1.25.3 X:nodwarf5
  Compiler: gc
  Platform: linux/amd64
```

### **2. Argo CD ì„œë²„(NodePort) ì„¤ì • í™•ì¸**

```bash
kubectl get svc -n argocd

NAME                               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                      AGE
argocd-applicationset-controller   ClusterIP   10.96.232.145   <none>        7000/TCP                     25m
argocd-dex-server                  ClusterIP   10.96.16.247    <none>        5556/TCP,5557/TCP            25m
argocd-redis                       ClusterIP   10.96.183.36    <none>        6379/TCP                     25m
argocd-repo-server                 ClusterIP   10.96.145.59    <none>        8081/TCP                     25m
argocd-server                      NodePort    10.96.86.67     <none>        80:30080/TCP,443:30002/TCP   25m
```

- `argocd-server` ì„œë¹„ìŠ¤ê°€ `443:30002/TCP` NodePortë¡œ ë…¸ì¶œëœ ìƒíƒœì„ì„ í™•ì¸

### **3. Argo CD CLI ë¡œê·¸ì¸ ë° ì»¨í…ìŠ¤íŠ¸ ì„¤ì •**

```bash
argocd login 127.0.0.1:30002 --plaintext
Username: admin
Password: qwe12345

'admin:login' logged in successfully
Context '127.0.0.1:30002' updated
```

- ë¡œê·¸ì¸ ì„±ê³µ í›„ `127.0.0.1:30002` ì»¨í…ìŠ¤íŠ¸ê°€ ìƒì„±Â·ì ìš©ë˜ì–´ ì´í›„ CLI ëª…ë ¹ì´ í•´ë‹¹ Argo CD ì„œë²„ì™€ ì—°ë™ë˜ë„ë¡ ì„¤ì •í•¨

### **4. ê¸°ë³¸ ê³„ì •/í”„ë¡œì íŠ¸/í´ëŸ¬ìŠ¤í„° ìƒíƒœ ì ê²€**

```bash
argocd account list

NAME   ENABLED  CAPABILITIES
admin  true     login
```

```bash
argocd proj list

NAME     DESCRIPTION  DESTINATIONS  SOURCES  CLUSTER-RESOURCE-WHITELIST  NAMESPACE-RESOURCE-BLACKLIST  SIGNATURE-KEYS  ORPHANED-RESOURCES  DESTINATION-SERVICE-ACCOUNTS
default               *,*           *        */*                         <none>                        <none>          disabled            <none>
```

```bash
argocd repo list

TYPE  NAME  REPO  INSECURE  OCI  LFS  CREDS  STATUS  MESSAGE  PROJECT
```

```bash
argocd cluster list

SERVER                          NAME        VERSION  STATUS      MESSAGE  PROJECT
https://kubernetes.default.svc  in-cluster  1.32     Successful           
```

```bash
argocd app list

NAME  CLUSTER  NAMESPACE  PROJECT  STATUS  HEALTH  SYNCPOLICY  CONDITIONS  REPO  PATH  TARGET
```

### **5. Argo CLIë¡œ Guestbook ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±**

```bash
argocd app create guestbook --repo https://github.com/argoproj/argocd-example-apps.git --path helm-guestbook \
  --dest-server https://kubernetes.default.svc --dest-namespace guestbook --values values.yaml

application 'guestbook' created
```

- ìƒì„± ì§í›„ ì•±ì€ `Manual` Sync ì •ì±…ìœ¼ë¡œ ì„¤ì •ë˜ì–´ `OutOfSync / Missing` ìƒíƒœì¸ ê²ƒ í™•ì¸í•¨

```bash
argocd app list

NAME              CLUSTER                         NAMESPACE  PROJECT  STATUS     HEALTH   SYNCPOLICY  CONDITIONS  REPO                                                 PATH            TARGET
argocd/guestbook  https://kubernetes.default.svc  guestbook  default  OutOfSync  Missing  Manual      <none>      https://github.com/argoproj/argocd-example-apps.git  helm-guestbook  
```

```bash
argocd app get argocd/guestbook

Name:               argocd/guestbook
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          guestbook
URL:                https://argocd.example.com/applications/guestbook
Source:
- Repo:             https://github.com/argoproj/argocd-example-apps.git
  Target:           
  Path:             helm-guestbook
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        OutOfSync from  (0d521c6)
Health Status:      Missing

GROUP  KIND        NAMESPACE  NAME                      STATUS     HEALTH   HOOK  MESSAGE
       Service     guestbook  guestbook-helm-guestbook  OutOfSync  Missing        
apps   Deployment  guestbook  guestbook-helm-guestbook  OutOfSync  Missing        
```
![](https://velog.velcdn.com/images/tlsalswls123/post/6e39493c-0c1f-4931-bde5-05fa462a8933/image.png)

### **6. ìˆ˜ë™ Syncë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë™ê¸°í™”**

```bash
argocd app sync argocd/guestbook

# ê²°ê³¼
TIMESTAMP                  GROUP        KIND   NAMESPACE                  NAME        STATUS    HEALTH        HOOK  MESSAGE
2025-11-08T17:12:28+09:00   apps  Deployment   guestbook  guestbook-helm-guestbook  OutOfSync  Missing              
2025-11-08T17:12:28+09:00            Service   guestbook  guestbook-helm-guestbook  OutOfSync  Missing              
2025-11-08T17:12:28+09:00            Service   guestbook  guestbook-helm-guestbook    Synced  Healthy              
2025-11-08T17:12:28+09:00            Service   guestbook  guestbook-helm-guestbook    Synced   Healthy              service/guestbook-helm-guestbook created
2025-11-08T17:12:28+09:00   apps  Deployment   guestbook  guestbook-helm-guestbook  OutOfSync  Missing              deployment.apps/guestbook-helm-guestbook created

Name:               argocd/guestbook
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          guestbook
URL:                https://argocd.example.com/applications/argocd/guestbook
Source:
- Repo:             https://github.com/argoproj/argocd-example-apps.git
  Target:           
  Path:             helm-guestbook
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to  (0d521c6)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      0d521c6e049889134f3122eb32d7ed342f43ca0d
Phase:              Succeeded
Start:              2025-11-08 17:12:28 +0900 KST
Finished:           2025-11-08 17:12:28 +0900 KST
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND        NAMESPACE  NAME                      STATUS  HEALTH       HOOK  MESSAGE
       Service     guestbook  guestbook-helm-guestbook  Synced  Healthy            service/guestbook-helm-guestbook created
apps   Deployment  guestbook  guestbook-helm-guestbook  Synced  Progressing        deployment.apps/guestbook-helm-guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/31c2c8d1-84a9-4a85-b219-be3b399d49bc/image.png)

```bash
argocd app get argocd/guestbook

# ê²°ê³¼
Name:               argocd/guestbook
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          guestbook
URL:                https://argocd.example.com/applications/guestbook
Source:
- Repo:             https://github.com/argoproj/argocd-example-apps.git
  Target:           
  Path:             helm-guestbook
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Manual
Sync Status:        Synced to  (0d521c6)
Health Status:      Healthy

GROUP  KIND        NAMESPACE  NAME                      STATUS  HEALTH   HOOK  MESSAGE
       Service     guestbook  guestbook-helm-guestbook  Synced  Healthy        service/guestbook-helm-guestbook created
apps   Deployment  guestbook  guestbook-helm-guestbook  Synced  Healthy        deployment.apps/guestbook-helm-guestbook created
```

### **7. Argo CLIë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‚­ì œ**

```bash
argocd app delete argocd/guestbook
Are you sure you want to delete 'argocd/guestbook' and all its resources? [y/n] y

application 'argocd/guestbook' deleted
```

### **8. Argo CD ì œê±° ë° ë‹¤ìŒ ì‹¤ìŠµ ì¤€ë¹„**

```bash
helm uninstall -n argocd argocd && kubectl delete ns argocd

These resources were kept due to the resource policy:
[CustomResourceDefinition] applications.argoproj.io
[CustomResourceDefinition] applicationsets.argoproj.io
[CustomResourceDefinition] appprojects.argoproj.io

release "argocd" uninstalled
namespace "argocd" deleted
```

---

## **ğŸ¤– Argo CD Autopilot**

- [https://argocd-autopilot.readthedocs.io/en/stable/](https://argocd-autopilot.readthedocs.io/en/stable/)
- Argo CD ì„¤ì¹˜ ìë™í™” + GitOps í™˜ê²½ ì´ˆê¸°í™”, ì• í”Œë¦¬ì¼€ì´ì…˜/í´ëŸ¬ìŠ¤í„° ë“± ì„ ì–¸ì  ê´€ë¦¬ ê°€ëŠ¥

### **1. argocd-autopilotÂ CLIÂ ì„¤ì¹˜**

- [https://argocd-autopilot.readthedocs.io/en/stable/Installation-Guide/](https://argocd-autopilot.readthedocs.io/en/stable/Installation-Guide/)

```bash
VERSION=$(curl --silent "https://api.github.com/repos/argoproj-labs/argocd-autopilot/releases/latest" \
  | grep '"tag_name"' | sed -E 's/.*"([^"]+)".*/\1/')
  
curl -L --output - \
  https://github.com/argoproj-labs/argocd-autopilot/releases/download/"$VERSION"/argocd-autopilot-linux-amd64.tar.gz \
  | tar zx
  
chmod +x argocd-autopilot-linux-amd64
sudo mv argocd-autopilot-linux-amd64 /usr/local/bin/argocd-autopilot
```

```bash
argocd-autopilot version
v0.4.20
```

### **2. GitOpsìš© Git ì €ì¥ì†Œ ë° í† í° ì¤€ë¹„**

**(1) ë ˆí¬ì§€í† ë¦¬ ìƒì„±**
![](https://velog.velcdn.com/images/tlsalswls123/post/4eeb55fa-2a29-4006-a3af-2ce8005a2875/image.png)

**(2) Git Personal access tokens ìƒì„±: scope(repo ì²´í¬)**
![](https://velog.velcdn.com/images/tlsalswls123/post/0d5bd29b-2d47-4f1d-aec3-7fdbddac3740/image.png)

**(3) í™˜ê²½ë³€ìˆ˜ ì„¤ì •**

```bash
export GIT_TOKEN=<ìì‹ ì˜ Git Token>
export GIT_REPO=<ìì‹ ì˜ Repo>
```

### **3. Autopilotìœ¼ë¡œ Argo CD ë¶€íŠ¸ìŠ¤íŠ¸ë©**

```bash
argocd-autopilot repo bootstrap

# ê²°ê³¼
INFO cloning repo: https://github.com/Shinminjin/autopilot.git 
INFO empty repository, initializing a new one with specified remote 
WARNING --provider not specified, assuming provider from url: github 
INFO using revision: "", installation path: ""    
INFO using context: "kind-myk8s", namespace: "argocd" 
INFO applying bootstrap manifests to cluster...   
namespace/argocd created
...
INFO pushing bootstrap manifests to repo          
Resolving deltas: 100% (1/1), done.
...
INFO argocd initialized. password: 9h24-XCC55s5NjVU 
INFO run:

    kubectl port-forward -n argocd svc/argocd-server 8080:80
```
![](https://velog.velcdn.com/images/tlsalswls123/post/ec520d88-0a17-465c-b85d-7afafc59b34d/image.png)

### **4. Argo CD ì„¤ì¹˜ ë° ìƒíƒœ í™•ì¸**

```bash
kubectl get pod -n argocd

NAME                                               READY   STATUS    RESTARTS   AGE
argocd-application-controller-0                    1/1     Running   0          5m24s
argocd-applicationset-controller-fc5545556-vg4qn   1/1     Running   0          5m24s
argocd-dex-server-f59c65cff-4jmb5                  1/1     Running   0          5m24s
argocd-notifications-controller-59f6949d7-j7nrl    1/1     Running   0          5m24s
argocd-redis-75c946f559-szrv7                      1/1     Running   0          5m24s
argocd-repo-server-6959c47c44-24h8r                1/1     Running   0          5m24s
argocd-server-65544f4864-mq7nj                     1/1     Running   0          5m24s
```

```bash
kubectl get appprojects.argoproj.io -n argocd

NAME      AGE
default   5m26s
```

```bash
kubectl get applications.argoproj.io -n argocd -owide

NAME                           SYNC STATUS   HEALTH STATUS   REVISION                                   PROJECT
argo-cd                        Synced        Healthy         fa1063a8a26351cca9a96597499652ba2a17fade   default
autopilot-bootstrap            Synced        Healthy         fa1063a8a26351cca9a96597499652ba2a17fade   default
cluster-resources-in-cluster   Synced        Healthy         fa1063a8a26351cca9a96597499652ba2a17fade   default
root                           Synced        Healthy         fa1063a8a26351cca9a96597499652ba2a17fade   default
```

### **5. Argo CD ëŒ€ì‹œë³´ë“œ ì ‘ì† ë° ì´ˆê¸° ê³„ì • í™•ì¸**

**(1) í¬íŠ¸í¬ì›Œë”©**

```bash
kubectl port-forward -n argocd svc/argocd-server 8080:80

Forwarding from 127.0.0.1:8080 -> 8080
Forwarding from [::1]:8080 -> 8080
```

**(2) ì´ˆê¸° íŒ¨ìŠ¤ì›Œë“œ í™•ì¸**

```bash
# ì´ˆê¸° íŒ¨ìŠ¤ì›Œë“œ
kubectl get secret -n argocd argocd-initial-admin-secret -o jsonpath='{.data.password}' | base64 -d ; echo
9h24-XCC55s5NjVU
```

**(3) ëŒ€ì‹œë³´ë“œ ì ‘ì†**

```bash
http://localhost:8080
admin / 9h24-XCC55s5NjVU
```
![](https://velog.velcdn.com/images/tlsalswls123/post/a29b5e9b-67ac-48e5-a271-fa855c88469a/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/c7e11118-9ec0-41a3-8496-139bd043a634/image.png)

```bash
kubectl get applications.argoproj.io -n argocd autopilot-bootstrap -o yaml | kubectl neat | yq

...
    "source": {
      "path": "bootstrap",
      "repoURL": "https://github.com/Shinminjin/autopilot.git"
    },
...
```

### **6. Autopilot ê¸°ë°˜ Project ìƒì„±(dev, prd)**

```bash
argocd-autopilot project create dev

INFO cloning git repository: https://github.com/Shinminjin/autopilot.git 
Enumerating objects: 17, done.
Counting objects: 100% (17/17), done.
Compressing objects: 100% (13/13), done.
Total 17 (delta 1), reused 17 (delta 1), pack-reused 0 (from 0)
INFO using revision: "", installation path: "/"   
INFO pushing new project manifest to repo         
INFO project created: 'dev'
```

```bash
argocd-autopilot project create prd

INFO cloning git repository: https://github.com/Shinminjin/autopilot.git 
Enumerating objects: 18, done.
Counting objects: 100% (18/18), done.
Compressing objects: 100% (15/15), done.
Total 18 (delta 2), reused 17 (delta 1), pack-reused 0 (from 0)
INFO using revision: "", installation path: "/"   
INFO pushing new project manifest to repo         
INFO project created: 'prd'
```

```bash
kubectl get appprojects.argoproj.io -n argocd

NAME      AGE
default   17m
dev       66s
prd       32s
```
![](https://velog.velcdn.com/images/tlsalswls123/post/2c82abac-b41a-40a9-9599-2abf42801023/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/73683b12-bcb6-4ce1-94fb-81faa34c0b23/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/f7e67b69-79c9-456a-817f-0e650399b461/image.png)

### **7. Autopilot ê¸°ë°˜ ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„± ë° ê´€ë¦¬**

```bash
argocd-autopilot app create hello-world1 --app github.com/argoproj-labs/argocd-autopilot/examples/demo-app/ -p dev --type kustomize

INFO cloning git repository: https://github.com/Shinminjin/autopilot.git 
Enumerating objects: 19, done.
Counting objects: 100% (19/19), done.
Compressing objects: 100% (16/16), done.
Total 19 (delta 3), reused 17 (delta 1), pack-reused 0 (from 0)
INFO using revision: "", installation path: "/"   
INFO committing changes to gitops repo...         
INFO installed application: hello-world1
```

```bash
argocd-autopilot app create hello-world2 --app github.com/argoproj-labs/argocd-autopilot/examples/demo-app/ -p prd --type kustomize

INFO cloning git repository: https://github.com/Shinminjin/autopilot.git 
Enumerating objects: 26, done.
Counting objects: 100% (26/26), done.
Compressing objects: 100% (22/22), done.
Total 26 (delta 4), reused 23 (delta 1), pack-reused 0 (from 0)
INFO using revision: "", installation path: "/"   
INFO committing changes to gitops repo...         
INFO installed application: hello-world2          
```
![](https://velog.velcdn.com/images/tlsalswls123/post/38a9d264-628b-490f-8b91-1cdcab1aa14d/image.png)

```bash
argocd-autopilot app delete hello-world2 -p prd

INFO cloning git repository: https://github.com/Shinminjin/autopilot.git 
Enumerating objects: 30, done.
Counting objects: 100% (30/30), done.
Compressing objects: 100% (25/25), done.
Total 30 (delta 5), reused 26 (delta 1), pack-reused 0 (from 0)
INFO using revision: "", installation path: "/"   
INFO committing changes to gitops repo...
```

```bash
kubectl get applications.argoproj.io -n argocd -owide

NAME                           SYNC STATUS   HEALTH STATUS   REVISION                                   PROJECT
argo-cd                        Synced        Healthy         cfef97378a57430ecf89c48954f9c44a5cd1b808   default
autopilot-bootstrap            Synced        Healthy         cfef97378a57430ecf89c48954f9c44a5cd1b808   default
cluster-resources-in-cluster   Synced        Healthy         cfef97378a57430ecf89c48954f9c44a5cd1b808   default
dev-hello-world1               Synced        Healthy         cfef97378a57430ecf89c48954f9c44a5cd1b808   dev
root                           Synced        Healthy         cfef97378a57430ecf89c48954f9c44a5cd1b808   default
```
![](https://velog.velcdn.com/images/tlsalswls123/post/f0083c5d-dbe8-4174-aff5-7dc82ee9c948/image.png)

### **8. GitOps ì†ŒìŠ¤ â†” í´ëŸ¬ìŠ¤í„° ìƒíƒœ ê²€ì¦**

```bash
 kubectl get applications.argoproj.io -n argocd dev-hello-world1 -o yaml | kubectl neat | yq

...
    "source": {
      "path": "apps/hello-world1/overlays/dev",
      "repoURL": "https://github.com/Shinminjin/autopilot.git"
    },
```

- `dev-hello-world1`ì˜ `source.path`ê°€ GitOps ë ˆí¬ì§€í† ë¦¬ì™€ ì •í™•íˆ ì—°ê²°ëœ ê²ƒì„ í™•ì¸

```bash
kubectl get deploy,pod

NAME                                READY   UP-TO-DATE   AVAILABLE   AGE
deployment.apps/simple-deployment   1/1     1            1           4m10s

NAME                                     READY   STATUS    RESTARTS   AGE
pod/simple-deployment-7854dd65f8-bnxn5   1/1     Running   0          4m10s
```

- Gitì— ì •ì˜ëœ ìƒíƒœê°€ Autopilot/Argo CDë¥¼ í†µí•´ í´ëŸ¬ìŠ¤í„°ì— ë°˜ì˜ë˜ê³  ìˆìŒì„ ê²€ì¦

### **9. ë‹¤ìŒ ì‹¤ìŠµì„ ìœ„í•œ ë¦¬ì†ŒìŠ¤ ì •ë¦¬**

```bash
kind delete cluster --name myk8s

Deleting cluster "myk8s" ...
Deleted nodes: ["myk8s-control-plane"]
```

---

## **ğŸ›°ï¸ Argo CD ìš´ì˜**

### **1. ë©€í‹° ë…¸ë“œ kind í´ëŸ¬ìŠ¤í„° êµ¬ì„±**

```bash
kind create cluster --name myk8s --image kindest/node:v1.32.8 --config - <<EOF
kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  extraPortMappings:
  - containerPort: 30000
    hostPort: 30000
  - containerPort: 30001
    hostPort: 30001
  - containerPort: 30002
    hostPort: 30002
  - containerPort: 30003
    hostPort: 30003
- role: worker
- role: worker
- role: worker
EOF
```

```bash
helm install kube-ops-view geek-cookbook/kube-ops-view --version 1.2.2 --set service.main.type=NodePort,service.main.ports.http.nodePort=30001 --set env.TZ="Asia/Seoul" --namespace kube-system
```

### **2. Argo CD ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ê¸°ë°˜ ì¤€ë¹„**

```bash
mkdir -p my-sample-app/resources
cat << EOF > resources/namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: argocd
EOF
kubectl apply -f resources/namespace.yaml

# ê²°ê³¼
namespace/argocd created
```

```bash
wget https://raw.githubusercontent.com/argoproj/argo-cd/refs/heads/master/manifests/ha/install.yaml
mv install.yaml resources/
```

### **3. GitOps ë¦¬í¬ì§€í„°ë¦¬ ì´ˆê¸° ì»¤ë°‹ ë° í‘¸ì‹œ**

```bash
git add . && git commit -m "Deploy Argo CD " && git push -u origin main
```
![](https://velog.velcdn.com/images/tlsalswls123/post/d589b307-6ecd-4abe-9870-33ee1ffc42ee/image.png)
- í´ëŸ¬ìŠ¤í„° ìƒíƒœë¥¼ Git ë¦¬í¬ì§€í„°ë¦¬ì™€ ë§¤í•‘í•˜ì—¬ ì´í›„ Argo CDê°€ ì„ ì–¸í˜•ìœ¼ë¡œ ìì‹ ì„ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ê¸°ë°˜ì„ ë§ˆë ¨í•¨

### **4. Argo CD ì„¤ì¹˜ ë° ì ‘ì† í™•ì¸**

**(1) Argo CD HA êµ¬ì„± ìš”ì†Œë¥¼ í´ëŸ¬ìŠ¤í„°ì— ë°°í¬**

```bash
kubectl apply -f resources/install.yaml -n argocd
```

**(2) í¬íŠ¸í¬ì›Œë”©**

```bash
kubectl port-forward svc/argocd-server -n argocd 8080:80

Forwarding from 127.0.0.1:8080 -> 8080
Forwarding from [::1]:8080 -> 8080
```

**(3) ì´ˆê¸° ë¹„ë°€ë²ˆí˜¸ í™•ì¸**

```bash
kubectl get secret -n argocd argocd-initial-admin-secret -o jsonpath='{.data.password}' | base64 -d ; echo
zz1h2jv08fPsbSKr
```

**(4) UI ì ‘ì†**

```bash
https://127.0.0.1:8080
admin / zz1h2jv08fPsbSKr
```
![](https://velog.velcdn.com/images/tlsalswls123/post/0bbfd5a4-9bc9-455b-a9f1-eb0b18b96905/image.png)

**(5) ì •ìƒ ê¸°ë™ í™•ì¸**

```bash
kubectl get pod -n argocd

NAME                                                READY   STATUS    RESTARTS   AGE
argocd-application-controller-0                     1/1     Running   0          12m
argocd-applicationset-controller-694b4774cd-js5tw   1/1     Running   0          12m
argocd-dex-server-66585dc685-g2ffs                  1/1     Running   0          12m
argocd-notifications-controller-7c584f65cc-vlk56    1/1     Running   0          12m
argocd-redis-ha-haproxy-7487b954d9-hqm74            1/1     Running   0          12m
argocd-redis-ha-haproxy-7487b954d9-l9nxn            1/1     Running   0          12m
argocd-redis-ha-haproxy-7487b954d9-n8rr5            1/1     Running   0          12m
argocd-redis-ha-server-0                            3/3     Running   0          12m
argocd-redis-ha-server-1                            3/3     Running   0          10m
argocd-redis-ha-server-2                            3/3     Running   0          10m
argocd-repo-server-74b54f7cb-42qs6                  1/1     Running   0          12m
argocd-repo-server-74b54f7cb-5sjmh                  1/1     Running   0          12m
argocd-server-8b767f58c-p5v2h                       1/1     Running   0          12m
argocd-server-8b767f58c-wbdfx                       1/1     Running   0          12m
```

### **5. Argo CDì— Git ë¦¬í¬ì§€í„°ë¦¬ ì—°ë™**

![](https://velog.velcdn.com/images/tlsalswls123/post/c67f7735-05ca-4ac5-89e5-19077b3b31ce/image.png)
- Argo CD UIì˜ **Settings â†’ Repositories**ì—ì„œ `my-sample-app` Git ë ˆí¬ì§€í† ë¦¬ ë“±ë¡

### **6. Argo CD ìê¸° ìì‹ ì„ ê´€ë¦¬í•˜ëŠ” Application ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: argocd
  namespace: argocd
spec:
  project: default
  source:
    path: resources
    repoURL: https://github.com/Shinminjin/my-sample-app
    targetRevision: main
  syncPolicy:
    automated: {}
  destination:
    namespace: argocd
    server: https://kubernetes.default.svc
EOF

application.argoproj.io/argocd created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/efeb0b17-2d12-48e4-9139-338368a57aca/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/5bd89b12-32ee-4c93-85f4-a9604c45db4e/image.png)

### **7. Argo CD ë™ê¸°í™” ìƒíƒœ ë° í—¬ìŠ¤ ì²´í¬**

```bash
kubectl get applications.argoproj.io -n argocd -owide

NAME     SYNC STATUS   HEALTH STATUS   REVISION                                   PROJECT
argocd   Synced        Healthy         aa92beaa6920fff4518a10c8e1a5930ab22b9e69   default
```

### **8. PRUNE ë™ì‘ í…ŒìŠ¤íŠ¸**

**(1) PRUNE RESOURCES í™œì„±í™”**
![](https://velog.velcdn.com/images/tlsalswls123/post/671f8bf7-35f8-481a-8d98-a5e65856b0e3/image.png)

**(2) Networkpolicy í™•ì¸**

```bash
kubectl get networkpolicies.networking.k8s.io -n argocd

NAME                                              POD-SELECTOR                                              AGE
argocd-application-controller-network-policy      app.kubernetes.io/name=argocd-application-controller      35m
argocd-applicationset-controller-network-policy   app.kubernetes.io/name=argocd-applicationset-controller   35m
argocd-dex-server-network-policy                  app.kubernetes.io/name=argocd-dex-server                  35m
argocd-notifications-controller-network-policy    app.kubernetes.io/name=argocd-notifications-controller    35m
argocd-redis-ha-proxy-network-policy              app.kubernetes.io/name=argocd-redis-ha-haproxy            35m
argocd-redis-ha-server-network-policy             app.kubernetes.io/name=argocd-redis-ha                    35m
argocd-repo-server-network-policy                 app.kubernetes.io/name=argocd-repo-server                 35m
argocd-server-network-policy                      app.kubernetes.io/name=argocd-server                      35m

```

**(3) NetworkPolicy ì •ì˜ ì‚­ì œ**
![](https://velog.velcdn.com/images/tlsalswls123/post/0dda2461-905b-482c-9b8c-7f67126bcd70/image.png)

**(4) ì›ê²© ë ˆí¬ì§€í† ë¦¬ì— ì»¤ë°‹ í›„, í‘¸ì‹œ**

```bash
cd ..
git add . && git commit -m "Delete Network Policy Resource" && git push -u origin main
```

**(5) Argo CDê°€ Git ë³€ê²½ì‚¬í•­ì„ ê°ì§€í•˜ê³  Sync + Prune ìˆ˜í–‰**

```bash
watch -d kubectl get networkpolicies.networking.k8s.io -n argocd
```
![](https://velog.velcdn.com/images/tlsalswls123/post/433ea7cf-0f42-4bd2-9904-7fcef112e82f/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/2d2bbca3-b87f-420a-9d48-5f5034befc7c/image.png)

---

## **ğŸ“ˆ ê´€ì°° ê°€ëŠ¥ì„± ì‹¤ìŠµ**

### **1. kube-prometheus-stack Helm ë¦¬í¬ì§€í† ë¦¬ ë“±ë¡**

```bash
cd ..
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
```

### **2. ëª¨ë‹ˆí„°ë§ ì„¤ì • ê°’ íŒŒì¼ ì •ì˜**

```bash
cat <<EOT > monitor-values.yaml
prometheus:
  prometheusSpec:
    scrapeInterval: "15s"
    evaluationInterval: "15s"
  service:
    type: NodePort
    nodePort: 30002

grafana:
  defaultDashboardsTimezone: Asia/Seoul
  adminPassword: prom-operator
  service:
    type: NodePort
    nodePort: 30003

alertmanager:
  enabled: false
defaultRules:
  create: false
prometheus-windows-exporter:
  prometheus:
    monitor:
      enabled: false
EOT
```

### **3. kube-prometheus-stack ë°°í¬**

```bash
helm install kube-prometheus-stack prometheus-community/kube-prometheus-stack --version 75.15.1 \
-f monitor-values.yaml --create-namespace --namespace monitoring
```

### **4. ëª¨ë‹ˆí„°ë§ ì»´í¬ë„ŒíŠ¸ ìƒíƒœ ë° ë¦¬ì†ŒìŠ¤ í™•ì¸**

```bash
helm list -n monitoring

NAME                 	NAMESPACE 	REVISION	UPDATED                                	STATUS  	CHART                        	APP VERSION
kube-prometheus-stack	monitoring	1       	2025-11-08 23:34:24.378026088 +0900 KST	deployed	kube-prometheus-stack-75.15.1	v0.83.0    
```

```bash
kubectl get pod,svc,ingress,pvc -n monitoring

NAME                                                            READY   STATUS    RESTARTS   AGE
pod/kube-prometheus-stack-grafana-7d9c86798d-jbl4m              3/3     Running   0          91s
pod/kube-prometheus-stack-kube-state-metrics-684f8c7558-zlkwq   1/1     Running   0          91s
pod/kube-prometheus-stack-operator-68589744f5-gfs2t             1/1     Running   0          91s
pod/kube-prometheus-stack-prometheus-node-exporter-2dgwz        1/1     Running   0          91s
pod/kube-prometheus-stack-prometheus-node-exporter-fqh48        1/1     Running   0          91s
pod/kube-prometheus-stack-prometheus-node-exporter-k78rw        1/1     Running   0          91s
pod/kube-prometheus-stack-prometheus-node-exporter-nvn2r        1/1     Running   0          91s
pod/prometheus-kube-prometheus-stack-prometheus-0               2/2     Running   0          81s

NAME                                                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)                         AGE
service/kube-prometheus-stack-grafana                    NodePort    10.96.195.107   <none>        80:30003/TCP                    91s
service/kube-prometheus-stack-kube-state-metrics         ClusterIP   10.96.168.95    <none>        8080/TCP                        91s
service/kube-prometheus-stack-operator                   ClusterIP   10.96.71.163    <none>        443/TCP                         91s
service/kube-prometheus-stack-prometheus                 NodePort    10.96.237.122   <none>        9090:30002/TCP,8080:30649/TCP   91s
service/kube-prometheus-stack-prometheus-node-exporter   ClusterIP   10.96.93.44     <none>        9100/TCP                        91s
service/prometheus-operated                              ClusterIP   None            <none>        9090/TCP                        81s
```

```bash
kubectl get prometheus,servicemonitors -n monitoring

NAME                                                                VERSION   DESIRED   READY   RECONCILED   AVAILABLE   AGE
prometheus.monitoring.coreos.com/kube-prometheus-stack-prometheus   v3.5.0    1         1       True         True        116s

NAME                                                                                  AGE
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-apiserver                  116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-coredns                    116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-grafana                    116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-kube-controller-manager    116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-kube-etcd                  116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-kube-proxy                 116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-kube-scheduler             116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-kube-state-metrics         116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-kubelet                    116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-operator                   116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-prometheus                 116s
servicemonitor.monitoring.coreos.com/kube-prometheus-stack-prometheus-node-exporter   116s
```

### **5. Prometheus CRD ë° ì˜¤í¼ë ˆì´í„° ì—°ë™ í™•ì¸**

```bash
kubectl get crd | grep monitoring

alertmanagerconfigs.monitoring.coreos.com   2025-11-08T14:34:22Z
alertmanagers.monitoring.coreos.com         2025-11-08T14:34:22Z
podmonitors.monitoring.coreos.com           2025-11-08T14:34:22Z
probes.monitoring.coreos.com                2025-11-08T14:34:22Z
prometheusagents.monitoring.coreos.com      2025-11-08T14:34:23Z
prometheuses.monitoring.coreos.com          2025-11-08T14:34:23Z
prometheusrules.monitoring.coreos.com       2025-11-08T14:34:23Z
scrapeconfigs.monitoring.coreos.com         2025-11-08T14:34:23Z
servicemonitors.monitoring.coreos.com       2025-11-08T14:34:23Z
thanosrulers.monitoring.coreos.com          2025-11-08T14:34:23Z
```

### **6. Prometheus ì¸ìŠ¤í„´ìŠ¤ ì„¤ì • ë° ë²„ì „ ê²€ì¦**

```bash
kubectl exec -it sts/prometheus-kube-prometheus-stack-prometheus -n monitoring -c prometheus -- prometheus --version

# ê²°ê³¼
prometheus, version 3.5.0 (branch: HEAD, revision: 8be3a9560fbdd18a94dedec4b747c35178177202)
  build user:       root@4451b64cb451
  build date:       20250714-16:15:23
  go version:       go1.24.5
  platform:         linux/amd64
  tags:             netgo,builtinassets
```

### **7. ServiceMonitor ë¼ë²¨ ë§¤ì¹­ í™•ì¸**

```bash
kubectl get prometheuses.monitoring.coreos.com -n monitoring -o yaml | kubectl neat | yq

...
        "podMonitorSelector": {
          "matchLabels": {
            "release": "kube-prometheus-stack"
          }
        },
        "portName": "http-web",
        "probeSelector": {
          "matchLabels": {
            "release": "kube-prometheus-stack"
          }
        },
        "replicas": 1,
        "retention": "10d",
        "routePrefix": "/",
        "ruleSelector": {
          "matchLabels": {
            "release": "kube-prometheus-stack"
          }
        },
        "scrapeConfigSelector": {
          "matchLabels": {
            "release": "kube-prometheus-stack"
          }
        },
...
```

```bash
kubectl get servicemonitors.monitoring.coreos.com -n monitoring kube-prometheus-stack-apiserver -o yaml | grep labels: -A10
  
# ê²°ê³¼  
  labels:
    app: kube-prometheus-stack-apiserver
    app.kubernetes.io/instance: kube-prometheus-stack
    app.kubernetes.io/managed-by: Helm
    app.kubernetes.io/part-of: kube-prometheus-stack
    app.kubernetes.io/version: 75.15.1
    chart: kube-prometheus-stack-75.15.1
    heritage: Helm
    release: kube-prometheus-stack
  name: kube-prometheus-stack-apiserver
  namespace: monitoring
```

- `release: kube-prometheus-stack` ë“± ê³µí†µ ë¼ë²¨ì´ ì„¤ì •ë˜ì–´ ìˆê³ , Prometheus ë¦¬ì†ŒìŠ¤ì˜ Selectorì™€ ì¼ì¹˜í•¨

---

## **ğŸ“¡ Argo CD êµ¬ì„±ìš”ì†Œì— ëŒ€í•œ ServiceMonitor ìƒì„±**

### **1. í…ŒìŠ¤íŠ¸ìš© NGINX íŒŒë“œ ê¸°ë™**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: nginx
  labels:
    app: nginx
spec:
  containers:
  - name: nginx
    image: nginx:alpine
    ports:
    - containerPort: 80
EOF

pod/nginx created
```

### **2. Argo CD Metrics ì„œë¹„ìŠ¤ í™•ì¸**

```bash
kubectl get svc,ep -n argocd -l app.kubernetes.io/name=argocd-metrics

NAME                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
service/argocd-metrics   ClusterIP   10.96.243.251   <none>        8082/TCP   58m

NAME                       ENDPOINTS         AGE
endpoints/argocd-metrics   10.244.1.5:8082   58m
```

```bash
kubectl get svc -n argocd argocd-metrics -o yaml | kubectl neat | yq

{
  "apiVersion": "v1",
  "kind": "Service",
  "metadata": {
    "annotations": {
      "argocd.argoproj.io/tracking-id": "argocd:/Service:argocd/argocd-metrics"
    },
    "labels": {
      "app.kubernetes.io/component": "metrics",
      "app.kubernetes.io/name": "argocd-metrics",
      "app.kubernetes.io/part-of": "argocd"
    },
    "name": "argocd-metrics",
    "namespace": "argocd"
  },
  "spec": {
    "clusterIP": "10.96.243.251",
    "clusterIPs": [
      "10.96.243.251"
    ],
    "ipFamilies": [
      "IPv4"
    ],
    "ipFamilyPolicy": "SingleStack",
    "ports": [
      {
        "name": "metrics",
        "port": 8082
      }
    ],
    "selector": {
      "app.kubernetes.io/name": "argocd-application-controller"
    }
  }
}
```

```bash
kubectl get pod -n argocd -l app.kubernetes.io/name=argocd-application-controller

NAME                              READY   STATUS    RESTARTS   AGE
argocd-application-controller-0   1/1     Running   0          59m
```

### **3. Argo CD Application Controllerìš© ServiceMonitor ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-metrics
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-metrics
  endpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - argocd
EOF

servicemonitor.monitoring.coreos.com/argocd-metrics created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/2330f977-1dc3-4fa1-ade8-06af9aabb834/image.png)

### **4. Argo CD ì£¼ìš” ì»´í¬ë„ŒíŠ¸ë³„ ServiceMonitor ì¶”ê°€**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-server-metrics
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-server-metrics
  endpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - argocd
EOF

servicemonitor.monitoring.coreos.com/argocd-server-metrics created
```

```bash
cat <<EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-repo-server-metrics
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-repo-server
  endpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - argocd
EOF

servicemonitor.monitoring.coreos.com/argocd-repo-server-metrics created
```

```bash
cat <<EOF | kubectl apply -f -
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-applicationset-controller-metrics
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-applicationset-controller
  endpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - argocd
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-dex-server
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-dex-server
  endpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - argocd
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-redis-haproxy-metrics
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-redis-ha-haproxy
  endpoints:
    - port: http-exporter-port
  namespaceSelector:
    matchNames:
      - argocd
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: argocd-notifications-controller
  namespace: monitoring
  labels:
    release: kube-prometheus-stack
spec:
  selector:
    matchLabels:
      app.kubernetes.io/name: argocd-notifications-controller-metrics
  endpoints:
    - port: metrics
  namespaceSelector:
    matchNames:
      - argocd
EOF

servicemonitor.monitoring.coreos.com/argocd-applicationset-controller-metrics created
servicemonitor.monitoring.coreos.com/argocd-dex-server created
servicemonitor.monitoring.coreos.com/argocd-redis-haproxy-metrics created
servicemonitor.monitoring.coreos.com/argocd-notifications-controller created
```

### **5. ServiceMonitor ë“±ë¡ ê²°ê³¼ ë° ìŠ¤í¬ë© ëŒ€ìƒ í™•ì¸**

```bash
kubectl get servicemonitors -n monitoring | grep argocd

argocd-applicationset-controller-metrics         19s
argocd-dex-server                                19s
argocd-metrics                                   4m42s
argocd-notifications-controller                  19s
argocd-redis-haproxy-metrics                     19s
argocd-repo-server-metrics                       46s
argocd-server-metrics                            75s
```
![](https://velog.velcdn.com/images/tlsalswls123/post/c198c64d-eba5-4dc7-a426-881d144105f4/image.png)

### **6. Grafanaì—ì„œ Argo CD ëŒ€ì‹œë³´ë“œ êµ¬ì„±**

```bash
http://127.0.0.1:30003
admin / prom-operator

# ëŒ€ì‹œë³´ë“œ Import
https://github.com/argoproj/argo-cd/blob/master/examples/dashboard.json
```
![](https://velog.velcdn.com/images/tlsalswls123/post/0f5a2ce6-e021-44bb-94ca-c5e59d2fa6c2/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/b4cdd557-6ab7-4d43-b9b3-f599cc58e05b/image.png)

### **7. Guestbook ì• í”Œë¦¬ì¼€ì´ì…˜ ìƒì„±**

```bash
cat <<EOF | kubectl apply -f -
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: guestbook
  namespace: argocd
  finalizers:
  - resources-finalizer.argocd.argoproj.io
spec:
  project: default
  source:
    helm:
      valueFiles:
      - values.yaml
    path: helm-guestbook
    repoURL: https://github.com/argoproj/argocd-example-apps
    targetRevision: HEAD
  syncPolicy:
    automated:
      enabled: true
      prune: true
      selfHeal: true
    syncOptions:
    - CreateNamespace=true
  destination:
    namespace: guestbook
    server: https://kubernetes.default.svc
EOF

Warning: metadata.finalizers: "resources-finalizer.argocd.argoproj.io": prefer a domain-qualified finalizer name including a path (/) to avoid accidental conflicts with other finalizer writers
application.argoproj.io/guestbook created
```
![](https://velog.velcdn.com/images/tlsalswls123/post/458bf4b1-2e19-4407-963a-02ca4e3986ff/image.png)
![](https://velog.velcdn.com/images/tlsalswls123/post/202c37d7-7233-4f9e-a762-ef5d6d515ee1/image.png)

